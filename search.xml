<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>win10çš„typoraé…ç½®giteeäº‘å›¾åºŠ</title>
    <url>/posts/fd71e1c8/</url>
    <content><![CDATA[<h1>ç›¸å…³å‡†å¤‡å‡†å¤‡</h1>
<ul>
<li><a href="https://www.typora.io/">Typora</a></li>
<li><a href="https://github.com/Molunerfinn/PicGo/releases">PicGo</a></li>
<li>gitee/githubè´¦å·</li>
</ul>
<h1>gitee/githubç›¸å…³é…ç½®</h1>
<ol>
<li>
<p>æ–°å»ºä»“åº“ï¼ˆ<strong>ä¸€å®šè¦æ˜¯å…¬å¼€çš„ï¼Œä¸ç„¶mdåˆ°æ—¶å€™æ— æ³•è®¿é—®</strong>ï¼‰</p>
</li>
<li>
<p>ç”ŸæˆToken ï¼Œ<strong>ä¿å­˜Token</strong></p>
<p>åœ¨è‡ªå·²çš„ç”¨æˆ·ä¸­å¿ƒç”Ÿæˆç§äººä»¤ç‰Œ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224175635.png" alt="image-20210224175635044"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224175714.png" alt="image-20210224175714200"></p>
</li>
</ol>
<h1>PicGOç›¸å…³é…ç½®</h1>
<h2 id="GitHubè®¾ç½®">GitHubè®¾ç½®</h2>
<p><a href="https://blog.csdn.net/yefcion/article/details/88412025">åŸæ–‡åœ°å€</a></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224180016.png" alt="image-20210224180016463"></p>
<ul>
<li>ä»“åº“å å³ä½ çš„ä»“åº“å</li>
<li>åˆ†æ”¯å é»˜è®¤ <code>master</code></li>
<li>Token å°±æ˜¯åˆšåˆšå¤åˆ¶çš„é‚£ä¸€ä¸²å­—ç¬¦</li>
<li>å­˜å‚¨è·¯å¾„ è¿™ä¸ªå¯ä»¥å¡«ä¹Ÿå¯ä»¥ä¸å¡«ï¼Œå¡«äº†çš„è¯å›¾ç‰‡å°±ä¸Šä¼ åˆ° git ä¸­ <code>data</code> è¿™ä¸ªæ–‡ä»¶å¤¹</li>
<li>åŸŸå <code>https://raw.githubusercontent.com/yefcion/cloudimg/master</code>è¿™ä¸ªè¦æ”¹ä¸€ä¸‹ æ ¼å¼ <code>https://raw.githubusercontent.com/[username]/[ä»“åº“å]/master</code></li>
</ul>
<h2 id="Giteeè®¾ç½®">Giteeè®¾ç½®</h2>
<ol>
<li>
<p>ä¸‹è½½æ’ä»¶gitee-uploader</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224180247.png" alt="image-20210224180247392"></p>
</li>
<li>
<p>è®¾ç½®Giteeå¹¶è®¾ç½®ä¸ºé»˜è®¤å›¾åºŠï¼ˆGithubæ˜¯å¤–ç½‘ï¼Œå¯èƒ½ä¼šæ…¢ï¼Œæ•…é€‰æ‹©giteeä¸ºé»˜è®¤ï¼‰</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224195106.png" alt="image-20210224195106781"></p>
</li>
</ol>
<h2 id="PicGOè®¾ç½®">PicGOè®¾ç½®</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224195211.png" alt="image-20210224195211867"></p>
<h2 id="Typoraè®¾ç½®">Typoraè®¾ç½®</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224195433.png" alt="image-20210224195433511"></p>
]]></content>
      <categories>
        <category>Typora</category>
        <category>Gitee</category>
        <category>Github</category>
      </categories>
      <tags>
        <tag>Typora</tag>
        <tag>Gitee</tag>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>win10çš„æ­å»ºhexoåšå®¢</title>
    <url>/posts/1bab7c20/</url>
    <content><![CDATA[<h1>ç¯å¢ƒé…ç½®</h1>
<p><strong>å®‰è£…å‰å‡†å¤‡</strong></p>
<ul>
<li>git</li>
<li>Nodejs</li>
</ul>
<h1>Hexoå®‰è£…</h1>
<ol>
<li>
<p>é¦–å…ˆé…ç½®npmçš„<strong>æ·˜å®æº</strong>,å®‰è£…å®Œæˆåå¯é€šè¿‡npm info hexoæŸ¥çœ‹æ˜¯å¦é…ç½®æ·˜å®æºæˆåŠŸ</p>
 <figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®‰è£…hexo</p>
 <figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‡å®šå®‰è£…çš„hexoç›®å½•</p>
 <figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">hexo init test</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> test     </span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</p>
 <figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">hexo clean      #æ¸…é™¤ç¼“å­˜</span><br><span class="line">hexo g      #ç”Ÿæˆé™æ€ç½‘é¡µ</span><br><span class="line">hexo s      #å¯åŠ¨æœ¬åœ°æœåŠ¡</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224200606.png" alt="image-20210224200605821"></p>
</li>
</ol>
<h1>Gtihubç›¸å…³é…ç½®</h1>
<p>New repositoryåˆ›å»ºæ–°ä»“åº“ï¼Œä»“åº“ååº”è¯¥ä¸ºï¼š<strong>ç”¨æˆ·å</strong>.<a href="https://link.zhihu.com/?target=http%3A//github.io">http://github.io</a> è¿™ä¸ª<strong>ç”¨æˆ·å</strong>ä½¿ç”¨ä½ çš„GitHubå¸å·åç§°ä»£æ›¿ï¼Œè¿™æ˜¯å›ºå®šå†™æ³•ï¼Œæ¯”å¦‚æˆ‘çš„ä»“åº“åä¸ºï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224200752.png" alt="image-20210224200752872"></p>
<h1>hexoé…ç½®è¿œç¨‹éƒ¨ç½²</h1>
<p>ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„**_config.yml** æ–‡ä»¶ä¸­é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/CNRF/CNRF.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ç›¸å…³å‘½ä»¤è¿›è¡Œéƒ¨ç½²</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo d  # ç¬¬ä¸€æ¬¡éƒ¨ç½²ä¼šæç¤ºè¾“å…¥githubçš„è´¦å·å’Œå¯†ç </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoéƒ¨ç½²ç¬¬ä¸‰æ–¹ä¸»é¢˜next 7.8ç‰ˆæœ¬</title>
    <url>/posts/d23fb963/</url>
    <content><![CDATA[<h1>next 7.8 ä¸»é¢˜å®‰è£…</h1>
<p><a href="https://github.com/theme-next/hexo-theme-next/archive/v7.8.0.zip">7.8.0ç‰ˆæœ¬ä¸‹è½½è¿æ¥</a></p>
<ol>
<li>
<p>å°†ä¸‹è½½å¥½çš„ä¸»é¢˜æ–‡ä»¶è§£å‹åˆ°hexoä¸»ç›®å½•ä¸‹çš„themesæ–‡ä»¶å¤¹ä¸‹</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224204119.png" alt="image-20210224204118992"></p>
</li>
<li>
<p>åœ¨ä¸»ç›®å½•çš„sourceä¸‹æ–°å»º**_data<strong>ç›®å½•ï¼Œå°†</strong>ç¬¬ä¸‰æ–¹ä¸»é¢˜<strong>ä¸­çš„</strong>_config.yml<strong>æ–‡ä»¶å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸‹é‡å‘½åä¸ºnext.yml,å¹¶ä¿®æ”¹æ–‡ä»¶ä¸­</strong>overrideä¸ºtrue**</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224203110.png" alt="image-20210224203110673"></p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">override:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¿®æ”¹ä¸»ç›®å½•çš„**_config.yml**æ–‡ä»¶ï¼Œå¯ç”¨ä¸»é¢˜</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224203236.png" alt="image-20210224203236580"></p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç”Ÿæˆnextä¸»é¢˜å¼€å¯çš„ç•Œé¢</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224203417.png" alt=""></p>
 <figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">hexo new page home</span><br><span class="line">hexo new page archives</span><br><span class="line">hexo new page about</span><br><span class="line">hexo new page tags</span><br><span class="line">hexo new page categories</span><br><span class="line">hexo new page commonweal</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>Hexo</category>
        <category>Next</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®å¤ç‚¹å‡»ç›®å½•æ— æ³•è·³è½¬</title>
    <url>/posts/14f8dec7/</url>
    <content><![CDATA[<p>åœ¨ themes/next/source/js/util.js ä¸­å¢åŠ ä¸¤è¡Œä»£ç ï¼Œåˆ é™¤ä¸¤è¡Œä»£ç ã€‚ä¿å­˜ï¼Œhexo clean &amp; hexo g &amp; hexo s å³å¯è§£å†³ã€‚ï¼ˆå¦‚æœè¿˜æ˜¯ä¸è¡Œå°±åˆ é™¤æµè§ˆå™¨ç¼“å­˜é‡è¯•ï¼‰</p>
<p><a href="https://github.com/theme-next/hexo-theme-next/pull/1540/files">ä¸­æ–‡ç›®å½•å±‚çº§æ— æ³•è·³è½¬</a></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210225115114.png" alt="image-20210225115114883"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">registerSidebarTOC: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> navItems = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.post-toc li&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> sections = [...navItems].map(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> link = element.querySelector(<span class="string">&#x27;a.nav-link&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> target = <span class="built_in">document</span>.getElementById(<span class="built_in">decodeURI</span>(link.getAttribute(<span class="string">&#x27;href&#x27;</span>)).replace(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>));</span><br><span class="line">    <span class="comment">// TOC item animation navigate.</span></span><br><span class="line">    link.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">      event.preventDefault();</span><br><span class="line">      <span class="comment">// var target = document.getElementById(event.currentTarget.getAttribute(&#x27;href&#x27;).replace(&#x27;#&#x27;, &#x27;&#x27;));</span></span><br><span class="line">      <span class="keyword">var</span> offset = target.getBoundingClientRect().top + <span class="built_in">window</span>.scrollY;</span><br><span class="line">      <span class="built_in">window</span>.anime(&#123;</span><br><span class="line">        targets  : <span class="built_in">document</span>.scrollingElement,</span><br><span class="line">        duration : <span class="number">500</span>,</span><br><span class="line">        easing   : <span class="string">&#x27;linear&#x27;</span>,</span><br><span class="line">        scrollTop: offset + <span class="number">10</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">    <span class="comment">// return document.getElementById(link.getAttribute(&#x27;href&#x27;).replace(&#x27;#&#x27;, &#x27;&#x27;));</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
        <category>Next</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>win10æ·»åŠ æ–°å»ºæ–‡ä»¶mdæ–¹å¼ä»¥åŠè®¾ç½®mdæ¨¡ç‰ˆ</title>
    <url>/posts/558e0cc4/</url>
    <content><![CDATA[<p><em><strong>åŠ¡å¿…å…ˆåˆ›å»ºç³»ç»Ÿè¿˜åŸç‚¹æˆ–è€…å¤‡ä»½æ³¨å†Œè¡¨</strong></em></p>
<h1>æ·»åŠ æ–°å»ºæ–¹å¼æ­¥éª¤</h1>
<p>æ–°å»º<code>temp.txt</code>è¾“å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\.md]</span><br><span class="line">@&#x3D;&quot;.md&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\.md\ShellNew]</span><br><span class="line">&quot;NullFile&quot;&#x3D;&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>æŠŠ<code>temp.txt</code>æ”¹åä¸º<code>temp.reg</code></p>
</li>
<li>
<p>åŒå‡»è¿è¡Œï¼Œå°±okäº†ï¼Œæœ‰é—®é¢˜è®°å¾—å…ˆé‡å¯ï¼Œå¦‚æœä¸è¡Œï¼Œå°±é‡‡ç”¨ä¸‹é¢è¿™ä¸ª</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\.md]</span><br><span class="line">@&#x3D;&quot;typora.md&quot;</span><br><span class="line">&quot;icon&quot;&#x3D;&quot;E:\\Typora\\bin\\typora.exe&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\.md\OpenWithProgids]</span><br><span class="line">&quot;Typora.md&quot;&#x3D;&quot;&quot;</span><br><span class="line">&quot;VSCode.md&quot;&#x3D;&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\.md\ShellNew]</span><br><span class="line">&quot;NullFile&quot;&#x3D;&quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>é…ç½®mdæ–‡ä»¶æ¨¡ç‰ˆ</h1>
<p>1ã€ä½¿ç”¨<code>notepad++</code>æ–°å»º<code>æ–°å»º Markdown.md</code>æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: </span><br><span class="line">date: </span><br><span class="line">tags: []</span><br><span class="line">categories:</span><br><span class="line">- []</span><br><span class="line">- []</span><br><span class="line">description: </span><br><span class="line">updated: </span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>å°†æ–‡ä»¶ç§»åŠ¨åˆ°ä¸ä¼š<strong>è½»æ˜“åˆ é™¤çš„æ–‡ä»¶å¤¹</strong></p>
<p>æ‰“å¼€æ³¨å†Œè¡¨ï¼ŒæŒ‰å¦‚ä¸‹(æ²¡æœ‰å°±åˆ›å»º)</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226105517.png" alt="image-20210226105516945"></p>
]]></content>
      <categories>
        <category>Typora</category>
        <category>Win10</category>
      </categories>
      <tags>
        <tag>Typora</tag>
        <tag>Win10</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo+NexTåšå®¢å½’æ¡£/æ ‡ç­¾/åˆ†ç±»é¡µç¾åŒ–</title>
    <url>/posts/be9758cd/</url>
    <content><![CDATA[<p>NexTè‡ªå¸¦çš„<code>å½’æ¡£</code>ã€<code>æ ‡ç­¾</code>ã€<code>åˆ†ç±»</code>é¡µçš„æ ·å¼æ¯”è¾ƒå•ä¸€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ·å¼æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›<code>css</code>é…ç½®æ¥å°†æˆ‘ä»¬æƒ³è¦çš„æ ·å¼æ·»åŠ åˆ°è¿™äº›é¡µé¢ä¸­ï¼Œæœ¬æ–‡å°±æ¥ä»‹ç»å¦‚ä½•æ·»åŠ æˆ–ä¿®æ”¹è¿™äº›é¡µé¢çš„æ ·å¼ã€‚</p>
<h1>å½©è‰²æ ‡ç­¾é¡µ</h1>
<ol>
<li>åœ¨ /themes/next/layout/ ç›®å½•ä¸‹ï¼Œæ–°å¢ tag-color.swig æ–‡ä»¶ï¼Œå¡«å…¥å¦‚ä¸‹å†…å®¹:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">     var alltags &#x3D; document.getElementsByClassName(&#39;tag-cloud-tags&#39;);</span><br><span class="line">     var tags &#x3D; alltags[0].getElementsByTagName(&#39;a&#39;);</span><br><span class="line">     for (var i &#x3D; tags.length - 1; i &gt;&#x3D; 0; i--) &#123;</span><br><span class="line">       var r&#x3D;Math.floor(Math.random()*75+130);</span><br><span class="line">       var g&#x3D;Math.floor(Math.random()*75+100);</span><br><span class="line">       var b&#x3D;Math.floor(Math.random()*75+80);</span><br><span class="line">       tags[i].style.background &#x3D; &quot;rgb(&quot;+r+&quot;,&quot;+g+&quot;,&quot;+b+&quot;)&quot;;</span><br><span class="line">     &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .tag-cloud-tags&#123;</span><br><span class="line">    &#x2F;*font-family: Helvetica, Tahoma, Arial;*&#x2F;</span><br><span class="line">    &#x2F;*font-weight: 100;*&#x2F;</span><br><span class="line">    text-align: center;</span><br><span class="line">    counter-reset: tags;</span><br><span class="line">  &#125;</span><br><span class="line">  .tag-cloud-tags a&#123;</span><br><span class="line">    border-radius: 6px;</span><br><span class="line">    padding-right: 5px;</span><br><span class="line">    padding-left: 5px;</span><br><span class="line">    margin: 8px 5px 0px 0px;</span><br><span class="line">  &#125;</span><br><span class="line">  .tag-cloud-tags a:before&#123;</span><br><span class="line">    content: &quot;ğŸ”–&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .tag-cloud-tags a:hover&#123;</span><br><span class="line">     box-shadow: 0px 5px 15px 0px rgba(0,0,0,.4);</span><br><span class="line">     transform: scale(1.1);</span><br><span class="line">     &#x2F;*box-shadow: 10px 10px 15px 2px rgba(0,0,0,.12), 0 0 6px 0 rgba(104, 104, 105, 0.1);*&#x2F;</span><br><span class="line">     transition-duration: 0.15s;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åœ¨åŒçº§ç›®å½•çš„ page.swig ä¸­å¼•å…¥ tag-color.swig</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;tag-cloud&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- ç›®å‰å…±è®¡xxxä¸ªæ ‡ç­¾</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;tag-cloud-title&quot;</span>&gt;</span><br><span class="line">            &#123;&#123; _p(<span class="string">&#x27;counter.tag_cloud&#x27;</span>, site.tags.length) &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        --&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;tag-cloud-tags&quot;</span>&gt;</span><br><span class="line">          &#123;&#123; tagcloud(&#123;<span class="attr">min_font</span>: <span class="number">10</span>, <span class="attr">max_font</span>: <span class="number">15</span>, <span class="attr">amount</span>: <span class="number">300</span>, <span class="attr">color</span>: <span class="literal">true</span>, <span class="attr">start_color</span>: <span class="string">&#x27;#ccc&#x27;</span>, <span class="attr">end_color</span>: <span class="string">&#x27;#111&#x27;</span>&#125;) &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">+     &#123;% include <span class="string">&#x27;tag-color.swig&#x27;</span> %&#125;</span><br><span class="line">    </span><br><span class="line">    &#123;% elif page.type === <span class="string">&#x27;categories&#x27;</span> %&#125;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;category-all-page&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;category-all-title&quot;</span>&gt;</span><br><span class="line">            &#123;&#123; _p(<span class="string">&#x27;counter.categories&#x27;</span>, site.categories.length) &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;category-all&quot;</span>&gt;</span><br><span class="line">          &#123;&#123; list_categories() &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä»¥ä¸‹æ˜¯æ–‡ç« åº•éƒ¨çš„æ ‡ç­¾æ ·å¼ï¼ˆä»£ç æ‹·å…¥ /themes/next/source/css/_schemes/(è‡ªå·±é€‰æ‹©çš„ä¸»é¢˜)/index.styl å³å¯ï¼‰ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*æ–‡ç« åº•éƒ¨æ ‡ç­¾æ ·å¼*&#x2F;</span><br><span class="line">.posts-expand .post-tags a &#123;</span><br><span class="line">  -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, .12), 0 1px 2px rgba(0, 0, 0, .24);</span><br><span class="line">  -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, .12), 0 1px 2px rgba(0, 0, 0, .24);</span><br><span class="line">  box-shadow: 0 1px 3px rgba(0, 0, 0, .12), 0 1px 2px rgba(0, 0, 0, .24);</span><br><span class="line">  font-family: &#39;Comic Sans MS&#39;, sans-serif;</span><br><span class="line">  transition: .2s ease-out;</span><br><span class="line">  padding: 3px 5px;</span><br><span class="line">  margin: 5px;</span><br><span class="line">  background: #f5f5f5;</span><br><span class="line">  border-bottom: none;</span><br><span class="line">  border-radius: 15px;</span><br><span class="line"></span><br><span class="line">  +mobile()&#123;</span><br><span class="line">    padding: 1px 3px;</span><br><span class="line">    font-size: 8px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    background: rgba(100,154,182,0.902);</span><br><span class="line">    color: #fff;</span><br><span class="line">    -webkit-box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);</span><br><span class="line">    -moz-box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);</span><br><span class="line">    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226130811.png" alt="image-20210226130811067"></p>
<h1>å½’æ¡£é¡µç¾åŒ–</h1>
<ol>
<li>ä¿®æ”¹ /themes/next/ layout/_ macro/post collapse.swig åçš„ä»£ç å¦‚ä¸‹:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% macro render(posts) %&#125;</span><br><span class="line">&#123;%- set current_year &#x3D; &#39;1970&#39; %&#125;</span><br><span class="line">&#123;%- for post in posts.toArray() %&#125;</span><br><span class="line"></span><br><span class="line">  &#123;%- set year &#x3D; date(post.date, &#39;YYYY&#39;) %&#125;</span><br><span class="line"></span><br><span class="line">  &#123;%- if year !&#x3D;&#x3D; current_year %&#125;</span><br><span class="line">    &#123;%- set current_year &#x3D; year %&#125;</span><br><span class="line">    &lt;div class&#x3D;&quot;collection-year&quot;&gt;</span><br><span class="line">      &lt;&#123;%- if theme.seo %&#125;h2&#123;% else %&#125;h1&#123;%- endif %&#125; class&#x3D;&quot;collection-header&quot;&gt;&#123;&#123; current_year &#125;&#125;&lt;&#x2F;&#123;%- if theme.seo %&#125;h2&#123;% else %&#125;h1&#123;%- endif %&#125;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &#123;%- endif %&#125;</span><br><span class="line"></span><br><span class="line">  &lt;article class&#x3D;&quot;my-post post-type-&#123;&#123; post.type | default(&#39;normal&#39;) &#125;&#125;&quot; itemscope itemtype&#x3D;&quot;http:&#x2F;&#x2F;schema.org&#x2F;Article&quot;&gt;</span><br><span class="line">    &lt;header class&#x3D;&quot;my-post-header&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class&#x3D;&quot;my-post-meta&quot;&gt;</span><br><span class="line">        &lt;time class&#x3D;&quot;my-post-time&quot; itemprop&#x3D;&quot;dateCreated&quot;</span><br><span class="line">              datetime&#x3D;&quot;&#123;&#123; moment(post.date).format() &#125;&#125;&quot;</span><br><span class="line">              content&#x3D;&quot;&#123;&#123; date(post.date, config.date_format) &#125;&#125;&quot;&gt;</span><br><span class="line">          &#123;&#123; date(post.date, &#39;MM-DD&#39;) &#125;&#125;</span><br><span class="line">        &lt;&#x2F;time&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;&#123;%- if theme.seo %&#125;h3&#123;% else %&#125;h2&#123;%- endif %&#125; class&#x3D;&quot;my-post-title&quot;&gt;</span><br><span class="line">        &#123;%- if post.link %&#125;&#123;# Link posts #&#125;</span><br><span class="line">          &lt;a class&#x3D;&quot;my-post-title-link post-title-link-external&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;&#123;&#123; url_for(post.link) &#125;&#125;&quot; itemprop&#x3D;&quot;url&quot;&gt;</span><br><span class="line">            &#123;&#123; post.title or post.link &#125;&#125;</span><br><span class="line">            &lt;i class&#x3D;&quot;fa fa-external-link&quot;&gt;&lt;&#x2F;i&gt;</span><br><span class="line">          &lt;&#x2F;a&gt;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">          &lt;a class&#x3D;&quot;my-post-title-link&quot; href&#x3D;&quot;&#123;&#123; url_for(post.path) &#125;&#125;&quot; itemprop&#x3D;&quot;url&quot;&gt;</span><br><span class="line">            &#123;% if post.type &#x3D;&#x3D;&#x3D; &#39;picture&#39; %&#125;</span><br><span class="line">              &#123;&#123; post.content &#125;&#125;</span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">              &lt;span itemprop&#x3D;&quot;name&quot;&gt;&#123;&#123; post.title or __(&#39;post.untitled&#39;) &#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">          &lt;&#x2F;a&gt;</span><br><span class="line">        &#123;%- endif %&#125;</span><br><span class="line">      &lt;&#x2F;&#123;%- if theme.seo %&#125;h3&#123;% else %&#125;h2&#123;%- endif %&#125;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;header&gt;</span><br><span class="line">  &lt;&#x2F;article&gt;</span><br><span class="line"></span><br><span class="line">&#123;%- endfor %&#125;</span><br><span class="line">&#123;% endmacro %&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦ä¿®æ”¹ï¼šä¸€æ˜¯å°† post-metaè¿™ä¸ªdivç§»åˆ°å‰é¢header æ ‡ç­¾ä¸‹ï¼›äºŒæ˜¯å°†æ‰€æœ‰çš„ class å±æ€§éƒ½åŠ ä¸Š my-ï¼Œä¾‹å¦‚ my-post-metaï¼Œè¿™æ ·æ”¹åŠ¨æ˜¯ä¸ºäº†ä¸å½±å“å…¶å®ƒé¡µé¢å¼•ç”¨çš„æ ·å¼ã€‚</p>
<ol>
<li>åœ¨ /themes/next/source/css/_schemes/(è‡ªå·±é€‰æ‹©çš„ä¸»é¢˜)/index.styl æ–°å¢å¦‚ä¸‹æ ·å¼ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* å½’æ¡£é¡µæ ·å¼ began *&#x2F;</span><br><span class="line">.page-archive .archive-page-counter &#123;</span><br><span class="line">  font-size: 18px;</span><br><span class="line">  background-color: #49b1f5;</span><br><span class="line">  padding-left: 10px;</span><br><span class="line">  padding-right: 10px;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  color: #fff;</span><br><span class="line">  +mobile() &#123;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.my-post-time&#123;</span><br><span class="line">  font-size: 11px;</span><br><span class="line">  position: absolute;</span><br><span class="line">  color: #fff;</span><br><span class="line">  background-color: #49b1f5;</span><br><span class="line">  border-radius: 5px;</span><br><span class="line">  padding-left: 5px;</span><br><span class="line">  padding-right: 5px;</span><br><span class="line">  margin-left: 15px;</span><br><span class="line">&#125;</span><br><span class="line">.mypost&#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  margin-bottom: 1rem;</span><br><span class="line">  -webkit-transition: all .2s ease-in-out;</span><br><span class="line">  -moz-transition: all .2s ease-in-out;</span><br><span class="line">  -o-transition: all .2s ease-in-out;</span><br><span class="line">  -ms-transition: all .2s ease-in-out;</span><br><span class="line">  transition: all .2s ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line">a.my-post-title-link:before&#123;</span><br><span class="line">  top: 10px;</span><br><span class="line">  width: 18px;</span><br><span class="line">  height: 18px;</span><br><span class="line">  content: &quot;ğŸ“š&quot;;</span><br><span class="line">  margin-right: 5px;</span><br><span class="line">  font: normal normal normal 14px&#x2F;1 FontAwesome;</span><br><span class="line">  font-size: 15px;</span><br><span class="line">  line-height: 18px;</span><br><span class="line">&#125;</span><br><span class="line">.my-post:hover&#123;</span><br><span class="line">  transform: scale(1.1);</span><br><span class="line">  box-shadow: 10px 10px 15px 2px rgba(0,0,0,.12), 0 0 6px 0 rgba(104, 104, 105, 0.1);</span><br><span class="line">  border-radius: 30px;</span><br><span class="line">  width: 400px;</span><br><span class="line">  padding: 1px 10px;</span><br><span class="line">  margin-left: 25px;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  transition-duration: 0.15s;</span><br><span class="line">  +mobile()&#123;</span><br><span class="line">    width: 260px;</span><br><span class="line">    margin-left: 18px;</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F;display:flex;</span><br><span class="line">&#125;</span><br><span class="line">a.my-post-title-link&#123;</span><br><span class="line">  text-decoration: none;</span><br><span class="line">  font-size: 15px;</span><br><span class="line">  font-weight: 400;</span><br><span class="line">  +mobile() &#123;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.my-post-title&#123;</span><br><span class="line">  display: block;</span><br><span class="line">  margin-left: 4.5rem;</span><br><span class="line">  color: #4c4948;</span><br><span class="line">  text-decoration: none;</span><br><span class="line">  font-size: .8rem;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  +mobile() &#123;</span><br><span class="line">    &#x2F;&#x2F;margin-left: 4rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.my-post-header&#123;</span><br><span class="line">  position: top;</span><br><span class="line">  margin-bottom: 1rem;</span><br><span class="line">  -webkit-transition: all .2s ease-in-out;</span><br><span class="line">  -moz-transition: all .2s ease-in-out;</span><br><span class="line">  -o-transition: all .2s ease-in-out;</span><br><span class="line">  -ms-transition: all .2s ease-in-out;</span><br><span class="line">  transition: all .2s ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;.my-post-title-link&#123;</span><br><span class="line">&#x2F;&#x2F;  font-size: 16px;</span><br><span class="line">&#x2F;&#x2F;  font-weight: 500;</span><br><span class="line">&#x2F;&#x2F;&#125;</span><br><span class="line">.my-post-meta&#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  color: #99a9bf;</span><br><span class="line">  width: 80px;</span><br><span class="line">  color: #114142;</span><br><span class="line">&#125;</span><br><span class="line">div.post-block.tag .collection-title h2 &#123;</span><br><span class="line">  border-width: 1px;</span><br><span class="line">  border-style: solid;</span><br><span class="line">  border-color: #3f3f3f;</span><br><span class="line">  border-radius: 20px;</span><br><span class="line">  font-size: 22px;</span><br><span class="line">  background-color: #b4e8fa;</span><br><span class="line">  padding: 2px 15px;</span><br><span class="line">  letter-spacing: 1.5px;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  color: #3f3f3f;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  margin: 10px 0 10px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  +mobile()&#123;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;* å½’æ¡£é¡µæ ·å¼ end *&#x2F;</span><br></pre></td></tr></table></figure>
<p>å®ç°æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><a href="https://img-blog.csdnimg.cn/20200720163209724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTY5Mzgz,size_16,color_FFFFFF,t_70"><img src="https://img-blog.csdnimg.cn/20200720163209724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTY5Mzgz,size_16,color_FFFFFF,t_70" alt="img"></a></p>
<h1>åˆ†ç±»é¡µç¾åŒ–</h1>
<p>åœ¨ /themes/next/source/css/_schemes/(è‡ªå·±é€‰æ‹©çš„ä¸»é¢˜)/index.styl æ–°å¢å¦‚ä¸‹æ ·å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* åˆ†ç±»é¡µæ ·å¼ began *&#x2F;</span><br><span class="line">.category-list-link:hover&#123;</span><br><span class="line">  transform: scale(1.1);</span><br><span class="line">  box-shadow: 10px 10px 15px 2px rgba(0,0,0,.12), 0 0 6px 0 rgba(104, 104, 105, 0.1);</span><br><span class="line">  border-radius: 15px;</span><br><span class="line">  padding: 6px 16px;</span><br><span class="line">  margin-left: 0px;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  transition-duration: 0.15s;</span><br><span class="line">  &#x2F;&#x2F;display:flex;</span><br><span class="line">&#125;</span><br><span class="line">a.category-list-link:before&#123;</span><br><span class="line">  top: 10px;</span><br><span class="line">  width: 18px;</span><br><span class="line">  height: 18px;</span><br><span class="line">  content: &quot;ğŸ“š&quot;;</span><br><span class="line">  margin-right: 5px;</span><br><span class="line">  font: normal normal normal 14px&#x2F;1 FontAwesome;</span><br><span class="line">  font-size: 15px;</span><br><span class="line">  line-height: 18px;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;* åˆ†ç±»é¡µæ ·å¼ end *&#x2F;</span><br></pre></td></tr></table></figure>
<p>å®ç°æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><a href="https://img-blog.csdnimg.cn/20200720172136778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTY5Mzgz,size_16,color_FFFFFF,t_70"><img src="https://img-blog.csdnimg.cn/20200720172136778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTY5Mzgz,size_16,color_FFFFFF,t_70" alt="img"></a></p>
]]></content>
      <categories>
        <category>Hexo</category>
        <category>Next</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„å®‰è£…ä¸å¸è½½</title>
    <url>/posts/5a759233/</url>
    <content><![CDATA[<p><strong>ç›¸å…³ç¯å¢ƒ</strong></p>
<p>æ“ä½œç³»ç»Ÿï¼šcentos7</p>
<p>mysqlç‰ˆæœ¬ï¼šmysql 5.7</p>
<h2 id="MySQL-5-7-çš„å®‰è£…">MySQL 5.7 çš„å®‰è£…</h2>
<h4 id="æ£€æµ‹ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦å®‰è£…mysql">æ£€æµ‹ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦å®‰è£…mysql</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum list installed | grep mysql</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309101055.png" alt="image-20210309101055184"></p>
<h4 id="åˆ é™¤ç³»ç»Ÿè‡ªå¸¦çš„mysqlåŠå…¶ä¾èµ–ï¼ˆé˜²æ­¢å†²çªï¼‰">åˆ é™¤ç³»ç»Ÿè‡ªå¸¦çš„mysqlåŠå…¶ä¾èµ–ï¼ˆé˜²æ­¢å†²çªï¼‰</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ­¤å¤„å¯¹åº”çš„æ˜¯è‡ªèº«ç‰ˆæœ¬</span></span><br><span class="line">yum -y remove mysql-libs.x86_64</span><br></pre></td></tr></table></figure>
<h4 id="å®‰è£…wgetå‘½å">å®‰è£…wgetå‘½å</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install wget -y </span><br></pre></td></tr></table></figure>
<h4 id="ä¸‹è½½å¹¶å®‰è£…MySQLå®˜æ–¹çš„-Yum-Repository">ä¸‹è½½å¹¶å®‰è£…MySQLå®˜æ–¹çš„ Yum Repository</h4>
<p>ç”±äºCentOS çš„yumæºä¸­æ²¡æœ‰mysqlï¼Œéœ€è¦åˆ°mysqlçš„å®˜ç½‘ä¸‹è½½yum repoé…ç½®æ–‡ä»¶ã€‚å¹¶è¿›è¡Œå®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm</span><br><span class="line"> yum install mysql-community-release-el6-5.noarch.rpm -y</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨yumå®‰è£…mysql">ä½¿ç”¨yumå®‰è£…mysql</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install mysql-community-server -y</span><br></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨mysqlæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨">å¯åŠ¨mysqlæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨ä¹‹å‰éœ€è¦ç”Ÿæˆä¸´æ—¶å¯†ç ï¼Œéœ€è¦ç”¨åˆ°è¯ä¹¦ï¼Œå¯èƒ½è¯ä¹¦è¿‡æœŸï¼Œéœ€è¦è¿›è¡Œæ›´æ–°æ“ä½œ</span></span><br><span class="line">yum update -y</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨mysqlæœåŠ¡</span></span><br><span class="line">service mysqld start</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®mysqlå¼€æœºå¯åŠ¨</span></span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>
<h4 id="è·å–mysqlçš„ä¸´æ—¶å¯†ç ">è·å–mysqlçš„ä¸´æ—¶å¯†ç </h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grep &quot;password&quot; /var/log/mysqld.log</span><br><span class="line"><span class="meta">#</span><span class="bash">æ²¡æœ‰è·å–åˆ°è¯´æ˜æ²¡æœ‰å¯†ç å¯ä»¥ç›´æ¥ç™»é™†</span></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨ä¸´æ—¶å¯†ç ç™»å½•">ä½¿ç”¨ä¸´æ—¶å¯†ç ç™»å½•</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p å¯†ç </span><br></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹å¯†ç ">ä¿®æ”¹å¯†ç </h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password_policy<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password_length<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">#ä¸Šé¢è¿™æ¡å‘½ä»¤ä¸è¡Œæ—¶ï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤</span><br><span class="line">#<span class="number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 å¯¹åº”<span class="number">123456</span></span><br><span class="line">#ä¹Ÿå¯ä»¥é€šè¿‡ <span class="keyword">select</span> password(<span class="string">&#x27;123456&#x27;</span>)è·å–</span><br><span class="line"> <span class="keyword">set</span> password<span class="operator">=</span><span class="string">&#x27; 6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309103437.png" alt=""></p>
<h4 id="å…è®¸è¿œç¨‹è¿æ¥æ•°æ®åº“">å…è®¸è¿œç¨‹è¿æ¥æ•°æ®åº“</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<h4 id="è®¾ç½®å­—ç¬¦é›†ä¸ºutf-8">è®¾ç½®å­—ç¬¦é›†ä¸ºutf-8</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">åœ¨[mysqld]éƒ¨åˆ†æ·»åŠ ï¼š</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨æ–‡ä»¶æœ«å°¾æ–°å¢[client]æ®µï¼Œå¹¶åœ¨[client]æ®µæ·»åŠ ï¼š</span></span><br><span class="line">default-character-set=utf8</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯mysql</span></span><br><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309103825.png" alt="image-20210309103825273"></p>
<h2 id="Linuxä¸‹mysqlçš„å½»åº•å¸è½½">Linuxä¸‹mysqlçš„å½»åº•å¸è½½</h2>
<h4 id="æŸ¥çœ‹mysqlçš„å®‰è£…æƒ…å†µ">æŸ¥çœ‹mysqlçš„å®‰è£…æƒ…å†µ</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -qa | grep -i mysql</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309104128.png" alt="image-20210309104128079"></p>
<h4 id="åˆ é™¤ä¸Šå›¾å®‰è£…çš„è½¯ä»¶">åˆ é™¤ä¸Šå›¾å®‰è£…çš„è½¯ä»¶</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -ev mysql-community-libs-5.6.51-2.el6.x86_64</span><br><span class="line">rpm -ev mysql-community-server-5.6.51-2.el6.x86_64</span><br><span class="line">rpm -ev mysql-community-release-el6-5.noarch</span><br><span class="line">rpm -ev mysql-community-common-5.6.51-2.el6.x86_64</span><br><span class="line">rpm -ev  mysql-community-client-5.6.51-2.el6.x86_64</span><br></pre></td></tr></table></figure>
<h4 id="éƒ½åˆ é™¤æˆåŠŸä¹‹åï¼ŒæŸ¥æ‰¾ç›¸å…³çš„mysqlçš„æ–‡ä»¶">éƒ½åˆ é™¤æˆåŠŸä¹‹åï¼ŒæŸ¥æ‰¾ç›¸å…³çš„mysqlçš„æ–‡ä»¶</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / -name mysql</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309104242.png" alt="image-20210309104242918"></p>
<h4 id="åˆ é™¤å…¨éƒ¨æ–‡ä»¶">åˆ é™¤å…¨éƒ¨æ–‡ä»¶</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm -rf /etc/logrotate.d/mysql</span><br><span class="line">rm -rf /etc/selinux/targeted/active/modules/100/mysql</span><br><span class="line">rm -rf /var/lib/mysql</span><br><span class="line">rm -rf /var/lib/mysql/mysql</span><br><span class="line">rm -rf /usr/bin/mysql</span><br><span class="line">rm -rf /usr/lib64/mysql</span><br><span class="line">rm -rf /usr/share/mysql</span><br></pre></td></tr></table></figure>
<h4 id="å†æ¬¡æ‰§è¡Œå‘½ä»¤">å†æ¬¡æ‰§è¡Œå‘½ä»¤</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -qa | grep -i mysql</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœæ²¡æœ‰æ˜¾å¼åˆ™è¡¨ç¤ºå¸è½½å®Œæˆ</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„å¸¸è§å‘½ä»¤</title>
    <url>/posts/4ae76812/</url>
    <content><![CDATA[<h2 id="æ“ä½œæ•°æ®åº“ï¼šCRUD">æ“ä½œæ•°æ®åº“ï¼šCRUD</h2>
<h3 id="C-Create-ï¼šåˆ›å»º">C(Create)ï¼šåˆ›å»º</h3>
<ul>
<li>
<p>åˆ›å»ºæ•°æ®åº“ï¼š</p>
<ul>
<li>create database æ•°æ®åº“åç§°;</li>
</ul>
</li>
<li>
<p>åˆ›å»ºæ•°æ®åº“ï¼Œåˆ¤æ–­ä¸å­˜åœ¨ï¼Œå†åˆ›å»ºï¼š</p>
<ul>
<li>create database if not exists æ•°æ®åº“åç§°;</li>
</ul>
</li>
<li>
<p>åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†</p>
<ul>
<li>create database æ•°æ®åº“åç§° character set å­—ç¬¦é›†å;</li>
</ul>
</li>
<li>
<p>ä¾‹å­ï¼š åˆ›å»ºdb4æ•°æ®åº“ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åˆ¶å®šå­—ç¬¦é›†ä¸ºutf8</p>
<ul>
<li>create database if not exists db4 character set utf8mb4;</li>
</ul>
</li>
</ul>
<h3 id="R-Retrieve-ï¼šæŸ¥è¯¢">R(Retrieve)ï¼šæŸ¥è¯¢</h3>
<ul>
<li>
<p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“çš„åç§°:</p>
<ul>
<li>show databases;</li>
</ul>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“çš„å­—ç¬¦é›†:æŸ¥è¯¢æŸä¸ªæ•°æ®åº“çš„åˆ›å»ºè¯­å¥</p>
<ul>
<li>show create database æ•°æ®åº“åç§°;</li>
</ul>
</li>
</ul>
<h3 id="U-Update-ï¼šä¿®æ”¹">U(Update)ï¼šä¿®æ”¹</h3>
<ul>
<li>ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†
<ul>
<li>alter database æ•°æ®åº“åç§° character set å­—ç¬¦é›†åç§°;</li>
</ul>
</li>
</ul>
<h3 id="D-Delete-ï¼šåˆ é™¤">D(Delete)ï¼šåˆ é™¤</h3>
<ul>
<li>åˆ é™¤æ•°æ®åº“
<ul>
<li>drop database æ•°æ®åº“åç§°;</li>
</ul>
</li>
<li>åˆ¤æ–­æ•°æ®åº“å­˜åœ¨ï¼Œå­˜åœ¨å†åˆ é™¤
<ul>
<li>drop database if exists æ•°æ®åº“åç§°;</li>
</ul>
</li>
</ul>
<h3 id="ä½¿ç”¨æ•°æ®åº“">ä½¿ç”¨æ•°æ®åº“</h3>
<ul>
<li>æŸ¥è¯¢å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“åç§°
<ul>
<li>select database();</li>
</ul>
</li>
<li>ä½¿ç”¨æ•°æ®åº“
<ul>
<li>use æ•°æ®åº“åç§°;</li>
</ul>
</li>
</ul>
<h2 id="æ“ä½œè¡¨">æ“ä½œè¡¨</h2>
<h3 id="C-Create-ï¼šåˆ›å»º-2">C(Create)ï¼šåˆ›å»º</h3>
<h4 id="è¯­æ³•ï¼š">è¯­æ³•ï¼š</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> è¡¨å(</span><br><span class="line">	åˆ—å<span class="number">1</span> æ•°æ®ç±»å‹<span class="number">1</span>,</span><br><span class="line">	åˆ—å<span class="number">2</span> æ•°æ®ç±»å‹<span class="number">2</span>,</span><br><span class="line">	....</span><br><span class="line">	åˆ—ån æ•°æ®ç±»å‹n</span><br><span class="line">);</span><br><span class="line">#æ³¨æ„ï¼šæœ€åä¸€åˆ—ï¼Œä¸éœ€è¦åŠ é€—å·ï¼ˆ,ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®åº“ç±»å‹">æ•°æ®åº“ç±»å‹</h4>
<ul>
<li>
<p>intï¼šæ•´æ•°ç±»å‹  age int,</p>
</li>
<li>
<p>double:å°æ•°ç±»å‹  score double(5,2)</p>
</li>
<li>
<p>date:æ—¥æœŸï¼ŒåªåŒ…å«å¹´æœˆæ—¥ï¼Œyyyy-MM-dd</p>
</li>
<li>
<p>datetime:æ—¥æœŸï¼ŒåŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’	 yyyy-MM-dd HH:mm:ss</p>
</li>
<li>
<p>timestamp:æ—¶é—´é”™ç±»å‹	åŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’	 yyyy-MM-dd HH:mm:ss</p>
<p><strong>å¦‚æœå°†æ¥ä¸ç»™è¿™ä¸ªå­—æ®µèµ‹å€¼ï¼Œæˆ–èµ‹å€¼ä¸ºnullï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œæ¥è‡ªåŠ¨èµ‹å€¼</strong></p>
</li>
<li>
<p>varcharï¼šå­—ç¬¦ä¸²</p>
<p>name varchar(20):å§“åæœ€å¤§20ä¸ªå­—ç¬¦</p>
<p>zhangsan 8ä¸ªå­—ç¬¦  å¼ ä¸‰ 2ä¸ªå­—ç¬¦</p>
<h4 id="åˆ›å»ºè¡¨">åˆ›å»ºè¡¨</h4>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">  `account` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è´¦å·&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åç§°&#x27;</span>,</span><br><span class="line">  `mobile` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ‰‹æœºå·&#x27;</span>,</span><br><span class="line">  `create_time` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `creator` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºäºº&#x27;</span>,</span><br><span class="line">  `operator` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹äºº&#x27;</span>,</span><br><span class="line">  `operat_time` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `create_ip` <span class="type">varchar</span>(<span class="number">512</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºè®°å½•ip&#x27;</span>,</span><br><span class="line">  `operat_ip` <span class="type">varchar</span>(<span class="number">512</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹è®°å½•çš„ip&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">2</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ•°æ®çŠ¶æ€ï¼š1-å¯ç”¨ï¼Œ 2-å±è”½ï¼ˆé¡µé¢å¯ä»¥æ˜¾ç¤ºï¼Œå¯ä»¥æ¢å¤ï¼‰ï¼Œ 3-ç¦ç”¨(é¡µé¢ä¸æ˜¾ç¤ºè¯¥æ¡æ•°æ®)&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> MyISAM AUTO_INCREMENT <span class="operator">=</span> <span class="number">3</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> COMPACT;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºè¡¨-2">åˆ›å»ºè¡¨</h4>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#å¤åˆ¶è¡¨ç»“æ„åŠæ•°æ®åˆ°æ–°è¡¨(æ–°è¡¨ä¸­æ²¡æœ‰äº†æ—§è¡¨çš„<span class="keyword">primary</span> keyã€Extraï¼ˆauto_incrementï¼‰ç­‰å±æ€§)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> æ–°è¡¨<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> æ—§è¡¨</span><br><span class="line">#åªå¤åˆ¶è¡¨ç»“æ„åˆ°æ–°è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> æ–°è¡¨<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> æ—§è¡¨<span class="keyword">WHERE</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> è¡¨å <span class="keyword">like</span> è¢«å¤åˆ¶çš„è¡¨å;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> usertest <span class="keyword">like</span> <span class="keyword">user</span>;</span><br><span class="line">#å¤åˆ¶æ—§è¡¨çš„æ•°æ®åˆ°æ–°è¡¨(å‡è®¾ä¸¤ä¸ªè¡¨ç»“æ„ä¸€æ ·)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> æ–°è¡¨<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> æ—§è¡¨</span><br><span class="line">å¤åˆ¶æ—§è¡¨çš„æ•°æ®åˆ°æ–°è¡¨(å‡è®¾ä¸¤ä¸ªè¡¨ç»“æ„ä¸ä¸€æ ·)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> æ–°è¡¨(å­—æ®µ<span class="number">1</span>,å­—æ®µ<span class="number">2</span>,.......) <span class="keyword">SELECT</span> å­—æ®µ<span class="number">1</span>,å­—æ®µ<span class="number">2</span>,...... <span class="keyword">FROM</span> æ—§è¡¨</span><br><span class="line">#å¯ä»¥å°†è¡¨<span class="number">1</span>ç»“æ„å¤åˆ¶åˆ°è¡¨<span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">INTO</span> è¡¨<span class="number">2</span> <span class="keyword">FROM</span> è¡¨<span class="number">1</span> <span class="keyword">WHERE</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span></span><br><span class="line">#å¯ä»¥å°†è¡¨<span class="number">1</span>å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ°è¡¨<span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">INTO</span> è¡¨<span class="number">2</span> <span class="keyword">FROM</span> è¡¨<span class="number">1</span></span><br><span class="line"># <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> æ—§è¡¨;</span><br><span class="line">å°†æ—§è¡¨çš„åˆ›å»ºå‘½ä»¤åˆ—å‡ºã€‚æˆ‘ä»¬åªéœ€è¦å°†è¯¥å‘½ä»¤æ‹·è´å‡ºæ¥ï¼Œæ›´æ”¹<span class="keyword">table</span>çš„åå­—ï¼Œå°±å¯ä»¥å»ºç«‹ä¸€ä¸ªå®Œå…¨ä¸€æ ·çš„è¡¨</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> æ—§è¡¨;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="R-Retrieve-ï¼šæŸ¥è¯¢-2">R(Retrieve)ï¼šæŸ¥è¯¢</h3>
<h4 id="æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨åç§°">æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨åç§°</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥è¯¢è¡¨ç»“æ„">æŸ¥è¯¢è¡¨ç»“æ„</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">desc</span> è¡¨å;</span><br><span class="line"><span class="keyword">desc</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>
<h3 id="U-Update-ï¼šä¿®æ”¹-2">U(Update)ï¼šä¿®æ”¹</h3>
<h4 id="ä¿®æ”¹è¡¨å">ä¿®æ”¹è¡¨å</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å rename <span class="keyword">to</span> æ–°çš„è¡¨å;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> usertest rename <span class="keyword">to</span> user_test;</span><br></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†">ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="type">character</span> <span class="keyword">set</span> å­—ç¬¦é›†åç§°;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_test <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br></pre></td></tr></table></figure>
<h4 id="æ·»åŠ ä¸€åˆ—">æ·»åŠ ä¸€åˆ—</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">add</span> åˆ—å æ•°æ®ç±»å‹;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_test <span class="keyword">add</span> test <span class="keyword">DOUBLE</span>;</span><br></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹åˆ—åç§°-ç±»å‹">ä¿®æ”¹åˆ—åç§° ç±»å‹</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å change åˆ—å æ–°åˆ—åˆ« æ–°æ•°æ®ç±»å‹;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å modify åˆ—å æ–°æ•°æ®ç±»å‹;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_test change test test1 <span class="type">int</span>;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤åˆ—">åˆ é™¤åˆ—</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> åˆ—å;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_test <span class="keyword">drop</span> test1;</span><br></pre></td></tr></table></figure>
<h3 id="D-Delete-ï¼šåˆ é™¤-2">D(Delete)ï¼šåˆ é™¤</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> è¡¨å;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span>  if <span class="keyword">exists</span> è¡¨å ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span>  if <span class="keyword">exists</span> user_test ;</span><br></pre></td></tr></table></figure>
<h2 id="æ“ä½œè¡¨ä¸­æ•°æ®">æ“ä½œè¡¨ä¸­æ•°æ®</h2>
<h3 id="æ·»åŠ æ•°æ®">æ·»åŠ æ•°æ®</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#åˆ—åå’Œå€¼è¦ä¸€ä¸€å¯¹åº”ï¼Œé™¤äº†æ•°å­—ç±»å‹ï¼Œå…¶ä»–ç±»å‹éœ€è¦ä½¿ç”¨å¼•å·(å•åŒéƒ½å¯ä»¥)å¼•èµ·æ¥</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> è¡¨å(åˆ—å<span class="number">1</span>,åˆ—å<span class="number">2</span>,...åˆ—ån) <span class="keyword">values</span>(å€¼<span class="number">1</span>,å€¼<span class="number">2</span>,...å€¼n);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>`(`id`, `account`, `password`, `name`, `mobile`, `create_time`, `creator`, `operator`, `operat_time`, `create_ip`, `operat_ip`, `status`) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;ç®¡ç†å‘˜&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;2020-03-12 10:35:57&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;2020-03-12 10:36:06&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹æ•°æ®">ä¿®æ”¹æ•°æ®</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#å¦‚æœä¸åŠ ä»»ä½•æ¡ä»¶ï¼Œåˆ™ä¼šå°†è¡¨ä¸­æ‰€æœ‰è®°å½•å…¨éƒ¨ä¿®æ”¹ã€‚</span><br><span class="line">update è¡¨å <span class="keyword">set</span> åˆ—å<span class="number">1</span> <span class="operator">=</span> å€¼<span class="number">1</span>, åˆ—å<span class="number">2</span> <span class="operator">=</span> å€¼<span class="number">2</span>,... [<span class="keyword">where</span> æ¡ä»¶];</span><br><span class="line">UPDATE `khxttest`.`<span class="keyword">user</span>` <span class="keyword">SET</span> `account` <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span>, `password` <span class="operator">=</span> <span class="string">&#x27;123456&#x27;</span>, `name` <span class="operator">=</span> <span class="string">&#x27;ç®¡ç†å‘˜&#x27;</span>, `mobile` <span class="operator">=</span> <span class="keyword">NULL</span>, `create_time` <span class="operator">=</span> <span class="string">&#x27;2020-03-12 10:35:57&#x27;</span>, `creator` <span class="operator">=</span> <span class="number">0</span>, `operator` <span class="operator">=</span> <span class="number">0</span>, `operat_time` <span class="operator">=</span> <span class="string">&#x27;2020-03-12 10:36:06&#x27;</span>, `create_ip` <span class="operator">=</span> <span class="string">&#x27;127.0.0.1&#x27;</span>, `operat_ip` <span class="operator">=</span> <span class="string">&#x27;127.0.0.1&#x27;</span>, `status` <span class="operator">=</span> <span class="number">1</span> <span class="keyword">WHERE</span> `id` <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> è¡¨å [<span class="keyword">where</span> æ¡ä»¶]</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> `khxttest`.`<span class="keyword">user</span>` <span class="keyword">WHERE</span> `id` <span class="operator">=</span> <span class="number">29</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>delete from è¡¨å; â€“ ä¸æ¨èä½¿ç”¨ã€‚æœ‰å¤šå°‘æ¡è®°å½•å°±ä¼šæ‰§è¡Œå¤šå°‘æ¬¡åˆ é™¤æ“ä½œ</p>
<p>TRUNCATE TABLE è¡¨å; â€“ æ¨èä½¿ç”¨ï¼Œæ•ˆç‡æ›´é«˜ å…ˆåˆ é™¤è¡¨ï¼Œç„¶åå†åˆ›å»ºä¸€å¼ ä¸€æ ·çš„è¡¨ã€‚</p>
</blockquote>
<h3 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> è¡¨å;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å¹´é¾„å¤§äº20å²</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&gt;=</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å¹´é¾„ç­‰äº20å²</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº20å²</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">!=</span> <span class="number">20</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&lt;&gt;</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº20 å°äºç­‰äº30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&gt;=</span> <span class="number">20</span> <span class="operator">&amp;&amp;</span>  age <span class="operator">&lt;=</span><span class="number">30</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&gt;=</span> <span class="number">20</span> <span class="keyword">AND</span>  age <span class="operator">&lt;=</span><span class="number">30</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å¹´é¾„22å²ï¼Œ18å²ï¼Œ25å²çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">22</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">18</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">25</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="keyword">IN</span> (<span class="number">22</span>,<span class="number">18</span>,<span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢è‹±è¯­æˆç»©ä¸ºnull</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> english <span class="operator">=</span> <span class="keyword">NULL</span>; <span class="comment">-- ä¸å¯¹çš„ã€‚nullå€¼ä¸èƒ½ä½¿ç”¨ = ï¼ˆ!=ï¼‰ åˆ¤æ–­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> english <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢è‹±è¯­æˆç»©ä¸ä¸ºnull</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> english  <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å§“é©¬çš„æœ‰å“ªäº›ï¼Ÿ like</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;é©¬%&#x27;</span>;</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å§“åç¬¬äºŒä¸ªå­—æ˜¯åŒ–çš„äºº</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> &quot;_åŒ–%&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å§“åæ˜¯3ä¸ªå­—çš„äºº</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;___&#x27;</span>;</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å§“åä¸­åŒ…å«å¾·çš„äºº</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%å¾·%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>whereå­å¥åè·Ÿæ¡ä»¶</p>
<ul>
<li><strong>&lt;  &lt;=  &gt;=   =     &lt;&gt;</strong></li>
<li>BETWEENâ€¦AND</li>
<li>IN( é›†åˆ)</li>
<li>LIKEï¼šæ¨¡ç³ŠæŸ¥è¯¢
<ul>
<li>å ä½ç¬¦ï¼š
<ol>
<li>_:å•ä¸ªä»»æ„å­—ç¬¦</li>
<li>%ï¼šå¤šä¸ªä»»æ„å­—ç¬¦</li>
</ol>
</li>
</ul>
</li>
<li>IS NULL</li>
<li>and  æˆ– &amp;&amp;</li>
<li>or  æˆ– ||</li>
<li>not  æˆ– !</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„Sqlæ‰§è¡Œæµç¨‹</title>
    <url>/posts/6b5d697/</url>
    <content><![CDATA[<h2 id="æ‰§è¡Œæµç¨‹å›¾">æ‰§è¡Œæµç¨‹å›¾</h2>
<p>ç®€æ˜“çš„æµç¨‹å›¾å¦‚ä¸‹:</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309144801.png" alt="image-20210309144801371"></p>
<p>å¤§è‡´æµç¨‹æè¿°:</p>
<ol>
<li>MySQLå®¢æˆ·ç«¯é€šè¿‡åè®®å°†SQLè¯­å¥å‘é€ç»™MySQLæœåŠ¡å™¨ã€‚</li>
<li>æœåŠ¡å™¨ä¼šå…ˆæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ‰§è¡Œè¿‡è¿™æ¡SQLï¼Œå¦‚æœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™å°†ç»“æœè¿”å›ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€ä¸ªç¯èŠ‚ï¼ˆ<strong>æŸ¥è¯¢ç¼“å­˜é»˜è®¤ä¸å¼€å¯</strong>ï¼‰ã€‚</li>
<li>æœåŠ¡å™¨ç«¯è¿›è¡ŒSQLè§£æï¼Œé¢„å¤„ç†ï¼Œç„¶åç”±æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ã€‚</li>
<li>æœåŠ¡å™¨æ ¹æ®æŸ¥è¯¢ä¼˜åŒ–å™¨ç»™å‡ºçš„æ‰§è¡Œè®¡åˆ’ï¼Œå†è°ƒç”¨å­˜å‚¨å¼•æ“çš„APIæ‰§è¡ŒæŸ¥è¯¢ã€‚</li>
<li>å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœ<strong>å¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œåˆ™ä¼šå¤‡ä»½ä¸€ä»½åˆ°æŸ¥è¯¢ç¼“å­˜ä¸­</strong>ã€‚</li>
</ol>
<h2 id="æµç¨‹å›¾è¯¦è§£">æµç¨‹å›¾è¯¦è§£</h2>
<h3 id="æŸ¥è¯¢ç¼“å­˜">æŸ¥è¯¢ç¼“å­˜</h3>
<p>MySQLæŸ¥è¯¢ç¼“å­˜ä¼šä¿å­˜æŸ¥è¯¢è¿”å›çš„å®Œæ•´ç»“æ„ã€‚å½“æŸ¥è¯¢å‘½ä¸­è¯¥ç¼“å­˜æ—¶ï¼ŒMySQLä¼šç«‹åˆ»è¿”å›ç»“æœï¼Œè·³è¿‡äº†è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œé˜¶æ®µã€‚ ä½†æŸ¥è¯¢ç¼“å­˜æ˜¯é»˜è®¤ä¸å¼€å¯çš„ï¼Œä¸”è¦æ±‚SQLå’Œå‚æ•°éƒ½æ˜¯ä¸€æ ·ï¼ŒåŒæ—¶æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿä¼šè·Ÿè¸ªæŸ¥è¯¢ä¸­æ¶‰åŠçš„æ¯ä¸€ä¸ªè¡¨ï¼Œå¦‚æœè¿™äº›è¡¨å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¯¥è¡¨ç›¸å…³çš„æ‰€æœ‰ç¼“å­˜æ•°æ®å‡ä¼šå¤±æ•ˆã€‚æ‰€ä»¥å‘½ä¸­ç‡ä¸€èˆ¬è¾ƒä½ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿå¾ˆå°‘ç”¨åˆ°ï¼Œ</p>
<h3 id="è§£æå’Œé¢„å¤„ç†">è§£æå’Œé¢„å¤„ç†</h3>
<p>å¦‚æœæŸ¥è¯¢ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™åˆ°è§£æå™¨ã€‚è§£æå™¨ä¸»è¦æ˜¯å¯¹SQLè¯­å¥è¿›è¡Œè§£æï¼Œä½¿ç”¨MySQLyè¯­æ³•è§„åˆ™è¿›è¡ŒéªŒè¯å’Œè§£ææŸ¥è¯¢ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„è§£ææ ‘ã€‚ å¾—åˆ°è§£ææ•°ä¹‹åï¼Œè¿˜éœ€è¦åšé¢„å¤„ç†ï¼Œé¢„å¤„ç†åˆ™è¿›ä¸€æ­¥æ£€æŸ¥è§£é‡Šæ ‘æ˜¯å¦åˆæ³•ï¼Œä»¥åŠè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚æ£€æŸ¥æ•°æ®è¡¨å’Œåˆ—æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæœ‰è®¡ç®—ï¼Œä¼šå°†è®¡ç®—çš„ç»“æœç®—å‡ºæ¥ç­‰ç­‰ã€‚</p>
<h3 id="æŸ¥è¯¢ä¼˜åŒ–å™¨">æŸ¥è¯¢ä¼˜åŒ–å™¨</h3>
<p>æŸ¥è¯¢ä¼˜åŒ–å™¨æ˜¯æ•´ä¸ªæµç¨‹ä¸­é‡è¦çš„ä¸€ç¯ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå°†é¢„å¤„ç†ä¹‹åçš„è§£ææ ‘è½¬åŒ–æˆæ‰§è¡Œè®¡åˆ’ã€‚ä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¤šç§æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åå‡ä¼šè¿”å›ç›¸åŒç»“æœã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯æ‰¾åˆ°è¿™å…¶ä¸­æœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ã€‚  ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„è¿‡ç¨‹ä¼šæ¶ˆè€—è¾ƒå¤šçš„æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å­˜åœ¨è®¸å¤šå¯é€‰çš„æ‰§è¡Œè®¡åˆ’æ—¶ã€‚å¦‚æœåœ¨ä¸€æ¡SQLè¯­å¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°†è¯¥è¯­å¥å¯¹åº”çš„æœ€ç»ˆæ‰§è¡Œè®¡åˆ’è¿›è¡Œç¼“å­˜ï¼Œå½“ç›¸ä¼¼çš„è¯­å¥å†æ¬¡è¢«è¾“å…¥æœåŠ¡å™¨æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç¼“å­˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œè·³è¿‡SQLè¯­å¥ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè¿›è€Œå¯ä»¥æé«˜è¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ã€‚ é€šå¸¸æ‰€è®²çš„ä¼˜åŒ–SQLï¼Œå…¶å®å°±æ˜¯æƒ³è®©æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„æ€è·¯,å¸®æˆ‘ä»¬é€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆã€‚</p>
<h3 id="æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’">æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’</h3>
<p>æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå°±æ˜¯MySQLæŸ¥è¯¢ä¸­çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ¯”å¦‚æ˜¯æ‰§è¡Œwhereè¯­å¥è¿˜æ˜¯fromè¯­å¥ï¼Œä¸‹é¢æœ‰ä¸€å¼ æ‰§è¡Œé¡ºåºçš„å›¾ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309145045.png" alt="image-20210309145045381"></p>
<p>æœ€å…ˆæ‰§è¡Œçš„æ€»æ˜¯FROMæ“ä½œï¼Œæœ€åæ‰§è¡Œçš„æ˜¯LIMITæ“ä½œã€‚å…¶ä¸­æ¯ä¸€ä¸ªæ“ä½œéƒ½ä¼šäº§ç”Ÿä¸€å¼ è™šæ‹Ÿçš„è¡¨ï¼Œè¿™ä¸ªè™šæ‹Ÿçš„è¡¨ä½œä¸ºä¸€ä¸ªå¤„ç†çš„è¾“å…¥ï¼Œåªæ˜¯è¿™äº›è™šæ‹Ÿçš„è¡¨å¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œä½†æ˜¯åªæœ‰æœ€åä¸€ä¸ªè™šæ‹Ÿçš„è¡¨æ‰ä¼šè¢«ä½œä¸ºç»“æœè¿”å›ã€‚å¦‚æœæ²¡æœ‰åœ¨è¯­å¥ä¸­æŒ‡å®šæŸä¸€ä¸ªå­å¥ï¼Œé‚£ä¹ˆå°†ä¼šè·³è¿‡ç›¸åº”çš„æ­¥éª¤ã€‚</p>
<ul>
<li>
<p>FORM: å¯¹FROMçš„å·¦è¾¹çš„è¡¨å’Œå³è¾¹çš„è¡¨è®¡ç®—ç¬›å¡å°”ç§¯ã€‚äº§ç”Ÿè™šè¡¨VT1</p>
</li>
<li>
<p>ON: å¯¹è™šè¡¨VT1è¿›è¡ŒONç­›é€‰ï¼Œåªæœ‰é‚£äº›ç¬¦åˆçš„è¡Œæ‰ä¼šè¢«è®°å½•åœ¨è™šè¡¨VT2ä¸­ã€‚</p>
</li>
<li>
<p>JOINï¼š å¦‚æœæŒ‡å®šäº†OUTER JOINï¼ˆæ¯”å¦‚left joinã€ right joinï¼‰ï¼Œé‚£ä¹ˆä¿ç•™è¡¨ä¸­æœªåŒ¹é…çš„è¡Œå°±ä¼šä½œä¸ºå¤–éƒ¨è¡Œæ·»åŠ åˆ°è™šæ‹Ÿè¡¨VT2ä¸­ï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT3ï¼Œ å¦‚æœ fromå­å¥ä¸­åŒ…å«ä¸¤ä¸ªä»¥ä¸Šçš„è¡¨çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹ä¸Šä¸€ä¸ªjoinè¿æ¥äº§ç”Ÿçš„ç»“æœVT3å’Œä¸‹ä¸€ä¸ªè¡¨é‡å¤æ‰§è¡Œæ­¥éª¤1~3è¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸€ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰çš„è¡¨ä¸ºæ­¢ã€‚</p>
</li>
<li>
<p>WHEREï¼š å¯¹è™šæ‹Ÿè¡¨VT3è¿›è¡ŒWHEREæ¡ä»¶è¿‡æ»¤ã€‚åªæœ‰ç¬¦åˆçš„è®°å½•æ‰ä¼šè¢«æ’å…¥åˆ°è™šæ‹Ÿè¡¨VT4ä¸­ã€‚</p>
</li>
<li>
<p>GROUP BY: æ ¹æ®group byå­å¥ä¸­çš„åˆ—ï¼Œå¯¹VT4ä¸­çš„è®°å½•è¿›è¡Œåˆ†ç»„æ“ä½œï¼Œäº§ç”ŸVT5.</p>
</li>
<li>
<p>CUBE | ROLLUP: å¯¹è¡¨VT5è¿›è¡Œcubeæˆ–è€…rollupæ“ä½œï¼Œäº§ç”Ÿè¡¨VT6.</p>
</li>
<li>
<p>HAVINGï¼š å¯¹è™šæ‹Ÿè¡¨VT6åº”ç”¨havingè¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆçš„è®°å½•æ‰ä¼šè¢« æ’å…¥åˆ°è™šæ‹Ÿè¡¨VT7ä¸­ã€‚</p>
</li>
<li>
<p>SELECTï¼š æ‰§è¡Œselectæ“ä½œï¼Œé€‰æ‹©æŒ‡å®šçš„åˆ—ï¼Œæ’å…¥åˆ°è™šæ‹Ÿè¡¨VT8ä¸­ã€‚</p>
</li>
<li>
<p>DISTINCTï¼š å¯¹VT8ä¸­çš„è®°å½•è¿›è¡Œå»é‡ã€‚äº§ç”Ÿè™šæ‹Ÿè¡¨VT9.</p>
</li>
<li>
<p>ORDER BY: å°†è™šæ‹Ÿè¡¨VT9ä¸­çš„è®°å½•æŒ‰ç…§&lt;order_by_list&gt;è¿›è¡Œæ’åºæ“ä½œï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT10.</p>
</li>
<li>
<p>LIMITï¼šå–å‡ºæŒ‡å®šè¡Œçš„è®°å½•ï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT11, å¹¶å°†ç»“æœè¿”å›ã€‚</p>
</li>
</ul>
<h3 id="æŸ¥è¯¢æ‰§è¡Œå¼•æ“">æŸ¥è¯¢æ‰§è¡Œå¼•æ“</h3>
<p>æ‰§è¡Œè®¡åˆ’ä¼šä¼ ç»™æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼Œæ‰§è¡Œå¼•æ“é€‰æ‹©å­˜å‚¨å¼•æ“æ¥æ‰§è¡Œè®¡åˆ’ï¼Œåˆ°ç£ç›˜ä¸­çš„æ–‡ä»¶ä¸­å»æŸ¥è¯¢ã€‚ å½±å“è¿™ä¸ªæŸ¥è¯¢æ€§èƒ½æœ€æ ¹æœ¬çš„åŸå› æ˜¯ä»€ä¹ˆ? å…¶å®æ˜¯ç¡¬ç›˜çš„æœºæ¢°è¿åŠ¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ç†Ÿæ‚‰çš„IOï¼Œæ‰€ä»¥ä¸€æ¡æŸ¥è¯¢è¯­å¥æ˜¯å¿«è¿˜æ˜¯æ…¢ï¼Œå°±æ˜¯æ ¹æ®è¿™ä¸ªæ—¶é—´çš„IOæ¥ç¡®å®šçš„ã€‚é‚£æ€ä¹ˆæ‰§è¡ŒIOåˆæ˜¯ä»€ä¹ˆæ¥ç¡®å®šçš„?å°±æ˜¯ä¼ è¿‡æ¥çš„è¿™ä¸€ä»½æ‰§è¡Œè®¡åˆ’.</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://juejin.cn/post/6844903780987715592">https://juejin.cn/post/6844903780987715592</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„å¤šè¡¨æŸ¥è¯¢åŠçº¦æŸ</title>
    <url>/posts/c746dd2d/</url>
    <content><![CDATA[<h2 id="MySQLçš„çº¦æŸ">MySQLçš„çº¦æŸ</h2>
<h3 id="æ’åºæŸ¥è¯¢">æ’åºæŸ¥è¯¢</h3>
<ul>
<li>è¯­æ³•ï¼šorder by å­å¥</li>
<li>order by æ’åºå­—æ®µ1 æ’åºæ–¹å¼1 ï¼Œ  æ’åºå­—æ®µ2 æ’åºæ–¹å¼2â€¦</li>
<li>æ’åºæ–¹å¼ï¼š
<ul>
<li>ASCï¼šå‡åºï¼Œé»˜è®¤çš„ã€‚</li>
<li>DESCï¼šé™åºã€‚</li>
</ul>
</li>
<li><strong>å¦‚æœæœ‰å¤šä¸ªæ’åºæ¡ä»¶ï¼Œåˆ™å½“å‰è¾¹çš„æ¡ä»¶å€¼ä¸€æ ·æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­ç¬¬äºŒæ¡ä»¶ã€‚</strong></li>
</ul>
<h3 id="èšåˆå‡½æ•°">èšåˆå‡½æ•°</h3>
<p>å°†ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¿›è¡Œçºµå‘çš„è®¡ç®—ã€‚</p>
<ul>
<li><strong>count</strong>ï¼šè®¡ç®—ä¸ªæ•°
<ul>
<li>ä¸€èˆ¬é€‰æ‹©éç©ºçš„åˆ—ï¼šä¸»é”®</li>
<li>count(*)</li>
</ul>
</li>
<li><strong>max</strong>ï¼šè®¡ç®—æœ€å¤§å€¼</li>
<li><strong>min</strong>ï¼šè®¡ç®—æœ€å°å€¼</li>
<li><strong>sum</strong>ï¼šè®¡ç®—å’Œ</li>
<li><strong>avg</strong>ï¼šè®¡ç®—å¹³å‡å€¼</li>
</ul>
<blockquote>
<p>èšåˆå‡½æ•°çš„è®¡ç®—ï¼Œ<strong>æ’é™¤nullå€¼ã€‚</strong></p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>é€‰æ‹©ä¸åŒ…å«éç©ºçš„åˆ—è¿›è¡Œè®¡ç®—</li>
<li>IFNULLå‡½æ•°</li>
</ol>
</blockquote>
<h3 id="åˆ†ç»„æŸ¥è¯¢">åˆ†ç»„æŸ¥è¯¢</h3>
<p>group by åˆ†ç»„å­—æ®µ</p>
<p>employee è¡¨æ•°æ®</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>gender</th>
<th>hire_date</th>
<th>salary</th>
<th>performance</th>
<th>manage</th>
<th>deparmant</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>å¼ ä¸‰</td>
<td>ç”·</td>
<td>2/12/1991 00:00:00</td>
<td>2000</td>
<td>200</td>
<td>500</td>
<td>è¥é”€éƒ¨</td>
</tr>
<tr>
<td>1002</td>
<td>æå››</td>
<td>ç”·</td>
<td>5/8/1993 00:00:00</td>
<td>4000</td>
<td>500</td>
<td></td>
<td>è¥é”€éƒ¨</td>
</tr>
<tr>
<td>1003</td>
<td>ç‹äº”</td>
<td>å¥³</td>
<td>12/13/1993 00:00:00</td>
<td>1000</td>
<td>100</td>
<td>5000</td>
<td>ç ”å‘éƒ¨</td>
</tr>
<tr>
<td>1004</td>
<td>èµµå…­</td>
<td>ç”·</td>
<td>8/19/1996 00:00:00</td>
<td>8000</td>
<td>1000</td>
<td>4000</td>
<td>è´¢åŠ¡éƒ¨</td>
</tr>
<tr>
<td>1005</td>
<td>å­™ä¸ƒ</td>
<td>å¥³</td>
<td>11/6/1997 00:00:00</td>
<td>5000</td>
<td>500</td>
<td></td>
<td>ç ”å‘éƒ¨</td>
</tr>
<tr>
<td>1006</td>
<td>å‘¨å…«</td>
<td>ç”·</td>
<td>10/16/1994 00:00:00</td>
<td>6000</td>
<td>2000</td>
<td>1000</td>
<td>äººäº‹éƒ¨</td>
</tr>
<tr>
<td>1007</td>
<td>å´ä¹</td>
<td>å¥³</td>
<td>9/22/1995 00:00:00</td>
<td>8000</td>
<td>1500</td>
<td></td>
<td>ç ”å‘éƒ¨</td>
</tr>
<tr>
<td>1008</td>
<td>éƒ‘å</td>
<td>å¥³</td>
<td>10/25/1998 00:00:00</td>
<td>4000</td>
<td>900</td>
<td></td>
<td>äººäº‹éƒ¨</td>
</tr>
</tbody>
</table>
<h4 id="GroupBy-Group-concat">GroupBy+Group_concat</h4>
<p>group by æ˜¯åˆ†ç»„ï¼Œæ˜¯åˆ†ç»„ï¼Œæ˜¯åˆ†ç»„ï¼Œåˆ†ç»„å¹¶ä¸æ˜¯å»é‡ï¼Œè€Œæ˜¯åˆ†ç»„</p>
<p>å°†æŸ¥è¯¢ç»“æœæŒ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿›è¡Œåˆ†ç»„ï¼Œå­—æ®µå€¼ç›¸åŒçš„ä¸ºä¸€ç»„</p>
<p>GroupBy+Group_concat ï¼š è¡¨ç¤ºåˆ†ç»„ä¹‹åï¼Œæ ¹æ®åˆ†ç»„ç»“æœï¼Œä½¿ç”¨ group_contact() æ¥æ”¾ç½®æ¯ä¸€ç»„çš„æ¯å­—æ®µçš„å€¼çš„é›†åˆ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> deparmant, GROUP_CONCAT(`name`) <span class="keyword">from</span> employee <span class="keyword">GROUP</span> <span class="keyword">BY</span> deparmant</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309112830.png" alt="image-20210309112830453"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name,gender <span class="keyword">from</span> employee <span class="keyword">GROUP</span> <span class="keyword">BY</span> gender,name</span><br><span class="line"><span class="comment">-- å…ˆæŒ‰genderåˆ†ç»„ï¼Œå†æŒ‰å§“ååˆ†ç»„...</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309112918.png" alt="image-20210309112918423"></p>
<h4 id="SQLåˆ†ç»„-èšåˆå‡½æ•°">SQLåˆ†ç»„+èšåˆå‡½æ•°</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> deparmant, GROUP_CONCAT(salary), <span class="built_in">SUM</span>(salary),<span class="built_in">AVG</span>(salary) å¹³å‡å·¥èµ„,<span class="built_in">MAX</span>(salary) æœ€é«˜å·¥èµ„ <span class="keyword">from</span> employee <span class="keyword">GROUP</span> <span class="keyword">BY</span> deparmant;</span><br><span class="line"><span class="comment">-- æ ¹æ®department åˆ†ç»„ï¼Œè®¡ç®—å„éƒ¨é—¨ä¸‹å·¥èµ„æ€»æ•°ï¼Œå¹³å‡å·¥èµ„ï¼Œæœ€é«˜å·¥èµ„![1532919789347]</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309112957.png" alt="image-20210309112957603"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨åç§°ä»¥åŠæ¯ä¸ªéƒ¨é—¨çš„äººæ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> deparmant, GROUP_CONCAT(`name`), <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee <span class="keyword">GROUP</span> <span class="keyword">BY</span> deparmant</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309113025.png" alt="image-20210309113025515"></p>
<h4 id="SQLåˆ†ç»„GroupBy-Having">SQLåˆ†ç»„GroupBy+Having</h4>
<ul>
<li>group by + having ç”¨æ¥åˆ†ç»„æŸ¥è¯¢åæŒ‡å®šä¸€äº›æ¡ä»¶æ¥è¾“å‡ºæŸ¥è¯¢ç»“æœ</li>
<li>having å’Œ where ä¸€æ ·ï¼Œä½† having åªèƒ½ç”¨äº group by</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å·¥èµ„æ€»å’Œå¤§äº 9000çš„éƒ¨é—¨åç§°</span></span><br><span class="line"><span class="keyword">SELECT</span> deparmant, GROUP_CONCAT(salary), <span class="built_in">SUM</span>(salary) <span class="keyword">FROM</span> employee </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> deparmant </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(salary) <span class="operator">&gt;</span> <span class="number">9000</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309113103.png" alt="image-20210309113103212"></p>
<h5 id="having-å’Œ-where-çš„åŒºåˆ«ï¼š">having å’Œ where çš„åŒºåˆ«ï¼š</h5>
<ol>
<li>having æ˜¯åœ¨åˆ†ç»„åå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œwhere æ˜¯åœ¨åˆ†ç»„å‰å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤</li>
<li>havingåé¢å¯ä»¥ä½¿ç”¨åˆ†ç»„å‡½æ•°(ç»Ÿè®¡å‡½æ•°)ï¼Œwhereåé¢ä¸å¯ä»¥ä½¿ç”¨åˆ†ç»„å‡½æ•°</li>
<li>where æ˜¯å¯¹åˆ†ç»„å‰è®°å½•çš„æ¡ä»¶ï¼Œå¦‚æœæŸè¡Œè®°å½•æ²¡æœ‰æ»¡è¶³whereå­—å¥çš„æ¡ä»¶ï¼Œé‚£ä¹ˆè¿™è¡Œè®°å½•ä¸ä¼šå‚åŠ åˆ†ç»„ï¼›è€Œhavingæ˜¯å¯¹åˆ†ç»„åæ•°æ®çš„çº¦æŸ</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å·¥èµ„å¤§äº2000çš„ï¼Œå·¥èµ„æ€»å’Œå¤§äº9000çš„éƒ¨é—¨åç§°ä»¥åŠå·¥èµ„å’Œ</span></span><br><span class="line"><span class="keyword">select</span> deparmant,GROUP_CONCAT(salary), <span class="built_in">SUM</span>(salary) <span class="keyword">from</span> employee </span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">2000</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> deparmant </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">sum</span>(salary) <span class="operator">&gt;</span> <span class="number">9000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">SUM</span>(salary) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309113315.png" alt="image-20210309113315352"></p>
<h3 id="sqlè¯­å¥ä¹¦å†™é¡ºåº">sqlè¯­å¥ä¹¦å†™é¡ºåº</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309113332.png" alt="image-20210309113332101"></p>
<h2 id="MySQLçš„å¤šè¡¨æŸ¥è¯¢">MySQLçš„å¤šè¡¨æŸ¥è¯¢</h2>
<h3 id="å‡†å¤‡sql">å‡†å¤‡sql</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºéƒ¨é—¨è¡¨</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	NAME <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept (NAME) <span class="keyword">VALUES</span> (<span class="string">&#x27;å¼€å‘éƒ¨&#x27;</span>),(<span class="string">&#x27;å¸‚åœºéƒ¨&#x27;</span>),(<span class="string">&#x27;è´¢åŠ¡éƒ¨&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå‘˜å·¥è¡¨</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp (</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	NAME <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	gender <span class="type">CHAR</span>(<span class="number">1</span>), <span class="comment">-- æ€§åˆ«</span></span><br><span class="line">	salary <span class="keyword">DOUBLE</span>, <span class="comment">-- å·¥èµ„</span></span><br><span class="line">	join_date <span class="type">DATE</span>, <span class="comment">-- å…¥èŒæ—¥æœŸ</span></span><br><span class="line">	dept_id <span class="type">INT</span>,</span><br><span class="line">	<span class="keyword">FOREIGN</span> KEY (dept_id) <span class="keyword">REFERENCES</span> dept(id) <span class="comment">-- å¤–é”®ï¼Œå…³è”éƒ¨é—¨è¡¨(éƒ¨é—¨è¡¨çš„ä¸»é”®)</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;å­™æ‚Ÿç©º&#x27;</span>,<span class="string">&#x27;ç”·&#x27;</span>,<span class="number">7200</span>,<span class="string">&#x27;2013-02-24&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;çŒªå…«æˆ’&#x27;</span>,<span class="string">&#x27;ç”·&#x27;</span>,<span class="number">3600</span>,<span class="string">&#x27;2010-12-02&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;å”åƒ§&#x27;</span>,<span class="string">&#x27;ç”·&#x27;</span>,<span class="number">9000</span>,<span class="string">&#x27;2008-08-08&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;ç™½éª¨ç²¾&#x27;</span>,<span class="string">&#x27;å¥³&#x27;</span>,<span class="number">5000</span>,<span class="string">&#x27;2015-10-07&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;èœ˜è››ç²¾&#x27;</span>,<span class="string">&#x27;å¥³&#x27;</span>,<span class="number">4500</span>,<span class="string">&#x27;2011-03-14&#x27;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h3 id="å¤šè¡¨æŸ¥è¯¢">å¤šè¡¨æŸ¥è¯¢</h3>
<h4 id="å†…è¿æ¥æŸ¥è¯¢">å†…è¿æ¥æŸ¥è¯¢</h4>
<h5 id="éšå¼å†…è¿æ¥">éšå¼å†…è¿æ¥</h5>
<p>ä½¿ç”¨whereæ¡ä»¶æ¶ˆé™¤æ— ç”¨æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ä¿¡æ¯å’Œå¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,dept <span class="keyword">WHERE</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;</span><br><span class="line">			</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å‘˜å·¥è¡¨çš„åç§°ï¼Œæ€§åˆ«ã€‚éƒ¨é—¨è¡¨çš„åç§°</span></span><br><span class="line"><span class="keyword">SELECT</span> emp.name,emp.gender,dept.name <span class="keyword">FROM</span> emp,dept <span class="keyword">WHERE</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;</span><br><span class="line">			</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">t1.name, <span class="comment">-- å‘˜å·¥è¡¨çš„å§“å</span></span><br><span class="line">t1.gender,<span class="comment">-- å‘˜å·¥è¡¨çš„æ€§åˆ«</span></span><br><span class="line">t2.name <span class="comment">-- éƒ¨é—¨è¡¨çš„åç§°</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">emp t1,</span><br><span class="line">dept t2</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">t1.`dept_id` <span class="operator">=</span> t2.`id`;</span><br></pre></td></tr></table></figure>
<h5 id="æ˜¾å¼å†…è¿æ¥">æ˜¾å¼å†…è¿æ¥</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•ï¼š select å­—æ®µåˆ—è¡¨ from è¡¨å1 [inner] join è¡¨å2 on æ¡ä»¶</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept <span class="keyword">ON</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;	</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">JOIN</span> dept <span class="keyword">ON</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;	</span><br></pre></td></tr></table></figure>
<h4 id="å¤–é“¾æ¥æŸ¥è¯¢">å¤–é“¾æ¥æŸ¥è¯¢</h4>
<h5 id="å·¦å¤–è¿æ¥">å·¦å¤–è¿æ¥</h5>
<p>å·¦å‘å¤–è”æ¥çš„ç»“æœé›†åŒ…æ‹¬ LEFT OUTERå­å¥ä¸­æŒ‡å®šçš„å·¦è¡¨çš„æ‰€æœ‰è¡Œï¼Œè€Œä¸ä»…ä»…æ˜¯è”æ¥åˆ—æ‰€åŒ¹é…çš„è¡Œã€‚å¦‚æœå·¦è¡¨çš„æŸè¡Œåœ¨å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…è¡Œï¼Œåˆ™åœ¨ç›¸å…³è”çš„ç»“æœé›†è¡Œä¸­å³è¡¨çš„æ‰€æœ‰é€‰æ‹©åˆ—è¡¨åˆ—å‡ä¸ºç©ºå€¼ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•ï¼šselect å­—æ®µåˆ—è¡¨ from è¡¨1 left [outer] join è¡¨2 on æ¡ä»¶ï¼›</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥è¯¢çš„æ˜¯å·¦è¡¨æ‰€æœ‰æ•°æ®ä»¥åŠå…¶äº¤é›†éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>æ•ˆæœ: å†…è¿æ¥æŸ¥è¯¢ä¸å¤šè¡¨è”åˆæŸ¥è¯¢çš„æ•ˆæœæ˜¯ä¸€æ ·çš„.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œå¦‚æœå‘˜å·¥æœ‰éƒ¨é—¨ï¼Œåˆ™æŸ¥è¯¢éƒ¨é—¨åç§°ï¼Œæ²¡æœ‰éƒ¨é—¨ï¼Œåˆ™ä¸æ˜¾ç¤ºéƒ¨é—¨åç§°</span></span><br><span class="line"><span class="keyword">SELECT</span> 	t1.<span class="operator">*</span>,t2.`name` <span class="keyword">FROM</span> emp t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept t2 <span class="keyword">ON</span> t1.`dept_id` <span class="operator">=</span> t2.`id`;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309115012.png" alt="image-20210309115012503"></p>
<h5 id="å³å¤–è¿æ¥">å³å¤–è¿æ¥</h5>
<p>å³å‘å¤–è”æ¥æ˜¯å·¦å‘å¤–è”æ¥çš„åå‘è”æ¥ã€‚å°†è¿”å›å³è¡¨çš„æ‰€æœ‰è¡Œã€‚å¦‚æœå³è¡¨çš„æŸè¡Œåœ¨å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…è¡Œï¼Œåˆ™å°†ä¸ºå·¦è¡¨è¿”å›ç©ºå€¼ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•ï¼šselect å­—æ®µåˆ—è¡¨ from è¡¨1 right [outer] join è¡¨2 on æ¡ä»¶ï¼›</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥è¯¢çš„æ˜¯å³è¡¨æ‰€æœ‰æ•°æ®ä»¥åŠå…¶äº¤é›†éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>æ•ˆæœ:äººå‘˜è¡¨ä¸­çš„æ•°æ®å…¨éƒ¨éƒ½æ˜¾ç¤º,è€Œ éƒ¨é—¨è¡¨ä¸­çš„æ•°æ®ç¬¦åˆæ¡ä»¶çš„æ‰ä¼šæ˜¾ç¤º,ä¸ç¬¦åˆæ¡ä»¶çš„ä¼šä»¥ null è¿›è¡Œå¡«å…….</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept t2 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> emp t1 <span class="keyword">ON</span> t1.`dept_id` <span class="operator">=</span> t2.`id`; </span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309114953.png" alt="image-20210309114953597"></p>
<h5 id="å­æŸ¥è¯¢">å­æŸ¥è¯¢</h5>
<p>æŸ¥è¯¢ä¸­åµŒå¥—æŸ¥è¯¢ï¼Œç§°åµŒå¥—æŸ¥è¯¢ä¸ºå­æŸ¥è¯¢ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">--  1 æŸ¥è¯¢æœ€é«˜çš„å·¥èµ„æ˜¯å¤šå°‘ 9000</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">--  2 æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼Œå¹¶ä¸”å·¥èµ„ç­‰äº9000çš„</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.`salary` <span class="operator">=</span> <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨å­æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">-- ä¸€æ¡sqlå°±å®Œæˆè¿™ä¸ªæ“ä½œã€‚å­æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.`salary` <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> emp);</span><br></pre></td></tr></table></figure>
<h5 id="å­æŸ¥è¯¢ä¸åŒæƒ…å†µ">å­æŸ¥è¯¢ä¸åŒæƒ…å†µ</h5>
<h6 id="å­æŸ¥è¯¢çš„ç»“æœæ˜¯å•è¡Œå•åˆ—çš„">å­æŸ¥è¯¢çš„ç»“æœæ˜¯å•è¡Œå•åˆ—çš„</h6>
<ul>
<li>
<p>å­æŸ¥è¯¢å¯ä»¥ä½œä¸ºæ¡ä»¶ï¼Œä½¿ç”¨è¿ç®—ç¬¦å»åˆ¤æ–­ã€‚ è¿ç®—ç¬¦ï¼š &gt; &gt;= &lt; &lt;= =</p>
</li>
<li>
<p>æŸ¥è¯¢å‘˜å·¥å·¥èµ„å°äºå¹³å‡å·¥èµ„çš„äºº</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.salary <span class="operator">&lt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> emp);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="å­æŸ¥è¯¢çš„ç»“æœæ˜¯å¤šè¡Œå•åˆ—">å­æŸ¥è¯¢çš„ç»“æœæ˜¯å¤šè¡Œå•åˆ—</h6>
<ul>
<li>
<p>æŸ¥è¯¢å¯ä»¥ä½œä¸ºæ¡ä»¶ï¼Œä½¿ç”¨è¿ç®—ç¬¦inæ¥åˆ¤æ–­</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢&#x27;è´¢åŠ¡éƒ¨&#x27;å’Œ&#x27;å¸‚åœºéƒ¨&#x27;æ‰€æœ‰çš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> dept <span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;è´¢åŠ¡éƒ¨&#x27;</span> <span class="keyword">OR</span> NAME <span class="operator">=</span> <span class="string">&#x27;å¸‚åœºéƒ¨&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">3</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">--- å­æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> dept_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> dept <span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;è´¢åŠ¡éƒ¨&#x27;</span> <span class="keyword">OR</span> NAME <span class="operator">=</span> <span class="string">&#x27;å¸‚åœºéƒ¨&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="æŸ¥è¯¢çš„ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—çš„">æŸ¥è¯¢çš„ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—çš„</h6>
<p>å­æŸ¥è¯¢å¯ä»¥ä½œä¸ºä¸€å¼ è™šæ‹Ÿè¡¨å‚ä¸æŸ¥è¯¢</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å‘˜å·¥å…¥èŒæ—¥æœŸæ˜¯2011-11-11æ—¥ä¹‹åçš„å‘˜å·¥ä¿¡æ¯å’Œéƒ¨é—¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">-- å­æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept t1 ,(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.`join_date` <span class="operator">&gt;</span> <span class="string">&#x27;2011-11-11&#x27;</span>) t2</span><br><span class="line"><span class="keyword">WHERE</span> t1.id <span class="operator">=</span> t2.dept_id;</span><br><span class="line"><span class="comment">-- æ™®é€šå†…è¿æ¥</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp t1,dept t2 <span class="keyword">WHERE</span> t1.`dept_id` <span class="operator">=</span> t2.`id` <span class="keyword">AND</span> t1.`join_date` <span class="operator">&gt;</span>  <span class="string">&#x27;2011-11-11&#x27;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„ç´¢å¼•</title>
    <url>/posts/9edcaf99/</url>
    <content><![CDATA[<h2 id="ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ">ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ç´¢å¼•æ˜¯ä»€ä¹ˆäº†ï¼ŒæŸ¥é˜…äº†å®˜æ–¹æ–‡æ¡£ã€‚å®˜æ–¹æ–‡æ¡£å†™äº†ç´¢å¼•çš„ä½œç”¨å’Œæ²¡æœ‰ç´¢å¼•ä¼šå¸¦æ¥å…¨è¡¨æ‰«æï¼Œéå¸¸è´¹æ—¶é—´ã€‚ <code>Indexes are used to find rows with specific column values quickly. Without an index, MySQL must begin with the first row and then read through the entire table to find the relevant rows.</code> ç®€å•çš„è¯´ç´¢å¼•æ˜¯æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±åƒæ˜¯ä»¥å‰çš„è‹±æ–‡è¯å…¸ï¼Œæ‰¾å•è¯å¦‚æœæ²¡æœ‰å‰é¢ç›®å½•çš„è¯ï¼Œæ•ˆç‡å¾ˆä½ï¼Œå¾—å…¨æ–‡æ‰¾ä¸€éã€‚</p>
<h2 id="ç´¢å¼•å®ç°åŸç†">ç´¢å¼•å®ç°åŸç†</h2>
<p>è¦ææ¸…æ¥šç´¢å¼•çš„å®ç°åŸç†ï¼Œå…ˆçœ‹çœ‹ç´¢å¼•çš„åº•å±‚å®ç°ï¼Œ<strong>MySQLç´¢å¼•å¤§éƒ¨åˆ†é‡‡ç”¨B-Treeå®ç°ï¼ŒB-Treeåˆæœ‰B-æ ‘å’ŒB+æ ‘</strong>ã€‚è¿˜æœ‰ä¸€äº›ä½¿ç”¨Hashç´¢å¼•ã€‚</p>
<h3 id="äºŒå‰æœç´¢æ ‘">äºŒå‰æœç´¢æ ‘</h3>
<p>å†è¯´B-Treeä¹‹å‰ï¼Œå…ˆç®€å•äº†è§£ä¸€ä¸‹äºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treesï¼‰ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309160238.png" alt="image-20210309160238726"></p>
<p>ç†è§£äºŒå‰æœç´¢æ ‘ï¼Œå¯¹äºåé¢ç†è§£B-å’ŒB+æ ‘å¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºè¿™2ç§æœ‰äº›ç‰¹æ€§è·ŸäºŒå‰æœç´¢æ ‘å¾ˆåƒã€‚äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹æ˜¯å·¦å­©å­çš„å€¼å°äºçˆ¶äº²èŠ‚ç‚¹çš„å€¼ï¼Œçˆ¶äº²èŠ‚ç‚¹çš„å€¼å°äºå³å­©å­çš„å€¼ï¼Œå³æŒ‰äºŒå‰æ ‘çš„ä¸­åºéå†ï¼Œåˆšå¥½æ˜¯ä¸€ä¸ªæŒ‰å°åˆ°å¤§æ’åºçš„ã€‚äºŒå‰æœç´¢æ ‘çš„æŸ¥æ‰¾å°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœè¦æŸ¥æ‰¾10ï¼Œå› ä¸º10æ¯”27å°ï¼Œæ‰€ä»¥å¾€å·¦å­©å­æ‰¾ï¼Œ10&lt;14ï¼Œè¿˜åœ¨å·¦å­©å­æ‰¾ã€‚æœ€åçš„æƒ…å†µä¸‹ï¼Œ<strong>æŸ¥æ‰¾çš„æ¬¡æ•°ç­‰äºæ ‘çš„é«˜åº¦</strong>ã€‚</p>
<h3 id="Bæ ‘">Bæ ‘</h3>
<p><strong>Bæ ‘å’ŒB-treeç†è§£æˆäº†ä¸¤ç§ä¸åŒç±»åˆ«çš„æ ‘ï¼Œå…¶å®è¿™ä¸¤ä¸ªæ˜¯åŒä¸€ç§æ ‘;</strong></p>
<h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4>
<p>Bæ ‘å’Œå¹³è¡¡äºŒå‰æ ‘ç¨æœ‰ä¸åŒçš„æ˜¯Bæ ‘å±äºå¤šå‰æ ‘åˆåå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼ˆæŸ¥æ‰¾è·¯å¾„ä¸åªä¸¤ä¸ªï¼‰ï¼Œæ•°æ®åº“ç´¢å¼•æŠ€æœ¯é‡Œå¤§é‡ä½¿ç”¨è€…Bæ ‘å’ŒB+æ ‘çš„æ•°æ®ç»“æ„</p>
<h4 id="è§„åˆ™">è§„åˆ™</h4>
<ol>
<li>æ’åºæ–¹å¼ï¼šæ‰€æœ‰èŠ‚ç‚¹å…³é”®å­—æ˜¯æŒ‰é€’å¢æ¬¡åºæ’åˆ—ï¼Œå¹¶éµå¾ªå·¦å°å³å¤§åŸåˆ™ï¼›</li>
<li>å­èŠ‚ç‚¹æ•°ï¼šéå¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°&gt;1ï¼Œä¸”&lt;=M ï¼Œä¸”M&gt;=2ï¼Œç©ºæ ‘é™¤å¤–ï¼ˆæ³¨ï¼šMé˜¶ä»£è¡¨ä¸€ä¸ªæ ‘èŠ‚ç‚¹æœ€å¤šæœ‰å¤šå°‘ä¸ªæŸ¥æ‰¾è·¯å¾„ï¼ŒM=Mè·¯,å½“M=2åˆ™æ˜¯2å‰æ ‘,M=3åˆ™æ˜¯3å‰ï¼‰ï¼›</li>
<li>å…³é”®å­—æ•°ï¼šæèŠ‚ç‚¹çš„å…³é”®å­—æ•°é‡å¤§äºç­‰äºceil(m/2)-1ä¸ªä¸”å°äºç­‰äºM-1ä¸ªï¼ˆæ³¨ï¼šceil()æ˜¯ä¸ªæœæ­£æ— ç©·æ–¹å‘å–æ•´çš„å‡½æ•° å¦‚ceil(1.1)ç»“æœä¸º2);</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹å‡åœ¨åŒä¸€å±‚ã€å¶å­èŠ‚ç‚¹é™¤äº†åŒ…å«äº†å…³é”®å­—å’Œå…³é”®å­—è®°å½•çš„æŒ‡é’ˆå¤–ä¹Ÿæœ‰æŒ‡å‘å…¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆåªä¸è¿‡å…¶æŒ‡é’ˆåœ°å€éƒ½ä¸ºnullå¯¹åº”ä¸‹å›¾æœ€åä¸€å±‚èŠ‚ç‚¹çš„ç©ºæ ¼å­;</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309163100.png" alt="image-20210309163059977"></p>
<h4 id="Bæ ‘æŸ¥è¯¢æµç¨‹">Bæ ‘æŸ¥è¯¢æµç¨‹</h4>
<p>ä»ä¸Šå›¾ä¸­æ‰¾åˆ°Eå­—æ¯ï¼ŒæŸ¥æ‰¾æµç¨‹å¦‚ä¸‹</p>
<ol>
<li>è·å–æ ¹èŠ‚ç‚¹çš„å…³é”®å­—è¿›è¡Œæ¯”è¾ƒï¼Œå½“å‰æ ¹èŠ‚ç‚¹å…³é”®å­—ä¸ºMï¼ŒE&lt;Mï¼ˆ26ä¸ªå­—æ¯é¡ºåºï¼‰ï¼Œæ‰€ä»¥å¾€æ‰¾åˆ°æŒ‡å‘å·¦è¾¹çš„å­èŠ‚ç‚¹ï¼ˆäºŒåˆ†æ³•è§„åˆ™ï¼Œå·¦å°å³å¤§ï¼Œå·¦è¾¹æ”¾å°äºå½“å‰èŠ‚ç‚¹å€¼çš„å­èŠ‚ç‚¹ã€å³è¾¹æ”¾å¤§äºå½“å‰èŠ‚ç‚¹å€¼çš„å­èŠ‚ç‚¹ï¼‰ï¼›</li>
<li>æ‹¿åˆ°å…³é”®å­—Då’ŒGï¼ŒD&lt;E&lt;G æ‰€ä»¥ç›´æ¥æ‰¾åˆ°Då’ŒGä¸­é—´çš„èŠ‚ç‚¹ï¼›</li>
<li>æ‹¿åˆ°Eå’ŒFï¼Œå› ä¸ºE=E æ‰€ä»¥ç›´æ¥è¿”å›å…³é”®å­—å’ŒæŒ‡é’ˆä¿¡æ¯ï¼ˆå¦‚æœæ ‘ç»“æ„é‡Œé¢æ²¡æœ‰åŒ…å«æ‰€è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹åˆ™è¿”å›nullï¼‰ï¼›</li>
</ol>
<h4 id="Bæ ‘æ’å…¥èŠ‚ç‚¹æµç¨‹">Bæ ‘æ’å…¥èŠ‚ç‚¹æµç¨‹</h4>
<p>èŠ‚ç‚¹è¦å¤„äºè¿è§„çŠ¶æ€ï¼Œå®ƒå¿…é¡»åŒ…å«åœ¨å¯æ¥å—èŒƒå›´ä¹‹å¤–æ•°ç›®çš„å…ƒç´ ã€‚</p>
<ol>
<li>é¦–å…ˆï¼ŒæŸ¥æ‰¾è¦æ’å…¥å…¶ä¸­çš„èŠ‚ç‚¹çš„ä½ç½®ã€‚æ¥ç€æŠŠå€¼æ’å…¥è¿™ä¸ªèŠ‚ç‚¹ä¸­ã€‚</li>
<li>å¦‚æœæ²¡æœ‰èŠ‚ç‚¹å¤„äºè¿è§„çŠ¶æ€åˆ™å¤„ç†ç»“æŸã€‚</li>
<li>å¦‚æœæŸä¸ªèŠ‚ç‚¹æœ‰è¿‡å¤šå…ƒç´ ï¼Œåˆ™æŠŠå®ƒåˆ†è£‚ä¸ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªéƒ½æœ‰æœ€å°æ•°ç›®çš„å…ƒç´ ã€‚åœ¨æ ‘ä¸Šé€’å½’å‘ä¸Šç»§ç»­è¿™ä¸ªå¤„ç†ç›´åˆ°åˆ°è¾¾æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹è¢«åˆ†è£‚ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ ¹èŠ‚ç‚¹ã€‚ä¸ºäº†ä½¿å®ƒå·¥ä½œï¼Œå…ƒç´ çš„æœ€å°å’Œæœ€å¤§æ•°ç›®å…¸å‹çš„å¿…é¡»é€‰æ‹©ä¸ºä½¿æœ€å°æ•°ä¸å°äºæœ€å¤§æ•°çš„ä¸€åŠã€‚</li>
</ol>
<h4 id="Bæ ‘åˆ é™¤èŠ‚ç‚¹æµç¨‹">Bæ ‘åˆ é™¤èŠ‚ç‚¹æµç¨‹</h4>
<ol>
<li>é¦–å…ˆï¼ŒæŸ¥æ‰¾è¦åˆ é™¤çš„å€¼ã€‚æ¥ç€ä»åŒ…å«å®ƒçš„èŠ‚ç‚¹ä¸­åˆ é™¤è¿™ä¸ªå€¼ã€‚</li>
<li>å¦‚æœæ²¡æœ‰èŠ‚ç‚¹å¤„äºè¿è§„çŠ¶æ€åˆ™å¤„ç†ç»“æŸã€‚</li>
<li>å¦‚æœèŠ‚ç‚¹å¤„äºè¿è§„çŠ¶æ€åˆ™æœ‰ä¸¤ç§å¯èƒ½æƒ…å†µï¼š
<ol>
<li>å®ƒçš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå°±æ˜¯åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæˆ–å¤šä¸ªå®ƒçš„å­èŠ‚ç‚¹è½¬ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼Œè€ŒæŠŠå®ƒè¿”å›ä¸ºåˆæ³•çŠ¶æ€ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œåœ¨æ›´æ”¹çˆ¶èŠ‚ç‚¹å’Œä¸¤ä¸ªå…„å¼ŸèŠ‚ç‚¹çš„åˆ†ç¦»å€¼ä¹‹åå¤„ç†ç»“æŸã€‚</li>
<li>å®ƒçš„å…„å¼ŸèŠ‚ç‚¹ç”±äºå¤„åœ¨ä½è¾¹ç•Œä¸Šè€Œæ²¡æœ‰é¢å¤–çš„å­èŠ‚ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹æŠŠä¸¤ä¸ªå…„å¼ŸèŠ‚ç‚¹åˆå¹¶åˆ°ä¸€ä¸ªå•ä¸€çš„èŠ‚ç‚¹ä¸­ï¼Œè€Œä¸”æˆ‘ä»¬é€’å½’åˆ°çˆ¶èŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºå®ƒè¢«åˆ é™¤äº†ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚æŒç»­è¿™ä¸ªå¤„ç†ç›´åˆ°å½“å‰èŠ‚ç‚¹æ˜¯åˆæ³•çŠ¶æ€æˆ–è€…åˆ°è¾¾æ ¹èŠ‚ç‚¹ï¼Œåœ¨å…¶ä¸Šæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¢«åˆå¹¶è€Œä¸”åˆå¹¶åçš„èŠ‚ç‚¹æˆä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ã€‚</li>
</ol>
</li>
</ol>
<h3 id="B-æ ‘">B+æ ‘</h3>
<h4 id="æ¦‚å¿µ-2">æ¦‚å¿µ</h4>
<p>B+æ ‘æ˜¯Bæ ‘çš„ä¸€ä¸ªå‡çº§ç‰ˆï¼Œç›¸å¯¹äºBæ ‘æ¥è¯´B+æ ‘æ›´å……åˆ†çš„åˆ©ç”¨äº†èŠ‚ç‚¹çš„ç©ºé—´ï¼Œè®©æŸ¥è¯¢é€Ÿåº¦æ›´åŠ ç¨³å®šï¼Œå…¶é€Ÿåº¦å®Œå…¨æ¥è¿‘äºäºŒåˆ†æ³•æŸ¥æ‰¾ã€‚</p>
<h4 id="è§„åˆ™-2">è§„åˆ™</h4>
<ol>
<li>B+è·ŸBæ ‘ä¸åŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸ä¿å­˜å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œåªè¿›è¡Œæ•°æ®ç´¢å¼•ï¼Œè¿™æ ·ä½¿å¾—B+æ ‘æ¯ä¸ªéå¶å­èŠ‚ç‚¹æ‰€èƒ½ä¿å­˜çš„å…³é”®å­—å¤§å¤§å¢åŠ ï¼›</li>
<li>B+æ ‘å¶å­èŠ‚ç‚¹ä¿å­˜äº†çˆ¶èŠ‚ç‚¹çš„æ‰€æœ‰å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œæ‰€æœ‰æ•°æ®åœ°å€å¿…é¡»è¦åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½è·å–åˆ°ã€‚æ‰€ä»¥æ¯æ¬¡æ•°æ®æŸ¥è¯¢çš„æ¬¡æ•°éƒ½ä¸€æ ·ï¼›</li>
<li>B+æ ‘å¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä»å°åˆ°å¤§æœ‰åºæ’åˆ—ï¼Œå·¦è¾¹ç»“å°¾æ•°æ®éƒ½ä¼šä¿å­˜å³è¾¹èŠ‚ç‚¹å¼€å§‹æ•°æ®çš„æŒ‡é’ˆã€‚</li>
<li><strong>éå¶å­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°=å…³é”®å­—æ•°ï¼ˆæ¥æºç™¾åº¦ç™¾ç§‘ï¼‰ï¼ˆæ ¹æ®å„ç§èµ„æ–™ è¿™é‡Œæœ‰ä¸¤ç§ç®—æ³•çš„å®ç°æ–¹å¼ï¼Œå¦ä¸€ç§ä¸ºéå¶èŠ‚ç‚¹çš„å…³é”®å­—æ•°=å­èŠ‚ç‚¹æ•°-1ï¼ˆæ¥æºç»´åŸºç™¾ç§‘)ï¼Œè™½ç„¶ä»–ä»¬æ•°æ®æ’åˆ—ç»“æ„ä¸ä¸€æ ·ï¼Œä½†å…¶åŸç†è¿˜æ˜¯ä¸€æ ·çš„Mysql çš„B+æ ‘æ˜¯ç”¨ç¬¬ä¸€ç§æ–¹å¼å®ç°ï¼‰</strong>;</li>
</ol>
<h4 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h4>
<ol>
<li>B+æ ‘çš„å±‚çº§æ›´å°‘ï¼šç›¸è¾ƒäºBæ ‘B+æ¯ä¸ªéå¶å­èŠ‚ç‚¹å­˜å‚¨çš„å…³é”®å­—æ•°æ›´å¤šï¼Œæ ‘çš„å±‚çº§æ›´å°‘æ‰€ä»¥æŸ¥è¯¢æ•°æ®æ›´å¿«</li>
<li>B+æ ‘æŸ¥è¯¢é€Ÿåº¦æ›´ç¨³å®šï¼šB+æ‰€æœ‰å…³é”®å­—æ•°æ®åœ°å€éƒ½å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æ¯æ¬¡æŸ¥æ‰¾çš„æ¬¡æ•°éƒ½ç›¸åŒæ‰€ä»¥æŸ¥è¯¢é€Ÿåº¦è¦æ¯”Bæ ‘æ›´ç¨³å®š;</li>
<li>B+æ ‘å¤©ç„¶å…·å¤‡æ’åºåŠŸèƒ½ï¼šB+æ ‘æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹æ•°æ®æ„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œåœ¨æŸ¥è¯¢å¤§å°åŒºé—´çš„æ•°æ®æ—¶å€™æ›´æ–¹ä¾¿ï¼Œæ•°æ®ç´§å¯†æ€§å¾ˆé«˜ï¼Œç¼“å­˜çš„å‘½ä¸­ç‡ä¹Ÿä¼šæ¯”Bæ ‘é«˜ã€‚</li>
<li>B+æ ‘å…¨èŠ‚ç‚¹éå†æ›´å¿«ï¼šB+æ ‘éå†æ•´æ£µæ ‘åªéœ€è¦éå†æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹å³å¯ï¼Œï¼Œè€Œä¸éœ€è¦åƒBæ ‘ä¸€æ ·éœ€è¦å¯¹æ¯ä¸€å±‚è¿›è¡Œéå†ï¼Œè¿™æœ‰åˆ©äºæ•°æ®åº“åšå…¨è¡¨æ‰«æã€‚</li>
</ol>
<blockquote>
<p>Bæ ‘ç›¸å¯¹äºB+æ ‘çš„ä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœç»å¸¸è®¿é—®çš„æ•°æ®ç¦»æ ¹èŠ‚ç‚¹å¾ˆè¿‘ï¼Œè€ŒBæ ‘çš„éå¶å­èŠ‚ç‚¹æœ¬èº«å­˜æœ‰å…³é”®å­—å…¶æ•°æ®çš„åœ°å€ï¼Œæ‰€ä»¥è¿™ç§æ•°æ®æ£€ç´¢çš„æ—¶å€™ä¼šè¦æ¯”B+æ ‘å¿«ã€‚</p>
</blockquote>
<h2 id="ä¸ºä»€ä¹ˆæ˜¯B-Tree-B-æ¥å®ç°æ•°æ®åº“ç´¢å¼•">ä¸ºä»€ä¹ˆæ˜¯B-Tree(B+)æ¥å®ç°æ•°æ®åº“ç´¢å¼•</h2>
<h3 id="ç£ç›˜å­˜å–åŸç†">ç£ç›˜å­˜å–åŸç†</h3>
<p>æ•°æ®å¯¼è®ºä¹¦ä¸­å¼€å¤´å°±æ˜¯è¯´ï¼š Bæ ‘æ˜¯ä¸ºç£ç›˜æˆ–å…¶ä»–ç›´æ¥å­˜å–çš„è¾…åŠ©å­˜å‚¨è®¾å¤‡è€Œè®¾è®¡çš„ä¸€ç§å¹³è¡¡æœç´¢æ ‘,è®¡ç®—æœºç³»ç»Ÿæœ‰ä¸»å­˜å’ŒåŸºäºç£ç›˜çš„è¾…å­˜ï¼Œä¸»å­˜é€šå¸¸å°±æ˜¯æˆ‘ä»¬è¯´çš„RAMï¼Œä¹Ÿå°±æ˜¯å†…å­˜ï¼Œè¿™é‡Œä¸å±•å¼€è¯´å®ƒã€‚<strong>ç´¢å¼•æ–‡ä»¶æœ¬èº«å¾ˆå¤§ï¼Œä¸€èˆ¬ä¸ä¼šå­˜åœ¨å†…å­˜é‡Œï¼Œå› æ­¤ç´¢å¼•å¾€å¾€æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜é‡Œï¼Œæ‰€ä»¥ç´¢å¼•æ£€ç´¢éœ€è¦ç£ç›˜I/Oæ“ä½œ</strong></p>
<p>ä¸ºäº†ç¼©çŸ­ç£ç›˜è¯»å–çš„æ—¶é—´ï¼Œè®¡ç®—æœºåšäº†ä¸€äº›ä¼˜åŒ–ï¼šç£ç›˜é¢„è¯»ã€‚ç£ç›˜é¢„è¯»æ˜¯åŸºäºå±€éƒ¨æ€§åŸç†ï¼šå½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚æ‰€ä»¥ç£ç›˜I/Oæ“ä½œæ—¶ä¸å…‰æŠŠå½“å‰ç£ç›˜åœ°å€çš„æ•°æ®ï¼Œè€Œæ˜¯æŠŠç›¸é‚»çš„æ•°æ®ä¹Ÿéƒ½è¯»å–åˆ°å†…å­˜ç¼“å†²åŒºå†…ï¼Œå› ä¸ºå±€éƒ¨æ€§åŸç†å‘Šè¯‰æˆ‘ä»¬ï¼Œ<strong>å½“è®¡ç®—æœºè®¿é—®ä¸€ä¸ªåœ°å€çš„æ•°æ®çš„æ—¶å€™ï¼Œä¸å…¶ç›¸é‚»çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«è¢«è®¿é—®åˆ°</strong>.</p>
<p>é¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚</p>
<ul>
<li>æ–‡ä»¶å¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•…è¦å­˜å‚¨åˆ°ç£ç›˜ä¸Šã€‚</li>
<li>ç´¢å¼•çš„ç»“æ„ç»„ç»‡è¦å°½é‡å‡å°‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oçš„å­˜å–æ¬¡æ•°ï¼Œå› ä¸ºæ¯æ¬¡ç£ç›˜I/Oæ¶ˆè€—æ—¶é—´éƒ½æ˜¯éå¸¸å¤šçš„ã€‚</li>
<li>å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»ï¼Œé¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚</li>
</ul>
<h3 id="B-B-çš„æŸ¥æ‰¾æ€§èƒ½">B-/B+çš„æŸ¥æ‰¾æ€§èƒ½</h3>
<p>æ•°æ®åº“ç³»ç»Ÿå·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚B-æ ‘ä¹Ÿåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€æ¬¡ç£ç›˜I/Oå°±è¯»å–äº†ä¸€é¡µçš„æ•°æ®ã€‚ä¸‹é¢æ˜¯B-æ ‘çš„ç¤ºä¾‹å›¾ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309164634.png" alt="image-20210309164634346"></p>
<p>æ ¹æ®B-Treeçš„å®šä¹‰ï¼Œå¯çŸ¥æ£€ç´¢ä¸€æ¬¡æœ€å¤šéœ€è¦è®¿é—®hä¸ªèŠ‚ç‚¹ï¼ˆhä¸ªæ ‘çš„é«˜åº¦ï¼‰ã€‚**B-Treeä¸­ä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦h-1æ¬¡I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œæ¸è¿›å¤æ‚åº¦ä¸ºO(h)=O(logdN)ã€‚ä¸€èˆ¬å®é™…åº”ç”¨ä¸­ï¼Œå‡ºåº¦dæ˜¯éå¸¸å¤§çš„æ•°å­—ï¼Œé€šå¸¸è¶…è¿‡100ï¼Œå› æ­¤héå¸¸å°ï¼ˆé€šå¸¸ä¸è¶…è¿‡3ï¼‰ã€‚æ‰€ä»¥B-Treeä½œä¸ºç´¢å¼•æ•ˆç‡æ˜¯éå¸¸é«˜ï¼Œç›¸æ¯”å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘è¦é«˜å¾ˆå¤šï¼Œ**å› ä¸ºè¿™äº›æ ‘çš„hä¸€èˆ¬éƒ½æ¯”è¾ƒæ·±ã€‚</p>
<h3 id="B-æ ‘çš„ç›´è§‚å›¾">B+æ ‘çš„ç›´è§‚å›¾</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309164727.png" alt="image-20210309164727718"></p>
<p>B+æ ‘æ¯”B-æ ‘æ›´åŠ é€‚åˆä½œä¸ºç£ç›˜çš„ç´¢å¼•æ•°æ®ç»“æ„ï¼ŒåŸå› æ˜¯B+æ ‘çš„å†…éƒ¨ç»“ç‚¹ä¸å­˜å‚¨dataï¼Œå†…éƒ¨ç»“ç‚¹çš„å‡ºåº¦dè¶Šå¤§ï¼Œé‚£ä¹ˆæ¸è¿›å¤æ‚åº¦è¶Šå°ã€‚å‡ºåº¦dçš„ä¸Šé™å–å†³äºèŠ‚ç‚¹å†…keyå’Œdataçš„å¤§å°ï¼š <strong>dmax=floor(pagesize/(keysize+datasize+pointsize))</strong></p>
<p>ä¸€èˆ¬3å±‚B+æ ‘å¯ä»¥å­˜å‚¨ä¸Šç™¾ä¸‡çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯»å–ä¸Šç™¾ä¸‡çš„æ•°æ®ï¼Œåªéœ€è¦3æ¬¡ç£ç›˜I/Oï¼Œå¯è§è¿™æ•ˆç‡ï¼Œå¤§å¤§æå‡äº†ã€‚</p>
<h2 id="ä¸åŒå¼•æ“çš„ç´¢å¼•å®ç°åŸç†">ä¸åŒå¼•æ“çš„ç´¢å¼•å®ç°åŸç†</h2>
<h3 id="MyISAMç´¢å¼•å®ç°">MyISAMç´¢å¼•å®ç°</h3>
<p>MyISAMçš„ç´¢å¼•é‡‡ç”¨B+æ ‘å®ç°ï¼ŒMyISAMçš„ç´¢å¼•å’Œæ•°æ®æ—¶åˆ†å¼€çš„ï¼Œå¶å­èŠ‚ç‚¹dataå­˜å–çš„æ˜¯æ•°æ®çš„åœ°å€ï¼Œè¦æ ¹æ®ç´¢å¼•æ‰¾åˆ°æ•°æ®ï¼Œå…ˆæ ¹æ®ç´¢å¼•æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œå†æ ¹æ®å¶å­èŠ‚ç‚¹æ‰¾åˆ°æ•°æ®çš„åœ°å€ï¼Œç„¶åå†æ ¹æ®æ•°æ®åœ°å€å–å‡ºæ•°æ®</p>
<h4 id="ä¸»é”®ç´¢å¼•ï¼š">ä¸»é”®ç´¢å¼•ï¼š</h4>
<p>MyISAMå¼•æ“ä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚<br>
ä¸‹å›¾æ˜¯MyISAMä¸»é”®ç´¢å¼•çš„åŸç†å›¾ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309165534.png" alt="image-20210309165534544"></p>
<p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥Col1ä¸ºä¸»é”®ï¼Œå›¾myisam1æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•ï¼ˆPrimary keyï¼‰ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡ºMyISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚</p>
<h4 id="è¾…åŠ©ç´¢å¼•ï¼ˆSecondary-keyï¼‰">è¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰</h4>
<p><strong>åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚</strong> å¦‚æœæˆ‘ä»¬åœ¨Col2ä¸Šå»ºç«‹ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309165625.png" alt="image-20210309165625118"></p>
<p>åŒæ ·ä¹Ÿæ˜¯ä¸€é¢—B+Treeï¼ŒdataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼Œ<strong>MyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</strong><br>
MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p>
<h3 id="InnoDBç´¢å¼•å®ç°">InnoDBç´¢å¼•å®ç°</h3>
<p>è™½ç„¶InnoDBä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†å…·ä½“å®ç°æ–¹å¼å´ä¸MyISAMæˆªç„¶ä¸åŒã€‚</p>
<ol>
<li><strong>ç¬¬ä¸€ä¸ªé‡å¤§åŒºåˆ«æ˜¯InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚</strong></li>
<li>InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚</li>
</ol>
<h4 id="ä¸»é”®ç´¢å¼•ï¼š-2">ä¸»é”®ç´¢å¼•ï¼š</h4>
<p>MyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309165746.png" alt="image-20210309165746780"></p>
<p>ä»¥ä¸Šæ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åš<strong>èšé›†ç´¢å¼•</strong>ã€‚å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚</p>
<h4 id="InnoDBçš„è¾…åŠ©ç´¢å¼•">InnoDBçš„è¾…åŠ©ç´¢å¼•</h4>
<p>InnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾ä¸ºå®šä¹‰åœ¨Col3ä¸Šçš„ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309165824.png" alt="image-20210309165824763"></p>
<p><strong>InnoDB è¡¨æ˜¯åŸºäºèšç°‡ç´¢å¼•å»ºç«‹çš„</strong>ã€‚å› æ­¤InnoDB çš„ç´¢å¼•èƒ½æä¾›ä¸€ç§éå¸¸å¿«é€Ÿçš„ä¸»é”®æŸ¥æ‰¾æ€§èƒ½ã€‚ä¸è¿‡ï¼Œå®ƒçš„è¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼Œ ä¹Ÿå°±æ˜¯éä¸»é”®ç´¢å¼•ï¼‰ä¹Ÿä¼šåŒ…å«ä¸»é”®åˆ—ï¼Œ <strong>æ‰€ä»¥ï¼Œå¦‚æœä¸»é”®å®šä¹‰çš„æ¯”è¾ƒå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿå°†å¾ˆå¤§ã€‚å¦‚æœæƒ³åœ¨è¡¨ä¸Šå®šä¹‰å¾ˆå¤šç´¢å¼•ï¼Œåˆ™äº‰å–å°½é‡æŠŠä¸»é”®å®šä¹‰å¾—å°ä¸€äº›ã€‚</strong> InnoDB ä¸ä¼šå‹ç¼©ç´¢å¼•ã€‚</p>
<p>æ–‡å­—ç¬¦çš„ASCIIç ä½œä¸ºæ¯”è¾ƒå‡†åˆ™ã€‚<strong>èšé›†ç´¢å¼•è¿™ç§å®ç°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ã€‚</strong></p>
<p>ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½<strong>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚</strong> å†ä¾‹å¦‚ï¼Œ <strong>ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</strong></p>
<h3 id="InnoDBç´¢å¼•å’ŒMyISAMç´¢å¼•çš„åŒºåˆ«ï¼š">InnoDBç´¢å¼•<strong>å’Œ</strong>MyISAMç´¢å¼•çš„åŒºåˆ«ï¼š</h3>
<p>ä¸€æ˜¯ä¸»ç´¢å¼•çš„åŒºåˆ«ï¼ŒInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚è€ŒMyISAMçš„ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ã€‚</p>
<p>äºŒæ˜¯è¾…åŠ©ç´¢å¼•çš„åŒºåˆ«ï¼šInnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚è€ŒMyISAMçš„è¾…åŠ©ç´¢å¼•å’Œä¸»ç´¢å¼•æ²¡æœ‰å¤šå¤§åŒºåˆ«ã€‚</p>
<h4 id="æ„ä¹‰">æ„ä¹‰</h4>
<p>InnoDBè¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ï¼Œä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸º<strong>æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚</strong></p>
<p><strong>ä¸å»ºè®®ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºInnoDBçš„ä¸»é”®</strong>ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œ<strong>éå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œæ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®ã€‚</strong></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„ä¼˜åŒ–</title>
    <url>/posts/f1e1e97a/</url>
    <content><![CDATA[<p><a href="https://dev.mysql.com/doc/refman/8.0/en/optimization.html">MySQLä¼˜åŒ–å®˜ç½‘å‚è€ƒ</a></p>
<h2 id="å¦‚ä½•ä¼˜åŒ–">å¦‚ä½•ä¼˜åŒ–</h2>
<ul>
<li>è®¾è®¡æ•°æ®åº“æ—¶ï¼šæ•°æ®åº“è¡¨ã€å­—æ®µçš„è®¾è®¡ï¼Œå­˜å‚¨å¼•æ“</li>
<li>åˆ©ç”¨å¥½MySQLè‡ªèº«æä¾›çš„åŠŸèƒ½ï¼Œå¦‚ç´¢å¼•ç­‰</li>
<li>æ¨ªå‘æ‰©å±•ï¼šMySQLé›†ç¾¤ã€è´Ÿè½½å‡è¡¡ã€è¯»å†™åˆ†ç¦»</li>
<li>SQLè¯­å¥çš„ä¼˜åŒ–ï¼ˆæ”¶æ•ˆç”šå¾®ï¼‰</li>
</ul>
<h2 id="å­—æ®µè®¾è®¡">å­—æ®µè®¾è®¡</h2>
<blockquote>
<p>å­—æ®µç±»å‹çš„é€‰æ‹©ï¼Œè®¾è®¡è§„èŒƒï¼ŒèŒƒå¼ï¼Œå¸¸è§è®¾è®¡æ¡ˆä¾‹</p>
</blockquote>
<h3 id="å­˜å‚¨IPåœ°å€">å­˜å‚¨IPåœ°å€</h3>
<p><strong>å¸¸è§„åšæ³•</strong>ï¼š varcharï¼ˆ15ï¼‰</p>
<p><strong>ä¼˜åŒ–é€‰æ‹©</strong>ï¼šint unsignedï¼Œå ç”¨4ä¸ªå­—èŠ‚ï¼ŒèŠ‚çœç©ºé—´ï¼ŒIPè¿ç®—é€Ÿåº¦å—</p>
<blockquote>
<p>inet_atonï¼›</p>
<p>inet_ntoa;</p>
<p>aâ€”address,n----number</p>
</blockquote>
<h3 id="å°½é‡ä½¿ç”¨æ•´æ•°å»è¡¨ç¤ºå­—ç¬¦ä¸²">å°½é‡ä½¿ç”¨æ•´æ•°å»è¡¨ç¤ºå­—ç¬¦ä¸²</h3>
<p><strong>æ•´å‹çš„ä¼˜åŠ¿</strong>ï¼šå­˜å‚¨ç©ºé—´å›ºå®šã€‚å¾€å¾€æ˜¯å°‘é‡ç©ºé—´,è¿ç®—é€Ÿåº¦å—</p>
<blockquote>
<p>MySQL å†…éƒ¨çš„æšä¸¾ï¼ˆå•é€‰ï¼‰ç±»å‹å’Œé›†åˆï¼ˆå¤šé€‰ï¼‰ç±»å‹ä½†æ˜¯ï¼Œ<strong>å®æ“çš„æ—¶å€™enumå’Œsetå¾ˆå°‘ç”¨</strong></p>
<p><strong>åŸå› </strong>ï¼šç»´æŠ¤æˆæœ¬é«˜</p>
<p><strong>ä½¿ç”¨çš„æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šå…³è”è¡¨</p>
</blockquote>
<h3 id="å­˜å‚¨é‡‘é¢">å­˜å‚¨é‡‘é¢</h3>
<p><strong>é‡‘é¢ï¼Œä»·æ ¼ï¼Œç»Ÿè®¡æ•°æ®çš„å­˜å‚¨</strong>ï¼šå¯¹æ•°æ®çš„ç²¾åº¦è¦æ±‚é«˜,</p>
<p><strong>ä¼˜åŒ–é€‰æ‹©</strong>ï¼š</p>
<ol>
<li>
<p><strong>price decimalï¼ˆ8ï¼Œ2ï¼‰</strong>ï¼›å®šç‚¹æ•°ï¼Œæœ‰ä¸¤ä½å°æ•°çš„å®šç‚¹æ•°ã€‚</p>
</li>
<li>
<p>price int ï¼Œbigintï¼Œæ•´æ•°ï¼Œå°å•ä½â€“&gt;å¤§æ•°é¢ï¼Œå¦‚<strong>9.01   åœ¨æ•°æ®åº“ä¸­å­˜å‚¨2ä¸º901ï¼Œåœ¨ç¨‹åºä¸­è¿›è¡Œç›¸å…³å¤„ç†</strong></p>
<blockquote>
<p>æ³¨æ„ï¼šå®šç‚¹æ•°ï¼Œæ”¯æŒå¾ˆå¤§çš„æ•°ï¼Œ</p>
<p>è½¬æˆå°å•ä½åï¼Œæ•´æ•°å­˜å‚¨ä¸äº†ï¼</p>
</blockquote>
</li>
</ol>
<h3 id="å®šé•¿æ•°æ®ç±»å‹å’Œå˜é•¿æ•°æ®ç±»å‹çš„é€‰æ‹©">å®šé•¿æ•°æ®ç±»å‹å’Œå˜é•¿æ•°æ®ç±»å‹çš„é€‰æ‹©</h3>
<p><strong>å®šç‚¹æ•°å’Œæµ®ç‚¹æ•°çš„é€‰æ‹©</strong></p>
<p><strong>å®šç‚¹æ•°</strong>ï¼šä¸ä¼šç²¾åº¦ä¸¢å¤±ã€‚ å ç”¨ç©ºé—´éšè€…æ•°å­—çš„å¢åŠ è€Œå¢åŠ </p>
<p><strong>æµ®ç‚¹æ•°</strong>ï¼šå¯¼è‡´ç²¾åº¦ä¸¢å¤± ã€‚å ç”¨å›ºå®šçš„å­˜å‚¨ç©ºé—´ï¼Œæ— è®ºå­˜å‚¨å¤šå¤§çš„æ•°æ®ï¼Œå ç”¨çš„ç©ºé—´æ˜¯å›ºå®šçš„ï¼ˆç±»ä¼¼äºintï¼‰</p>
<p><strong>å®šé•¿ç±»å‹</strong>ï¼šå­˜å‚¨ç©ºé—´å›ºå®šï¼šintï¼Œfloat,double.char,date,time,datetime,year,timestamp</p>
<p><strong>å˜é•¿ç±»å‹</strong>ï¼šå­˜å‚¨ç©ºé—´å¯å˜ï¼švarchar,decimal,text</p>
<h3 id="å­—ç¬¦ä¸²ç±»å‹çš„é€‰æ‹©">å­—ç¬¦ä¸²ç±»å‹çš„é€‰æ‹©</h3>
<p><strong>ä½¿ç”¨varchar</strong></p>
<blockquote>
<p>char(10) å¦‚æœä½ å­˜abcï¼Œéœ€è¦ç©ºé—´ä¸º10ï¼Œ3ä¸ªå­˜abcï¼Œ7ä¸ªå­˜ç©ºå­—ç¬¦ï¼Œå› ä¸ºcharæ˜¯å›ºå®šé•¿åº¦</p>
<p>varchar(10)å¦‚æœä½ å­˜abcï¼Œéœ€è¦ç©ºé—´ä¸º4ï¼Œ3ä¸ªå­˜abcï¼Œ1ä¸ªå­˜é•¿åº¦ï¼Œvarcharæ˜¯å¯å˜é•¿åº¦</p>
<p><strong>è¶…è¿‡10çš„éƒ¨åˆ†ï¼Œéƒ½ä¼šè¢«æˆªæ–­</strong></p>
</blockquote>
<p><strong>text,ç±»å‹ç‹¬ç«‹å­˜å‚¨ï¼Œä¸å ç”¨å­—æ®µæ€»ç©ºé—´</strong></p>
<h3 id="å°½å¯èƒ½é€‰æ‹©å°çš„æ•°æ®ç±»å‹å’ŒæŒ‡å®šçŸ­çš„é•¿åº¦">å°½å¯èƒ½é€‰æ‹©å°çš„æ•°æ®ç±»å‹å’ŒæŒ‡å®šçŸ­çš„é•¿åº¦</h3>
<h3 id="å°½å¯èƒ½ä½¿ç”¨-not-null">å°½å¯èƒ½ä½¿ç”¨ not null</h3>
<p><strong>é<code>null</code>å­—æ®µçš„å¤„ç†è¦æ¯”<code>null</code>å­—æ®µçš„å¤„ç†é«˜æ•ˆäº›</strong>ï¼ä¸”ä¸éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸º<code>null</code>ã€‚</p>
<p><code>null</code>åœ¨MySQLä¸­ï¼Œä¸å¥½å¤„ç†ï¼Œ<strong>å­˜å‚¨éœ€è¦é¢å¤–ç©ºé—´ï¼Œè¿ç®—ä¹Ÿéœ€è¦ç‰¹æ®Šçš„è¿ç®—ç¬¦</strong>ã€‚å¦‚<code>select null = null</code>å’Œ<code>select null &lt;&gt; null</code>ï¼ˆ<code>&lt;&gt;</code>ä¸ºä¸ç­‰å·ï¼‰æœ‰ç€åŒæ ·çš„ç»“æœï¼Œåªèƒ½é€šè¿‡<code>is null</code>å’Œ<code>is not null</code>æ¥åˆ¤æ–­å­—æ®µæ˜¯å¦ä¸º<code>null</code>ã€‚</p>
<blockquote>
<p>MySQLä¸­æ¯æ¡è®°å½•éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œè¡¨ç¤ºæ¯ä¸ªå­—æ®µæ˜¯å¦ä¸º<code>null</code>ã€‚å› æ­¤é€šå¸¸ä½¿ç”¨ç‰¹æ®Šçš„æ•°æ®è¿›è¡Œå ä½ï¼Œæ¯”å¦‚<code>int not null default 0</code>ã€<code>string not null default â€˜â€™</code></p>
</blockquote>
<h3 id="å­—æ®µæ³¨é‡Šè¦å®Œæ•´ï¼Œè§åçŸ¥æ„">å­—æ®µæ³¨é‡Šè¦å®Œæ•´ï¼Œè§åçŸ¥æ„</h3>
<h3 id="å•è¡¨å­—æ®µä¸å®œè¿‡å¤š">å•è¡¨å­—æ®µä¸å®œè¿‡å¤š</h3>
<blockquote>
<p>å½“å•è¡¨å­—æ®µå­—æ®µè¿‡å¤šï¼Œå¯ä»¥è€ƒè™‘æ‹†æˆå¤šå¼ è¡¨ï¼Œå°†å°é•¿åº¦çš„å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ï¼Œå…¶ä½™çš„æ”¾åœ¨å…¶ä»–è¡¨ä¸­</p>
</blockquote>
<h3 id="å¯ä»¥é¢„ç•™å­—æ®µ">å¯ä»¥é¢„ç•™å­—æ®µ</h3>
<blockquote>
<p>ä¼˜å…ˆæ»¡è¶³ä¸šåŠ¡ï¼Œå¯ä»¥é¢„ç•™ä¸€äº›å­—æ®µ</p>
</blockquote>
<h2 id="å…³è”è¡¨çš„è®¾è®¡">å…³è”è¡¨çš„è®¾è®¡</h2>
<blockquote>
<p>å¤–é”®<code>foreign key</code>åªèƒ½å®ç°ä¸€å¯¹ä¸€æˆ–ä¸€å¯¹å¤šçš„æ˜ å°„</p>
</blockquote>
<h3 id="ä¸€å¯¹å¤š">ä¸€å¯¹å¤š</h3>
<blockquote>
<p>ä½¿ç”¨å¤–é”®</p>
</blockquote>
<h3 id="å¤šå¯¹å¤š">å¤šå¯¹å¤š</h3>
<blockquote>
<p>ä½¿ç”¨ä¸­é—´è¡¨å­˜å‚¨ä¸¤è¡¨ä¹‹é—´çš„å…³è”å…³ç³»</p>
</blockquote>
<h3 id="ä¸€å¯¹ä¸€">ä¸€å¯¹ä¸€</h3>
<blockquote>
<p>å¦‚å•†å“çš„åŸºæœ¬ä¿¡æ¯ï¼ˆ<code>item</code>ï¼‰å’Œå•†å“çš„è¯¦ç»†ä¿¡æ¯ï¼ˆ<code>item_intro</code>ï¼‰ï¼Œé€šå¸¸ä½¿ç”¨ç›¸åŒçš„ä¸»é”®æˆ–è€…å¢åŠ ä¸€ä¸ªå¤–é”®å­—æ®µï¼ˆ<code>item_id</code>ï¼‰</p>
</blockquote>
<h2 id="ç´¢å¼•">ç´¢å¼•</h2>
<blockquote>
<p>å…³é”®å­—ä¸æ•°æ®çš„æ˜ å°„å…³ç³»ç§°ä¸ºç´¢å¼•ï¼ˆ==åŒ…å«å…³é”®å­—å’Œå¯¹åº”çš„è®°å½•åœ¨ç£ç›˜ä¸­çš„åœ°å€==ï¼‰ã€‚å…³é”®å­—æ˜¯ä»æ•°æ®å½“ä¸­æå–çš„ç”¨äºæ ‡è¯†ã€æ£€ç´¢æ•°æ®çš„ç‰¹å®šå†…å®¹ã€‚</p>
</blockquote>
<h3 id="ç´¢å¼•æ£€ç´¢ä¸ºä»€ä¹ˆå¿«">ç´¢å¼•æ£€ç´¢ä¸ºä»€ä¹ˆå¿«</h3>
<ol>
<li>
<p>å…³é”®å­—ç›¸å¯¹äºæ•°æ®æœ¬èº«ï¼Œ==æ•°æ®é‡å°==</p>
</li>
<li>
<p>å…³é”®å­—æ˜¯==æœ‰åº==çš„ï¼ŒäºŒåˆ†æŸ¥æ‰¾å¯å¿«é€Ÿç¡®å®šä½ç½®</p>
<blockquote>
<p>å›¾ä¹¦é¦†ä¸ºæ¯æœ¬ä¹¦éƒ½åŠ äº†ç´¢å¼•å·ï¼ˆç±»åˆ«-æ¥¼å±‚-ä¹¦æ¶ï¼‰ã€å­—å…¸ä¸ºè¯è¯­è§£é‡ŠæŒ‰å­—æ¯é¡ºåºç¼–å†™ç›®å½•ç­‰éƒ½ç”¨åˆ°äº†ç´¢å¼•ã€‚</p>
</blockquote>
</li>
</ol>
<h3 id="MySQLä¸­ç´¢å¼•ç±»å‹">MySQLä¸­ç´¢å¼•ç±»å‹</h3>
<ol>
<li><strong>æ™®é€šç´¢å¼•</strong>ï¼ˆ<code>key</code>ï¼‰</li>
<li><strong>å”¯ä¸€ç´¢å¼•</strong>ï¼ˆ<code>unique key</code>ï¼‰</li>
<li><strong>ä¸»é”®ç´¢å¼•</strong>ï¼ˆ<code>primary key</code>ï¼‰</li>
<li><strong>å…¨æ–‡ç´¢å¼•</strong>ï¼ˆ<code>fulltext key</code>ï¼‰</li>
</ol>
<h4 id="ç´¢å¼•çš„å…³é”®å­—æœ‰ä¸åŒçš„é™åˆ¶ï¼š">ç´¢å¼•çš„å…³é”®å­—æœ‰ä¸åŒçš„é™åˆ¶ï¼š</h4>
<ul>
<li>**æ™®é€šç´¢å¼•ï¼š**å¯¹å…³é”®å­—æ²¡æœ‰é™åˆ¶</li>
<li>**å”¯ä¸€ç´¢å¼•ï¼š**è¦æ±‚è®°å½•æä¾›çš„å…³é”®å­—ä¸èƒ½é‡å¤</li>
<li>**ä¸»é”®ç´¢å¼•ï¼š**è¦æ±‚å…³é”®å­—å”¯ä¸€ä¸”ä¸ä¸ºnull</li>
</ul>
<h3 id="ç´¢å¼•ç®¡ç†è¯­æ³•">ç´¢å¼•ç®¡ç†è¯­æ³•</h3>
<h4 id="æŸ¥çœ‹ç´¢å¼•">æŸ¥çœ‹ç´¢å¼•</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--æŸ¥çœ‹å»ºè¡¨è¯­å¥</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> è¡¨å;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">CREATE</span> <span class="keyword">table</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="comment">--æŸ¥çœ‹è¡¨ä¸­å­—æ®µ</span></span><br><span class="line"><span class="keyword">desc</span> è¡¨å;</span><br><span class="line"><span class="keyword">desc</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">--æŸ¥çœ‹è¡¨ä¸­æ‰€æœ‰ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SHOW</span> index <span class="keyword">FROM</span> `è¡¨å`</span><br><span class="line"><span class="keyword">SHOW</span> keys <span class="keyword">FROM</span> `è¡¨å`;</span><br><span class="line"><span class="keyword">SHOW</span> index <span class="keyword">FROM</span> `user_index`;</span><br><span class="line"><span class="keyword">SHOW</span> keys <span class="keyword">FROM</span> `user_index`;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312094403.png" alt="image-20210312094403347"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312094416.png" alt="image-20210312094416711"></p>
<h4 id="åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</h4>
<h5 id="åˆ›å»ºè¡¨ä¹‹åå»ºç«‹ç´¢å¼•">åˆ›å»ºè¡¨ä¹‹åå»ºç«‹ç´¢å¼•</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> user_index(</span><br><span class="line">	id <span class="type">int</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">	first_name <span class="type">varchar</span>(<span class="number">16</span>),</span><br><span class="line">	last_name <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">	id_card <span class="type">VARCHAR</span>(<span class="number">18</span>),</span><br><span class="line">	information text</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºä¸€ä¸ªfirst_nameå’Œlast_nameçš„å¤åˆç´¢å¼•ï¼Œå¹¶å‘½åä¸ºname</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">add</span> key name (first_name,last_name),</span><br><span class="line"><span class="comment">-- åˆ›å»ºä¸€ä¸ªid_cardçš„å”¯ä¸€ç´¢å¼•ï¼Œé»˜è®¤ä»¥å­—æ®µåä½œä¸ºç´¢å¼•å</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">add</span> <span class="keyword">UNIQUE</span> KEY (id_card),</span><br><span class="line"><span class="comment">-- é¸¡è‚‹ï¼Œå…¨æ–‡ç´¢å¼•ä¸æ”¯æŒä¸­æ–‡</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">add</span> FULLTEXT KEY (information);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºè¡¨æ—¶æŒ‡å®šç´¢å¼•">åˆ›å»ºè¡¨æ—¶æŒ‡å®šç´¢å¼•</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_index2 (</span><br><span class="line">	id <span class="type">INT</span> auto_increment <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	first_name <span class="type">VARCHAR</span> (<span class="number">16</span>),</span><br><span class="line">	last_name <span class="type">VARCHAR</span> (<span class="number">16</span>),</span><br><span class="line">	id_card <span class="type">VARCHAR</span> (<span class="number">18</span>),</span><br><span class="line">	information text,</span><br><span class="line">	KEY name (first_name, last_name),</span><br><span class="line">	FULLTEXT KEY (information),</span><br><span class="line">	<span class="keyword">UNIQUE</span> KEY (id_card)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤ç´¢å¼•">åˆ é™¤ç´¢å¼•</h4>
<h5 id="åˆ é™¤æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•">åˆ é™¤æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•</h5>
<p>æ ¹æ®ç´¢å¼•ååˆ é™¤æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ï¼š<code>alter table è¡¨å drop KEY ç´¢å¼•å</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-----åˆ é™¤æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> KEY ç´¢å¼•å</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> KEY name;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> KEY id_card;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> KEY information;</span><br></pre></td></tr></table></figure>
<h5 id="åˆ é™¤ä¸»é”®ç´¢å¼•">åˆ é™¤ä¸»é”®ç´¢å¼•</h5>
<p>åˆ é™¤ä¸»é”®ç´¢å¼•ï¼š<code>alter table è¡¨å drop primary key</code>ï¼ˆå› ä¸ºä¸»é”®åªæœ‰ä¸€ä¸ªï¼‰ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸»é”®è‡ªå¢é•¿ï¼Œé‚£ä¹ˆä¸èƒ½ç›´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼ˆè‡ªå¢é•¿ä¾èµ–äºä¸»é”®ç´¢å¼•ï¼‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">---åˆ é™¤ä¸»é”®ç´¢å¼•</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> <span class="keyword">primary</span> key</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> <span class="keyword">primary</span> key</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312100733.png" alt="image-20210312100733734"></p>
<p><strong>éœ€è¦å–æ¶ˆè‡ªå¢é•¿</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--å–æ¶ˆä¸»é”®è‡ªå¢</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `è¡¨å` MODIFY <span class="keyword">COLUMN</span> å­—æ®µå å­—æ®µç±»å‹ï¼ˆé•¿åº¦ï¼‰ <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">FIRST</span> ;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `user_index` MODIFY <span class="keyword">COLUMN</span> id <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">FIRST</span> ;</span><br><span class="line"><span class="comment">---åˆ é™¤ä¸»é”®ç´¢å¼•</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> <span class="keyword">primary</span> key</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_index <span class="keyword">drop</span> <span class="keyword">primary</span> key</span><br></pre></td></tr></table></figure>
<h3 id="ç´¢å¼•å¤±æ•ˆ">ç´¢å¼•å¤±æ•ˆ</h3>
<ol>
<li>
<p><strong>like ä»¥%å¼€å¤´</strong>ï¼Œç´¢å¼•æ— æ•ˆï¼›<strong>å½“likeå‰ç¼€æ²¡æœ‰%ï¼Œåç¼€æœ‰%æ—¶ï¼Œç´¢å¼•æœ‰æ•ˆ</strong>ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104045.png" alt="image-20210312104045534"></p>
</li>
<li>
<p><strong>orè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•</strong>ã€‚å½“orå·¦å³æŸ¥è¯¢å­—æ®µåªæœ‰ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¤±æ•ˆï¼Œåªæœ‰å½“orå·¦å³æŸ¥è¯¢å­—æ®µå‡ä¸ºç´¢å¼•æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104107.png" alt="image-20210312104107314"></p>
</li>
<li>
<p><strong>ç»„åˆç´¢å¼•ï¼Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€åˆ—ç´¢å¼•</strong>ï¼Œç´¢å¼•å¤±æ•ˆã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104314.png" alt="image-20210312104314829"></p>
</li>
<li>
<p><strong>æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬åŒ–</strong>ã€‚å¦‚varcharä¸åŠ å•å¼•å·çš„è¯å¯èƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºintå‹ï¼Œä½¿ç´¢å¼•æ— æ•ˆï¼Œäº§ç”Ÿå…¨è¡¨æ‰«æã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104329.png" alt="image-20210312104329349"></p>
</li>
<li>
<p><strong><font color=red>åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨ IS NULL æˆ– IS NOT NULLæ“ä½œï¼Œç´¢å¼•ä¸ä¸€å®šå¤±æ•ˆï¼Œå¯èƒ½åœ¨æŸäº›æƒ…å†µä¼šå¤±æ•ˆ</font></strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104455.png" alt="image-20210312104455798"></p>
<p>æ­¤å¤„æˆ‘å°†é‡æ–°åˆ›å»ºä¸€ä¸ªempè¡¨ï¼ˆ<strong>æ­¤å¤„ç´¢å¼•ä¸ºInnoDBç±»å‹ç´¢å¼•</strong>ï¼‰</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104819.png" alt="image-20210312104819712"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312104905.png" alt="image-20210312104905292"></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">----åˆ›å»ºæ–°ç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> index test2 <span class="keyword">on</span> emp(name)</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312105105.png" alt="image-20210312105105179"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312105210.png" alt="image-20210312105210686"></p>
</li>
<li>
<p><strong>åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨notï¼Œ&lt;&gt;ï¼Œ!=</strong>ã€‚ä¸ç­‰äºæ“ä½œç¬¦æ˜¯æ°¸è¿œä¸ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œå› æ­¤å¯¹å®ƒçš„å¤„ç†åªä¼šäº§ç”Ÿå…¨è¡¨æ‰«æã€‚ ä¼˜åŒ–æ–¹æ³•ï¼š key&lt;&gt;0 æ”¹ä¸º key&gt;0 or key&lt;0ã€‚</p>
</li>
<li>
<p><strong>å½“å…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«æ—¶ï¼Œmysqlä¼šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ç´¢å¼•å¤±æ•ˆã€‚</strong></p>
</li>
<li>
<p><strong>ä¸è¦åœ¨å­—æ®µä¸­åšè¿ç®—</strong></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">----ä¸‹é¢ä¸¤æ¡SQLè¯­å¥åœ¨è¯­ä¹‰ä¸Šç›¸åŒï¼Œ(idä¸ºä¸»é”®)ä½†æ˜¯ç¬¬ä¸€æ¡ä¼šä½¿ç”¨ä¸»é”®ç´¢å¼•è€Œç¬¬äºŒæ¡ä¸ä¼šã€‚</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">20</span><span class="number">-1</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">+</span><span class="number">1</span> <span class="operator">=</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="ç´¢å¼•ä½¿ç”¨åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰">ç´¢å¼•ä½¿ç”¨åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰</h2>
<h3 id="where">where</h3>
<p>æ ¹æ®<code>id</code>æŸ¥è¯¢è®°å½•ï¼Œå› ä¸º<code>id</code>å­—æ®µä»…å»ºç«‹äº†ä¸»é”®ç´¢å¼•ï¼Œå› æ­¤æ­¤SQLæ‰§è¡Œå¯é€‰çš„ç´¢å¼•åªæœ‰ä¸»é”®ç´¢å¼•ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œæœ€ç»ˆä¼šé€‰ä¸€ä¸ªè¾ƒä¼˜çš„ä½œä¸ºæ£€ç´¢çš„ä¾æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¢åŠ ä¸€ä¸ªæ²¡æœ‰å»ºç«‹ç´¢å¼•çš„å­—æ®µ</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> innodb1 <span class="keyword">add</span> sex <span class="type">char</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">-- æŒ‰sexæ£€ç´¢æ—¶å¯é€‰çš„ç´¢å¼•ä¸ºnull</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> innodb1 <span class="keyword">where</span> sex<span class="operator">=</span><span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210312103826.png" alt="image-20210312103826193"></p>
<blockquote>
<p>å¯ä»¥å°è¯•åœ¨ä¸€ä¸ªå­—æ®µæœªå»ºç«‹ç´¢å¼•æ—¶ï¼Œæ ¹æ®è¯¥å­—æ®µæŸ¥è¯¢çš„æ•ˆç‡ï¼Œç„¶åå¯¹è¯¥å­—æ®µå»ºç«‹ç´¢å¼•ï¼ˆ<code>alter table è¡¨å add index(å­—æ®µå)</code>ï¼‰ï¼ŒåŒæ ·çš„SQLæ‰§è¡Œçš„æ•ˆç‡ï¼Œä½ ä¼šå‘ç°æŸ¥è¯¢æ•ˆç‡ä¼šæœ‰æ˜æ˜¾çš„æå‡ï¼ˆæ•°æ®é‡è¶Šå¤§è¶Šæ˜æ˜¾ï¼‰ã€‚</p>
</blockquote>
<h3 id="order-by">order by</h3>
<ul>
<li>
<p><strong>è¯¥å­—æ®µæ²¡æœ‰å»ºç«‹ç´¢å¼•</strong></p>
<p>å°†<strong>æŸ¥è¯¢å‡ºçš„æ‰€æœ‰æ•°æ®ä½¿ç”¨å¤–éƒ¨æ’åº</strong>ï¼ˆå°†æ•°æ®ä»ç¡¬ç›˜åˆ†æ‰¹è¯»å–åˆ°å†…å­˜ä½¿ç”¨å†…éƒ¨æ’åºï¼Œæœ€ååˆå¹¶æ’åºç»“æœï¼‰</p>
</li>
<li>
<p><strong>è¯¥å­—æ®µå»ºç«‹ç´¢å¼•</strong></p>
<p>ç›´æ¥<strong>æŒ‰ç…§ç´¢å¼•çš„é¡ºåºå’Œæ˜ å°„å…³ç³»é€æ¡å–å‡ºæ•°æ®</strong>ã€‚è€Œä¸”å¦‚æœåˆ†é¡µçš„ï¼Œé‚£ä¹ˆåªç”¨<strong>å–å‡ºç´¢å¼•è¡¨æŸä¸ªèŒƒå›´å†…çš„ç´¢å¼•å¯¹åº”çš„æ•°æ®</strong></p>
</li>
</ul>
<h3 id="join">join</h3>
<blockquote>
<p>å¯¹<code>join</code>è¯­å¥åŒ¹é…å…³ç³»ï¼ˆ<code>on</code>ï¼‰æ¶‰åŠçš„å­—æ®µå»ºç«‹ç´¢å¼•èƒ½å¤Ÿæé«˜æ•ˆç‡</p>
</blockquote>
<h3 id="ç´¢å¼•è¦†ç›–">ç´¢å¼•è¦†ç›–</h3>
<p>å¦‚æœè¦æŸ¥è¯¢çš„å­—æ®µéƒ½å»ºç«‹è¿‡ç´¢å¼•ï¼Œé‚£ä¹ˆå¼•æ“ä¼šç›´æ¥åœ¨ç´¢å¼•è¡¨ä¸­æŸ¥è¯¢è€Œä¸ä¼šè®¿é—®åŸå§‹æ•°æ®ï¼ˆå¦åˆ™åªè¦æœ‰ä¸€ä¸ªå­—æ®µæ²¡æœ‰å»ºç«‹ç´¢å¼•å°±ä¼šåšå…¨è¡¨æ‰«æï¼‰ï¼Œè¿™å«ç´¢å¼•è¦†ç›–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„åœ¨<code>select</code>å==åªå†™å¿…è¦çš„æŸ¥è¯¢å­—æ®µ==ï¼Œä»¥å¢åŠ ç´¢å¼•è¦†ç›–çš„å‡ ç‡ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„äº‹åŠ¡</title>
    <url>/posts/d2eae622/</url>
    <content><![CDATA[<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309135338.jpg" alt="16a3e7b7a6894434"></p>
<h2 id="ä¸ºä»€ä¹ˆè¦æœ‰äº‹åŠ¡">ä¸ºä»€ä¹ˆè¦æœ‰äº‹åŠ¡</h2>
<p><strong>æ•°æ®åº“å¼•å…¥äº‹åŠ¡çš„ä¸»è¦ç›®çš„æ˜¯äº‹åŠ¡ä¼šæŠŠæ•°æ®åº“ä¼šä»ä¸€ç§ä¸€è‡´çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ç§ä¸€è‡´çŠ¶æ€ï¼Œæ•°æ®åº“æäº¤å·¥ä½œæ—¶å¯ä»¥ç¡®ä¿è¦ä¹ˆæ‰€æœ‰ä¿®æ”¹éƒ½ä¿å­˜ï¼Œè¦ä¹ˆæ‰€æœ‰ä¿®æ”¹éƒ½ä¸ä¿å­˜ã€‚</strong></p>
<h3 id="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰">äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰</h3>
<ul>
<li><strong>A(Atomicity) åŸå­æ€§</strong></li>
<li><strong>C(Consistency) ä¸€è‡´æ€§</strong></li>
<li><strong>I(Isolation) éš”ç¦»æ€§</strong></li>
<li><strong>D(Durability) æŒä¹…æ€§</strong></li>
</ul>
<h4 id="A-Atomicity-åŸå­æ€§">A(Atomicity) åŸå­æ€§</h4>
<p>åŸå­æ€§æ˜¯<strong>æ•´ä¸ªæ•°æ®åº“äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½</strong>ï¼Œåªæœ‰<font color=red>äº‹åŠ¡ä¸­çš„æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½æ‰§è¡ŒæˆåŠŸï¼Œæ‰ç®—æ•´ä¸ªäº‹åŠ¡æˆåŠŸã€‚äº‹åŠ¡ä¸­ä»»ä½•ä¸€ä¸ªSQLæ‰§è¡Œå¤±è´¥ï¼Œå·²ç»æ‰§è¡ŒæˆåŠŸçš„SQLè¯­å¥ä¹Ÿå¿…é¡»æ’¤é”€ï¼Œå›åˆ°æ‰§è¡Œäº‹åŠ¡çš„ä¹‹å‰çš„çŠ¶æ€</font>ã€‚</p>
<h4 id="C-Consistency-ä¸€è‡´æ€§">C(Consistency) ä¸€è‡´æ€§</h4>
<p>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€å˜ä¸ºä¸‹ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€ã€‚<font  color=red>åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œä¹‹åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚</font></p>
<h4 id="I-Isolation-éš”ç¦»æ€§">I(Isolation) éš”ç¦»æ€§</h4>
<p>éš”ç¦»æ€§è¦æ±‚<font color=red>æ¯ä¸ªè¯»å†™äº‹åŠ¡å¯¹å…¶ä»–äº‹åŠ¡çš„æ“ä½œå¯¹è±¡èƒ½ç›¸äº’åˆ†ç¦»ã€‚</font></p>
<h4 id="D-Durability-æŒä¹…æ€§">D(Durability) æŒä¹…æ€§</h4>
<p>æŒä¹…æ€§æŒ‡<font color=red>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå…¶ç»“æœå°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚</font></p>
<h2 id="äº‹åŠ¡çš„å®ç°">äº‹åŠ¡çš„å®ç°</h2>
<p>äº‹åŠ¡çš„å®ç°å°±æ˜¯å¦‚ä½•å®ç°ACIDç‰¹æ€§ï¼Œä¸‹é¢ä¸€å›¾ä¸‹æ¦‚å†µä¸‹ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309140003.png" alt="image-20210309140003622"></p>
<p><font color=red>äº‹åŠ¡çš„å®ç°é€šè¿‡ redo_log å’Œ undo_logï¼Œ ä»¥åŠé”å®ç°ï¼Œé”å®ç°äº‹åŠ¡çš„</font></p>
<p><font color=blue>redo_log å®ç°æŒä¹…åŒ–å’ŒåŸå­æ€§ï¼Œè€Œundo_logå®ç°ä¸€è‡´æ€§ï¼ŒäºŒç§æ—¥å¿—å‡å¯ä»¥è§†ä¸ºä¸€ç§æ¢å¤æ“ä½œï¼Œredo_logæ˜¯æ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µæ“ä½œï¼Œè€Œundo_logæ˜¯å›æ»šè¡Œè®°å½•åˆ°ç‰¹å®šç‰ˆæœ¬ã€‚äºŒè€…è®°å½•çš„å†…å®¹ä¹Ÿä¸åŒï¼Œredo_logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•é¡µçš„ç‰©ç†ä¿®æ”¹æ“ä½œï¼Œè€Œundo_logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œæ ¹æ®æ¯è¡Œè®°å½•è¿›è¡Œè®°å½•ã€‚</font></p>
<h3 id="redo-log-é‡åšæ—¥å¿—">redo log é‡åšæ—¥å¿—</h3>
<p><strong>redo_log é‡åšæ—¥å¿—ä¸Šé¢å·²ç»æåˆ°å®ç°æŒä¹…åŒ–å’ŒåŸå­æ€§</strong>ï¼Œé‡åšæ—¥å¿—ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œ<font color=red>ä¸€æ˜¯å†…å­˜ä¸­çš„é‡åšæ—¥å¿—ç¼“å­˜(redo log buffer)ï¼Œè¿™éƒ¨åˆ†æ˜¯å®¹æ˜“ä¸¢å¤±çš„ã€‚äºŒæ˜¯é‡åšæ—¥å¿—æ–‡ä»¶(redo log file)ï¼Œè¿™éƒ¨åˆ†æ˜¯æŒä¹…çš„</font></p>
<h4 id="redo-logæ›´æ–°æµç¨‹">redo logæ›´æ–°æµç¨‹</h4>
<p>redo logçš„æ›´æ–°æµç¨‹å¦‚ä¸‹å›¾ï¼Œä»¥ä¸€æ¬¡Update æ“ä½œä¸ºä¾‹ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309140424.png" alt="image-20210309140424737"></p>
<ol>
<li>æ‰§è¡Œupdateæ“ä½œã€‚</li>
<li>å…ˆå°†åŸå§‹æ•°æ®ä»ç£ç›˜è¯»å–åˆ°å†…å­˜ï¼Œä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ã€‚</li>
<li>ç”Ÿæˆä¸€æ¡é‡åšæ—¥å¿—å†™å…¥redo log bufferï¼Œè®°å½•æ•°æ®è¢«ä¿®æ”¹åçš„å€¼ã€‚</li>
<li>å½“äº‹åŠ¡æäº¤æ—¶ï¼Œéœ€è¦å°†redo log bufferä¸­çš„å†…å®¹åˆ·æ–°åˆ°redo log fileã€‚</li>
<li>äº‹åŠ¡æäº¤åï¼Œä¹Ÿä¼šå°†å†…å­˜ä¸­ä¿®æ”¹æ•°æ®çš„å€¼å†™å…¥ç£ç›˜ã€‚</li>
</ol>
<blockquote>
<p>ä¸ºäº†ç¡®ä¿æ¯æ¬¡æ—¥å¿—éƒ½å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œ<font color=red>InnoDBå­˜å‚¨å¼•æ“ä¼šè°ƒç”¨ä¸€æ¬¡fsyncæ“ä½œã€‚</font></p>
</blockquote>
<h4 id="å­˜å‚¨æ ¼å¼å†…å®¹">å­˜å‚¨æ ¼å¼å†…å®¹</h4>
<h5 id="mysqlçš„binlogä¸redo-logåŒºåˆ«">mysqlçš„binlogä¸redo logåŒºåˆ«</h5>
<ol>
<li>é¦–å…ˆ2è€…éƒ½æ˜¯è®°å½•æ•°æ®çš„æ”¹å˜ï¼Œä¸åŒçš„æ˜¯ï¼Œbinlogæ˜¯è®°å½•æ‰€æœ‰æ•°æ®çš„æ”¹å˜ä¿¡æ¯ï¼Œè€Œinnodbçš„redo logåªæ˜¯è®°å½•æ‰€æœ‰innodbè¡¨æ•°æ®çš„å˜åŒ–ã€‚</li>
<li>binlogæ˜¯è®°å½•å·²ç»æäº¤å®Œæ¯•ä¹‹åçš„dmlä»¥åŠddl sqlè¯­å¥ï¼Œè€Œinnodb  redo logæ˜¯æ­£åœ¨æ‰§è¡Œä¸­çš„dmlä»¥åŠddlè¯­å¥</li>
<li>binlogå¯ä»¥ä½œä¸ºæ¢å¤æ•°æ®ä½¿ç”¨ ï¼Œredo logå¯ä»¥ä½œä¸ºå¼‚å¸¸downæœºæˆ–è€…ä»‹è´¨æ•…éšœåçš„æ•°æ®æ¢å¤ä½¿ç”¨</li>
<li>åœ¨dbæ–‡ä»¶ç›®å½•ä¸‹ï¼Œä¹Ÿåˆ†å±äºä¸åŒçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</li>
</ol>
<h5 id="mysqlçš„binlogä¸redo-logçš„å†™å…¥æ–¹å¼">mysqlçš„binlogä¸redo logçš„å†™å…¥æ–¹å¼</h5>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309141112.png" alt="image-20210309141112695"></p>
<p>binlogæ˜¯æ¯æ¬¡äº‹åŠ¡æ‰å†™å…¥ï¼Œæ‰€ä»¥<strong>æ¯ä¸ªäº‹åŠ¡åªä¼šæœ‰ä¸€æ¡æ—¥å¿—ï¼Œè®°å½•çš„é€»è¾‘æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥è¯´è®°å½•çš„å°±æ˜¯SQLè¯­å¥ã€‚</strong></p>
<p>redo logæ˜¯äº‹åŠ¡å¼€å§‹å°±å¼€å§‹å†™å…¥ï¼Œ*<strong>T1è¡¨ç¤ºäº‹åŠ¡æäº¤</strong>ã€‚<strong>è®°å½•çš„æ˜¯ç‰©ç†æ ¼å¼æ—¥å¿—</strong>ï¼Œå³æ¯ä¸ªé¡µçš„ä¿®æ”¹ã€‚</p>
<p>redo logé»˜è®¤æ˜¯ä»¥block(å—)çš„æ–¹å¼ä¸ºå•ä½è¿›è¡Œå­˜å‚¨ï¼Œæ¯ä¸ªå—æ˜¯512ä¸ªå­—èŠ‚ã€‚ä¸åŒçš„æ•°æ®åº“å¼•æ“æœ‰å¯¹åº”çš„é‡åšæ—¥å¿—æ ¼å¼ï¼ŒInnodbçš„å­˜å‚¨ç®¡ç†æ˜¯åŸºäºé¡µçš„ï¼Œæ‰€ä»¥å…¶é‡åšæ—¥å¿—ä¹Ÿæ˜¯åŸºäºé¡µçš„ã€‚</p>
<p>redo logæ ¼å¼:</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309141251.png" alt="image-20210309141251321"></p>
<ul>
<li>redo_log_type é‡åšæ—¥å¿—ç±»å‹</li>
<li>space è¡¨ç©ºé—´çš„ID</li>
<li>page_no é¡µçš„åç§»é‡</li>
<li>redo_log_body å­˜å‚¨å†…å®¹</li>
</ul>
<p>æ‰§è¡Œä¸€æ¡æ’å…¥è¯­å¥ï¼Œé‡åšæ—¥å¿—å¤§è‡´ä¸º:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line">           <span class="operator">|</span></span><br><span class="line">page(<span class="number">2</span>,<span class="number">3</span>), <span class="keyword">offset</span> <span class="number">32</span>, <span class="keyword">value</span> <span class="number">1</span>,<span class="number">2</span> # ä¸»é”®ç´¢å¼•</span><br><span class="line">page(<span class="number">2</span>,<span class="number">4</span>), <span class="keyword">offset</span> <span class="number">64</span>, <span class="keyword">value</span> <span class="number">2</span>   # è¾…åŠ©ç´¢å¼•</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ¢å¤æœºåˆ¶">æ¢å¤æœºåˆ¶</h4>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309141428.png" alt="image-20210309141428811"></p>
<p><strong>LSN(Log Sequence Number) æ—¥å¿—åºåˆ—å·</strong>ï¼ŒInnodbé‡Œï¼ŒLSNå 8ä¸ªå­—èŠ‚ï¼Œä¸”æ˜¯å•è°ƒé€’å¢çš„ï¼Œ<strong>ä»£è¡¨çš„å«ä¹‰</strong>æœ‰: é‡åšæ—¥å¿—å†™å…¥çš„æ€»é‡ã€checkpointçš„ä½ç½®ã€é¡µçš„ç‰ˆæœ¬ã€‚</p>
<p>å‡è®¾åœ¨LSN=10000çš„æ—¶å€™æ•°æ®åº“å‡ºç°æ•…éšœï¼Œç£ç›˜ä¸­checkpointä¸º10000ï¼Œè¡¨ç¤ºç£ç›˜å·²ç»åˆ·æ–°åˆ°10000è¿™ä¸ªåºåˆ—å·ï¼Œå½“å‰redologçš„checkpointæ˜¯13000ï¼Œåˆ™éœ€è¦æ¢å¤10000-13000çš„æ•°æ®ã€‚</p>
<h4 id="redo-logä¸ºä»€ä¹ˆå¯ä»¥å®ç°äº‹åŠ¡çš„åŸå­æ€§å’ŒæŒä¹…æ€§ã€‚">redo logä¸ºä»€ä¹ˆå¯ä»¥å®ç°äº‹åŠ¡çš„åŸå­æ€§å’ŒæŒä¹…æ€§ã€‚</h4>
<ul>
<li>åŸå­æ€§ï¼Œæ˜¯redo logè®°å½•äº†äº‹åŠ¡æœŸé—´æ“ä½œçš„ç‰©ç†æ—¥å¿—ï¼Œäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¹¶æ²¡æœ‰å†™å…¥ç£ç›˜ï¼Œä¿å­˜åœ¨å†…å­˜é‡Œï¼Œå¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œæ•°æ®åº“ç£ç›˜ä¸ä¼šæœ‰å½±å“ï¼Œå›æ»šæ‰äº‹åŠ¡å†…å­˜éƒ¨åˆ†å³å¯ã€‚</li>
<li>æŒä¹…æ€§ï¼Œredo log ä¼šåœ¨äº‹åŠ¡æäº¤æ—¶å°†æ—¥å¿—å­˜å‚¨åˆ°ç£ç›˜redo log fileï¼Œä¿è¯æ—¥å¿—çš„æŒä¹…æ€§ã€‚</li>
</ul>
<h3 id="undo-log">undo log</h3>
<p>redo logä¸€æ—¦æäº¤æ„å‘³ç€æŒä¹…åŒ–äº†ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦å¯¹å…¶è¿›è¡Œrollbackæ“ä½œï¼Œé‚£å°±éœ€è¦undo logã€‚</p>
<p>undo logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œåªæ˜¯å°†æ•°æ®åº“é€»è¾‘çš„æ¢å¤åˆ°åŸæ¥çš„æ ·å­ã€‚å¹¶ä¸èƒ½å°†æ•°æ®åº“ç‰©ç†åœ°æ¢å¤åˆ°æ‰§è¡Œè¯­å¥æˆ–è€…äº‹åŠ¡ä¹‹å‰çš„æ ·å­ã€‚è™½ç„¶æ‰€æœ‰çš„é€»è¾‘ä¿®æ”¹å‡è¢«å–æ¶ˆäº†ï¼Œä½†æ˜¯æ•°æ®ç»“æ„å’Œé¡µæœ¬èº«åœ¨å›æ»šå‰åå¯èƒ½ä¸ä¸€æ ·äº†ã€‚</p>
<p>æ—¢ç„¶æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯ä»¥<font color=red>ç†è§£ä¸ºå®ƒå­˜å‚¨çš„æ˜¯SQL, åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨çš„æ¯ä¸€æ¡ INSERT éƒ½å¯¹åº”äº†ä¸€æ¡ DELETEï¼Œæ¯ä¸€æ¡ UPDATE ä¹Ÿéƒ½å¯¹åº”ä¸€æ¡ç›¸åçš„ UPDATE è¯­å¥ã€‚</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309141731.png" alt="image-20210309141731783"></p>
<ul>
<li>
<p>undo log å­˜æ”¾åœ¨æ•°æ®åº“å†…éƒ¨çš„ä¸€ä¸ªç‰¹æ®Šæ®µ(segment)ä¸­ï¼Œä¹Ÿå«undoæ®µï¼Œå­˜åœ¨äºå…±äº«è¡¨ç©ºé—´ä¸­ã€‚</p>
</li>
<li>
<p>undo logå®ç°äº†äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥é€šè¿‡undo logæ¢å¤åˆ°äº‹åŠ¡ä¹‹å‰çš„é€»è¾‘çŠ¶æ€ï¼Œä¿è¯ä¸€è‡´æ€§ã€‚</p>
</li>
<li>
<p>undo log è¿˜å¯ä»¥å®ç°MVCCï¼ˆMulti-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼Œ<font color=red>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶å…¶å®å¯ä»¥é€šè¿‡ undo log å½¢æˆä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç‰ˆæœ¬é“¾ï¼Œæ¯ä¸€ä¸ªå†™æ“ä½œä¼šäº§ç”Ÿä¸€ä¸ªç‰ˆæœ¬ï¼Œæ•°æ®åº“å‘ç”Ÿè¯»çš„å¹¶å‘è®¿é—®æ—¶ï¼Œè¯»æ“ä½œè®¿é—®ç‰ˆæœ¬é“¾ï¼Œè¿”å›æœ€åˆé€‚çš„ç»“æœç›´æ¥è¿”å›</font>ã€‚ä»è€Œè¯»å†™æ“ä½œä¹‹é—´æ²¡æœ‰å†²çªï¼Œæé«˜äº†æ€§èƒ½ã€‚</p>
</li>
</ul>
<h2 id="äº‹åŠ¡æ§åˆ¶è¯­å¥">äº‹åŠ¡æ§åˆ¶è¯­å¥</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309143119.png" alt="image-20210309143119908"></p>
<blockquote>
<p>set transaction ä¿®æ”¹äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ¯”å¦‚ä¿®æ”¹ä¼šè¯çº§åˆ«çš„äº‹åŠ¡:</p>
<p><strong>set session transaction isolation level read committed;</strong></p>
</blockquote>
<h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309143218.png" alt="image-20210309143218209"></p>
<p>å››ç§éš”ç¦»çº§åˆ«ï¼ŒæŒ‰READ-UNCOMMITTEDã€READ-COMMITTEDã€REPEATABLE-READã€SERIALIZABLEé¡ºåºï¼Œéš”ç¦»çº§åˆ«æ˜¯ä»ä½åˆ°é«˜**ï¼ŒInnoDBé»˜è®¤æ˜¯REPEATABLE-READçº§åˆ«ï¼Œæ­¤çº§åˆ«åœ¨å…¶ä½™æ•°æ®åº“ä¸­æ˜¯ä¼šå¼•èµ·å¹»è¯»é—®é¢˜ï¼ŒInnoDBé‡‡ç”¨Next-Key Locké”ç®—æ³•é¿å…äº†æ­¤é—®é¢˜**</p>
<h3 id="READ-UNCOMMITTED">READ-UNCOMMITTED</h3>
<p>READ-UNCOMMITTED ä¸­æ–‡å«<strong>æœªæäº¤è¯»</strong>ï¼Œå³ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾:</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309143631.png" alt="image-20210309143630946"></p>
<p><font color=red>SessionAå’ŒSessionBåˆ†åˆ«å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼ŒSessionBä¸­çš„äº‹åŠ¡å…ˆå°†idä¸º1çš„è®°å½•çš„nameåˆ—æ›´æ–°ä¸ºâ€™lisiâ€™ï¼Œç„¶åSession ä¸­çš„äº‹åŠ¡å†å»æŸ¥è¯¢è¿™æ¡idä¸º1çš„è®°å½•ï¼Œé‚£ä¹ˆåœ¨æœªæäº¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼ŒæŸ¥è¯¢ç»“æœç”±â€™zhangsanâ€™å˜æˆäº†â€™lisiâ€™ï¼Œä¹Ÿå°±æ˜¯è¯´æŸä¸ªäº‹åŠ¡è¯»åˆ°äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ã€‚ä½†æ˜¯å¦‚æœSessionBä¸­çš„äº‹åŠ¡ç¨åè¿›è¡Œäº†å›æ»šï¼Œé‚£ä¹ˆSessionAä¸­çš„äº‹åŠ¡ç›¸å½“äºè¯»åˆ°äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™ç§ç°è±¡ä¹Ÿç§°ä¸ºè„è¯»ã€‚</font>å¯è§READ-UNCOMMITTEDæ˜¯éå¸¸ä¸å®‰å…¨</p>
<h3 id="READ-COMMITTED">READ COMMITTED</h3>
<p>READ COMMITTED ä¸­æ–‡å«<strong>å·²æäº¤è¯»ï¼Œæˆ–è€…å«ä¸å¯é‡å¤è¯»</strong>ã€‚<font color=red>å³ä¸€ä¸ªäº‹åŠ¡èƒ½è¯»åˆ°å¦ä¸€ä¸ªå·²ç»æäº¤äº‹åŠ¡ä¿®æ”¹åçš„æ•°æ®ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡å‡å¯¹è¯¥æ•°æ®è¿›è¡Œä¿®æ”¹å¹¶æäº¤ï¼Œè¯¥äº‹åŠ¡ä¹Ÿèƒ½æŸ¥è¯¢åˆ°æœ€æ–°å€¼ã€‚</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309143845.png" alt="image-20210309143845407"></p>
<p><font color=red>SessionB ä¿®æ”¹åï¼Œå¦‚æœæœªæäº¤ï¼ŒSessionAæ˜¯è¯»ä¸åˆ°ï¼Œä½†SessionBä¸€æ—¦æäº¤åï¼ŒSessionAå³å¯è¯»åˆ°SessionBä¿®æ”¹çš„å†…å®¹ã€‚</font>ä¸å¯é‡å¤è¯»æ˜¯è¿åäº‹åŠ¡çš„éš”ç¦»æ€§çš„ã€‚</p>
<h3 id="REPEATABLE-READ">REPEATABLE READ</h3>
<p>REPEATABLE READ ä¸­æ–‡å«å¯é‡å¤è¯»ï¼Œ<font color=red>å³äº‹åŠ¡èƒ½è¯»åˆ°å¦ä¸€ä¸ªå·²ç»æäº¤çš„äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡è¯»è¿‡æŸæ¡è®°å½•åï¼Œå³ä½¿åé¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†è¯¥è®°å½•çš„å€¼å¹¶ä¸”æäº¤ï¼Œè¯¥äº‹åŠ¡ä¹‹åå†è¯»è¯¥æ¡è®°å½•æ—¶ï¼Œè¯»åˆ°çš„ä»æ˜¯ç¬¬ä¸€æ¬¡è¯»åˆ°çš„å€¼ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½è¯»åˆ°ä¸åŒçš„æ•°æ®ã€‚</font>å¦‚ä¸‹å›¾:</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309144051.png" alt="image-20210309144051799"></p>
<p>InnoDBé»˜è®¤æ˜¯è¿™ç§éš”ç¦»çº§åˆ«ï¼ŒSessionBæ— è®ºæ€ä¹ˆä¿®æ”¹id=1çš„å€¼ï¼ŒSessionAè¯»åˆ°ä¾ç„¶æ˜¯è‡ªå·±å¼€å¯äº‹åŠ¡ç¬¬ä¸€æ¬¡è¯»åˆ°çš„å†…å®¹ã€‚</p>
<h3 id="SERIALIZABLE">SERIALIZABLE</h3>
<p>SERIALIZABLE å«ä¸²è¡ŒåŒ–ï¼Œ ä¸Šé¢ä¸‰ç§éš”ç¦»çº§åˆ«å¯ä»¥è¿›è¡Œ è¯»-è¯» æˆ–è€… è¯»-å†™ã€å†™-è¯»ä¸‰ç§å¹¶å‘æ“ä½œï¼Œè€Œ<font color=red>SERIALIZABLEä¸å…è®¸è¯»-å†™ï¼Œå†™-è¯»çš„å¹¶å‘æ“ä½œ</font>ã€‚ å¦‚ä¸‹å›¾:</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309144203.png" alt="image-20210309144203252"></p>
<p>SessionB å¯¹ id=1 è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼ŒSessionA è¯»å–id=1åˆ™éœ€è¦ç­‰å¾… SessionB æäº¤äº‹åŠ¡ã€‚å¯ä»¥ç†è§£SessionBåœ¨æ›´æ–°çš„æ—¶å€™åŠ äº†é”ã€‚</p>
<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</h2>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡<strong>å…è®¸å¤šä¸ªç‹¬ç«‹çš„äº‹åŠ¡èµ„æºå‚ä¸åˆ°ä¸€ä¸ªå…¨å±€çš„äº‹åŠ¡ä¸­ã€‚å…¨å±€äº‹åŠ¡è¦æ±‚åœ¨å…¶ä¸­çš„æ‰€æœ‰å‚ä¸çš„äº‹åŠ¡è¦ä¹ˆéƒ½æäº¤ï¼Œè¦ä¹ˆéƒ½å›æ»šã€‚</strong></p>
<h3 id="InnoDB-åˆ†å¸ƒå¼äº‹åŠ¡">InnoDB åˆ†å¸ƒå¼äº‹åŠ¡</h3>
<p>InnoDB æ˜¯æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºç®¡ç†å™¨ï¼ˆResource Managersï¼‰ï¼Œä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨(Transaction Manager)ï¼Œä»¥åŠä¸€ä¸ªåº”ç”¨ç¨‹åº(Application Program)ç»„æˆã€‚</p>
<ul>
<li>èµ„æºç®¡ç†å™¨ï¼ˆResource Managersï¼‰ï¼Œæä¾›è®¿é—®äº‹åŠ¡èµ„æºçš„æ–¹æ³•ï¼Œä¸€èˆ¬ä¸€ä¸ªæ•°æ®åº“å°±æ˜¯ä¸€ä¸ªèµ„æºç®¡ç†å™¨ã€‚</li>
<li>äº‹åŠ¡ç®¡ç†å™¨(Transaction Manager)ï¼Œåè°ƒå‚ä¸å…¨å±€äº‹åŠ¡ä¸­çš„å„ä¸ªäº‹åŠ¡ï¼Œéœ€è¦å’Œå‚ä¸å…¨å±€äº‹åŠ¡çš„æ‰€æœ‰èµ„æºç®¡ç†å™¨è¿›è¡Œé€šä¿¡ã€‚</li>
<li>åº”ç”¨ç¨‹åº(Application Program) å®šä¹‰äº‹åŠ¡çš„è¾¹ç•Œï¼ŒæŒ‡å®šå…¨å±€äº‹åŠ¡ä¸­çš„æ“ä½œã€‚</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309144336.png" alt="image-20210309144336352"></p>
<p>åº”ç”¨ç¨‹åºå‘ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åº“æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œ<strong>äº‹åŠ¡ç®¡ç†å™¨è¿›è¡Œç®¡ç†äº‹åŠ¡ï¼Œé€šè¿‡äºŒæ®µå¼æäº¤ï¼Œç¬¬ä¸€é˜¶æ®µæ‰€æœ‰å‚ä¸çš„å…¨å±€äº‹åŠ¡çš„èŠ‚ç‚¹éƒ½å¼€å§‹å‡†å¤‡ï¼Œå‘Šè¯‰äº‹åŠ¡ç®¡ç†å™¨éƒ½å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥æäº¤äº†ã€‚ç¬¬äºŒé˜¶æ®µï¼Œäº‹åŠ¡ç®¡ç†å™¨å‘Šè¯‰æ¯ä¸€ä¸ªèµ„æºç®¡ç†å™¨æ˜¯æ‰§è¡ŒCommit è¿˜æ˜¯ Rollbackã€‚å¦‚æœä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æ˜¾ç¤ºä¸èƒ½æäº¤ï¼Œåˆ™æ‰€æœ‰çš„èŠ‚ç‚¹è¢«å‘ŠçŸ¥éœ€è¦å›æ»š</strong>ã€‚</p>
<h3 id="TCCåˆ†å¸ƒå¼äº‹åŠ¡">TCCåˆ†å¸ƒå¼äº‹åŠ¡</h3>
<p><strong>InnoDBçš„åˆ†å¸ƒå¼æ˜¯æ•°æ®åº“å®ç°çš„, æ•°æ®åº“å¤–å¸¸è§çš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯TCCåˆ†å¸ƒå¼äº‹åŠ¡</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309144458.png" alt="image-20210309144458126"></p>
<p>ä¸Šå›¾æè¿°äº†TCCåˆ†å¸ƒå¼äº‹åŠ¡çš„æµç¨‹ï¼Œå‡è®¾ç”µå•†ä¸šåŠ¡ä¸­ï¼Œæ”¯ä»˜åéœ€è¦ä¿®æ”¹åº“å­˜ï¼Œç§¯åˆ†ï¼Œç‰©æµä»“å‚¨çš„æ•°æ®ï¼Œå¦‚æœä¸€ä¸ªå¤±è´¥åˆ™å…¨éƒ¨å›æ»šã€‚</p>
<p>TCCåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæœ‰ä¸‰ä¸ªé˜¶æ®µï¼ŒTryï¼ŒConfirm, Cancelã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå‚ä¸äº‹åŠ¡çš„æœåŠ¡éƒ½éœ€è¦å®ç°è¿™ä¸‰ä¸ªæ¥å£ï¼Œåº“å­˜ã€ç§¯åˆ†ã€ä»“å‚¨éƒ½éœ€è¦å®ç°è¿™ä¸‰ä¸ªæ¥å£ã€‚</p>
<p>ç¬¬ä¸€é˜¶æ®µï¼ŒTryï¼Œä¸šåŠ¡åº”ç”¨è°ƒå–å„ä¸ªæœåŠ¡çš„Tryæ¥å£ï¼Œå‘Šè¯‰ä»–ä»¬ç»™æˆ‘é¢„ç•™ä¸€ä¸ªå•†å“ï¼Œæœ‰äººè¦è´­ä¹°ï¼Œå¯ä»¥ç†è§£ä¸ºå†»ç»“ï¼Œæ¯ä¸€æ­¥éƒ½ä¸æ‰§è¡ŒæˆåŠŸï¼Œåªæ˜¯æ ‡è®°æ›´æ–°çŠ¶æ€ã€‚</p>
<p>ç¬¬äºŒé˜¶æ®µï¼ŒConfirmï¼Œç¡®è®¤é˜¶æ®µï¼Œå³äº‹åŠ¡åè°ƒå™¨è°ƒå–æ¯ä¸ªæœåŠ¡Confirmæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¦‚æœæŸä¸€ä¸ªæœåŠ¡çš„Confirmå¤±è´¥ï¼Œåˆ™æœ‰ç¬¬ä¸‰ä¸ªé˜¶æ®µã€‚å¦‚æœæˆåŠŸåˆ™ç»“æŸäº‹åŠ¡ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼ŒCancelï¼Œå¦‚æœåœ¨ç¬¬äºŒä¸ªé˜¶æ®µæœ‰ä¸€ä¸ªäº‹åŠ¡æäº¤å¤±è´¥ï¼Œåˆ™äº‹åŠ¡åè°ƒå™¨è°ƒå–æ‰€æœ‰ä¸šåŠ¡çš„Cancelæ¥å£ï¼Œå›æ»šäº‹åŠ¡ï¼Œå°†ç¬¬ä¸€é˜¶æ®µå†»ç»“çš„å•†å“æ¢å¤ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„åˆ†åº“åˆ†è¡¨</title>
    <url>/posts/85c1a08/</url>
    <content><![CDATA[<h2 id="åˆ†åº“åˆ†è¡¨å‰çš„é—®é¢˜">åˆ†åº“åˆ†è¡¨å‰çš„é—®é¢˜</h2>
<p>ä»»ä½•é—®é¢˜éƒ½æ˜¯å¤ªå¤§æˆ–è€…å¤ªå°çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿™é‡Œé¢å¯¹çš„æ•°æ®é‡å¤ªå¤§çš„é—®é¢˜ã€‚</p>
<h3 id="ç”¨æˆ·è¯·æ±‚é‡å¤ªå¤§">ç”¨æˆ·è¯·æ±‚é‡å¤ªå¤§</h3>
<p>å› ä¸ºå•æœåŠ¡å™¨TPSï¼Œå†…å­˜ï¼ŒIOéƒ½æ˜¯æœ‰é™çš„ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šåˆ†æ•£è¯·æ±‚åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼› å…¶å®ç”¨æˆ·è¯·æ±‚å’Œæ‰§è¡Œä¸€ä¸ªsqlæŸ¥è¯¢æ˜¯æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è¯·æ±‚ä¸€ä¸ªèµ„æºï¼Œåªæ˜¯ç”¨æˆ·è¯·æ±‚è¿˜ä¼šç»è¿‡ç½‘å…³ï¼Œè·¯ç”±ï¼ŒhttpæœåŠ¡å™¨ç­‰ã€‚</p>
<h3 id="å•åº“å¤ªå¤§">å•åº“å¤ªå¤§</h3>
<p>å•ä¸ªæ•°æ®åº“å¤„ç†èƒ½åŠ›æœ‰é™ï¼›å•åº“æ‰€åœ¨æœåŠ¡å™¨ä¸Šç£ç›˜ç©ºé—´ä¸è¶³ï¼›å•åº“ä¸Šæ“ä½œçš„IOç“¶é¢ˆ</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šåˆ‡åˆ†æˆæ›´å¤šæ›´å°çš„åº“</p>
<h3 id="å•è¡¨å¤ªå¤§">å•è¡¨å¤ªå¤§</h3>
<p>CRUDéƒ½æˆé—®é¢˜ï¼›ç´¢å¼•è†¨èƒ€ï¼ŒæŸ¥è¯¢è¶…æ—¶</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šåˆ‡åˆ†æˆå¤šä¸ªæ•°æ®é›†æ›´å°çš„è¡¨ã€‚å°†è¡¨ä¸­å¤§å­—æ®µå•ç‹¬å­˜æ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œä¸å¸¸ç”¨å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ä¸­</p>
<h2 id="åˆ†åº“åˆ†è¡¨çš„æ–¹å¼æ–¹æ³•">åˆ†åº“åˆ†è¡¨çš„æ–¹å¼æ–¹æ³•</h2>
<p>ä¸€èˆ¬å°±æ˜¯å‚ç›´åˆ‡åˆ†å’Œæ°´å¹³åˆ‡åˆ†ï¼Œè¿™æ˜¯ä¸€ç§ç»“æœé›†æè¿°çš„åˆ‡åˆ†æ–¹å¼ï¼Œæ˜¯ç‰©ç†ç©ºé—´ä¸Šçš„åˆ‡åˆ†ã€‚ æˆ‘ä»¬ä»é¢ä¸´çš„é—®é¢˜ï¼Œå¼€å§‹è§£å†³ï¼Œé˜è¿°ï¼š é¦–å…ˆæ˜¯ç”¨æˆ·è¯·æ±‚é‡å¤ªå¤§ï¼Œæˆ‘ä»¬å°±å †æœºå™¨æå®šï¼ˆè¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼‰ã€‚ç„¶åæ˜¯å•ä¸ªåº“å¤ªå¤§ï¼Œè¿™æ—¶æˆ‘ä»¬è¦çœ‹æ˜¯å› ä¸ºè¡¨å¤šè€Œå¯¼è‡´æ•°æ®å¤šï¼Œè¿˜æ˜¯å› ä¸º<strong>å•å¼ è¡¨é‡Œé¢çš„æ•°æ®å¤š</strong>ã€‚ å¦‚æœæ˜¯å› ä¸ºè¡¨å¤šè€Œæ•°æ®å¤šï¼Œä½¿ç”¨<strong>å‚ç›´åˆ‡åˆ†</strong>ï¼Œæ ¹æ®ä¸šåŠ¡åˆ‡åˆ†æˆä¸åŒçš„åº“ã€‚å¦‚æœæ˜¯<strong>å› ä¸ºå•å¼ è¡¨çš„æ•°æ®é‡å¤ªå¤§</strong>ï¼Œè¿™æ—¶è¦ç”¨<strong>æ°´å¹³åˆ‡åˆ†</strong>ï¼Œå³æŠŠè¡¨çš„æ•°æ®æŒ‰æŸç§è§„åˆ™åˆ‡åˆ†æˆå¤šå¼ è¡¨ï¼Œç”šè‡³å¤šä¸ªåº“ä¸Šçš„å¤šå¼ è¡¨ã€‚</p>
<p><strong>åˆ†åº“åˆ†è¡¨çš„é¡ºåºåº”è¯¥æ˜¯å…ˆå‚ç›´åˆ†ï¼Œåæ°´å¹³åˆ†ã€‚</strong> å› ä¸ºå‚ç›´åˆ†æ›´ç®€å•ï¼Œæ›´ç¬¦åˆæˆ‘ä»¬å¤„ç†ç°å®ä¸–ç•Œé—®é¢˜çš„æ–¹å¼ã€‚</p>
<h3 id="å‚ç›´æ‹†åˆ†">å‚ç›´æ‹†åˆ†</h3>
<ol>
<li>
<p>å‚ç›´åˆ†è¡¨</p>
<p>å°±æ˜¯â€œå¤§è¡¨æ‹†å°è¡¨â€ï¼ŒåŸºäºåˆ—å­—æ®µè¿›è¡Œçš„ã€‚ä¸€èˆ¬æ˜¯è¡¨ä¸­çš„å­—æ®µè¾ƒå¤šï¼Œå°†ä¸å¸¸ç”¨çš„ï¼Œ æ•°æ®è¾ƒå¤§ï¼Œé•¿åº¦è¾ƒé•¿ï¼ˆæ¯”å¦‚textç±»å‹å­—æ®µï¼‰çš„æ‹†åˆ†åˆ°â€œæ‰©å±•è¡¨â€œã€‚ ä¸€èˆ¬æ˜¯é’ˆå¯¹é‚£ç§å‡ ç™¾åˆ—çš„å¤§è¡¨ï¼Œä¹Ÿé¿å…æŸ¥è¯¢æ—¶ï¼Œæ•°æ®é‡å¤ªå¤§é€ æˆçš„â€œè·¨é¡µâ€é—®é¢˜</p>
</li>
<li>
<p>å‚ç›´åˆ†åº“</p>
<p>å‚ç›´åˆ†åº“é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿä¸­çš„ä¸åŒä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œæ¯”å¦‚ç”¨æˆ·Userä¸€ä¸ªåº“ï¼Œå•†å“Producetä¸€ä¸ªåº“ï¼Œè®¢å•Orderä¸€ä¸ªåº“ã€‚ åˆ‡åˆ†åï¼Œè¦æ”¾åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå‚ç›´åˆ†åº“ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿçªç ´IOã€è¿æ¥æ•°åŠå•æœºç¡¬ä»¶èµ„æºçš„ç“¶é¢ˆã€‚</p>
</li>
</ol>
<h3 id="æ°´å¹³æ‹†åˆ†">æ°´å¹³æ‹†åˆ†</h3>
<ol>
<li>
<p>æ°´å¹³åˆ†è¡¨</p>
<p>é’ˆå¯¹æ•°æ®é‡å·¨å¤§çš„å•å¼ è¡¨ï¼ˆæ¯”å¦‚è®¢å•è¡¨ï¼‰ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™ï¼ˆRANGE,HASHå–æ¨¡ç­‰ï¼‰ï¼Œåˆ‡åˆ†åˆ°å¤šå¼ è¡¨é‡Œé¢å»ã€‚ ä½†æ˜¯è¿™äº›è¡¨è¿˜æ˜¯åœ¨åŒä¸€ä¸ªåº“ä¸­ï¼Œæ‰€ä»¥åº“çº§åˆ«çš„æ•°æ®åº“æ“ä½œè¿˜æ˜¯æœ‰IOç“¶é¢ˆã€‚ä¸å»ºè®®é‡‡ç”¨ã€‚</p>
</li>
<li>
<p>æ°´å¹³åˆ†åº“åˆ†è¡¨</p>
<p>å°†å•å¼ è¡¨çš„æ•°æ®åˆ‡åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šå»ï¼Œæ¯ä¸ªæœåŠ¡å™¨å…·æœ‰ç›¸åº”çš„åº“ä¸è¡¨ï¼Œåªæ˜¯è¡¨ä¸­æ•°æ®é›†åˆä¸åŒã€‚ æ°´å¹³åˆ†åº“åˆ†è¡¨èƒ½å¤Ÿæœ‰æ•ˆçš„ç¼“è§£å•æœºå’Œå•åº“çš„æ€§èƒ½ç“¶é¢ˆå’Œå‹åŠ›ï¼Œçªç ´IOã€è¿æ¥æ•°ã€ç¡¬ä»¶èµ„æºç­‰çš„ç“¶é¢ˆã€‚</p>
</li>
<li>
<p>æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™</p>
<ul>
<li>RANGEï¼šä»0åˆ°10000ä¸€ä¸ªè¡¨ï¼Œ10001åˆ°20000ä¸€ä¸ªè¡¨ï¼›</li>
<li>HASHå–æ¨¡ï¼šä¸€ä¸ªå•†åœºç³»ç»Ÿï¼Œä¸€èˆ¬éƒ½æ˜¯å°†ç”¨æˆ·ï¼Œè®¢å•ä½œä¸ºä¸»è¡¨ï¼Œç„¶åå°†å’Œå®ƒä»¬ç›¸å…³çš„ä½œä¸ºé™„è¡¨ï¼Œè¿™æ ·ä¸ä¼šé€ æˆè·¨åº“äº‹åŠ¡ä¹‹ç±»çš„é—®é¢˜ã€‚ å–ç”¨æˆ·idï¼Œç„¶åhashå–æ¨¡ï¼Œåˆ†é…åˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šã€‚</li>
<li>åœ°ç†åŒºåŸŸï¼šæ¯”å¦‚æŒ‰ç…§åä¸œï¼Œåå—ï¼ŒååŒ—è¿™æ ·æ¥åŒºåˆ†ä¸šåŠ¡</li>
<li>æ—¶é—´ï¼šæŒ‰ç…§æ—¶é—´åˆ‡åˆ†ï¼Œå°±æ˜¯å°†6ä¸ªæœˆå‰ï¼Œç”šè‡³ä¸€å¹´å‰çš„æ•°æ®åˆ‡å‡ºå»æ”¾åˆ°å¦å¤–çš„ä¸€å¼ è¡¨ï¼Œå› ä¸ºéšç€æ—¶é—´æµé€ï¼Œè¿™äº›è¡¨çš„æ•°æ® è¢«æŸ¥è¯¢çš„æ¦‚ç‡å˜å°ï¼Œæ‰€ä»¥æ²¡å¿…è¦å’Œâ€œçƒ­æ•°æ®â€æ”¾åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªä¹Ÿæ˜¯â€œå†·çƒ­æ•°æ®åˆ†ç¦»â€ã€‚</li>
</ul>
</li>
</ol>
<h2 id="åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜">åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜</h2>
<h3 id="è·¨èŠ‚ç‚¹-JOIN">è·¨èŠ‚ç‚¹ JOIN</h3>
<p>åœ¨æ•°æ®åˆ‡åˆ†ä¹‹å‰ï¼Œå…³è”æŸ¥è¯¢å¯ä»¥ç›´æ¥é€šè¿‡ SQL JOIN æ¥å®Œæˆï¼Œä½†æ˜¯åˆ‡åˆ†ä¹‹åï¼Œæ•°æ®å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶è¿›è¡Œå…³è”æŸ¥è¯¢å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œä¸€èˆ¬åº”è¯¥å°½é‡é¿å…å…³è”æŸ¥è¯¢ã€‚</p>
<blockquote>
<p>åœ¨äº’è”ç½‘ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæœ¬æ¥åœ¨ä¸€å¼€å§‹å°±åº”è¯¥é¿å…å…³è”æŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨å…³è”æŸ¥è¯¢ï¼Œæœ‰å¾ˆå¤§çš„å¯èƒ½æ˜¯å› ä¸ºè®¾è®¡çš„ä¸å¤Ÿåˆç†æˆ–è€…æŠ€æœ¯é€‰å‹æœ‰è¯¯ã€‚æŠ¥è¡¨ç±»çš„ç³»ç»Ÿåœ¨ BI æ—¶ä»£éƒ½æ˜¯é€šè¿‡ OLAPã€æ•°æ®ä»“åº“ç­‰æ¥å®ç°çš„ï¼ˆç°åœ¨æ›´å¤šçš„å€ŸåŠ©äºç¦»çº¿åˆ†æã€æµå¼è®¡ç®—ç­‰ï¼‰ï¼Œè€Œä¸åº”è¯¥åœ¨æ•°æ®åº“ä¸­ç›´æ¥æ‰§è¡Œå¤§é‡çš„ JOIN æŸ¥è¯¢æ¥è¿›è¡Œç»Ÿè®¡å’Œåˆ†æã€‚</p>
</blockquote>
<p><strong>åœ¨æ— æ³•é¿å…è·¨èŠ‚ç‚¹ JOIN æ“ä½œæ—¶ï¼Œä¸€èˆ¬æ™®éçš„åšæ³•æ˜¯å°†æŸ¥è¯¢åˆ†ä¸ºä¸¤æ¬¡ï¼Œåœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶æ‰¾å‡ºå…³è”æ•°æ®çš„ IDï¼Œç„¶åæ ¹æ®è¿™äº› ID å‘èµ·ç¬¬äºŒæ¬¡æŸ¥è¯¢å¾—åˆ°å…³è”æ•°æ®ã€‚</strong></p>
<h3 id="è·¨èŠ‚ç‚¹åˆ†é¡µæ’åº">è·¨èŠ‚ç‚¹åˆ†é¡µæ’åº</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ†é¡µéƒ½éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚å½“æ’åºå­—æ®µå°±æ˜¯åˆ†ç‰‡å­—æ®µæ—¶ï¼Œé€šè¿‡åˆ†ç‰‡è§„åˆ™æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°å®šä½åˆ°å…·ä½“çš„åˆ†ç‰‡ä¸Šï¼Œè€Œå½“æ’åºå­—æ®µä¸æ˜¯åˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œå°±éœ€è¦åœ¨ä¸åŒçš„åˆ†ç‰‡ä¸­åˆ†åˆ«å°†æ•°æ®è¿›è¡Œæ’åºï¼Œç„¶åæŠŠç»“æœé›†è¿›è¡Œæ±‡æ€»å¹¶å†æ¬¡è¿›è¡Œæ’åºã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317150038.png" alt="image-20210317150038859"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317150050.png" alt="image-20210317150050514"></p>
<h3 id="è·¨èŠ‚ç‚¹æ’åºã€åˆ†ç»„å’Œèšåˆæ“ä½œ">è·¨èŠ‚ç‚¹æ’åºã€åˆ†ç»„å’Œèšåˆæ“ä½œ</h3>
<p>ä¸è·¨èŠ‚ç‚¹åˆ†é¡µæ’åºç±»ä¼¼ï¼Œå¤šæ•°çš„ sharding ç»„ä»¶éƒ½ä¸ä¼šå¯¹è¿™äº›æ“ä½œï¼ˆorder byã€group byã€countã€avg ç­‰ï¼‰è‡ªåŠ¨è¿›è¡Œåˆå¹¶ï¼Œéœ€è¦æ‰‹å·¥åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°ç»“æœé›†ï¼Œç„¶ååœ¨åº”ç”¨ä¸­è¿›è¡Œåˆå¹¶ï¼Œå†…å­˜æ¶ˆè€—ä¸¥é‡ã€‚</p>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</h3>
<p>è¿›è¡Œäº†åˆ†åº“åˆ†è¡¨ä»¥åï¼ŒåŸå…ˆä¸€æ¬¡ä¸šåŠ¡ä¸­çš„äº‹åŠ¡å¯èƒ½ä¼šæ¶‰åŠåˆ°å¤šä¸ªæ•°æ®åº“èŠ‚ç‚¹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚æœ‰ä¸€é¡¹æ¶ˆè´¹ä¸šåŠ¡ï¼Œåœ¨ç”¨æˆ·é€‰è´­å®Œå•†å“è¿›è¡Œç»“ç®—æ—¶ï¼Œéœ€è¦æ‰£å‡ç”¨æˆ·ä½™é¢ï¼Œç”¨æˆ·çš„ç§¯åˆ†å’Œä¼˜æƒ åˆ¸ï¼Œè€Œç”¨æˆ·çš„ç§¯åˆ†å’Œä¼˜æƒ åˆ¸ä¿¡æ¯å¯èƒ½ä½äºå…¶ä»–èŠ‚ç‚¹çš„æ•°æ®åº“ä¸­ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¿è¯åœ¨ç»“ç®—æ—¶åŒæ—¶æ‰£é™¤ä½™é¢ã€ç§¯åˆ†å’Œä¼˜æƒ åˆ¸ï¼Œè¿™ä¸€ç³»åˆ—åŠ¨ä½œéœ€è¦ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œï¼Œè¿™ä¸ªäº‹åŠ¡å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ï¼šåŸºäº XA çš„ 2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ï¼Œä»¥åŠ 2PC çš„æ”¹è¿›ç‰ˆæœ¬ 3PCã€TCCï¼ˆTry-Confirm-Cancelï¼Œäº‹åŠ¡è¡¥å¿ï¼‰ï¼Œæ€§èƒ½å‡ºè‰²çš„ Best Efforts 1PC å’ŒåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆç­‰ã€‚</p>
<p>ç”±äºåŸºäº XA çš„æ ‡å‡†åˆ†å¸ƒå¼äº‹åŠ¡è¿‡äºä¸¥æ ¼ï¼Œåœ¨æäº¤äº‹åŠ¡æ—¶éœ€è¦å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œåè°ƒï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå»¶é•¿äº†äº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿™ä¼šå¯¼è‡´è®¿é—®å…±äº«èµ„æºæ—¶å‘ç”Ÿå†²çªå’Œæ­»é”çš„æ¦‚ç‡å¢å¤§ï¼Œå¹¶ä¸”è¿™ç§è¶‹åŠ¿ä¼šéšç€èŠ‚ç‚¹çš„å¢å¤šè€Œè¶Šå‘æ˜æ˜¾ï¼Œä»è€Œæˆä¸ºç³»ç»Ÿåœ¨æ•°æ®åº“å±‚é¢ä¸Šè¿›è¡Œæ°´å¹³ä¼¸ç¼©çš„æ·é”ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤š sharding ç³»ç»Ÿä¸ä½¿ç”¨æ ‡å‡†åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸå› ã€‚ä¸ä¹‹ç›¸å¯¹çš„ï¼ŒBest Efforts 1PC å…·æœ‰å‡ºè‰²çš„æ€§èƒ½ä¼˜åŠ¿ï¼ŒåŒæ—¶å®ç°çš„æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå› æ­¤è¢«å¤§å¤šæ•° sharding ç³»ç»Ÿæ‰€é‡‡ç”¨ã€‚</p>
<h3 id="ä¸»é”®">ä¸»é”®</h3>
<p>å½“æ•°æ®åº“è¢«åˆ‡åˆ†åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šæ—¶ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å†ä»¥æ¥æ•°æ®åº“è‡ªèº«çš„ä¸»é”®ç”Ÿæˆæœºåˆ¶äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¿è¯æŸä¸ªåˆ†ç‰‡ä¸Šçš„æ•°æ®åº“ç”Ÿæˆçš„ ID åœ¨å…¨å±€ä¸Šæ˜¯å”¯ä¸€çš„ï¼ŒåŒæ—¶æˆ‘ä»¬çš„åº”ç”¨åœ¨æ’å…¥æ•°æ®å‰éœ€è¦å…ˆè·å– IDï¼Œä»¥ä¾¿è¿›è¡Œ SQL çš„è·¯ç”±</p>
<h4 id="UUID">UUID</h4>
<p>å¸¸è§çš„å…¨å±€å”¯ä¸€ä¸»é”®ç”Ÿæˆæ–¹æ¡ˆä¸­ï¼ŒUUID æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªã€‚æ ‡å‡†çš„ UUID åŒ…å« 32 ä¸ª 16 è¿›åˆ¶æ•°å­—ï¼Œä»¥ <code>8-4-4-4-12</code> çš„å½¢å¼åˆ†ä¸ºäº”æ®µï¼Œæ¯”å¦‚ï¼š<code>550e8400-e29b-41d4-a716-446655440000</code>ï¼Œç›®å‰ä¸šç•Œå…±æœ‰äº”ç§ç”Ÿæˆ UUID çš„æ–¹å¼ï¼Œè¯¦æƒ…è¯·è§ IETF å‘å¸ƒçš„ UUID è§„èŒƒï¼š<a href="https://www.ietf.org/rfc/rfc4122.txt">A Universally Unique IDentifier (UUID) URN Namespace</a>ã€‚UUID çš„ä¼˜ç‚¹æ˜¯é€šè¿‡æœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç½‘ç»œæ¶ˆè€—ï¼Œæ€§èƒ½éå¸¸é«˜ï¼Œç¼ºç‚¹æ˜¯é•¿åº¦è¿‡é•¿ä¸å®¹æ˜“å­˜å‚¨ï¼Œä¸”å¯èƒ½å­˜åœ¨ä¿¡æ¯å®‰å…¨é—®é¢˜ï¼ˆåŸºäº MAC åœ°å€ç”Ÿæˆ UUID çš„ç®—æ³•å¯èƒ½ä¼šé€ æˆ MAC åœ°å€æ³„éœ²ï¼‰ã€‚MySQL å®˜æ–¹å¯¹äºä¸»é”®çš„å»ºè®®æ˜¯è¶ŠçŸ­è¶Šå¥½ï¼ŒUUID ä¸ç¬¦åˆè¦æ±‚ï¼ŒåŒæ—¶åœ¨ InnoDB å¼•æ“ä¸­ï¼ŒUUID çš„æ— åºæ€§å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä½ç½®çš„é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚</p>
<h4 id="sequence-è¡¨">sequence è¡¨</h4>
<p>é€šè¿‡æ•°æ®åº“ç»´æŠ¤ä¸€ä¸ª sequence è¡¨ï¼Œè¡¨ç»“æ„ç±»ä¼¼äºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `SEQUENCE` (</span><br><span class="line">    `table_name` <span class="type">varchar</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `next_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`table_name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å½“éœ€è¦ä¸ºæŸä¸ªè¡¨ç”Ÿæˆ ID æ—¶ï¼Œå°±ä» sequence è¡¨ä¸­å–å‡ºå¯¹åº”è¡¨çš„ next_idï¼Œå¹¶å°† next_id çš„å€¼å¢åŠ  1 åæ›´æ–°åˆ°æ•°æ®åº“ä¸­ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚è¿™ä¸ªæ–¹æ¡ˆå®ç°ç®€å•ï¼Œä½†æ˜¯<strong>ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºæ‰€æœ‰çš„æ’å…¥æ“ä½œéƒ½éœ€è¦è®¿é—®è¿™å¼ è¡¨ï¼Œå› æ­¤è¯¥è¡¨å¾ˆå®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼ŒåŒæ—¶å®ƒä¹Ÿå­˜åœ¨å•ç‚¹é—®é¢˜ã€‚</strong></p>
<h4 id="snowflake">snowflake</h4>
<p>snowflake æ˜¯ twitter çš„åˆ†å¸ƒå¼è‡ªå¢ ID ç®—æ³•ï¼Œåˆç§°é›ªèŠ±ç®—æ³•ã€‚è¿™ç§ç®—æ³•çš„å¥½å¤„æ˜¯æ•´ä¸ª ID æ˜¯è¶‹åŠ¿é€’å¢çš„ï¼Œæ€§èƒ½å¾ˆé«˜ä¹Ÿå¾ˆçµæ´»ï¼Œä½†æ˜¯ç”±äºå¼ºä¾èµ–æœºå™¨çš„æ—¶é’Ÿï¼Œ<strong>å¦‚æœæœºå™¨ä¸Šçš„æ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´é‡å¤å‘å·çš„é—®é¢˜</strong>ã€‚</p>
<p>è¿˜æœ‰ä¸€äº›æ˜¯åœ¨é›ªèŠ±ç®—æ³•çš„åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ç™¾åº¦çš„ <a href="https://github.com/baidu/uid-generator">uid-generator</a> å’Œç¾å›¢çš„ <a href="https://github.com/Meituan-Dianping/Leaf">Leaf</a>ã€‚</p>
<h3 id="æ•°æ®è¿ç§»ã€æ‰©å®¹ç­‰é—®é¢˜">æ•°æ®è¿ç§»ã€æ‰©å®¹ç­‰é—®é¢˜</h3>
<p>ç”±äºæ‰©å®¹åè·¯ç”±è§„åˆ™å‘ç”Ÿå˜åŒ–ï¼Œæ‰©å®¹å‰çš„æ•°æ®è¡Œå¾ˆæœ‰å¯èƒ½éœ€è¦è¿›è¡Œæ•°æ®è¿ç§»ã€‚åœ¨è¿›è¡Œæ•°æ®è¿ç§»æ—¶ï¼Œä¸€èˆ¬æ˜¯ä¸å…è®¸åœæœºçš„ï¼Œå› æ­¤ç†æƒ³çš„æ‰©å®¹æ–¹å¼å°±æ˜¯é¿å…æ•°æ®è¿ç§»ã€‚</p>
<h2 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h2>
<p>ç›®å‰åˆ†åº“åˆ†è¡¨çš„ä¸­é—´ä»¶ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ç±»æ˜¯å®¢æˆ·ç«¯æ¶æ„ï¼Œä¸€ç±»æ˜¯ä»£ç†æ¶æ„ã€‚</p>
<p>å®¢æˆ·ç«¯æ¶æ„çš„ä¸­é—´ä»¶éœ€è¦åœ¨åº”ç”¨ä¸­è¿›è¡Œæ•´åˆï¼Œä¸­é—´ä»¶ä¸€èˆ¬ä¼šä»¥ jar åŒ…çš„å½¢å¼æä¾›ã€‚é€šè¿‡ä¿®æ”¹åº”ç”¨çš„æ•°æ®è®¿é—®å±‚ï¼ˆJDBC æˆ–è€…ä»¥ JDBC ä¸ºåŸºç¡€çš„ ORM æ¡†æ¶ï¼‰çš„æ–¹å¼å¯¹åº”ç”¨å†…äº§ç”Ÿçš„ SQL è¿›è¡Œè§£æã€é‡å†™ã€è·¯ç”±ã€æ‰§è¡Œï¼Œå¹¶å¯¹ç»“æœé›†è¿›è¡Œå½’å¹¶ã€‚è¿™ç§æ¶æ„çš„ä¼˜ç‚¹æ˜¯æ— éœ€å¯¹ä¸šåŠ¡è¿›è¡Œæ”¹é€ ï¼Œç®€å•ä¸”æˆæœ¬è¾ƒä½ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ä¸­é—´ä»¶ä¸åº”ç”¨ç»‘å®šï¼Œå¯¹åº”ç”¨æœ‰ä¸€å®šçš„ä¾µå…¥æ€§ï¼Œä¸æ”¯æŒå¤æ‚çš„éœ€æ±‚ï¼Œå¹¶ä¸”å¯¹åº”ç”¨æ•°æ®è®¿é—®å±‚çš„å®ç°æœ‰é™åˆ¶ã€‚æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„äº§å“ä¸º <a href="https://github.com/apache/incubator-shardingsphere">ShardingSphere</a> ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317150513.png" alt="image-20210317150513519"></p>
<p>ä»£ç†æ¶æ„çš„ä¸­é—´ä»¶ä¸€èˆ¬æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œç›¸å½“äºå®ç°äº†ä¸€ä¸ªæ”¯æŒå¯¹åº”æ•°æ®åº“åè®®çš„ä»£ç†æœåŠ¡å™¨ã€‚ä»¥ MySQL ä¸ºä¾‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ MySQL å®¢æˆ·ç«¯å·¥å…·æˆ–è€…å‘½ä»¤è¡Œè®¿é—®è¯¥ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶ä¼šä½¿ç”¨ MySQL åè®®ä¸å¤šä¸ª MySQL æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚è¿™ç§æ¶æ„çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿå¤„ç†éå¸¸å¤æ‚çš„éœ€æ±‚ï¼Œå¯¹åº”ç”¨æ•°æ®è®¿é—®å±‚çš„å®ç°æ²¡æœ‰é™åˆ¶ï¼Œå¯¹äºåº”ç”¨æœåŠ¡é€æ˜ä¸ä¼šå¢åŠ ä»»ä½•é¢å¤–çš„è´Ÿè½½ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ç”±äºéœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼Œå¢åŠ äº†è¿ç»´æˆæœ¬ï¼ŒåŒæ—¶åº”ç”¨éœ€è¦ç»è¿‡ä¸€å±‚ä»£ç†æ‰å¯ä»¥è®¿é—®æ•°æ®åº“ï¼Œåœ¨ç½‘ç»œä¸Šå¤šäº†ä¸€è·³ï¼Œå½±å“æ€§èƒ½å¹¶å¯èƒ½ä¼šæœ‰é¢å¤–çš„é£é™©ã€‚æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„äº§å“æœ‰ <a href="https://github.com/MyCATApache/Mycat-Server">MyCat</a> å’Œ <a href="https://github.com/alibaba/cobar">Cobar</a>ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹1</title>
    <url>/posts/cfe2d636/</url>
    <content><![CDATA[<h2 id="çº¿ç¨‹çš„çŠ¶æ€å›¾"><strong>çº¿ç¨‹çš„çŠ¶æ€å›¾</strong></h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113754.jpg" alt="img"></p>
<ol>
<li>
<p><strong>æ–°å»º(NEW)</strong>ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>å¯è¿è¡Œ(RUNNABLE)</strong>ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹(æ¯”å¦‚mainçº¿ç¨‹ï¼‰è°ƒç”¨äº†è¯¥å¯¹è±¡çš„start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œç­‰å¾…è¢«çº¿ç¨‹è°ƒåº¦é€‰ä¸­ï¼Œè·å–cpu çš„ä½¿ç”¨æƒ ã€‚</p>
</li>
<li>
<p><strong>è¿è¡Œ(RUNNING)</strong>ï¼šå¯è¿è¡ŒçŠ¶æ€(runnable)çš„çº¿ç¨‹è·å¾—äº†cpu æ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰ ï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚</p>
</li>
<li>
<p><strong>é˜»å¡(BLOCKED)</strong>ï¼šé˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒäº†cpu ä½¿ç”¨æƒï¼Œä¹Ÿå³è®©å‡ºäº†cpu timesliceï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šå†æ¬¡è·å¾—cpu timeslice è½¬åˆ°è¿è¡Œ(running)çŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(ä¸€). ç­‰å¾…é˜»å¡ï¼šè¿è¡Œ(running)çš„çº¿ç¨‹æ‰§è¡Œo.wait()æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—(waitting queue)ä¸­ã€‚</span><br><span class="line">(äºŒ). åŒæ­¥é˜»å¡ï¼šè¿è¡Œ(running)çš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± (lock pool)ä¸­ã€‚</span><br><span class="line">(ä¸‰). å…¶ä»–é˜»å¡ï¼šè¿è¡Œ(running)çš„çº¿ç¨‹æ‰§è¡ŒThread.sleep(<span class="keyword">long</span> ms)æˆ–t.join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ­»äº¡(DEAD)</strong>ï¼šçº¿ç¨‹run()ã€main() æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œæˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚æ­»äº¡çš„çº¿ç¨‹ä¸å¯å†æ¬¡å¤ç”Ÿã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">runæ–¹æ³•æ˜¯threadé‡Œé¢çš„ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è°ƒç”¨runæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™å®ƒæ˜¯ä¼šè¿è¡Œåœ¨æˆ‘ä»¬çš„ä¸»çº¿ç¨‹ä¸­çš„ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„ç¨‹åºä¸­åªæœ‰ä¸»çº¿ç¨‹ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œéƒ½æ˜¯ç›´æ¥è°ƒç”¨çš„runæ–¹æ³•ï¼Œé‚£ä¹ˆä»–ä»¬çš„æ‰§è¡Œé¡ºåºä¸€å®šæ˜¯é¡ºåºæ‰§è¡Œ</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="å¯åŠ¨çº¿ç¨‹æ–¹å¼">å¯åŠ¨çº¿ç¨‹æ–¹å¼</h2>
<ol>
<li>ç»§æ‰¿Thread</li>
<li>å®ç°Runableæ¥å£</li>
<li>Executors.newCachedTreadï¼ˆçº¿ç¨‹æ± ï¼Œæœ¬è´¨è¿˜æ˜¯ä¸Šé¢ä¸¤ç§æ–¹å¼å…¶ä¸­ä¸€ç§å»å®ç°çº¿ç¨‹ï¼‰</li>
<li>ä½¿ç”¨Lamdaè¡¨è¾¾å¼ï¼ˆæœ¬è´¨è¿˜æ˜¯ç»§æ‰¿Threadï¼‰</li>
<li>å®ç°Callableæ¥å£</li>
</ol>
<h2 id="synchronized">synchronized</h2>
<h3 id="synchronizedæ¦‚è¿°">synchronizedæ¦‚è¿°</h3>
<p><strong>synchronizedæ˜¯Javaçš„å†…å»ºé”ï¼Œç”¨æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ç§é‡è¦æ‰‹æ®µ</strong>,<strong>synchronizedå¯ä»¥ä¿è¯åœ¨å¤šçº¿ç¨‹çŠ¶æ€ä¸‹ï¼Œæ¯æ¬¡ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº</strong></p>
<p><strong>synchronizedçš„ä½œç”¨ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š</strong></p>
<ol>
<li>åŸå­æ€§ï¼šçº¿ç¨‹äº’æ–¥çš„è®¿é—®åŒæ­¥ä»£ç å—ï¼Œå¯ä»¥å°†å°åŸå­åˆæˆå¤§åŸå­</li>
<li>å¯è§æ€§ï¼šsynchronizedè§£é”ä¹‹å‰ï¼Œå¿…é¡»å°†å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œå…¶å®ƒçº¿ç¨‹æ“ä½œè¯¥å˜é‡æ—¶æ¯æ¬¡éƒ½å¯ä»¥çœ‹åˆ°è¢«ä¿®æ”¹åçš„å€¼ã€‚</li>
<li>æœ‰åºæ€§ï¼šä¸€ä¸ªçº¿ç¨‹çš„åŠ é”ï¼Œå¿…é¡»ç­‰åˆ°å…¶å®ƒçº¿ç¨‹å°†é”é‡Šæ”¾ï¼›ä¸€ä¸ªçº¿ç¨‹è¦é‡Šæ”¾é”ï¼Œé¦–å…ˆè¦åŠ é”ã€‚</li>
</ol>
<h3 id="synchronizedåŒæ­¥åŸç†">synchronizedåŒæ­¥åŸç†</h3>
<p>synchronizedä»…æ˜¯Javaä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰çœ‹åˆ°æ˜¾ç¤ºçš„åŠ é”å’Œè§£é”è¿‡ç¨‹ã€‚å› æ­¤æœ‰å¿…è¦é€šè¿‡<strong>javap</strong>å‘½ä»¤ï¼ŒæŸ¥çœ‹ç›¸åº”çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</p>
<h5 id="synchronizedä¿®é¥°ä»£ç å—">synchronizedä¿®é¥°ä»£ç å—</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åŠ é”æ“ä½œ</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(test);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>javapæŸ¥çœ‹ç›¸åº”çš„classæ–‡ä»¶ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113800.png" alt="img"></p>
<p><strong>å¯ä»¥çœ‹å‡ºåœ¨æ‰§è¡ŒåŒæ­¥ä»£ç å—ä¹‹å‰ä¹‹åéƒ½æœ‰ä¸€ä¸ªmonitorå­—æ ·ï¼Œå…¶ä¸­å‰é¢çš„æ˜¯monitorenterï¼Œåé¢çš„æ˜¯ç¦»å¼€monitorexitï¼Œä¸éš¾æƒ³è±¡ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼Œé¦–å…ˆè¦è·å–é”ï¼Œè€Œè·å–é”çš„è¿‡ç¨‹å°±æ˜¯monitorenter ï¼Œåœ¨æ‰§è¡Œå®Œä»£ç å—ä¹‹åï¼Œè¦é‡Šæ”¾é”ï¼Œé‡Šæ”¾é”å°±æ˜¯æ‰§è¡ŒmonitorexitæŒ‡ä»¤ã€‚</strong></p>
<p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ªmonitorexitå‘¢ï¼Ÿ</strong></p>
<p><strong>è¿™ä¸ªä¸»è¦æ˜¯é˜²æ­¢åœ¨åŒæ­¥ä»£ç å—ä¸­çº¿ç¨‹å› å¼‚å¸¸é€€å‡ºï¼Œè€Œé”æ²¡æœ‰å¾—åˆ°é‡Šæ”¾ï¼Œè¿™å¿…ç„¶ä¼šé€ æˆæ­»é”ï¼ˆç­‰å¾…çš„çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”ï¼‰ã€‚å› æ­¤æœ€åä¸€ä¸ªmonitorexitæ˜¯ä¿è¯åœ¨å¼‚å¸¸æƒ…å†µä¸‹ï¼Œé”ä¹Ÿå¯ä»¥å¾—åˆ°é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚</strong></p>
<h5 id="synchronizedä¿®é¥°æ–¹æ³•">synchronizedä¿®é¥°æ–¹æ³•</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span>   <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;hello again&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(test);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113803.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><strong>ä»…æœ‰ACC_SYNCHRONIZEDè¿™ä¹ˆä¸€ä¸ªæ ‡å¿—ï¼Œè¯¥æ ‡è®°è¡¨æ˜çº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•æ—¶ï¼Œéœ€è¦monitorenterï¼Œé€€å‡ºè¯¥æ–¹æ³•æ—¶éœ€è¦monitorexitã€‚</strong></p>
<h3 id="synchronizedå¯é‡å…¥çš„åŸç†">synchronizedå¯é‡å…¥çš„åŸç†</h3>
<p>**é‡å…¥é”æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°è¯¥é”ä¹‹åï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­è·å¾—è¯¥é”ã€‚**åº•å±‚åŸç†ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“çº¿ç¨‹è·å–è¯¥é”æ—¶ï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œå†æ¬¡è·å¾—è¯¥é”æ—¶ç»§ç»­åŠ ä¸€ï¼Œé‡Šæ”¾é”æ—¶ï¼Œè®¡æ•°å™¨å‡ä¸€ï¼Œå½“è®¡æ•°å™¨å€¼ä¸º0æ—¶ï¼Œè¡¨æ˜è¯¥é”æœªè¢«ä»»ä½•çº¿ç¨‹æ‰€æŒæœ‰ï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥ç«äº‰è·å–é”ã€‚</p>
<h3 id="é”ä¼˜åŒ–">é”ä¼˜åŒ–</h3>
<p>JDK1.6ä¹‹å‰ï¼Œsynchronizedæ˜¯ä¸€ä¸ªé‡é‡çº§é”ï¼Œä½•è°“é‡é‡çº§é”ï¼Ÿå°±æ˜¯å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€æŠŠé”ï¼Œæœªè·å¾—é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç­‰åˆ°æŒæœ‰é”çš„çº¿ç¨‹å°†é”é‡Šæ”¾ä¹‹åï¼Œè¿™äº›çº¿ç¨‹åˆè¢«å”¤é†’ã€‚å…¶ä¸­çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’éƒ½ä¸æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œæ˜¯ä¸€ä¸ªæå…¶è€—è´¹CPUèµ„æºçš„è¿‡ç¨‹ã€‚å› æ­¤ä¸ºäº†æé«˜synchronizedçš„æ€§èƒ½ç‰¹åœ°åœ¨JDK1.6åšäº†ä¼˜åŒ–</p>
<h4 id="Javaå¯¹è±¡å†…å­˜æ¨¡å‹"><strong>Javaå¯¹è±¡å†…å­˜æ¨¡å‹</strong></h4>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113805.png" alt="javaä¸­å¯¹è±¡å†…å­˜æ¨¡å‹"></p>
<p>ä¸€ä¸ªJavaå¯¹è±¡ç”±ï¼Œå¯¹è±¡æ ‡è®°ï¼Œç±»å‹æŒ‡é’ˆï¼ŒçœŸå®æ•°æ®ï¼Œå†…å­˜å¯¹é½å››éƒ¨åˆ†ç»„æˆã€‚</p>
<ul>
<li>å¯¹è±¡æ ‡è®°ä¹Ÿç§°Mark Wordå­—æ®µï¼Œå­˜å‚¨å½“å‰å¯¹è±¡çš„ä¸€äº›è¿è¡Œæ—¶æ•°æ®ã€‚</li>
<li>ç±»å‹æŒ‡é’ˆï¼ŒJVMæ ¹æ®è¯¥æŒ‡é’ˆç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</li>
<li>çœŸå®æ•°æ®è‡ªç„¶æ˜¯å¯¹è±¡çš„å±æ€§å€¼ã€‚</li>
<li>å†…å­˜è¡¥é½ï¼Œæ˜¯å½“æ•°æ®ä¸æ˜¯å¯¹é½æ•°çš„æ•´æ•°å€çš„æ—¶å€™ï¼Œè¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—å¯¹è±¡çš„æ•´ä½“å¤§å°æ˜¯å¯¹é½æ•°çš„æ•´æ•°å€æ–¹ä¾¿å¯»å€ã€‚å…¸å‹çš„ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ€æƒ³ã€‚</li>
</ul>
<p><strong>å…¶ä¸­å¯¹è±¡æ ‡è®°å’Œç±»å‹æŒ‡é’ˆç»Ÿç§°ä¸ºJavaå¯¹è±¡å¤´ã€‚</strong></p>
<h5 id="Mark-Wordå­—æ®µ">Mark Wordå­—æ®µ</h5>
<p>Mark Wordç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«è¿è¡Œæ—¶çš„æ•°æ®ï¼Œå¦‚hashcodeï¼ŒGCåˆ†ä»£å¹´é¾„ï¼Œé”çŠ¶æ€æ ‡å¿—ä½ï¼Œçº¿ç¨‹æŒæœ‰çš„é”ï¼Œåå‘çº¿ç¨‹IDï¼Œç­‰ç­‰ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113808.jpg" alt="img"></p>
<h5 id="ä¸ºç¤¾ä¹ˆJavaçš„ä»»æ„å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ï¼Ÿ">ä¸ºç¤¾ä¹ˆJavaçš„ä»»æ„å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ï¼Ÿ</h5>
<p><strong>åœ¨Javaå¯¹è±¡å¤´ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªmonitorå¯¹è±¡</strong>ï¼Œæ¯ä¸ªå¯¹è±¡è‡ªåˆ›å»ºä¹‹ååœ¨å¯¹è±¡å¤´ä¸­å°±å«æœ‰monitorå¯¹è±¡ï¼Œmonitoræ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸åŒçš„å¯¹è±¡monitorè‡ªç„¶ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå› æ­¤å¯¹è±¡ä½œä¸ºé”çš„æœ¬è´¨æ˜¯å¯¹è±¡å¤´ä¸­çš„monitorå¯¹è±¡ä½œä¸ºäº†é”ã€‚è¿™ä¾¿æ˜¯ä¸ºä»€ä¹ˆJavaçš„ä»»æ„å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”çš„åŸå› ã€‚</p>
<blockquote>
<p>å½“å¯¹è±¡åœ¨<strong>æ— é”çš„çŠ¶æ€ä¸‹è¿›è¡Œäº†hashcode</strong>çš„è®¡ç®—ï¼ˆequalsæ–¹æ³•ç­‰ï¼‰æ—¶ï¼Œæ— æ³•è¿›å…¥åˆ°åå‘é”çš„çŠ¶æ€ï¼ˆ<strong>å› ä¸ºåå‘é”ä¼šåœ¨å‰56ä½ä¸­è®°å½•çº¿ç¨‹idï¼Œä½†æ˜¯å¦‚æœæœ‰hashcodeæ—¶æ— æ³•è®°å½•id</strong>ï¼Œå¦‚å†…å­˜å›¾æ‰€ç¤ºï¼‰</p>
</blockquote>
<h4 id="ä¼˜åŒ–æ‰‹æ®µ">ä¼˜åŒ–æ‰‹æ®µ</h4>
<h6 id="åå‘é”ï¼š">åå‘é”ï¼š</h6>
<p>åå‘é”é’ˆå¯¹çš„æ˜¯é”ä¸å­˜åœ¨ç«äº‰ï¼Œæ¯æ¬¡ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è·å–è¯¥é”ï¼Œä¸ºäº†æé«˜è·å–é”çš„æ•ˆç‡ï¼Œå› æ­¤å°†è¯¥é”åå‘è¯¥çº¿ç¨‹ã€‚æå‡æ€§èƒ½ã€‚</p>
<p><strong>åå‘é”çš„è·å–ï¼š</strong></p>
<blockquote>
<p>1.é¦–å…ˆæ£€æµ‹æ˜¯å¦ä¸ºå¯åå‘çŠ¶æ€ï¼ˆé”æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼Œé”æ ‡å¿—ä½æ˜¯å¦ä¸º01ï¼‰.<br>
2.å¦‚æœå¤„äºå¯åå‘çŠ¶æ€ï¼Œæµ‹è¯•Mark Wordä¸­çš„çº¿ç¨‹IDæ˜¯å¦æŒ‡å‘è‡ªå·±ï¼Œå¦‚æœæ˜¯ï¼Œä¸éœ€è¦å†æ¬¡è·å–é”ï¼Œç›´æ¥æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚<br>
3.å¦‚æœçº¿ç¨‹Idï¼Œä¸æ˜¯è‡ªå·±çš„çº¿ç¨‹Idï¼Œé€šè¿‡CASè·å–é”ï¼Œè·å–æˆåŠŸè¡¨æ˜å½“å‰åå‘é”ä¸å­˜åœ¨ç«äº‰ï¼Œè·å–å¤±è´¥ï¼Œåˆ™è¯´æ˜å½“å‰åå‘é”å­˜åœ¨		é”ç«äº‰ï¼Œåå‘é”è†¨èƒ€ä¸ºè½»é‡çº§é”ã€‚</p>
</blockquote>
<p><strong>åå‘é”çš„æ’¤é”€ï¼š</strong></p>
<p>åå‘é”åªæœ‰å½“å‡ºç°ç«äº‰æ—¶ï¼Œæ‰ä¼šå‡ºç°é”æ’¤é”€ã€‚</p>
<blockquote>
<p>1ã€‚ç­‰å¾…ä¸€ä¸ªå…¨å±€å®‰å…¨ç‚¹ï¼Œæ­¤æ—¶æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯æš‚åœçš„ï¼Œæ£€æŸ¥æŒæœ‰é”çš„çº¿ç¨‹çŠ¶æ€ï¼Œå¦‚æœèƒ½æ‰¾åˆ°è¯´æ˜å½“å‰çº¿ç¨‹è¿˜å­˜æ´»ï¼Œè¯´æ˜è¿˜åœ¨æ‰§			è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ï¼Œé¦–ç›¸å°†è¯¥çº¿ç¨‹é˜»å¡ï¼Œç„¶åè¿›è¡Œé”å‡çº§ï¼Œå‡çº§åˆ°è½»é‡çº§é”ï¼Œå”¤é†’è¯¥çº¿ç¨‹ç»§ç»­æ‰§è¡Œä»£åŒæ­¥ç ã€‚</p>
<p>2.å¦‚æœæŒæœ‰åå‘é”çš„çº¿ç¨‹æœªå­˜æ´»ï¼Œå°†å¯¹è±¡å¤´ä¸­çš„çº¿ç¨‹ç½®nullï¼Œç„¶åç›´æ¥é”å‡çº§ã€‚</p>
</blockquote>
<h6 id="è½»é‡çº§é”ï¼š"><strong>è½»é‡çº§é”ï¼š</strong></h6>
<p>åå‘é”è€ƒè™‘çš„æ˜¯ä¸å­˜åœ¨å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€æŠŠé”ï¼Œè€Œè½»é‡çº§é”è€ƒè™‘çš„æ˜¯ï¼Œå¤šä¸ªçº¿ç¨‹ä¸ä¼šåœ¨åŒä¸€æ—¶åˆ»æ¥ç«äº‰åŒä¸€æŠŠé”ã€‚</p>
<p><strong>è½»é‡çº§é”çš„è·å–ï¼š</strong></p>
<blockquote>
<p>1.åœ¨çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•å¾—ç©ºé—´ï¼Œ</p>
<p>2.å¹¶å°†Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ï¼Œï¼ˆè¿™ä¸€æ­¥ä¸è®ºæ˜¯å¦å­˜åœ¨ç«äº‰éƒ½å¯ä»¥æ‰§è¡Œï¼‰ã€‚</p>
<p>3.å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­å¾—Mark wordå­—æ®µå˜æˆæŒ‡å‘é”è®°å½•å¾—æŒ‡é’ˆã€‚</p>
<p>4 æ“ä½œæˆåŠŸï¼Œä¸å­˜åœ¨é”ç«äº‰ï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</p>
<p>5æ“ä½œå¤±è´¥ï¼Œé”å·²ç»è¢«å…¶å®ƒçº¿ç¨‹æŠ¢å äº†ï¼Œè¿™æ—¶è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p>
</blockquote>
<p><strong>è½»é‡çº§é”å¾—é‡Šæ”¾ï¼š</strong></p>
<blockquote>
<p>åæ›¿æ¢ï¼Œä½¿ç”¨CASå°†æ ˆå¸§ä¸­å¾—é”å½•ç©ºé—´æ›¿æ¢åˆ°å¯¹è±¡å¤´ï¼ŒæˆåŠŸæ²¡æœ‰é”ç«äº‰ï¼Œé”å¾—ä»¥é‡Šæ”¾ï¼Œå¤±è´¥è¯´æ˜å­˜åœ¨ç«äº‰ï¼Œé‚£å—æŒ‡å‘é”è®°å½•å¾—æŒ‡é’ˆæœ‰åˆ«çš„çº¿ç¨‹åœ¨ç”¨ï¼Œå› æ­¤é”è†¨èƒ€å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p>
</blockquote>
<h6 id="é‡é‡çº§é”ï¼š"><strong>é‡é‡çº§é”ï¼š</strong></h6>
<p>é‡é‡çº§é”æè¿°åŒä¸€æ—¶åˆ»æœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€æŠŠé”ã€‚</p>
<blockquote>
<p>å½“å¤šä¸ªçº¿ç¨‹å…±åŒç«äº‰åŒä¸€æŠŠé”æ—¶ï¼Œç«äº‰å¤±è´¥å¾—é”ä¼šè¢«é˜»å¡ï¼Œç­‰åˆ°æŒæœ‰é”çš„çº¿ç¨‹å°†é”é‡Šæ”¾åå†æ¬¡å”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œå› ä¸ºçº¿ç¨‹çš„å”¤é†’å’Œé˜»å¡æ˜¯ä¸€ä¸ªå¾ˆè€—è´¹CPUèµ„æºçš„æ“ä½œï¼Œå› æ­¤æ­¤å¤„é‡‡å–è‡ªé€‚åº”è‡ªæ—‹æ¥è·å–é‡é‡çº§é”æ¥è·å–é‡é‡çº§é”ã€‚</p>
</blockquote>
<h6 id="é”çš„å‡çº§">é”çš„å‡çº§</h6>
<p><strong>æ— é” â€“ &gt; åå‘é” -----&gt; è½»é‡çº§é” ---- &gt; é‡é‡çº§é”</strong></p>
<h6 id="å…¶å®ƒä¼˜åŒ–">å…¶å®ƒä¼˜åŒ–</h6>
<p><strong>è‡ªæ—‹é”ï¼š</strong></p>
<p>çº¿ç¨‹æœªè·å¾—é”åï¼Œä¸æ˜¯ä¸€æ˜§çš„é˜»å¡ï¼Œè€Œæ˜¯è®©çº¿ç¨‹ä¸æ–­å°è¯•è·å–é”ã€‚</p>
<p>ç¼ºç‚¹ï¼šè‹¥çº¿ç¨‹å ç”¨é”æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´CPUèµ„æºç™½ç™½æµªè´¹ã€‚</p>
<p>è§£å†³æ–¹å¼ï¼šå½“å°è¯•æ¬¡æ•°(ä¸€èˆ¬æ˜¯10æ¬¡ï¼Œå…·ä½“çœ‹JVMçš„å®ç°)è¾¾åˆ°æ¯ä¸ªå€¼å¾—æ—¶å€™ï¼Œçº¿ç¨‹æŒ‚èµ·ã€‚</p>
<p><strong>è‡ªé€‚åº”è‡ªæ—‹é”ï¼š</strong></p>
<p>è‡ªæ—‹å¾—æ¬¡æ•°ç”±ä¸Šä¸€æ¬¡è·å–é”çš„è‡ªæ—‹æ¬¡æ•°å†³å®šï¼Œæ¬¡æ•°ç¨å¾®å»¶é•¿ä¸€ç‚¹ç‚¹ã€‚</p>
<p><strong>é”æ¶ˆé™¤</strong></p>
<p>å¯¹äºçº¿ç¨‹çš„ç§æœ‰å˜é‡ï¼Œä¸å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œæ²¡æœ‰å¿…è¦åŠ é”ï¼Œå³ä½¿åŠ é”ç¼–è¯‘åï¼Œä¹Ÿä¼šå»æ‰ã€‚</p>
<p><strong>é”ç²—åŒ–</strong></p>
<p>å½“ä¸€ä¸ªå¾ªç¯ä¸­å­˜åœ¨åŠ é”æ“ä½œæ—¶ï¼Œå¯ä»¥å°†åŠ é”æ“ä½œæåˆ°å¾ªç¯å¤–é¢æ‰§è¡Œï¼Œä¸€æ¬¡åŠ é”ä»£æ›¿å¤šæ¬¡åŠ é”ï¼Œæå‡æ€§èƒ½ã€‚</p>
<p><strong>æ‰§è¡Œæ—¶é—´çŸ­ï¼ˆåŠ é”ä»£ç ï¼‰ï¼Œçº¿ç¨‹æ•°å°‘ï¼Œåå‘ç”¨è‡ªæ—‹é”</strong><br>
<strong>æ‰§è¡Œæ—¶é—´é•¿ï¼Œçº¿ç¨‹æ•°å¤šï¼Œç”¨ç³»ç»Ÿé‡é‡çº§</strong></p>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹2</title>
    <url>/posts/56eb878c/</url>
    <content><![CDATA[<h3 id="volatile">volatile</h3>
<h4 id="ä½œç”¨">ä½œç”¨</h4>
<ul>
<li>
<p>ä¿è¯çº¿ç¨‹å¯è§æ€§</p>
<p><strong>ä½¿ç”¨volatileï¼Œå°†ä¼šå¼ºåˆ¶æ‰€æœ‰çº¿ç¨‹éƒ½å»å †å†…å­˜ä¸­è¯»å–å˜é‡çš„å€¼</strong></p>
<p>-MESIï¼ˆCPUçš„ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼‰</p>
<p><strong>è¯¦ç»†å¯çœ‹</strong></p>
<p><a href="https://www.cnblogs.com/z00377750/p/9180644.html">https://www.cnblogs.com/z00377750/p/9180644.html</a></p>
</li>
<li>
<p>ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼ˆCPUçº§åˆ«çš„æ”¯æŒï¼‰</p>
<ul>
<li>cpuçº§åˆ«å¢åŠ è¯»å†™å±éšœ</li>
</ul>
</li>
</ul>
<h4 id="å›¾è§£è¯´æ˜ï¼š">å›¾è§£è¯´æ˜ï¼š</h4>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113818.png" alt="image-20200814153856725"></p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A Bçº¿ç¨‹éƒ½ç”¨åˆ°ä¸€ä¸ªå˜é‡ï¼Œjavaé»˜è®¤æ˜¯Açº¿ç¨‹ä¸­ä¿ç•™ä¸€ä»½copyï¼Œè¿™æ ·å¦‚æœBçº¿ç¨‹ä¿®æ”¹äº†è¯¥å˜é‡ï¼Œåˆ™Açº¿ç¨‹æœªå¿…çŸ¥é“ï¼Œä¸çŸ¥Bçº¿ç¨‹ä½•æ—¶å»ä¿®æ”¹çœŸæ­£çš„å˜é‡çš„å€¼ï¼Œæ­¤æ—¶ä½¿ç”¨volatileå…³é”®å­—ï¼Œä¼šè®©æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¯»åˆ°å˜é‡çš„ä¿®æ”¹å€¼</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="volatieå’ŒsynchronizedåŒºåˆ«">volatieå’ŒsynchronizedåŒºåˆ«</h4>
<ul>
<li>
<p>volatileæœ¬è´¨æ˜¯åœ¨å‘Šè¯‰<strong>jvmå½“å‰å˜é‡åœ¨å¯„å­˜å™¨ï¼ˆå·¥ä½œå†…å­˜ï¼‰ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦ä»ä¸»å­˜ä¸­è¯»å–</strong>ï¼› synchronizedåˆ™æ˜¯<strong>é”å®šå½“å‰å˜é‡</strong>ï¼Œåªæœ‰å½“<strong>å‰çº¿ç¨‹å¯ä»¥è®¿é—®</strong>è¯¥å˜é‡ï¼Œ<strong>å…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½</strong>ã€‚</p>
</li>
<li>
<p>volatile<strong>ä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«</strong>ï¼›synchronizedåˆ™å¯ä»¥ä½¿ç”¨<strong>åœ¨å˜é‡ã€æ–¹æ³•ã€å’Œç±»çº§åˆ«</strong>çš„</p>
</li>
<li>
<p>volatile<strong>ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§</strong>ï¼Œ<strong>ä¸èƒ½ä¿è¯åŸå­æ€§</strong>ï¼›è€Œ<strong>synchronizedåˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">volatileå¹¶ä¸èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹å…±åŒä¿®æ”¹å˜é‡æ—¶æ‰€å¸¦æ¥çš„ä¸ä¸€è‡´é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´volatileä¸èƒ½æ›¿ä»£synchronized</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>volatileä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronizedå¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡</p>
</li>
<li>
<p>volatileæ ‡è®°çš„å˜é‡<strong>ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä¸ä¼šè¿›è¡ŒæŒ‡ä»¤é‡æ’åº</strong>ï¼›synchronizedæ ‡è®°çš„å˜é‡å¯ä»¥<strong>è¢«ç¼–è¯‘å™¨ä¼˜åŒ–</strong></p>
</li>
</ul>
<h4 id="volatileå…¶ä»–">volatileå…¶ä»–</h4>
<ol>
<li>
<p><strong>volatile å¼•ç”¨ç±»å‹ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰åªèƒ½ä¿è¯å¼•ç”¨æœ¬èº«çš„å¯è§æ€§</strong>ï¼Œä¸èƒ½ä¿è¯å†…éƒ¨å­—æ®µçš„å¯è§æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T04_VolatileNotSync</span> </span>&#123;</span><br><span class="line">	<span class="keyword">volatile</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) count++;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		T04_VolatileNotSync t = <span class="keyword">new</span> T04_VolatileNotSync();</span><br><span class="line">		</span><br><span class="line">		List&lt;Thread&gt; threads = <span class="keyword">new</span> ArrayList&lt;Thread&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">			threads.add(<span class="keyword">new</span> Thread(t::m, <span class="string">&quot;thread-&quot;</span>+i));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		threads.forEach((o)-&gt;o.start());</span><br><span class="line">		</span><br><span class="line">		threads.forEach((o)-&gt;&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				o.join();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		System.out.println(t.count);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">=============</span><br><span class="line"> è¾“å‡ºç»“æœçš„åŸå› æ˜¯ï¼š<span class="keyword">volatile</span>è™½ç„¶èƒ½å¤Ÿä¿è¯countçš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿä¿éšœcount++çš„åŸå­æ€§</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113823.png" alt="image-20200814160705502"></p>
</li>
</ol>
<h3 id="CASï¼ˆcompare-and-swapï¼‰">CASï¼ˆcompare and swapï¼‰</h3>
<h4 id="ä»€ä¹ˆæ˜¯CAS">ä»€ä¹ˆæ˜¯CAS</h4>
<p>CASï¼šCompare and Swapï¼Œå³æ¯”è¾ƒå†äº¤æ¢ã€‚</p>
<p>jdk5å¢åŠ äº†å¹¶å‘åŒ…java.util.concurrent.*,å…¶ä¸‹é¢çš„ç±»ä½¿ç”¨CASç®—æ³•å®ç°äº†åŒºåˆ«äºsynchronouseåŒæ­¥é”çš„ä¸€ç§ä¹è§‚é”ã€‚JDK 5ä¹‹å‰Javaè¯­è¨€æ˜¯é synchronizedå…³é”®å­—ä¿è¯åŒæ­¥çš„ï¼Œè¿™æ˜¯ä¸€ç§ç‹¬å é”ï¼Œä¹Ÿæ˜¯æ˜¯æ‚²è§‚é”ã€‚</p>
<p><strong>CASå±äºCPUåŸè¯­çº§åˆ«çš„æ”¯æŒï¼Œæ­£å¸¸ç¨‹åºä¸ä¼šè¢«æ‰“æ–­</strong></p>
<h4 id="CASç®—æ³•ç†è§£">CASç®—æ³•ç†è§£</h4>
<p>CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œ<strong>å†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼B</strong>ã€‚<strong>å½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114037.png" alt="image-20210223114037788"></p>
<h4 id="CASå®ç°åŸç†">CASå®ç°åŸç†</h4>
<h4 id="CASç¼ºç‚¹">CASç¼ºç‚¹</h4>
<ul>
<li>å¾ªç¯æ—¶é—´å¤ªé•¿ï¼›</li>
<li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡åŸå­æ“ä½œï¼›</li>
<li>ä¼šå‡ºç°ABAé—®é¢˜ï¼›</li>
</ul>
<h6 id="å¾ªç¯æ—¶é—´é•¿å¼€é”€å¾ˆå¤§ï¼š">å¾ªç¯æ—¶é—´é•¿å¼€é”€å¾ˆå¤§ï¼š</h6>
<p>CAS é€šå¸¸æ˜¯é…åˆæ— é™å¾ªç¯ä¸€èµ·ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° getAndAddInt æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå¦‚æœ CAS å¤±è´¥ï¼Œä¼šä¸€ç›´è¿›è¡Œå°è¯•ã€‚å¦‚æœ CAS é•¿æ—¶é—´ä¸€ç›´ä¸æˆåŠŸï¼Œå¯èƒ½ä¼šç»™ CPU å¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚</p>
<h6 id="åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œï¼š">åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œï¼š</h6>
<p>å½“å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯ CAS çš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå˜é‡æ“ä½œæ—¶ï¼ŒCAS ç›®å‰æ— æ³•ç›´æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§åŠæ³•æ¥è§£å†³ï¼š1ï¼‰ä½¿ç”¨äº’æ–¥é”æ¥ä¿è¯åŸå­æ€§ï¼›2ï¼‰å°†å¤šä¸ªå˜é‡å°è£…æˆå¯¹è±¡ï¼Œé€šè¿‡ AtomicReference æ¥ä¿è¯åŸå­æ€§ã€‚</p>
<h6 id="ä»€ä¹ˆæ˜¯ABAé—®é¢˜ï¼ŸABAé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ">ä»€ä¹ˆæ˜¯ABAé—®é¢˜ï¼ŸABAé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ</h6>
<p>CAS çš„ä½¿ç”¨æµç¨‹é€šå¸¸å¦‚ä¸‹ï¼š1ï¼‰é¦–å…ˆä»åœ°å€ V è¯»å–å€¼ Aï¼›2ï¼‰æ ¹æ® A è®¡ç®—ç›®æ ‡å€¼ Bï¼›3ï¼‰é€šè¿‡ CAS ä»¥åŸå­çš„æ–¹å¼å°†åœ°å€ V ä¸­çš„å€¼ä» A ä¿®æ”¹ä¸º Bã€‚</p>
<p>ä½†æ˜¯åœ¨ç¬¬1æ­¥ä¸­è¯»å–çš„å€¼æ˜¯Aï¼Œå¹¶ä¸”åœ¨ç¬¬3æ­¥ä¿®æ”¹æˆåŠŸäº†ï¼Œæˆ‘ä»¬å°±èƒ½è¯´å®ƒçš„å€¼åœ¨ç¬¬1æ­¥å’Œç¬¬3æ­¥ä¹‹é—´æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ”¹å˜è¿‡äº†å—ï¼Ÿ</p>
<p>å¦‚æœåœ¨è¿™æ®µæœŸé—´å®ƒçš„å€¼æ›¾ç»è¢«æ”¹æˆäº†Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸ºAï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚è¿™ä¸ªæ¼æ´ç§°ä¸ºCASæ“ä½œçš„â€œABAâ€é—®é¢˜ã€‚Javaå¹¶å‘åŒ…ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„ç±»â€œ<strong>AtomicStampedReference</strong>â€ï¼Œå®ƒ<strong>å¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬</strong>æ¥ä¿è¯CASçš„æ­£ç¡®æ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨CASå‰è¦è€ƒè™‘æ¸…æ¥šâ€œABAâ€é—®é¢˜æ˜¯å¦ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ABAé—®é¢˜ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´é«˜æ•ˆã€‚</p>
<h3 id="AutomicXXXï¼ˆCAS-volatileï¼‰">AutomicXXXï¼ˆCAS+ volatileï¼‰</h3>
<h4 id="ç›¸å…³æ¦‚å¿µ">ç›¸å…³æ¦‚å¿µ</h4>
<ul>
<li>
<p>Javaä»JDK1.5å¼€å§‹æä¾›äº†java.util.concurrent.atomicåŒ…ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ— é”çš„è¿›è¡ŒåŸå­æ“ä½œã€‚åŸå­å˜é‡çš„åº•å±‚ä½¿ç”¨äº†å¤„ç†å™¨æä¾›çš„åŸå­æŒ‡ä»¤ï¼Œä½†æ˜¯ä¸åŒçš„CPUæ¶æ„å¯èƒ½æä¾›çš„åŸå­æŒ‡ä»¤ä¸ä¸€æ ·ï¼Œä¹Ÿæœ‰å¯èƒ½éœ€è¦æŸç§å½¢å¼çš„å†…éƒ¨é”,æ‰€ä»¥è¯¥æ–¹æ³•ä¸èƒ½ç»å¯¹ä¿è¯çº¿ç¨‹ä¸è¢«é˜»å¡ã€‚</p>
</li>
<li>
<p>åŸå­ç±»å…¶å†…éƒ¨å®ç°ä¸æ˜¯ç®€å•çš„ä½¿ç”¨synchronizedï¼Œè€Œæ˜¯ä¸€ä¸ªæ›´ä¸ºé«˜æ•ˆçš„æ–¹å¼CAS (compare and swap) + volatileå’Œnativeæ–¹æ³•ï¼ˆåŒæ­¥çš„å·¥ä½œæ›´å¤šçš„äº¤ç»™äº†ç¡¬ä»¶ï¼‰ï¼Œä»è€Œé¿å…äº†synchronizedçš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡</p>
</li>
<li>
<p>è™½ç„¶åŸºäºCASçš„çº¿ç¨‹å®‰å…¨æœºåˆ¶å¾ˆå¥½å¾ˆé«˜æ•ˆï¼Œä½†è¦è¯´çš„æ˜¯ï¼Œå¹¶éæ‰€æœ‰çº¿ç¨‹å®‰å…¨éƒ½å¯ä»¥ç”¨è¿™æ ·çš„æ–¹æ³•æ¥å®ç°ï¼Œè¿™åªé€‚åˆä¸€äº›ç²’åº¦æ¯”è¾ƒå°ï¼Œå‹å¦‚è®¡æ•°å™¨è¿™æ ·çš„éœ€æ±‚ç”¨èµ·æ¥æ‰æœ‰æ•ˆï¼Œå¦åˆ™ä¹Ÿä¸ä¼šæœ‰é”çš„å­˜åœ¨äº†</p>
</li>
<li>
<p>åœ¨AtomicåŒ…é‡Œä¸€å…±æœ‰12ä¸ªç±»ï¼Œå››ç§åŸå­æ›´æ–°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ï¼ŒåŸå­æ›´æ–°æ•°ç»„ï¼ŒåŸå­æ›´æ–°å¼•ç”¨å’ŒåŸå­æ›´æ–°å­—æ®µã€‚AtomicåŒ…é‡Œçš„ç±»åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Unsafeå®ç°çš„åŒ…è£…ç±»</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113841" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
</li>
</ul>
<h4 id="ä»£ç è¯¦è§£">ä»£ç è¯¦è§£</h4>
<p>ä¸»è¦ä»¥AtomicIntegerä¸ºä¾‹</p>
<ul>
<li><strong>æœ‰å‚æ„é€ å‡½æ•°</strong>ï¼šä»æ„é€ å‡½æ•°å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œæ•°å€¼å­˜æ”¾åœ¨æˆå‘˜å˜é‡valueä¸­;</li>
<li>æˆå‘˜å˜é‡valueå£°æ˜ä¸ºvolatileç±»å‹ï¼Œè¯´æ˜äº†å¤šçº¿ç¨‹ä¸‹çš„å¯è§æ€§ï¼Œå³ä»»ä½•ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹ï¼Œåœ¨å…¶å®ƒçº¿ç¨‹ä¸­éƒ½ä¼šè¢«ç«‹åˆ»çœ‹åˆ°</li>
<li><strong>compareAndSet</strong>æ–¹æ³•ï¼ˆvalueçš„å€¼é€šè¿‡å†…éƒ¨thiså’ŒvalueOffsetä¼ é€’ï¼‰</li>
<li>æ¥æ”¶2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æœŸæœ›æ•°æ®(expected)ï¼Œä¸€ä¸ªæ˜¯æ–°æ•°æ®(new)ï¼›å¦‚æœatomicé‡Œé¢çš„æ•°æ®å’ŒæœŸæœ›æ•°æ®ä¸€è‡´ï¼Œåˆ™å°†æ–°æ•°æ®è®¾å®šç»™atomicçš„æ•°æ®ï¼Œè¿”å›trueï¼Œè¡¨æ˜æˆåŠŸï¼›å¦åˆ™å°±ä¸è®¾å®šï¼Œå¹¶è¿”å›falseã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿ç¨‹æ± </title>
    <url>/posts/de7c53fe/</url>
    <content><![CDATA[<h3 id="Executoræ¡†æ¶"><strong>Executoræ¡†æ¶</strong></h3>
<p>çº¿ç¨‹æ± å°±æ˜¯<strong>çº¿ç¨‹çš„é›†åˆ</strong>ï¼Œçº¿ç¨‹æ± é›†ä¸­ç®¡ç†çº¿ç¨‹ï¼Œä»¥å®ç°çº¿ç¨‹çš„é‡ç”¨ï¼Œé™ä½èµ„æºæ¶ˆè€—ï¼Œæé«˜å“åº”é€Ÿåº¦ç­‰ã€‚çº¿ç¨‹ç”¨äºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå•ä¸ªçš„çº¿ç¨‹æ—¢æ˜¯å·¥ä½œå•å…ƒä¹Ÿæ˜¯æ‰§è¡Œæœºåˆ¶ï¼Œä»JDK1.5å¼€å§‹ï¼Œä¸ºäº†æŠŠå·¥ä½œå•å…ƒä¸æ‰§è¡Œæœºåˆ¶åˆ†ç¦»å¼€ï¼ŒExecutoræ¡†æ¶è¯ç”Ÿäº†ï¼Œä»–æ˜¯ä¸€ä¸ªç”¨äºç»Ÿä¸€åˆ›å»ºä¸è¿è¡Œçš„æ¥å£ã€‚<strong>Executoræ¡†æ¶å®ç°çš„å°±æ˜¯çº¿ç¨‹æ± çš„åŠŸèƒ½</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114336.png" alt="img"></p>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><strong>Executor</strong> æ‰§è¡Œå™¨æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰æ‰§è¡ŒRunnableä»»åŠ¡çš„æ–¹å¼ã€‚</li>
<li><strong>ExecutorService</strong> è¯¥æ¥å£å®šä¹‰æä¾›å¯¹Executorçš„æœåŠ¡ã€‚</li>
<li><strong>ScheduledExecutorService</strong> å®šæ—¶è°ƒåº¦æ¥å£ã€‚</li>
<li><strong>AbstractExecutorService</strong> æ‰§è¡Œæ¡†æ¶æŠ½è±¡ç±»ã€‚</li>
<li><strong>ThreadPoolExecutor</strong> JDKä¸­çº¿ç¨‹æ± çš„å…·ä½“å®ç°ã€‚</li>
<li><strong>Executors</strong> çº¿ç¨‹æ± å·¥å‚ç±»ã€‚</li>
</ul>
<h3 id="ThreadPoolExecutorï¼ˆçº¿ç¨‹æ± ç±»ï¼‰">ThreadPoolExecutorï¼ˆ<strong>çº¿ç¨‹æ± ç±»</strong>ï¼‰</h3>
<p>çº¿ç¨‹æ± æ˜¯ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œå®ƒæ¶‰åŠåˆ°ä»»åŠ¡ã€çº¿ç¨‹æ± ç­‰çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºçº¿ç¨‹æ± çš„åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½é…ç½®çš„çº¿ç¨‹æ± ä¸æ˜¯è¾ƒä¼˜çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                         TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                         BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                         ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                         RejectedExecutionHandler handler)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="çº¿ç¨‹æ± çš„ä¸ƒä¸ªå‚æ•°">çº¿ç¨‹æ± çš„ä¸ƒä¸ªå‚æ•°</h4>
<ul>
<li>
<p>corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</p>
</li>
<li>
<p>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°ã€‚</p>
</li>
<li>
<p>keepAliveTimeï¼šçº¿ç¨‹å­˜æ´»æ—¶é—´ã€‚å½“çº¿ç¨‹æ•°å¤§äºcoreæ•°ï¼Œé‚£ä¹ˆè¶…è¿‡è¯¥æ—¶é—´çš„çº¿ç¨‹å°†ä¼šè¢«ç»ˆç»“ã€‚</p>
</li>
<li>
<p>unitï¼škeepAliveTimeçš„å•ä½ã€‚java.util.concurrent.TimeUnitç±»å­˜åœ¨é™æ€é™æ€å±æ€§ï¼š NANOSECONDSã€MICROSECONDSã€MILLISECONDSã€SECONDS</p>
</li>
<li>
<p>workQueueï¼šRunnableçš„é˜»å¡é˜Ÿåˆ—ã€‚è‹¥çº¿ç¨‹æ± å·²ç»è¢«å æ»¡ï¼Œåˆ™è¯¥é˜Ÿåˆ—ç”¨äºå­˜æ”¾æ— æ³•å†æ”¾å…¥çº¿ç¨‹æ± ä¸­çš„Runnableã€‚</p>
</li>
<li>
<p>threadFactory:åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ï¼Œå¯ä»¥ç”¨æ¥è®¾å®šçº¿ç¨‹åã€æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ç­‰ç­‰</p>
</li>
<li>
<p>handlerï¼šæ‹’ç»ç­–ç•¥</p>
</li>
</ul>
<h4 id="äº”ç§çº¿ç¨‹æ± ">äº”ç§çº¿ç¨‹æ± </h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   ExecutorService threadPool = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//æœ‰ç¼“å†²çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•° JVM æ§åˆ¶ï¼Œçº¿ç¨‹å¤ªå¤šä¼šå¯¼è‡´CUPä¸€ç›´è¿›è¡Œåˆ‡æ¢ï¼Œé˜»å¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯SynchronousQueue(å®¹é‡ä¸º0),ä¸å¸Œæœ›ä»»åŠ¡å †ç§¯</span></span><br><span class="line">   threadPool = Executors.newCachedThreadPool();</span><br><span class="line"><span class="comment">//å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ä¿æŒä¸€è‡´ï¼Œå¸Œæœ›ä»¥æ’å®šçš„å¤„ç†é€Ÿåº¦ä½¿ç”¨çº¿ç¨‹</span></span><br><span class="line">   threadPool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//å¯åˆ›å»ºæœ€å¤§çº¿ç¨‹ä¸ºintæœ€å¤§å€¼ï¼Œçº¿ç¨‹å¤ªå¤šä¼šå¯¼è‡´CPUé¢‘ç¹åˆ‡æ¢</span></span><br><span class="line">   threadPool = Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//å•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œé˜Ÿåˆ—é•¿åº¦ä¸ºintæœ€å¤§å€¼ï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡è¯·æ±‚</span></span><br><span class="line">   threadPool = Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="comment">//é»˜è®¤çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶å‚æ•°æ¯”è¾ƒå¤š </span></span><br><span class="line">   threadPool = <span class="keyword">new</span> ThreadPoolExecutor();</span><br><span class="line"><span class="comment">// åŸºäºå·¥ä½œçªƒå–ç®—æ³•ï¼Œå…¶ä¸­ä»»åŠ¡å¯ä»¥ç”Ÿæˆå…¶ä»–è¾ƒå°çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å°†æ·»åŠ åˆ°å¹¶è¡Œå¤„ç†çº¿ç¨‹çš„é˜Ÿåˆ—ä¸­ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹å®Œæˆäº†å·¥ä½œå¹¶ä¸”æ— äº‹å¯åšï¼Œåˆ™å¯ä»¥ä»å¦ä¸€çº¿ç¨‹çš„é˜Ÿåˆ—ä¸­â€œçªƒå–â€å·¥ä½œ</span></span><br><span class="line">   threadPool = Executors.newWorkStealingPool();</span><br></pre></td></tr></table></figure>
<h4 id="é˜»å¡é˜Ÿåˆ—">é˜»å¡é˜Ÿåˆ—</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BlockingQueue&lt;Runnable&gt; workQueue = <span class="keyword">null</span>;</span><br><span class="line">workQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">5</span>);<span class="comment">//åŸºäºæ•°ç»„çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œæœ‰ç•Œ</span></span><br><span class="line">workQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;();<span class="comment">//åŸºäºé“¾è¡¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œæ— ç•Œ</span></span><br><span class="line">workQueue = <span class="keyword">new</span> SynchronousQueue&lt;&gt;();<span class="comment">//æ— ç¼“å†²çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œæ— ç•Œ</span></span><br></pre></td></tr></table></figure>
<h4 id="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥">çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥</h4>
<blockquote>
<p>é˜¿é‡Œå‡ºå“çš„è§„èŒƒä¸å»ºè®®ä½¿ç”¨è¿™äº›æ‹’ç»ç­–ç•¥ï¼Œå»ºè®®è‡ªå®šä¹‰ç­–ç•¥ï¼ˆå¯ä¿å­˜åˆ°redisï¼Œkafakaæˆ–æ—¥å¿—æ–‡ä»¶ç­‰ä¸­ï¼‰</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RejectedExecutionHandler rejected = <span class="keyword">null</span>;</span><br><span class="line">rejected = <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy();<span class="comment">//é»˜è®¤ï¼Œé˜Ÿåˆ—æ»¡äº†ä¸¢ä»»åŠ¡æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">rejected = <span class="keyword">new</span> ThreadPoolExecutor.DiscardPolicy();<span class="comment">//é˜Ÿåˆ—æ»¡äº†ä¸¢ä»»åŠ¡ä¸å¼‚å¸¸</span></span><br><span class="line">rejected = <span class="keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy();<span class="comment">//å°†æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„ä»»åŠ¡åˆ ï¼Œä¹‹åå†å°è¯•åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">rejected = <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy();<span class="comment">//å¦‚æœæ·»åŠ åˆ°çº¿ç¨‹æ± å¤±è´¥ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ä¼šè‡ªå·±å»æ‰§è¡Œè¯¥ä»»åŠ¡</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ThreadPoolExecutoræºç è§£æ</title>
    <url>/posts/ca94e89b/</url>
    <content><![CDATA[<h1>ThreadPoolExecutoræºç è§£æ</h1>
<h3 id="1ã€å¸¸ç”¨å˜é‡çš„è§£é‡Š">1ã€å¸¸ç”¨å˜é‡çš„è§£é‡Š</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. `ctl`ï¼Œå¯ä»¥çœ‹åšä¸€ä¸ªintç±»å‹çš„æ•°å­—ï¼Œé«˜3ä½è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œä½29ä½è¡¨ç¤ºworkeræ•°é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger ctl = <span class="keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="number">0</span>));</span><br><span class="line"><span class="comment">// 2. `COUNT_BITS`ï¼Œ`Integer.SIZE`ä¸º32ï¼Œæ‰€ä»¥`COUNT_BITS`ä¸º29</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COUNT_BITS = Integer.SIZE - <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 3. `CAPACITY`ï¼Œçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚1å·¦ç§»29ä½ï¼Œç„¶åå‡1ï¼Œå³ä¸º 2^29 - 1</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAPACITY   = (<span class="number">1</span> &lt;&lt; COUNT_BITS) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// runState is stored in the high-order bits</span></span><br><span class="line"><span class="comment">// 4. çº¿ç¨‹æ± æœ‰5ç§çŠ¶æ€ï¼ŒæŒ‰å¤§å°æ’åºå¦‚ä¸‹ï¼šRUNNING &lt; SHUTDOWN &lt; STOP &lt; TIDYING &lt; TERMINATED</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNNING    = -<span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHUTDOWN   =  <span class="number">0</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP       =  <span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIDYING    =  <span class="number">2</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TERMINATED =  <span class="number">3</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Packing and unpacking ctl</span></span><br><span class="line"><span class="comment">// 5. `runStateOf()`ï¼Œè·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œé€šè¿‡æŒ‰ä½ä¸æ“ä½œï¼Œä½29ä½å°†å…¨éƒ¨å˜æˆ0</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">runStateOf</span><span class="params">(<span class="keyword">int</span> c)</span>     </span>&#123; <span class="keyword">return</span> c &amp; ~CAPACITY; &#125;</span><br><span class="line"><span class="comment">// 6. `workerCountOf()`ï¼Œè·å–çº¿ç¨‹æ± workeræ•°é‡ï¼Œé€šè¿‡æŒ‰ä½ä¸æ“ä½œï¼Œé«˜3ä½å°†å…¨éƒ¨å˜æˆ0</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">workerCountOf</span><span class="params">(<span class="keyword">int</span> c)</span>  </span>&#123; <span class="keyword">return</span> c &amp; CAPACITY; &#125;</span><br><span class="line"><span class="comment">// 7. `ctlOf()`ï¼Œæ ¹æ®çº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ± workeræ•°é‡ï¼Œç”Ÿæˆctlå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">ctlOf</span><span class="params">(<span class="keyword">int</span> rs, <span class="keyword">int</span> wc)</span> </span>&#123; <span class="keyword">return</span> rs | wc; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Bit field accessors that don&#x27;t require unpacking ctl.</span></span><br><span class="line"><span class="comment"> * These depend on the bit layout and on workerCount being never negative.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 8. `runStateLessThan()`ï¼Œçº¿ç¨‹æ± çŠ¶æ€å°äºxx</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">runStateLessThan</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c &lt; s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 9. `runStateAtLeast()`ï¼Œçº¿ç¨‹æ± çŠ¶æ€å¤§äºç­‰äºxx</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">runStateAtLeast</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c &gt;= s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2ã€æ„é€ æ–¹æ³•">2ã€æ„é€ æ–¹æ³•</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹å‚æ•°æ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="comment">// ç©ºæŒ‡é’ˆæ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¼ å…¥å‚æ•°`unit`å’Œ`keepAliveTime`ï¼Œå°†å­˜æ´»æ—¶é—´è½¬æ¢ä¸ºçº³ç§’å­˜åˆ°å˜é‡`keepAliveTime `ä¸­</span></span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3ã€æäº¤æ‰§è¡Œtaskçš„è¿‡ç¨‹">3ã€æäº¤æ‰§è¡Œtaskçš„è¿‡ç¨‹</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Proceed in 3 steps:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 1. If fewer than corePoolSize threads are running, try to</span></span><br><span class="line"><span class="comment">     * start a new thread with the given command as its first</span></span><br><span class="line"><span class="comment">     * task.  The call to addWorker atomically checks runState and</span></span><br><span class="line"><span class="comment">     * workerCount, and so prevents false alarms that would add</span></span><br><span class="line"><span class="comment">     * threads when it shouldn&#x27;t, by returning false.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 2. If a task can be successfully queued, then we still need</span></span><br><span class="line"><span class="comment">     * to double-check whether we should have added a thread</span></span><br><span class="line"><span class="comment">     * (because existing ones died since last checking) or that</span></span><br><span class="line"><span class="comment">     * the pool shut down since entry into this method. So we</span></span><br><span class="line"><span class="comment">     * recheck state and if necessary roll back the enqueuing if</span></span><br><span class="line"><span class="comment">     * stopped, or start a new thread if there are none.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 3. If we cannot queue task, then we try to add a new</span></span><br><span class="line"><span class="comment">     * thread.  If it fails, we know we are shut down or saturated</span></span><br><span class="line"><span class="comment">     * and so reject the task.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">    <span class="comment">// workeræ•°é‡æ¯”æ ¸å¿ƒçº¿ç¨‹æ•°å°ï¼Œç›´æ¥åˆ›å»ºworkeræ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// workeræ•°é‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä»»åŠ¡ç›´æ¥è¿›å…¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">        <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯RUNNINGçŠ¶æ€ï¼Œè¯´æ˜æ‰§è¡Œè¿‡shutdownå‘½ä»¤ï¼Œéœ€è¦å¯¹æ–°åŠ å…¥çš„ä»»åŠ¡æ‰§è¡Œreject()æ“ä½œã€‚</span></span><br><span class="line">        <span class="comment">// è¿™å„¿ä¸ºä»€ä¹ˆéœ€è¦recheckï¼Œæ˜¯å› ä¸ºä»»åŠ¡å…¥é˜Ÿåˆ—å‰åï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">            reject(command);</span><br><span class="line">        <span class="comment">// è¿™å„¿ä¸ºä»€ä¹ˆéœ€è¦åˆ¤æ–­0å€¼ï¼Œä¸»è¦æ˜¯åœ¨çº¿ç¨‹æ± æ„é€ æ–¹æ³•ä¸­ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°å…è®¸ä¸º0</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœçº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œæˆ–è€…ä»»åŠ¡è¿›å…¥é˜Ÿåˆ—å¤±è´¥ï¼Œåˆ™å°è¯•åˆ›å»ºworkeræ‰§è¡Œä»»åŠ¡ã€‚</span></span><br><span class="line">    <span class="comment">// è¿™å„¿æœ‰3ç‚¹éœ€è¦æ³¨æ„ï¼š</span></span><br><span class="line">    <span class="comment">// 1. çº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€æ—¶ï¼ŒaddWorkerå†…éƒ¨ä¼šåˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// 2. addWorkerç¬¬2ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹</span></span><br><span class="line">    <span class="comment">// 3. addWorkerè¿”å›falseï¼Œåˆ™è¯´æ˜ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œéœ€è¦æ‰§è¡Œrejectæ“ä½œ</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4ã€addworkeræºç è§£æ">4ã€addworkeræºç è§£æ</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>&#123;</span><br><span class="line">    retry:</span><br><span class="line">    <span class="comment">// å¤–å±‚è‡ªæ—‹</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ¡ä»¶å†™å¾—æ¯”è¾ƒéš¾æ‡‚ï¼Œæˆ‘å¯¹å…¶è¿›è¡Œäº†è°ƒæ•´ï¼Œå’Œä¸‹é¢çš„æ¡ä»¶ç­‰ä»·</span></span><br><span class="line">        <span class="comment">// (rs &gt; SHUTDOWN) || </span></span><br><span class="line">        <span class="comment">// (rs == SHUTDOWN &amp;&amp; firstTask != null) || </span></span><br><span class="line">        <span class="comment">// (rs == SHUTDOWN &amp;&amp; workQueue.isEmpty())</span></span><br><span class="line">        <span class="comment">// 1. çº¿ç¨‹æ± çŠ¶æ€å¤§äºSHUTDOWNæ—¶ï¼Œç›´æ¥è¿”å›false</span></span><br><span class="line">        <span class="comment">// 2. çº¿ç¨‹æ± çŠ¶æ€ç­‰äºSHUTDOWNï¼Œä¸”firstTaskä¸ä¸ºnullï¼Œç›´æ¥è¿”å›false</span></span><br><span class="line">        <span class="comment">// 3. çº¿ç¨‹æ± çŠ¶æ€ç­‰äºSHUTDOWNï¼Œä¸”é˜Ÿåˆ—ä¸ºç©ºï¼Œç›´æ¥è¿”å›false</span></span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">            ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">               firstTask == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">               ! workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†…å±‚è‡ªæ—‹</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">            <span class="comment">// workeræ•°é‡è¶…è¿‡å®¹é‡ï¼Œç›´æ¥è¿”å›false</span></span><br><span class="line">            <span class="keyword">if</span> (wc &gt;= CAPACITY ||</span><br><span class="line">                wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨CASçš„æ–¹å¼å¢åŠ workeræ•°é‡ã€‚</span></span><br><span class="line">            <span class="comment">// è‹¥å¢åŠ æˆåŠŸï¼Œåˆ™ç›´æ¥è·³å‡ºå¤–å±‚å¾ªç¯è¿›å…¥åˆ°ç¬¬äºŒéƒ¨åˆ†</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">break</span> retry;</span><br><span class="line">            c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">            <span class="comment">// çº¿ç¨‹æ± çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¯¹å¤–å±‚å¾ªç¯è¿›è¡Œè‡ªæ—‹</span></span><br><span class="line">            <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                <span class="keyword">continue</span> retry;</span><br><span class="line">            <span class="comment">// å…¶ä»–æƒ…å†µï¼Œç›´æ¥å†…å±‚å¾ªç¯è¿›è¡Œè‡ªæ—‹å³å¯</span></span><br><span class="line">            <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">    Worker w = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">        <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">        <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            <span class="comment">// workerçš„æ·»åŠ å¿…é¡»æ˜¯ä¸²è¡Œçš„ï¼Œå› æ­¤éœ€è¦åŠ é”</span></span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">                <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">                <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">                <span class="comment">// è¿™å„¿éœ€è¦é‡æ–°æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                    <span class="comment">// workerå·²ç»è°ƒç”¨è¿‡äº†start()æ–¹æ³•ï¼Œåˆ™ä¸å†åˆ›å»ºworker</span></span><br><span class="line">                    <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                    <span class="comment">// workeråˆ›å»ºå¹¶æ·»åŠ åˆ°workersæˆåŠŸ</span></span><br><span class="line">                    workers.add(w);</span><br><span class="line">                    <span class="comment">// æ›´æ–°`largestPoolSize`å˜é‡</span></span><br><span class="line">                    <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                    <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                        largestPoolSize = s;</span><br><span class="line">                    workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¯åŠ¨workerçº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">if</span> (workerAdded) &#123;</span><br><span class="line">                t.start();</span><br><span class="line">                workerStarted = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// workerçº¿ç¨‹å¯åŠ¨å¤±è´¥ï¼Œè¯´æ˜çº¿ç¨‹æ± çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼ˆå…³é—­æ“ä½œè¢«æ‰§è¡Œï¼‰ï¼Œéœ€è¦è¿›è¡Œshutdownç›¸å…³æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">            addWorkerFailed(w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> workerStarted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5ã€çº¿ç¨‹æ± workerä»»åŠ¡å•å…ƒ">5ã€çº¿ç¨‹æ± workerä»»åŠ¡å•å…ƒ</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This class will never be serialized, but we provide a</span></span><br><span class="line"><span class="comment">     * serialVersionUID to suppress a javac warning.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6138294804551838833L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Thread this worker is running in.  Null if factory fails. */</span></span><br><span class="line">    <span class="keyword">final</span> Thread thread;</span><br><span class="line">    <span class="comment">/** Initial task to run.  Possibly null. */</span></span><br><span class="line">    Runnable firstTask;</span><br><span class="line">    <span class="comment">/** Per-thread task counter */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> completedTasks;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates with given first task and thread from ThreadFactory.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> firstTask the first task (null if none)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Worker(Runnable firstTask) &#123;</span><br><span class="line">        setState(-<span class="number">1</span>); <span class="comment">// inhibit interrupts until runWorker</span></span><br><span class="line">        <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">        <span class="comment">// è¿™å„¿æ˜¯Workerçš„å…³é”®æ‰€åœ¨ï¼Œä½¿ç”¨äº†çº¿ç¨‹å·¥å‚åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ã€‚ä¼ å…¥çš„å‚æ•°ä¸ºå½“å‰worker</span></span><br><span class="line">        <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Delegates main run loop to outer runWorker  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        runWorker(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6ã€æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œé€»è¾‘-runworker">6ã€æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œé€»è¾‘-runworker</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>&#123;</span><br><span class="line">    Thread wt = Thread.currentThread();</span><br><span class="line">    Runnable task = w.firstTask;</span><br><span class="line">    w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// è°ƒç”¨unlock()æ˜¯ä¸ºäº†è®©å¤–éƒ¨å¯ä»¥ä¸­æ–­</span></span><br><span class="line">    w.unlock(); <span class="comment">// allow interrupts</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå˜é‡ç”¨äºåˆ¤æ–­æ˜¯å¦è¿›å…¥è¿‡è‡ªæ—‹ï¼ˆwhileå¾ªç¯ï¼‰</span></span><br><span class="line">    <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™å„¿æ˜¯è‡ªæ—‹</span></span><br><span class="line">        <span class="comment">// 1. å¦‚æœfirstTaskä¸ä¸ºnullï¼Œåˆ™æ‰§è¡ŒfirstTaskï¼›</span></span><br><span class="line">        <span class="comment">// 2. å¦‚æœfirstTaskä¸ºnullï¼Œåˆ™è°ƒç”¨getTask()ä»é˜Ÿåˆ—è·å–ä»»åŠ¡ã€‚</span></span><br><span class="line">        <span class="comment">// 3. é˜»å¡é˜Ÿåˆ—çš„ç‰¹æ€§å°±æ˜¯ï¼šå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿™å„¿å¯¹workerè¿›è¡ŒåŠ é”ï¼Œæ˜¯ä¸ºäº†è¾¾åˆ°ä¸‹é¢çš„ç›®çš„</span></span><br><span class="line">            <span class="comment">// 1. é™ä½é”èŒƒå›´ï¼Œæå‡æ€§èƒ½</span></span><br><span class="line">            <span class="comment">// 2. ä¿è¯æ¯ä¸ªworkeræ‰§è¡Œçš„ä»»åŠ¡æ˜¯ä¸²è¡Œçš„</span></span><br><span class="line">            w.lock();</span><br><span class="line">            <span class="comment">// If pool is stopping, ensure thread is interrupted;</span></span><br><span class="line">            <span class="comment">// if not, ensure thread is not interrupted.  This</span></span><br><span class="line">            <span class="comment">// requires a recheck in second case to deal with</span></span><br><span class="line">            <span class="comment">// shutdownNow race while clearing interrupt</span></span><br><span class="line">            <span class="comment">// å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œåˆ™å¯¹å½“å‰çº¿ç¨‹è¿›è¡Œä¸­æ–­æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &amp;&amp;</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                wt.interrupt();</span><br><span class="line">            <span class="comment">// æ‰§è¡Œä»»åŠ¡ï¼Œä¸”åœ¨æ‰§è¡Œå‰åé€šè¿‡`beforeExecute()`å’Œ`afterExecute()`æ¥æ‰©å±•å…¶åŠŸèƒ½ã€‚</span></span><br><span class="line">            <span class="comment">// è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨å½“å‰ç±»é‡Œé¢ä¸ºç©ºå®ç°ã€‚</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    task.run();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (RuntimeException x) &#123;</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Error x) &#123;</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable x) &#123;</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    afterExecute(task, thrown);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// å¸®åŠ©gc</span></span><br><span class="line">                task = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">// å·²å®Œæˆä»»åŠ¡æ•°åŠ ä¸€ </span></span><br><span class="line">                w.completedTasks++;</span><br><span class="line">                w.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        completedAbruptly = <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªæ—‹æ“ä½œè¢«é€€å‡ºï¼Œè¯´æ˜çº¿ç¨‹æ± æ­£åœ¨ç»“æŸ</span></span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹çš„å¼ºè½¯å¼±è™šå››ç§å¼•ç”¨</title>
    <url>/posts/d6b7922e/</url>
    <content><![CDATA[<h3 id="ThreadLocal">ThreadLocal</h3>
<p>springçš„å£°æ˜å¼äº‹åŠ¡ä¼šä½¿ç”¨åˆ°ï¼Œä¿è¯å½“å‰çº¿ç¨‹ä¸­æ•°æ®åº“è¿æ¥æ˜¯åŒä¸€ä¸ªè¿æ¥</p>
<h3 id="å¼ºå¼•ç”¨">å¼ºå¼•ç”¨</h3>
<p>åªè¦ä¸€å¯¹è±¡æœ‰å¼ºå¼•ç”¨ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¸ä¼šå›æ”¶</p>
<h3 id="è½¯å¼•ç”¨">è½¯å¼•ç”¨</h3>
<p>åœ¨å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œä¼šä¼˜å…ˆå›æ”¶åªæœ‰è½¯å¼•ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä¸»è¦æ˜¯åšç¼“å­˜ç”¨</p>
<h3 id="å¼±å¼•ç”¨">å¼±å¼•ç”¨</h3>
<p>åªè¦æ˜¯è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡Œå›æ”¶ï¼Œåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡å°±ä¼šè¢«å›æ”¶</p>
<ul>
<li>tomcatä¸­å°±æ˜¯ä½¿ç”¨çš„å¼±åº”ç”¨</li>
<li>ThreadLocalä¹Ÿæ˜¯ä½¿ç”¨å¼±åº”ç”¨</li>
</ul>
<p>weakhashmap</p>
<h3 id="è™šå¼•ç”¨">è™šå¼•ç”¨</h3>
<p>ä¸»è¦æ˜¯ç®¡ç†å †å¤–å†…å­˜çš„ï¼Œä¸»è¦æ˜¯ç»™å†™jvmçš„ä½¿ç”¨</p>
<p>ä¸»è¦æ£€æµ‹é˜Ÿåˆ—é…åˆä½¿ç”¨ï¼Œè™šå¼•ç”¨APIæ— æ³•getåˆ°å€¼ï¼Œä¸»è¦æ˜¯é€šçŸ¥å¯¹è±¡å·²ç»è¢«å›æ”¶ï¼Œå»æ¸…ç†å †å¤–çš„å†…å­˜</p>
<table>
<thead>
<tr>
<th style="text-align:left">å¼•ç”¨ç±»å‹</th>
<th style="text-align:left">è¢«åƒåœ¾å›æ”¶æ—¶é—´</th>
<th>ç”¨é€”</th>
<th>ç”Ÿå­˜æ—¶é—´</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å¼ºå¼•ç”¨</td>
<td style="text-align:left">ä»æ¥ä¸ä¼š</td>
<td>å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€</td>
<td>JVMåœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢</td>
</tr>
<tr>
<td style="text-align:left">è½¯å¼•ç”¨</td>
<td style="text-align:left">å½“å†…å­˜ä¸è¶³æ—¶</td>
<td>å¯¹è±¡ç¼“å­˜</td>
<td>å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢</td>
</tr>
<tr>
<td style="text-align:left">å¼±å¼•ç”¨</td>
<td style="text-align:left">æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</td>
<td>å¯¹è±¡ç¼“å­˜</td>
<td>åƒåœ¾å›æ”¶åç»ˆæ­¢</td>
</tr>
<tr>
<td style="text-align:left">è™šå¼•ç”¨</td>
<td style="text-align:left">æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</td>
<td>è·Ÿè¸ªå¯¹è±¡çš„åƒåœ¾å›æ”¶</td>
<td>åƒåœ¾å›æ”¶åç»ˆæ­¢</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeperçš„å®‰è£…å’Œç®€å•æ“ä½œ</title>
    <url>/posts/b439f21c/</url>
    <content><![CDATA[<h1>å®‰è£…ç¯å¢ƒ</h1>
<ol>
<li>ç³»ç»Ÿï¼šCentOS 7</li>
<li>Javaç¯å¢ƒï¼š JDK8</li>
</ol>
<h1>ä¸‹è½½åŠå®‰è£…</h1>
<p>zookeeperæœ‰å•æœºã€ä¼ªé›†ç¾¤ã€é›†ç¾¤ä¸‰ç§éƒ¨ç½²æ–¹å¼ï¼Œæˆ‘ä½¿ç”¨çš„zookeeperç‰ˆæœ¬æ˜¯ï¼šzookeeper-3.5.9</p>
<p>ä¸‹è½½Zookeeper</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;apache.claz.org&#x2F;zookeeper&#x2F;zookeeper-3.5.9&#x2F;apache-zookeeper-3.5.9-bin.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="å•æœºæ¨¡å¼">å•æœºæ¨¡å¼</h2>
<h3 id="è§£å‹">è§£å‹</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;è§£å‹åˆ°æŒ‡å®šç›®å½•</span><br><span class="line">tar -zxvf apache-zookeeper-3.5.9-bin.tar.gz   -C &#x2F;user&#x2F;soft&#x2F;</span><br></pre></td></tr></table></figure>
<p>è§£å‹åç›®å½•</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301110436.png" alt="image-20210301110435970"></p>
<p>è¿›å…¥confç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªzookeeperçš„é…ç½®æ–‡ä»¶zoo.cfgï¼Œå¯å¤åˆ¶conf/zoo_sample.cfgä½œä¸ºé…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd conf</span><br><span class="line">cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®æ–‡ä»¶è¯´æ˜ï¼š">é…ç½®æ–‡ä»¶è¯´æ˜ï¼š</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># The number of milliseconds of each tick</span><br><span class="line"># tickTimeï¼šCSé€šä¿¡å¿ƒè·³æ•°</span><br><span class="line"># Zookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚tickTimeä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</span><br><span class="line">tickTime&#x3D;2000</span><br><span class="line"></span><br><span class="line"># The number of ticks that the initial </span><br><span class="line"># synchronization phase can take</span><br><span class="line">#initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™</span><br><span class="line"># é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</span><br><span class="line">initLimit&#x3D;10</span><br><span class="line"></span><br><span class="line"># The number of ticks that can pass between </span><br><span class="line"># sending a request and getting an acknowledgement</span><br><span class="line"># syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</span><br><span class="line"># é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨ä¸leaderæœåŠ¡å™¨ä¹‹é—´è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTime*syncLimit ï¼‰ã€‚</span><br><span class="line">syncLimit&#x3D;5</span><br><span class="line"></span><br><span class="line"># the directory where the snapshot is stored.</span><br><span class="line"># do not use &#x2F;tmp for storage, &#x2F;tmp here is just </span><br><span class="line"># example sakes.</span><br><span class="line"># dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•</span><br><span class="line"># Zookeeperä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeperå°†å†™æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚</span><br><span class="line">dataDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;apache-zookeeper-3.6.2-bin&#x2F;data</span><br><span class="line"></span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">#clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£</span><br><span class="line">#å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚</span><br><span class="line">clientPort&#x3D;2181</span><br><span class="line"></span><br><span class="line"># the maximum number of client connections.</span><br><span class="line"># increase this if you need to handle more clients</span><br><span class="line">#æœ€å¤§è¿æ¥æ•°</span><br><span class="line">#maxClientCnxns&#x3D;60</span><br><span class="line">#</span><br><span class="line"># Be sure to read the maintenance section of the </span><br><span class="line"># administrator guide before turning on autopurge.</span><br><span class="line">#</span><br><span class="line"># http:&#x2F;&#x2F;zookeeper.apache.org&#x2F;doc&#x2F;current&#x2F;zookeeperAdmin.html#sc_maintenance</span><br><span class="line">#</span><br><span class="line"># The number of snapshots to retain in dataDir</span><br><span class="line">#ä¿ç•™æ•°é‡3</span><br><span class="line">#autopurge.snapRetainCount&#x3D;3</span><br><span class="line"></span><br><span class="line"># Purge task interval in hours</span><br><span class="line"># Set to &quot;0&quot; to disable auto purge feature</span><br><span class="line">#æ¸…ç†æ—¶é—´é—´éš”1å°æ—¶</span><br><span class="line">#autopurge.purgeInterval&#x3D;1</span><br><span class="line"></span><br><span class="line">## Metrics Providers</span><br><span class="line">#</span><br><span class="line"># https:&#x2F;&#x2F;prometheus.io Metrics Exporter</span><br><span class="line">#metricsProvider.className&#x3D;org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span><br><span class="line">#metricsProvider.httpPort&#x3D;7000</span><br><span class="line">#metricsProvider.exportJvmInfo&#x3D;true</span><br><span class="line"></span><br><span class="line"> # æœåŠ¡å™¨åç§°ä¸åœ°å€ï¼šé›†ç¾¤ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ç¼–å·ï¼ŒæœåŠ¡å™¨åœ°å€ï¼ŒLFé€šä¿¡ç«¯å£ï¼Œé€‰ä¸¾ç«¯å£ï¼‰</span><br><span class="line"># è¿™ä¸ªé…ç½®é¡¹çš„ä¹¦å†™æ ¼å¼æ¯”è¾ƒç‰¹æ®Šï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</span><br><span class="line"># server.N&#x3D;YYY:A:B   </span><br><span class="line"># å…¶ä¸­Nè¡¨ç¤ºæœåŠ¡å™¨ç¼–å·ï¼ŒYYYè¡¨ç¤ºæœåŠ¡å™¨çš„IPåœ°å€ï¼ŒAä¸ºLFé€šä¿¡ç«¯å£ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„leaderäº¤æ¢çš„ä¿¡æ¯çš„ç«¯å£ã€‚Bä¸ºé€‰ä¸¾ç«¯å£ï¼Œè¡¨ç¤ºé€‰ä¸¾æ–°leaderæ—¶æœåŠ¡å™¨é—´ç›¸äº’é€šä¿¡çš„ç«¯å£ï¼ˆå½“leaderæŒ‚æ‰æ—¶ï¼Œå…¶ä½™æœåŠ¡å™¨ä¼šç›¸äº’é€šä¿¡ï¼Œé€‰æ‹©å‡ºæ–°çš„leaderï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªæœåŠ¡å™¨çš„Aç«¯å£éƒ½æ˜¯ä¸€æ ·ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„Bç«¯å£ä¹Ÿæ˜¯ä¸€æ ·ã€‚ä½†æ˜¯å½“æ‰€é‡‡ç”¨çš„ä¸ºä¼ªé›†ç¾¤æ—¶ï¼ŒIPåœ°å€éƒ½ä¸€æ ·ï¼Œåªèƒ½æ—¶Aç«¯å£å’ŒBç«¯å£ä¸ä¸€æ ·ã€‚ </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨åŠåœæ­¢æœåŠ¡">å¯åŠ¨åŠåœæ­¢æœåŠ¡</h3>
<p>å¯ä»¥ä¸ä¿®æ”¹zoo.cfgï¼Œé»˜è®¤é…ç½®å°±è¡Œï¼Œè¿›å»zookeeperå®‰è£…ç›®å½•ï¼Œå¯åŠ¨ZooKeeper</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨å‘½ä»¤ï¼š</span></span><br><span class="line">./bin/zkServer.sh start</span><br><span class="line"><span class="comment">#åœ¨å‰ç«¯å¯åŠ¨ï¼Œå¯çœ‹å¯åŠ¨æ—¥å¿—</span></span><br><span class="line">./bin/zkServer.sh start-foreground</span><br><span class="line"><span class="comment">#åœæ­¢å‘½ä»¤ï¼š</span></span><br><span class="line">./bin/zkServer.sh stopã€€ã€€</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯å‘½ä»¤ï¼š</span></span><br><span class="line">./bin/zkServer.sh restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#çŠ¶æ€æŸ¥çœ‹å‘½ä»¤ï¼š</span></span><br><span class="line">./bin/zkServer.sh status</span><br></pre></td></tr></table></figure>
<h2 id="ä¼ªé›†ç¾¤æ¨¡å¼">ä¼ªé›†ç¾¤æ¨¡å¼</h2>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>åœ¨åŒä¸€å°ä¸»æœºä¸Šï¼Œé€šè¿‡å¤åˆ¶å¾—åˆ°ä¸‰ä¸ªzookeeperå®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp -r  /usr/soft/zookeeper/Zookeeper   /usr/soft/zookeeper/Zookeeper2</span><br></pre></td></tr></table></figure>
<h3 id="èŠ‚ç‚¹é…ç½®">èŠ‚ç‚¹é…ç½®</h3>
<p>zookeeper1é…ç½®æ–‡ä»¶conf/zoo.cfgä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tickTime&#x3D;2000</span><br><span class="line">initLimit&#x3D;5</span><br><span class="line">syncLimit&#x3D;2</span><br><span class="line">dataDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper1&#x2F;data</span><br><span class="line">dataLogDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper1&#x2F;logs</span><br><span class="line">clientPort&#x3D;12181</span><br><span class="line"></span><br><span class="line">server.1&#x3D;127.0.0.1:12888:13888</span><br><span class="line">server.2&#x3D;127.0.0.1:14888:15888</span><br><span class="line">server.3&#x3D;127.0.0.1:16888:17888</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šserver.1ä¸­çš„æ•°å­—1ä¸º<strong>æœåŠ¡å™¨çš„ID</strong>ï¼Œéœ€è¦ä¸<strong>myidæ–‡ä»¶ä¸­çš„idä¸€è‡´</strong>ï¼Œä¸‹ä¸€æ­¥å°†é…ç½®myid</p>
<p>zookeeper1çš„data/myidé…ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼ˆå³æ–°å»ºä¸€ä¸ªæ–‡ä»¶data/myidï¼Œåœ¨å…¶ä¸­æ·»åŠ å†…å®¹ä¸ºï¼š1ï¼‰ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;1&#x27;</span> &gt; data/myid</span><br></pre></td></tr></table></figure>
<p>zookeeper2é…ç½®æ–‡ä»¶conf/zoo.cfgä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tickTime&#x3D;2000</span><br><span class="line">initLimit&#x3D;5</span><br><span class="line">syncLimit&#x3D;2</span><br><span class="line">dataDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper2&#x2F;data</span><br><span class="line">dataLogDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper2&#x2F;logs</span><br><span class="line">clientPort&#x3D;12182</span><br><span class="line"></span><br><span class="line">server.1&#x3D;127.0.0.1:12888:13888</span><br><span class="line">server.2&#x3D;127.0.0.1:14888:15888</span><br><span class="line">server.3&#x3D;127.0.0.1:16888:17888</span><br></pre></td></tr></table></figure>
<p>zookeeper2çš„data/myidé…ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#39;2&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>
<p>zookeeper3é…ç½®æ–‡ä»¶conf/zoo.cfgä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tickTime&#x3D;2000</span><br><span class="line">initLimit&#x3D;5</span><br><span class="line">syncLimit&#x3D;2</span><br><span class="line">dataDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper3&#x2F;data</span><br><span class="line">dataLogDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper3&#x2F;logs</span><br><span class="line">clientPort&#x3D;12183</span><br><span class="line"></span><br><span class="line">server.1&#x3D;127.0.0.1:12888:13888</span><br><span class="line">server.2&#x3D;127.0.0.1:14888:15888</span><br><span class="line">server.3&#x3D;127.0.0.1:16888:17888</span><br></pre></td></tr></table></figure>
<p>zookeeper3çš„data/myidé…ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#39;3&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªzookeeperèŠ‚ç‚¹</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301134558.png" alt="image-20210301134558405"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301134626.png" alt="image-20210301134626147"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301134728.png" alt="image-20210301134728171"></p>
<h2 id="é›†ç¾¤æ¨¡å¼">é›†ç¾¤æ¨¡å¼</h2>
<p>å‚è€ƒä¼ªé›†ç¾¤æ¨¡å¼</p>
<p>1ã€åœ¨ä¸‰å°æœºå™¨ä¸Šåˆ†åˆ«éƒ¨ç½²1ä¸ªZooKeeperå®ä¾‹</p>
<p>2ã€zookeeperé…ç½®æ–‡ä»¶conf/zoo.cfgï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tickTime&#x3D;2000</span><br><span class="line">initLimit&#x3D;5</span><br><span class="line">syncLimit&#x3D;2</span><br><span class="line">dataDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper1&#x2F;data</span><br><span class="line">dataLogDir&#x3D;&#x2F;usr&#x2F;soft&#x2F;zookeeper&#x2F;zookeeper1&#x2F;logs</span><br><span class="line">clientPort&#x3D;12181</span><br><span class="line"></span><br><span class="line">server.1&#x3D;127.0.0.1:12888:13888</span><br><span class="line">&#x2F;&#x2F;ä¿®æ”¹ä¸º2ï¼Œ3èŠ‚ç‚¹çš„ip</span><br><span class="line">server.2&#x3D;127.0.0.1:14888:15888</span><br><span class="line">server.3&#x3D;127.0.0.1:16888:17888</span><br></pre></td></tr></table></figure>
<p>3ã€zookeeperçš„data/myidé…ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 echo &#39;1&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>
<p>zookeeper1 å¯¹åº”çš„æ˜¯ 1ï¼Œzookeeper2 å¯¹åº”çš„æ˜¯ 2ï¼Œzookeeper3 å¯¹åº”çš„æ˜¯ 3</p>
<p>4ã€åˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªzookeeperèŠ‚ç‚¹ï¼Œå³å®Œæˆå¯¹ZooKeeperé›†ç¾¤çš„å®‰è£…</p>
<h1>Zookeeperç®€å•æ“ä½œ</h1>
<p>aã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥ZooKeeperæœåŠ¡</p>
<p>å‘½ä»¤ï¼š<code>./bin/zkCli.sh -server 127.0.0.1:12181</code></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301140944.png" alt="image-20210301140944047"></p>
<p>bã€ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ ZooKeeper ä¸­æ‰€åŒ…å«çš„å†…å®¹ï¼š<br>
å‘½ä»¤ï¼š<font color=blue>ls /</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301141124.png" alt="image-20210301141124292"></p>
<p>c ã€åˆ›å»ºèŠ‚ç‚¹</p>
<p>å‘½ä»¤ ï¼š<font color=blue>create /zk myData</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301141402.png" alt="image-20210301141402229"></p>
<p>dã€è·å–èŠ‚ç‚¹â€˜zkâ€™</p>
<p>å‘½ä»¤ï¼š<font color=blue>get /zk</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301141449.png" alt="image-20210301141449291"></p>
<p>eã€åˆ é™¤znodeèŠ‚ç‚¹â€œ zk</p>
<p>å‘½ä»¤ï¼š<font color=blue>delete /zk</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210301141725.png" alt="image-20210301141725018"></p>
<p>fã€é€€å‡ºå®¢æˆ·ç«¯</p>
<p>å‘½ä»¤ï¼š<font color=blue>quit</font></p>
]]></content>
      <categories>
        <category>ZooKeeper</category>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>ZooKeeper</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼ä¸€è‡´æ€§ç†è®ºï¼ŒCAPï¼ŒBASEç†è®º</title>
    <url>/posts/6afaddd1/</url>
    <content><![CDATA[<h1>åˆ†å¸ƒå¼çš„é—®é¢˜</h1>
<p>åˆ†å¸ƒå¼å› ä¸º<strong>ç½‘ç»œçš„ä¸ç¡®å®šæ€§</strong>ï¼Œ<strong>èŠ‚ç‚¹æ•…éšœç­‰æƒ…å†µ</strong>ï¼Œä¼šå¸¦æ¥å„ç§å¤æ‚çš„é—®é¢˜ã€‚æˆ‘ä»¬åœ¨å­¦ä¹ åˆ†å¸ƒå¼çš„ç›¸å…³ç†è®ºæ—¶ï¼Œä¸€å®šè¦æ˜ç¡®è¿™æ ·ä¸€ä¸ª<strong>é“ç†</strong>ï¼Œå°±æ˜¯ï¼šç½‘ç»œä¸å¯é ï¼Œç½‘ç»œåˆ†åŒºä»¥åŠèŠ‚ç‚¹å®•æœºæ˜¯å¸¸æ€ï¼Œå¦å¤–ç½‘ç»œå¸¦å®½èµ„æºæ˜¯åŠå…¶çè´µçš„ï¼Œæˆ‘ä»¬<font color=red>å¿…é¡»åœ¨ç½‘ç»œä¸å¯é ã€åˆ†åŒºä»¥åŠèŠ‚ç‚¹å®•æœºçš„å‰æä¸‹ï¼Œæ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿ</font>ã€‚</p>
<h2 id="åˆ†å¸ƒå¼ç¯å¢ƒçš„é—®é¢˜">åˆ†å¸ƒå¼ç¯å¢ƒçš„é—®é¢˜</h2>
<ol>
<li><strong>é€šä¿¡å¼‚å¸¸</strong>ï¼šä»é›†ä¸­å¼å‘åˆ†å¸ƒå¼æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šå¼•å…¥ç½‘ç»œå› ç´ ï¼Œè€Œç”±äºç½‘ç»œæœ¬èº«çš„ä¸å¯é æ€§ï¼Œå› æ­¤ä¹Ÿå¼•å…¥äº†é¢å¤–çš„é—®é¢˜ã€‚<strong>åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦åœ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå› æ­¤å½“ç½‘ç»œé€šä¿¡è®¾å¤‡æ•…éšœå°±ä¼šå¯¼è‡´æ— æ³•é¡ºåˆ©å®Œæˆä¸€æ¬¡ç½‘ç»œé€šä¿¡ï¼Œå°±ç®—å„èŠ‚ç‚¹çš„ç½‘ç»œé€šä¿¡æ­£å¸¸ï¼Œä½†æ˜¯æ¶ˆæ¯ä¸¢å¤±å’Œæ¶ˆæ¯å»¶æ—¶ä¹Ÿæ˜¯éå¸¸æ™®éçš„äº‹æƒ…</strong>ã€‚</li>
<li><strong>ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰</strong>ï¼šç½‘ç»œå‘ç”Ÿå¼‚å¸¸æƒ…å†µå¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œå»¶æ—¶ä¸æ–­å¢å¤§ï¼Œæœ€ç»ˆå¯¼è‡´ç»„æˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªæœ‰éƒ¨åˆ†èŠ‚ç‚¹èƒ½å¤Ÿæ­£å¸¸é€šè¡Œï¼Œè€Œå¦ä¸€äº›èŠ‚ç‚¹åˆ™ä¸èƒ½ã€‚æˆ‘ä»¬ç§°è¿™ç§æƒ…å†µå«åšç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰ï¼Œå½“ç½‘ç»œåˆ†åŒºå‡ºç°æ—¶ï¼Œ<strong>åˆ†å¸ƒå¼ç³»ç»Ÿä¼šå‡ºç°å¤šä¸ªå±€éƒ¨å°é›†ç¾¤ï¼ˆå¤šä¸ªå°é›†ç¾¤å¯èƒ½åˆä¼šäº§ç”Ÿå¤šä¸ªmasterèŠ‚ç‚¹ï¼‰ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼ç³»ç»Ÿè¦æ±‚è¿™äº›å°é›†ç¾¤è¦èƒ½ç‹¬ç«‹å®ŒæˆåŸæœ¬éœ€è¦æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ‰èƒ½å®Œæˆçš„åŠŸèƒ½</strong>ï¼Œè¿™å°±å¯¹åˆ†å¸ƒå¼ä¸€è‡´æ€§æå‡ºäº†éå¸¸å¤§çš„æŒ‘æˆ˜ã€‚</li>
<li><strong>èŠ‚ç‚¹æ•…éšœ</strong>ï¼šèŠ‚ç‚¹å®•æœºæ˜¯åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„å¸¸æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½ä¼šå‡ºç°å®•æœºæˆ–åƒµæ­»çš„æƒ…å†µï¼Œå¹¶ä¸”æ¯å¤©éƒ½åœ¨å‘ç”Ÿã€‚</li>
<li><strong>ä¸‰æ€</strong>ï¼šç”±äºç½‘ç»œä¸å¯é çš„åŸå› ï¼Œå› æ­¤<strong>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½å­˜åœ¨ç‰¹æœ‰çš„â€œä¸‰æ€â€æ¦‚å¿µï¼Œå³ï¼šæˆåŠŸï¼Œå¤±è´¥ä¸è¶…æ—¶</strong>ã€‚åœ¨é›†ä¸­å¼å•æœºéƒ¨ç½²ä¸­ï¼Œç”±äºæ²¡æœ‰ç½‘ç»œå› ç´ ï¼Œæ‰€ä»¥ç¨‹åºçš„æ¯ä¸€æ¬¡è°ƒç”¨éƒ½èƒ½å¾—åˆ°â€œæˆåŠŸâ€æˆ–è€…â€œå¤±è´¥â€çš„å“åº”ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œä¸å¯é ï¼Œå¯èƒ½å°±ä¼šå‡ºç°è¶…æ—¶çš„æƒ…å†µã€‚<strong>å¯èƒ½åœ¨æ¶ˆæ¯å‘é€æ—¶ä¸¢å¤±æˆ–è€…åœ¨å“åº”è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œå½“å‡ºç°è¶…æ—¶æƒ…å†µæ—¶ï¼Œç½‘ç»œé€šä¿¡çš„å‘èµ·æ–¹æ˜¯æ— æ³•ç¡®å®šå½“å‰è¯·æ±‚æ˜¯å¦è¢«æˆåŠŸå¤„ç†çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„éš¾ç‚¹</strong>ã€‚</li>
</ol>
<h1>åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h1>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<strong>èŠ‚ç‚¹å®•æœºæ˜¯å¸¸æ€</strong>ï¼Œä¸ºäº†é«˜å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šéƒ¨ç½²å¤šå°æœåŠ¡å™¨ï¼ŒåŠ¿å¿…å°±ä¼šå­˜åœ¨<strong>æ•°æ®çš„å¤åˆ¶é—®é¢˜</strong>ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹äºæ•°æ®çš„å¤åˆ¶éœ€æ±‚ä¸€èˆ¬æ¥è‡ªäºä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š</p>
<blockquote>
<ul>
<li>é«˜å¯ç”¨ï¼šå°†æ•°æ®å¤åˆ¶åˆ°åˆ†å¸ƒå¼éƒ¨ç½²çš„å¤šå°æœºå™¨ä¸­ï¼Œå¯ä»¥æ¶ˆé™¤å•ç‚¹æ•…éšœï¼Œé˜²æ­¢ç³»ç»Ÿç”±äºæŸå°ï¼ˆäº›ï¼‰æœºå™¨å®•æœºå¯¼è‡´çš„ä¸å¯ç”¨ã€‚</li>
<li>æ€§èƒ½ï¼šé€šè¿‡è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œèƒ½å¤Ÿè®©åˆ†å¸ƒåœ¨ä¸åŒåœ°æ–¹çš„æ•°æ®å‰¯æœ¬å…¨éƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚æœ‰æ•ˆæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</li>
</ul>
</blockquote>
<p><strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼•å…¥å¤åˆ¶æœºåˆ¶åï¼Œä¸åŒçš„æ•°æ®èŠ‚ç‚¹ä¹‹é—´ç”±äºç½‘ç»œå»¶æ—¶ç­‰åŸå› å¾ˆå®¹æ˜“äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</strong>ã€‚å¤åˆ¶æœºåˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ä½†æ˜¯æ•°æ®å¤åˆ¶é¢ä¸´çš„ä¸»è¦éš¾é¢˜ä¹Ÿæ˜¯å¦‚ä½•ä¿è¯å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚å…¶ä¸­ï¼Œå¸¸è§çš„å°±æ˜¯ä¸»ä»æ•°æ®åº“ä¹‹é—´çš„å¤åˆ¶å»¶æ—¶é—®é¢˜ã€‚</p>
<blockquote>
<p>Zookeeperå°±æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„å·¥ä¸šè§£å†³æ–¹æ¡ˆï¼Œpaxosæ˜¯ç†è®ºç®—æ³•ï¼Œå…¶ä¸­zabï¼Œraftå’Œä¼—å¤šå¼€æºç®—æ³•æ˜¯å¯¹paxosçš„å·¥ä¸šçº§å®ç°ã€‚Zookeeperä½¿ç”¨zabæ¥ä¿è¯å…¶è‡ªèº«ç³»ç»Ÿçš„é«˜å¯ç”¨ä¸æ•°æ®ä¸€è‡´æ€§çš„ã€‚</p>
</blockquote>
<h1>CAPç†è®º</h1>
<p>CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œä¸‰è€…ä¸å¯å¾—å…¼ã€‚</p>
<p>ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»æ˜¯å¦åŒæ ·çš„å€¼ã€‚ï¼ˆç­‰åŒäºæ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬ï¼‰</p>
<p>å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šä¿è¯æ¯ä¸ªè¯·æ±‚ä¸ç®¡æˆåŠŸæˆ–è€…å¤±è´¥éƒ½æœ‰å“åº”ã€‚</p>
<p>åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰ï¼šç³»ç»Ÿä¸­ä»»æ„ä¿¡æ¯çš„ä¸¢å¤±æˆ–å¤±è´¥ä¸ä¼šå½±å“ç³»ç»Ÿçš„ç»§ç»­è¿ä½œã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302163013.png" alt="image-20210302163013412"></p>
<p>CAPåŸåˆ™çš„ç²¾é«“å°±æ˜¯è¦ä¹ˆAPï¼Œè¦ä¹ˆCPï¼Œè¦ä¹ˆACï¼Œä½†æ˜¯ä¸å­˜åœ¨CAPã€‚å¦‚æœåœ¨æŸä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ•°æ®æ— å‰¯æœ¬ï¼Œ é‚£ä¹ˆç³»ç»Ÿå¿…ç„¶æ»¡è¶³å¼ºä¸€è‡´æ€§æ¡ä»¶ï¼Œ å› ä¸ºåªæœ‰ç‹¬ä¸€æ•°æ®ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶Cå’ŒPä¸¤è¦ç´ å…·å¤‡ï¼Œä½†æ˜¯å¦‚æœç³»ç»Ÿå‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºçŠ¶å†µæˆ–è€…å®•æœºï¼Œå¿…ç„¶å¯¼è‡´æŸäº›æ•°æ®ä¸å¯ä»¥è®¿é—®ï¼Œæ­¤æ—¶å¯ç”¨æ€§æ¡ä»¶å°±ä¸èƒ½è¢«æ»¡è¶³ï¼Œå³åœ¨æ­¤æƒ…å†µä¸‹è·å¾—äº†CPç³»ç»Ÿï¼Œä½†æ˜¯CAPä¸å¯åŒæ—¶æ»¡è¶³</p>
<h2 id="ä¸€è‡´æ€§ä¸å¯ç”¨æ€§çš„å†³æ‹©ç¼–è¾‘">ä¸€è‡´æ€§ä¸å¯ç”¨æ€§çš„å†³æ‹©ç¼–è¾‘</h2>
<p>CAPç†è®ºå°±æ˜¯è¯´åœ¨åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæœ€å¤šåªèƒ½å®ç°ä¸Šé¢çš„ä¸¤ç‚¹ã€‚è€Œç”±äºå½“å‰çš„ç½‘ç»œç¡¬ä»¶è‚¯å®šä¼šå‡ºç°å»¶è¿Ÿä¸¢åŒ…ç­‰é—®é¢˜ï¼Œæ‰€ä»¥<font color=red>åˆ†åŒºå®¹å¿æ€§æ˜¯æˆ‘ä»¬å¿…é¡»éœ€è¦å®ç°çš„</font>ã€‚æ‰€ä»¥æˆ‘ä»¬<font color=red>åªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œæ²¡æœ‰NoSQLç³»ç»Ÿèƒ½åŒæ—¶ä¿è¯è¿™ä¸‰ç‚¹</font>ã€‚</p>
<p>CAPä¸‰ä¸ªç‰¹æ€§åªèƒ½æ»¡è¶³å…¶ä¸­ä¸¤ä¸ªï¼Œé‚£ä¹ˆå–èˆçš„ç­–ç•¥å°±å…±æœ‰ä¸‰ç§ï¼š</p>
<p>**<font color=red>CA without P</font>ï¼š**å¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†æ”¾å¼ƒPçš„åŒæ—¶ä¹Ÿå°±æ„å‘³ç€æ”¾å¼ƒäº†ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼èŠ‚ç‚¹å—é™ï¼Œæ²¡åŠæ³•éƒ¨ç½²å­èŠ‚ç‚¹ï¼Œè¿™æ˜¯è¿èƒŒåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„åˆè¡·çš„ã€‚<strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“RDBMSï¼šOracleã€MySQLå°±æ˜¯CAã€‚</strong></p>
<p>**<font color=red>CP without A </font>ï¼š**å¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨æœåŠ¡å™¨ä¹‹é—´ä¿æŒå¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿(ä¹Ÿå°±æ˜¯ç­‰å¾…æ•°æ®åŒæ­¥å®Œæ‰èƒ½æ­£å¸¸è®¿é—®æœåŠ¡)ï¼Œä¸€æ—¦å‘ç”Ÿç½‘ç»œæ•…éšœæˆ–è€…æ¶ˆæ¯ä¸¢å¤±ç­‰æƒ…å†µï¼Œå°±è¦ç‰ºç‰²ç”¨æˆ·çš„ä½“éªŒï¼Œç­‰å¾…æ‰€æœ‰æ•°æ®å…¨éƒ¨ä¸€è‡´äº†ä¹‹åå†è®©ç”¨æˆ·è®¿é—®ç³»ç»Ÿã€‚è®¾è®¡æˆCPçš„ç³»ç»Ÿå…¶å®ä¸å°‘ï¼Œ<strong>æœ€å…¸å‹çš„å°±æ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¦‚Redisã€HBaseç­‰</strong>ã€‚å¯¹äºè¿™äº›åˆ†å¸ƒå¼æ•°æ®åº“æ¥è¯´ï¼Œæ•°æ®çš„ä¸€è‡´æ€§æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› ä¸ºå¦‚æœè¿è¿™ä¸ªæ ‡å‡†éƒ½è¾¾ä¸åˆ°ï¼Œé‚£ä¹ˆç›´æ¥é‡‡ç”¨å…³ç³»å‹æ•°æ®åº“å°±å¥½ï¼Œæ²¡å¿…è¦å†æµªè´¹èµ„æºæ¥éƒ¨ç½²åˆ†å¸ƒå¼æ•°æ®åº“ã€‚</p>
<p>**<font color=red>AP wihtout C</font>ï¼š**è¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚å…¸å‹çš„åº”ç”¨å°±å¦‚æŸç±³çš„æŠ¢è´­æ‰‹æœºåœºæ™¯ï¼Œå¯èƒ½å‰å‡ ç§’ä½ æµè§ˆå•†å“çš„æ—¶å€™é¡µé¢æç¤ºæ˜¯æœ‰åº“å­˜çš„ï¼Œå½“ä½ é€‰æ‹©å®Œå•†å“å‡†å¤‡ä¸‹å•çš„æ—¶å€™ï¼Œç³»ç»Ÿæç¤ºä½ ä¸‹å•å¤±è´¥ï¼Œå•†å“å·²å”®å®Œã€‚è¿™å…¶å®å°±æ˜¯å…ˆåœ¨ Aï¼ˆå¯ç”¨æ€§ï¼‰æ–¹é¢ä¿è¯ç³»ç»Ÿå¯ä»¥æ­£å¸¸çš„æœåŠ¡ï¼Œç„¶ååœ¨æ•°æ®çš„ä¸€è‡´æ€§æ–¹é¢åšäº†äº›ç‰ºç‰²ï¼Œè™½ç„¶å¤šå°‘ä¼šå½±å“ä¸€äº›ç”¨æˆ·ä½“éªŒï¼Œä½†ä¹Ÿä¸è‡³äºé€ æˆç”¨æˆ·è´­ç‰©æµç¨‹çš„ä¸¥é‡é˜»å¡ã€‚</p>
<h1>BASEç†è®º</h1>
<p>BASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’ŒEventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç®€å†™ï¼ŒBASEæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„ç»“è®ºï¼Œæ˜¯åŸºäºCAPå®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ï¼Œ<font color=red>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrong consistencyï¼‰ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual consistencyï¼‰</font></p>
<h2 id="åŸºæœ¬å¯ç”¨">åŸºæœ¬å¯ç”¨</h2>
<p>åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§â€”â€”ä½†è¯·æ³¨æ„ï¼Œè¿™ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ï¼Œä»¥ä¸‹ä¸¤ä¸ªå°±æ˜¯â€œåŸºæœ¬å¯ç”¨â€çš„å…¸å‹ä¾‹å­ã€‚</p>
<ul>
<li>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåœ¨çº¿æœç´¢å¼•æ“éœ€è¦0.5ç§’å†…è¿”å›ç»™ç”¨æˆ·ç›¸åº”çš„æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºå‡ºç°å¼‚å¸¸ï¼ˆæ¯”å¦‚ç³»ç»Ÿéƒ¨åˆ†æœºæˆ¿å‘ç”Ÿæ–­ç”µæˆ–æ–­ç½‘æ•…éšœï¼‰ï¼ŒæŸ¥è¯¢ç»“æœçš„å“åº”æ—¶é—´å¢åŠ åˆ°äº†1~2ç§’ã€‚</li>
<li>åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ä¸Šè¿›è¡Œè´­ç‰©ï¼Œæ¶ˆè´¹è€…å‡ ä¹èƒ½å¤Ÿé¡ºåˆ©åœ°å®Œæˆæ¯ä¸€ç¬”è®¢å•ï¼Œä½†æ˜¯åœ¨ä¸€äº›èŠ‚æ—¥å¤§ä¿ƒè´­ç‰©é«˜å³°çš„æ—¶å€™ï¼Œç”±äºæ¶ˆè´¹è€…çš„è´­ç‰©è¡Œä¸ºæ¿€å¢ï¼Œä¸ºäº†ä¿æŠ¤è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚</li>
</ul>
<p>å¼±çŠ¶æ€ä¹Ÿç§°ä¸ºè½¯çŠ¶æ€ï¼Œå’Œç¡¬çŠ¶æ€ç›¸å¯¹ï¼Œæ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®å¬ä¸çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</p>
<h2 id="æœ€ç»ˆä¸€è‡´æ€§">æœ€ç»ˆä¸€è‡´æ€§</h2>
<p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯<font color=red>ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€</font>ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§</p>
]]></content>
      <categories>
        <category>ZooKeeper</category>
        <category>åˆ†å¸ƒå¼</category>
        <category>CAP</category>
        <category>BASEç†è®º</category>
      </categories>
      <tags>
        <tag>ZooKeeper</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>CAP</tag>
        <tag>BASEç†è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®â€”â€”paxosç®—æ³•</title>
    <url>/posts/fe45d335/</url>
    <content><![CDATA[<h1>paxosç›®çš„</h1>
<p>Paxosç®—æ³•æ˜¯<font color=red>åŸºäºæ¶ˆæ¯ä¼ é€’ä¸”å…·æœ‰é«˜åº¦å®¹é”™ç‰¹æ€§çš„ä¸€è‡´æ€§ç®—æ³•</font>ï¼Œæ˜¯ç›®å‰å…¬è®¤çš„è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜æœ€æœ‰æ•ˆçš„ç®—æ³•ä¹‹ä¸€ï¼Œå…¶<font color=red>è§£å†³çš„é—®é¢˜å°±æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•å°±æŸä¸ªå€¼ï¼ˆå†³è®®ï¼‰è¾¾æˆä¸€è‡´</font>ã€‚</p>
<p>Paxosç®—æ³•çš„å‰æå‡è®¾æ˜¯ä¸å­˜åœ¨æ‹œå åº­å°†å†›é—®é¢˜ï¼Œå³ï¼š <font color=red>ä¿¡é“æ˜¯å®‰å…¨çš„ï¼ˆä¿¡é“å¯é ï¼‰ï¼Œå‘å‡ºçš„ä¿¡å·ä¸ä¼šè¢«ç¯¡æ”¹ï¼Œå› ä¸ºPaxosç®—æ³•æ˜¯åŸºäºæ¶ˆæ¯ä¼ é€’çš„</font>ã€‚ï¼šå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302154508.png" alt="image-20210302154508699"></p>
<h1>paxosç®—æ³•è§’è‰²åˆ’åˆ†ï¼šä¸‰ç§ç±»å‹</h1>
<ul>
<li>
<p>æè®®è€…ï¼ˆProposerï¼‰ï¼šæå‡ºææ¡ˆï¼›</p>
</li>
<li>
<p>æ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šå¯¹ææ¡ˆä½œå‡ºè£å†³ï¼›</p>
</li>
<li>
<p>å‘ŠçŸ¥è€…ï¼ˆLearnerï¼‰ï¼šè¢«å‘ŠçŸ¥æŠ•ç¥¨çš„ç»“æœï¼Œ<strong>ä¸å‚ä¸æŠ•ç¥¨è¿‡ç¨‹</strong>ã€‚</p>
<blockquote>
<p><font color=blue>ææ¡ˆï¼ˆProposalï¼‰</font>ã€‚æœ€ç»ˆè¦è¾¾æˆä¸€è‡´çš„valueå°±åœ¨ææ¡ˆé‡Œã€‚åªè¦Proposerå‘çš„ææ¡ˆè¢«Acceptoræ¥å—ï¼ˆåŠæ•°ä»¥ä¸Šçš„AcceptoråŒæ„æ‰è¡Œï¼‰ï¼ŒProposerå°±è®¤ä¸ºè¯¥ææ¡ˆé‡Œçš„valueè¢«é€‰å®šäº†ã€‚Acceptorå‘Šè¯‰Learnerå“ªä¸ªvalueè¢«é€‰å®šï¼ŒLearnerå°±è®¤ä¸ºé‚£ä¸ªvalueè¢«é€‰å®šã€‚åªè¦Acceptoræ¥å—äº†æŸä¸ªææ¡ˆï¼ŒAcceptorå°±ä»»åŠ¡è¯¥ææ¡ˆé‡Œçš„valueè¢«é€‰å®šäº†ã€‚</p>
</blockquote>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302155514.png" alt="image-20210302155514766"></p>
</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>ï¼šä¸ºäº†é¿å…å•ç‚¹é—®é¢˜ï¼šä¼šæœ‰ä¸€ä¸ªacceptoré›†åˆï¼Œproposerå‘è¯¥é›†åˆå‘é€ææ¡ˆï¼Œacceptoré›†åˆä¸­æ‰€æœ‰æˆå‘˜éƒ½æœ‰å¯èƒ½æ¥å—ææ¡ˆï¼Œå¹¶ä¸”åªèƒ½æ‰¹å‡†ä¸€ä¸ªææ¡ˆï¼Œå½“æœ‰åŠæ•°ä»¥ä¸Šçš„æˆå‘˜åŒæ„ï¼Œé‚£ä¹ˆå°±åŒæ„æ‰¹å‡†è¯¥ææ¡ˆ</p>
<h1>paxosç®—æ³•è¿‡ç¨‹</h1>
<ul>
<li>é˜¶æ®µä¸€ï¼ˆprepareé˜¶æ®µï¼‰ï¼š</li>
</ul>
<p>(a) Proposeré€‰æ‹©ä¸€ä¸ªææ¡ˆç¼–å·Nï¼Œç„¶åå‘åŠæ•°ä»¥ä¸Šçš„Acceptorå‘é€ç¼–å·ä¸ºNçš„Prepareè¯·æ±‚ã€‚Pareperï¼ˆNï¼‰</p>
<p>(b) å¦‚æœä¸€ä¸ªAcceptoræ”¶åˆ°ä¸€ä¸ªç¼–å·ä¸ºNçš„Prepareè¯·æ±‚ï¼Œå¦‚æœå°äºå®ƒå·²ç»å“åº”è¿‡çš„è¯·æ±‚ï¼Œåˆ™æ‹’ç»ï¼Œä¸å›åº”æˆ–å›å¤errorã€‚è‹¥Nå¤§äºè¯¥Acceptorå·²ç»å“åº”è¿‡çš„æ‰€æœ‰Prepareè¯·æ±‚çš„ç¼–å·ï¼ˆmaxNï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå°†å®ƒå·²ç»æ¥å—è¿‡ï¼ˆå·²ç»ç»è¿‡ç¬¬äºŒé˜¶æ®µacceptçš„ææ¡ˆï¼‰çš„ç¼–å·æœ€å¤§çš„ææ¡ˆï¼ˆå¦‚æœæœ‰çš„è¯ï¼Œå¦‚æœè¿˜æ²¡æœ‰çš„acceptææ¡ˆçš„è¯è¿”å›{pokï¼Œnullï¼Œnull}ï¼‰ä½œä¸ºå“åº”åé¦ˆç»™Proposerï¼ŒåŒæ—¶è¯¥Acceptoræ‰¿è¯ºä¸å†æ¥å—ä»»ä½•ç¼–å·å°äºNçš„ææ¡ˆ</p>
<ul>
<li>é˜¶æ®µäºŒï¼ˆaccepté˜¶æ®µï¼‰ï¼š</li>
</ul>
<p>(a) å¦‚æœä¸€ä¸ªProposeræ”¶åˆ°åŠæ•°ä»¥ä¸ŠAcceptorå¯¹å…¶å‘å‡ºçš„ç¼–å·ä¸ºNçš„Prepareè¯·æ±‚çš„å“åº”ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå‘é€ä¸€ä¸ªé’ˆå¯¹[N,V]ææ¡ˆçš„Acceptè¯·æ±‚ç»™åŠæ•°ä»¥ä¸Šçš„Acceptorã€‚æ³¨æ„ï¼šVå°±æ˜¯æ”¶åˆ°çš„å“åº”ä¸­ç¼–å·æœ€å¤§çš„ææ¡ˆçš„valueï¼ˆæŸä¸ªacceptorå“åº”çš„å®ƒå·²ç»é€šè¿‡çš„{acceptNï¼ŒacceptV}ï¼‰ï¼Œå¦‚æœå“åº”ä¸­ä¸åŒ…å«ä»»ä½•ææ¡ˆï¼Œé‚£ä¹ˆVå°±ç”±Proposerè‡ªå·±å†³å®šã€‚</p>
<p>(b) å¦‚æœAcceptoræ”¶åˆ°ä¸€ä¸ªé’ˆå¯¹ç¼–å·ä¸ºNçš„ææ¡ˆçš„Acceptè¯·æ±‚ï¼Œåªè¦è¯¥Acceptoræ²¡æœ‰å¯¹ç¼–å·å¤§äºNçš„Prepareè¯·æ±‚åšå‡ºè¿‡å“åº”ï¼Œå®ƒå°±æ¥å—è¯¥ææ¡ˆã€‚å¦‚æœNå°äºAcceptorä»¥åŠå“åº”çš„prepareè¯·æ±‚ï¼Œåˆ™æ‹’ç»ï¼Œä¸å›åº”æˆ–å›å¤errorï¼ˆå½“proposeræ²¡æœ‰æ”¶åˆ°è¿‡åŠçš„å›åº”ï¼Œé‚£ä¹ˆä»–ä¼šé‡æ–°è¿›å…¥ç¬¬ä¸€é˜¶æ®µï¼Œé€’å¢ææ¡ˆå·ï¼Œé‡æ–°æå‡ºprepareè¯·æ±‚ï¼‰ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302154726.png" alt="image-20210302154726554"></p>
<h1>paxosä¼˜ç¼ºç‚¹</h1>
<p>ä¼˜ç‚¹ï¼špaxosç®—æ³•çš„ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼ŒæŒ‰ç…§æ­¤æ–¹æ³•å¯ä»¥å¯¹å¤šä¸ªæ•°æ®å€¼è¾¾åˆ°ä¸€è‡´ï¼Œæ”¶æ•›è¾ƒå¥½ã€‚</p>
<p>ç¼ºç‚¹ï¼špaxosç®—æ³•çš„ç¼ºç‚¹æ˜¯ä¼šå‡ºç°æ´»é”é—®é¢˜ï¼šè€ƒè™‘åˆ°ä¸€ç§æç«¯çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ä¸ªproposerä¾æ¬¡æå‡ºäº†ä¸€ç³»åˆ—ç¼–å·é€’å¢çš„è®®æ¡ˆï¼Œä½†æ˜¯æœ€ç»ˆpaxosæ— æ³•å½¢æˆæœ€ç»ˆçš„è®®æ¡ˆã€‚å…·ä½“åœºæ™¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302154914.png" alt=""></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302154927.png" alt=""><strong>è§£å†³åŠæ³•</strong>ï¼š</p>
<p>é€šè¿‡<strong>é€‰å–ä¸»Proposer</strong>ï¼Œå°±å¯ä»¥ä¿è¯Paxosç®—æ³•çš„æ´»æ€§ã€‚é€‰æ‹©ä¸€ä¸ªä¸»Proposerï¼Œå¹¶è§„å®šåªæœ‰ä¸»Proposeræ‰èƒ½æå‡ºè®®æ¡ˆã€‚è¿™æ ·ä¸€æ¥ï¼Œ<font color=red>åªè¦ä¸»Proposerå’Œè¿‡åŠçš„Acceptorèƒ½å¤Ÿæ­£å¸¸è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œé‚£ä¹ˆè‚¯å®šä¼šæœ‰ä¸€ä¸ªææ¡ˆè¢«æ‰¹å‡†ï¼ˆç¬¬äºŒé˜¶æ®µçš„acceptï¼‰ï¼Œåˆ™å¯ä»¥è§£å†³æ­»å¾ªç¯å¯¼è‡´çš„æ´»é”é—®é¢˜</font>ã€‚</p>
<h5 id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h5>
<p><strong>é€šè¿‡é€‰æ‹©ä¸€ä¸ªä¸»Proposerï¼Œå¹¶è§„å®šåªèƒ½ç”±ä¸»Proposeræ‰èƒ½æå‡ºè®®æ¡ˆï¼Œæ•´ä¸ªpaxosç®—æ³•å°±å¯ä»¥ä¿æŒæ´»æ€§ã€‚</strong></p>
<h1>Paxosç®—æ³•çš„è¿‡åŠä¾æ®</h1>
<p>åœ¨Paxosç®—æ³•ä¸­ï¼Œé‡‡ç”¨äº†â€œè¿‡åŠâ€ç†å¿µï¼Œä¹Ÿå°±æ˜¯å°‘æ•°æœä»å¤šæ•°ï¼Œè¿™ä½¿Paxosç®—æ³•å…·æœ‰å¾ˆå¥½çš„å®¹é”™æ€§</p>
<h2 id="PaxosåŸºäºçš„è¿‡åŠæ•°å­¦åŸç†">PaxosåŸºäºçš„è¿‡åŠæ•°å­¦åŸç†</h2>
<p>å¤§å¤šæ•°ï¼ˆè¿‡åŠï¼‰è¿›ç¨‹ç»„æˆçš„é›†åˆä¸ºæ³•å®šé›†åˆï¼Œ<font color=red> ä¸¤ä¸ªæ³•å®šï¼ˆè¿‡åŠï¼‰é›†åˆå¿…ç„¶å­˜åœ¨éç©ºäº¤é›†ï¼Œå³è‡³å°‘æœ‰ä¸€ä¸ªå…¬å…±è¿›ç¨‹ï¼Œç§°ä¸ºæ³•å®šé›†åˆæ€§è´¨</font>ã€‚ ä¾‹å¦‚A,B,C,D,Fè¿›ç¨‹ç»„æˆçš„å…¨é›†ï¼Œæ³•å®šé›†åˆQ1åŒ…æ‹¬è¿›ç¨‹A,B,Cï¼ŒQ2åŒ…æ‹¬è¿›ç¨‹B,C,Dï¼Œé‚£ä¹ˆQ1å’ŒQ2çš„äº¤é›†å¿…ç„¶ä¸åœ¨ç©ºï¼ŒCå°±æ˜¯Q1ï¼ŒQ2çš„å…¬å…±è¿›ç¨‹ã€‚å¦‚æœè¦è¯´Paxosæœ€æ ¹æœ¬çš„åŸç†æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆå°±æ˜¯è¿™ä¸ªç®€å•æ€§è´¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š<font color=red>ä¸¤ä¸ªè¿‡åŠçš„é›†åˆå¿…ç„¶å­˜åœ¨äº¤é›†ï¼Œä¹Ÿå°±æ˜¯è‚¯å®šæ˜¯ç›¸ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯è‚¯å®šè¾¾æˆäº†ä¸€è‡´</font>ã€‚</p>
<p>Paxosæ˜¯åŸºäºæ¶ˆæ¯ä¼ é€’çš„å…·æœ‰é«˜åº¦å®¹é”™æ€§çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‚<font color=red>Paxosç®—æ³•å¼•å…¥äº†è¿‡åŠçš„æ¦‚å¿µï¼Œè§£å†³äº†2PCï¼Œ3PCçš„å¤ªè¿‡ä¿å®ˆçš„ç¼ºç‚¹ï¼Œä¸”ä½¿ç®—æ³•å…·æœ‰äº†å¾ˆå¥½çš„å®¹é”™æ€§ï¼Œå¦å¤–Paxosç®—æ³•æ”¯æŒåˆ†å¸ƒå¼èŠ‚ç‚¹è§’è‰²ä¹‹é—´çš„è½®æ¢ï¼Œè¿™æå¤§é¿å…äº†åˆ†å¸ƒå¼å•ç‚¹çš„å‡ºç°ï¼Œå› æ­¤Paxosç®—æ³•æ—¢è§£å†³äº†æ— é™ç­‰å¾…é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†è„‘è£‚é—®é¢˜ï¼Œæ˜¯ç›®å‰æ¥è¯´æœ€ä¼˜ç§€çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‚å…¶ä¸­ï¼ŒZookeeperçš„ZABç®—æ³•å’ŒRaftä¸€è‡´æ€§ç®—æ³•éƒ½æ˜¯åŸºäºPaxosçš„</font></p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ol>
<li><a href="https://www.zhihu.com/question/19787937">å¦‚ä½•æµ…æ˜¾æ˜“æ‡‚åœ°è§£è¯´ Paxos çš„ç®—æ³•ï¼Ÿ</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95">paxosç®—æ³•</a></li>
</ol>
]]></content>
      <categories>
        <category>ZooKeeper</category>
        <category>åˆ†å¸ƒå¼</category>
        <category>panxos</category>
      </categories>
      <tags>
        <tag>ZooKeeper</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>panxos</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeperå®ç°åˆ†å¸ƒå¼é”</title>
    <url>/posts/60085ed9/</url>
    <content><![CDATA[<h2 id="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</h2>
<p>åˆ†å¸ƒå¼é”çš„æ€è·¯æ˜¯æ¯ä¸ªå®¢æˆ·ç«¯éƒ½åœ¨æŸä¸ªç›®å½•ä¸‹æ³¨å†Œä¸€ä¸ªä¸´æ—¶æœ‰åºèŠ‚ç‚¹ï¼Œæ¯æ¬¡æœ€å°çš„èŠ‚ç‚¹ä¼šè·å–é”ï¼Œå½“å‰èŠ‚ç‚¹ä¼šå»ç›‘å¬ä¸Šä¸€ä¸ªè¾ƒå°èŠ‚ç‚¹ï¼Œå¦‚æœè¾ƒå°èŠ‚ç‚¹å¤±æ•ˆä¹‹åï¼Œå°±ä¼šå»è·å–é”ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210320111311.png" alt="image-20210320111311093"></p>
<h3 id="javaåŸç”Ÿzookeeperå®¢æˆ·ç«¯">javaåŸç”Ÿzookeeperå®¢æˆ·ç«¯</h3>
<ol>
<li>
<p>å¼•å…¥jaråŒ…</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ›å»ºZKå®¢æˆ·ç«¯è¿æ¥å•ä¾‹</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.zookeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZookeeperClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">//zké›†ç¾¤åœ°å€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZOOKEEPER_CONNECT=<span class="string">&quot;192.168.232.128:12181,192.168.232.128:12182,192.168.232.128:12183,192.168.232.128:12184&quot;</span>;</span><br><span class="line">    <span class="comment">//è®¡æ•°å™¨ï¼Œç”¨äºç­‰å¾…è¿æ¥æˆåŠŸ</span></span><br><span class="line">    <span class="comment">//CountDownLatchæ˜¯å› ä¸ºè¿æ¥æ—¶ä¼šè€—æ—¶è¾ƒé•¿ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨è¿›è¡Œé˜»å¡ï¼Œå¦åˆ™ä¼šåœ¨connectingé˜¶æ®µå°±è¢«é‡Šæ”¾äº†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIMEOUT = <span class="number">5000</span>;</span><br><span class="line">    <span class="comment">//ç”¨volatileä¿®é¥°å•ä¾‹ï¼Œé˜²æ­¢èµ‹å€¼æ—¶å‘ç”ŸæŒ‡ä»¤é‡æ’</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> ZooKeeper instance;</span><br><span class="line">    <span class="comment">//ç”¨Double checkè·å–å•ä¾‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ZooKeeper <span class="title">getInstance</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span> )&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ZookeeperClient.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//è¿æ¥æ—¶æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œç›‘å¬è¿æ¥çŠ¶æ€å˜åŒ–</span></span><br><span class="line">                    instance = <span class="keyword">new</span> ZooKeeper(ZOOKEEPER_CONNECT, SESSION_TIMEOUT, <span class="keyword">new</span> Watcher() &#123;</span><br><span class="line">                        <span class="comment">//ç›‘å¬å›è°ƒæ–¹æ³•</span></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent watchedEvent)</span> </span>&#123;</span><br><span class="line">                            <span class="comment">//å½“è¿æ¥çŠ¶æ€å˜æˆconnectedï¼Œå°±è¯´æ˜è¿æ¥æˆåŠŸ</span></span><br><span class="line">                            <span class="keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123;</span><br><span class="line">                                countDownLatch.countDown();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">//ç­‰å¾…è¿æ¥æˆåŠŸ</span></span><br><span class="line">                    countDownLatch.await();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SESSION_TIMEOUT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ›å»ºåˆ†å¸ƒå¼é”å®¢æˆ·ç«¯</p>
</li>
</ol>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.zookeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.SortedSet;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DistibutedLock</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ ¹ç›®å½•ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå»æ­¤ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶æœ‰åºå­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment">//éœ€è¦åœ¨zookeeperé›†ç¾¤ä¸­æœ‰æ­¤ç›®å½•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ROOT_PATH = <span class="string">&quot;/apilock&quot;</span>;</span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zookeeper;</span><br><span class="line">    <span class="comment">//sessionè¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> SESSION_TIMEOUT;</span><br><span class="line">    <span class="comment">//å½“å‰å®¢æˆ·ç«¯åˆ›å»ºæœ‰åºèŠ‚ç‚¹çš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String lockId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DistibutedLock</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.zookeeper =ZookeeperClient.getInstance();</span><br><span class="line">        <span class="keyword">this</span>.SESSION_TIMEOUT = ZookeeperClient.getSessionTimeout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºä¸´æ—¶æœ‰åºå­èŠ‚ç‚¹</span></span><br><span class="line">            lockId = zookeeper.create(ROOT_PATH+<span class="string">&quot;/&quot;</span>,<span class="string">&quot;123&quot;</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;åˆ›å»ºèŠ‚ç‚¹&quot;</span>+lockId+<span class="string">&quot;,å¼€å§‹ç«äº‰é”&quot;</span>);</span><br><span class="line">            <span class="comment">//è·å–/lockç›®å½•ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">            List&lt;String&gt; children = zookeeper.getChildren(ROOT_PATH, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//ç”¨SortedSetå¯¹å­èŠ‚ç‚¹ä»å°åˆ°å¤§è¿›è¡Œæ’åº</span></span><br><span class="line">            SortedSet&lt;String&gt; sortedSet = <span class="keyword">new</span> TreeSet&lt;String&gt;();</span><br><span class="line">            <span class="keyword">for</span> (String child : children) &#123;</span><br><span class="line">                sortedSet.add(ROOT_PATH+<span class="string">&quot;/&quot;</span>+child);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–æœ€å°èŠ‚ç‚¹åç§°</span></span><br><span class="line">            String first = sortedSet.first();</span><br><span class="line">            <span class="comment">//å¦‚æœå½“å‰åˆ›å»ºèŠ‚ç‚¹å°±æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œåˆ™è·å–é”</span></span><br><span class="line">            <span class="keyword">if</span> (first.equals(lockId)) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;è·å–é”&quot;</span>+lockId);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–æ¯”å½“å‰idå°çš„èŠ‚ç‚¹é›†åˆ</span></span><br><span class="line">            SortedSet&lt;String&gt; frontSet = sortedSet.headSet(lockId);</span><br><span class="line">            <span class="keyword">if</span> (!frontSet.isEmpty()) &#123;</span><br><span class="line">                <span class="comment">//å–é›†åˆä¸­æœ€åä¸€ä¸ªå…ƒç´ ,ä¹Ÿå°±æ˜¯ä¸´è¿‘æœ€å°èŠ‚ç‚¹</span></span><br><span class="line">                String last = frontSet.last();</span><br><span class="line">                System.out.println(lockId+<span class="string">&quot;ç›‘å¬&quot;</span>+last);</span><br><span class="line">                <span class="comment">//å½“å‰èŠ‚ç‚¹å»ç›‘å¬ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“ä¸Šä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤çš„æ—¶å€™</span></span><br><span class="line">                <span class="comment">//å½“å‰èŠ‚ç‚¹å°±å¯ä»¥è·å–é”</span></span><br><span class="line">                zookeeper.exists(last, <span class="keyword">new</span> Watcher() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent watchedEvent)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDeleted) &#123;</span><br><span class="line">                            countDownLatch.countDown();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                countDownLatch.await(SESSION_TIMEOUT, TimeUnit.MILLISECONDS);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è·å–é”&quot;</span> + lockId);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">unLock</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å¼€å§‹åˆ é™¤é”&quot;</span> + lockId);</span><br><span class="line">            <span class="comment">//åˆ é™¤å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">            zookeeper.delete(lockId, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>
<p>æµ‹è¯•ä»£ç </p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.zookeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJavaApi</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç­‰å¾…å™¨ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œåˆ°æŸä¸ªæ­¥éª¤æ‰åœæ­¢é˜»å¡</span></span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿåä¸ªçº¿ç¨‹å»è·å–é”</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt; &#123;</span><br><span class="line">                DistibutedLock lock = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    lock = <span class="keyword">new</span> DistibutedLock();</span><br><span class="line">                    cyclicBarrier.await();</span><br><span class="line">                    lock.lock();</span><br><span class="line">                    TimeUnit.MILLISECONDS.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">500</span>));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(lock!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                        lock.unLock();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210320113632.png" alt=""></p>
</li>
</ol>
<h3 id="ZKClientå®ç°åˆ†å¸ƒå¼é”">ZKClientå®ç°åˆ†å¸ƒå¼é”</h3>
<ol>
<li>
<p>å¯¼å…¥jar</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ›å»ºZKå®¢æˆ·ç«¯è¿æ¥å•ä¾‹</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKClientInstance</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZOOKEEPER_CONNECT=<span class="string">&quot;192.168.232.128:12181,192.168.232.128:12182,192.168.232.128:12183,192.168.232.128:12184&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> ZkClient instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ZkClient <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ZKClientInstance.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> ZkClient(ZOOKEEPER_CONNECT,<span class="number">5000</span>,</span><br><span class="line">                            <span class="number">5000</span>,<span class="keyword">new</span> SerializableSerializer());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ›å»ºåˆ†å¸ƒå¼é”å®¢æˆ·ç«¯</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.zookeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.I0Itec.zkclient.IZkDataListener;</span><br><span class="line"><span class="keyword">import</span> org.I0Itec.zkclient.ZkClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.SortedSet;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKClientDisLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROOT_PATH = <span class="string">&quot;/apilock&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ZkClient zkClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lockId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ZKClientDisLock</span><span class="params">(ZkClient zkClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.zkClient = zkClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        lockId = zkClient.createEphemeralSequential(ROOT_PATH + <span class="string">&quot;/&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; children = zkClient.getChildren(ROOT_PATH);</span><br><span class="line">        SortedSet&lt;String&gt; sortedSet = <span class="keyword">new</span> TreeSet&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String child : children) &#123;</span><br><span class="line">            sortedSet.add(ROOT_PATH+<span class="string">&quot;/&quot;</span>+child);</span><br><span class="line">        &#125;</span><br><span class="line">        String first = sortedSet.first();</span><br><span class="line">        <span class="keyword">if</span> (first.equals(lockId)) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è·å–é”&quot;</span> + lockId);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SortedSet&lt;String&gt; frontSet = sortedSet.headSet(lockId);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != frontSet &amp;&amp; frontSet.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            String last = frontSet.last();</span><br><span class="line">            IZkDataListener iZkDataListener = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(lockId + <span class="string">&quot;ç›‘å¬&quot;</span> + last + <span class="string">&quot;èŠ‚ç‚¹å˜åŒ–&quot;</span>);</span><br><span class="line">                iZkDataListener = <span class="keyword">new</span> IZkDataListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDataChange</span><span class="params">(String s, Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDataDeleted</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        countDownLatch.countDown();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                zkClient.subscribeDataChanges(last, iZkDataListener);</span><br><span class="line">                countDownLatch.await();</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è·å–é”&quot;</span> + lockId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                zkClient.unsubscribeDataChanges(last,iZkDataListener);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unLock</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;é‡Šæ”¾é”&quot;</span>+ lockId + <span class="string">&quot;-----&quot;</span>);</span><br><span class="line">        zkClient.delete(lockId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.zookeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestZkClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> finalI = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt; &#123;</span><br><span class="line">                ZKClientDisLock lock = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    lock = <span class="keyword">new</span> ZKClientDisLock(ZKClientInstance.getInstance());</span><br><span class="line">                    cyclicBarrier.await();</span><br><span class="line">                    lock.lock();</span><br><span class="line">                    TimeUnit.MILLISECONDS.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">500</span>));</span><br><span class="line">                &#125;  <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(lock!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                        lock.unLock();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>ZooKeeper</category>
        <category>åˆ†å¸ƒå¼</category>
        <category>åˆ†å¸ƒå¼é”</category>
      </categories>
      <tags>
        <tag>ZooKeeper</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…rediså‡ºç°çš„é—®é¢˜</title>
    <url>/posts/5e07a887/</url>
    <content><![CDATA[<p><strong>æ“ä½œç³»ç»Ÿä¸ºcentOs7  redisä¸º6.0.8ç‰ˆæœ¬</strong></p>
<h3 id="1-å½“Makeå‘½ä»¤æç¤ºæ— ccç¯å¢ƒæ—¶éœ€è¦è¿›è¡Œå®‰è£…Gccå®‰è£…åŒ…é‡æ–°å®‰è£…ï¼ŒåŒæ—¶éœ€è¦æ‰§è¡Œmake-distcleanæ¸…ç†ç›¸å…³æ–‡ä»¶ï¼Œå†æ‰§è¡Œmakeå‘½ä»¤">1.å½“Makeå‘½ä»¤æç¤ºæ— ccç¯å¢ƒæ—¶éœ€è¦è¿›è¡Œå®‰è£…Gccå®‰è£…åŒ…é‡æ–°å®‰è£…ï¼ŒåŒæ—¶éœ€è¦æ‰§è¡Œmake distcleanæ¸…ç†ç›¸å…³æ–‡ä»¶ï¼Œå†æ‰§è¡Œmakeå‘½ä»¤</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¸€èˆ¬é”™è¯¯ä¸ºgccå¥—è£…é”™è¯¯</span><br><span class="line">yum install cpp</span><br><span class="line">yum install binutils</span><br><span class="line">yum install glibc</span><br><span class="line">yum install glibc-kernheaders</span><br><span class="line">yum install glibc-common</span><br><span class="line">yum install glibc-devel</span><br><span class="line">yum install gcc</span><br><span class="line">yum install make</span><br><span class="line">&#x2F;&#x2F;æ¸…ç†é”™è¯¯æ–‡ä»¶</span><br><span class="line">make distclean</span><br><span class="line">&#x2F;&#x2F;é‡æ–°å®‰è£…</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/m0_37952284/article/details/109012324">server.c:5307:31: é”™è¯¯:â€˜struct redisServerâ€™æ²¡æœ‰åä¸ºâ€˜server_xxxâ€™çš„æˆå‘˜</a></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113217.png" alt="image-20201103103148896"></p>
<ol start="2">
<li>
<h3 id="ä¸‹è½½äº†redisç‰ˆæœ¬6-0-6ï¼Œæ­£å¸¸è§£å‹ï¼ŒCentosç”¨çš„7-6ï¼Œmakeå®‰è£…æ—¶æŠ¥é”™">ä¸‹è½½äº†redisç‰ˆæœ¬6.0.6ï¼Œæ­£å¸¸è§£å‹ï¼ŒCentosç”¨çš„7.6ï¼Œmakeå®‰è£…æ—¶æŠ¥é”™:</h3>
</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113232.png" alt="image-20201103104749570"></p>
<p>åŸå› æ˜¯rediesç”¨äº†cè¯­è¨€ç¼–å†™ï¼Œcentos7.6åº”è¯¥ä¹Ÿæœ‰ä»¥ä¸‹ç‰ˆæœ¬ï¼Œé»˜è®¤å®‰è£…çš„gcc4.8.5ç‰ˆæœ¬è¾ƒä½ï¼Œéœ€è¦åœ¨5.3ä»¥ä¸Šç‰ˆæœ¬ï¼Œç°æ›´æ¢ä¸º9.3ï¼Œå…ˆæŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -v</span><br></pre></td></tr></table></figure>
<p>å¼€å§‹æ›´æ¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install centos-release-scl</span><br><span class="line">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br><span class="line">echo &quot;source &#x2F;opt&#x2F;rh&#x2F;devtoolset-9&#x2F;enable&quot; &gt;&gt;&#x2F;etc&#x2F;profile</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>é‡è¿shell</strong>(ä¸é‡è¿gccç‰ˆæœ¬ä¸å˜)ï¼Œé‡æ–°makeï¼Œå³æˆåŠŸäº†</p>
<h3 id="3-å®‰è£…Redis-6-0-6-install-server-shæŠ¥é”™">3.å®‰è£…Redis 6.0.6 ./install_server.shæŠ¥é”™</h3>
<p>äº§ç”ŸåŸå› :gcc9ç‰ˆæœ¬æ ¡éªŒæ›´åŠ ä¸¥æ ¼å¯¼è‡´</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113249.png" alt="image-20201103111330639"></p>
<p>è§£å†³æ–¹æ¡ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi .&#x2F;install_server.sh</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113254.png" alt="image-20201103111506170"></p>
<p><strong>æ³¨é‡Šæ‰ä»£ç </strong>é‡æ–°è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#bail if this system is managed by systemd</span><br><span class="line">#_pid_1_exe&#x3D;&quot;$(readlink -f &#x2F;proc&#x2F;1&#x2F;exe)&quot;</span><br><span class="line">#if [ &quot;$&#123;_pid_1_exe##*&#x2F;&#125;&quot; &#x3D; systemd ]</span><br><span class="line">#then</span><br><span class="line">#       echo &quot;This systems seems to use systemd.&quot;</span><br><span class="line">#       echo &quot;Please take a look at the provided example service unit files in this directory, and adapt and install them. Sorry!&quot;</span><br><span class="line">#       exit 1</span><br><span class="line">#fi</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>centoså®‰è£…redis</title>
    <url>/posts/725846d4/</url>
    <content><![CDATA[<p><strong>æ“ä½œç³»ç»Ÿä¸ºcentOS7  redisä¸º6.0.8ç‰ˆæœ¬</strong></p>
<ol>
<li>
<p>å®‰è£…wgetå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install wget</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223112933.png" alt="image-20201026172631943"></p>
</li>
<li>
<p>å®‰è£…GCCåŒ…ï¼ˆredisæ˜¯cè¯­è¨€ç¼–å†™ï¼Œliunxéœ€è¦å®‰è£…ç›¸å…³è½¯ä»¶ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install gcc</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223112947.png" alt="image-20201026172608587"></p>
</li>
<li>
<p>åœ¨æŒ‡å®šç›®å½•è·å–å®‰è£…åŒ…ï¼ˆæˆ–è€…ä¸‹è½½ä¹‹åç§»åŠ¨åˆ°æŒ‡å®šç›®å½•  ï¼‰</p>
<p><a href="https://redis.io/download%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%85%B3%E7%89%88%E6%9C%AC%E8%BF%9E%E6%8E%A5%EF%BC%8C%E8%BF%99%E9%87%8C%E4%B8%8B%E8%BD%BD6.0%E7%89%88%E6%9C%AC">https://redis.io/downloadè·å–ç›¸å…³ç‰ˆæœ¬è¿æ¥ï¼Œè¿™é‡Œä¸‹è½½6.0ç‰ˆæœ¬</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-6.0.8.tar.gz</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113024.png" alt="image-20201026172901823"></p>
</li>
<li>
<p>è§£å‹gzåŒ…ï¼ˆä¸‹è½½çš„æ˜¯æºç ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar xf redis-6.0.8.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ ¹æ®è§£å‹åŒ…ä¸­æ–‡ä»¶çš„REDME.mdæ–‡æ¡£è¿›è¡Œç›¸å…³æ“ä½œï¼ˆé‡è¦ï¼šå®‰è£…å…¶ä»–è½¯ä»¶åŒç†ï¼‰</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113031.png" alt="image-20201103102727621"></p>
</li>
<li>
<p>ä½¿ç”¨makeç›¸å…³å‘½ä»¤è¿›è¡Œå®‰è£…ç¨‹åº</p>
</li>
<li>
<p>å®‰è£…å¯æ‰§è¡Œåˆ°æŒ‡å®šç›®å½•ï¼ˆåˆ†ç¦»æºç ï¼‰</p>
<p>æŸ¥çœ‹/home/redis-6.0.8/INSTALLï¼Œæ ¹æ®æ–‡æ¡£å®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">make install PREFIX&#x3D;&#x2F;home&#x2F;redis6</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ³¨å†Œredisä¸ºæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‰§è¡Œvi &#x2F;etc&#x2F;profileå‘½ä»¤ï¼Œåœ¨æ–‡ä»¶æœ€åæ–°å¢å†…å®¹</span><br><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line">&#x2F;&#x2F;REDIS_HOMEçš„è·¯å¾„ä¸ºç¬¬ä¸ƒæ­¥çš„å®‰è£…è·¯å¾„</span><br><span class="line">export REDIS_HOME&#x3D;&#x2F;home&#x2F;redis6</span><br><span class="line">export PATH&#x3D;$PATH:$REDIS_HOME&#x2F;bin</span><br><span class="line">&#x2F;&#x2F;ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line">&#x2F;&#x2F;éªŒè¯æ˜¯å¦æ·»åŠ æˆåŠŸ</span><br><span class="line">echo $PATH</span><br><span class="line">&#x2F;&#x2F;æ‰§è¡Œ</span><br><span class="line">&#x2F;home&#x2F;redis-6.0.8&#x2F;utils&#x2F;install_server.shè„šæœ¬æ³¨å†Œä¸ºæœåŠ¡</span><br><span class="line">.&#x2F;install_server.sh</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113126.png" alt="image-20201103103148896"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113145.png" alt="image-20201103112714896"></p>
<ol start="9">
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®‰è£…éœ€æ±‚ä¿®æ”¹ç›¸å…³é…ç½®</li>
</ol>
<p>rediså¸¸è§é…ç½®å‚è§https://blog.csdn.net/suprezheng/article/details/90679790</p>
<ol start="10">
<li>å°†redis_6379(æ ¹æ®ç”Ÿæˆçš„é…ç½®æ–‡ä»¶åç§°)è®¾ç½®ä¸ºå¼€å¯</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;etc&#x2F;init.d</span><br><span class="line">  #init.dæ²¡æœ‰redis_6379æ–‡ä»¶çš„å¯ä»¥åœ¨æºæ–‡ä»¶ä¸­æ‰¾åˆ°redis.confæ–‡ä»¶è¿›è¡Œä¿®æ”¹</span><br><span class="line">  chkconfig --add redis_6379</span><br><span class="line">  chkconfig redis_6379 on</span><br><span class="line">  #æŸ¥çœ‹å¼€æœºè‡ªå¯çš„åˆ—è¡¨</span><br><span class="line">  chkconfig --list</span><br><span class="line">  #é‡å¯redis</span><br><span class="line">  service redis_6379 restart</span><br><span class="line">  #æ‰‹åŠ¨å¯ç”¨</span><br><span class="line">  redis-server &#x2F;etc&#x2F;redis&#x2F;6379.conf</span><br><span class="line">  chkconfig --listçš„å‚æ•°æ„ä¹‰</span><br><span class="line">  1è¡¨ç¤ºï¼šå•ç”¨æˆ·æ¨¡å¼</span><br><span class="line">  2è¡¨ç¤ºï¼šæ— ç½‘ç»œè¿æ¥çš„å¤šç”¨æˆ·å‘½ä»¤è¡Œæ¨¡å¼</span><br><span class="line">  3è¡¨ç¤ºï¼šæœ‰ç½‘ç»œè¿æ¥çš„å¤šç”¨æˆ·å‘½ä»¤è¡Œæ¨¡å¼</span><br><span class="line">  4è¡¨ç¤ºï¼šä¸å¯ç”¨</span><br><span class="line">  5è¡¨ç¤ºï¼šå¸¦å›¾å½¢ç•Œé¢çš„å¤šç”¨æˆ·æ¨¡å¼</span><br><span class="line">  6è¡¨ç¤ºï¼šé‡æ–°å¯åŠ¨</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>rediså…¥é—¨</title>
    <url>/posts/eca8b4a8/</url>
    <content><![CDATA[<h4 id="1-redisç›¸å…³ä»‹ç»">1.redisç›¸å…³ä»‹ç»</h4>
<p><a href="http://redis.cn/">redisä¸­æ–‡ç½‘</a></p>
<h5 id="1-1-redisçš„ä»‹ç»">1.1 redisçš„ä»‹ç»</h5>
<p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚ å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ <a href="http://redis.cn/topics/data-types-intro.html#strings">å­—ç¬¦ä¸²ï¼ˆstringsï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#hashes">æ•£åˆ—ï¼ˆhashesï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#lists">åˆ—è¡¨ï¼ˆlistsï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#sets">é›†åˆï¼ˆsetsï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#sorted-sets">æœ‰åºé›†åˆï¼ˆsorted setsï¼‰</a> ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> å’Œ <a href="http://redis.cn/commands/geoadd.html">åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰</a> ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚ Redis å†…ç½®äº† <a href="http://redis.cn/topics/replication.html">å¤åˆ¶ï¼ˆreplicationï¼‰</a>ï¼Œ<a href="http://redis.cn/commands/eval.html">LUAè„šæœ¬ï¼ˆLua scriptingï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/lru-cache.html">LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰</a>ï¼Œ<a href="http://redis.cn/topics/transactions.html">äº‹åŠ¡ï¼ˆtransactionsï¼‰</a> å’Œä¸åŒçº§åˆ«çš„ <a href="http://redis.cn/topics/persistence.html">ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰</a>ï¼Œ å¹¶é€šè¿‡ <a href="http://redis.cn/topics/sentinel.html">Rediså“¨å…µï¼ˆSentinelï¼‰</a>å’Œè‡ªåŠ¨ <a href="http://redis.cn/topics/cluster-tutorial.html">åˆ†åŒºï¼ˆClusterï¼‰</a>æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113311.png" alt="image-20210211203040301"></p>
<h5 id="1-2-rediså’Œmemcachedçš„åŒºåˆ«">1.2  .rediså’Œmemcachedçš„åŒºåˆ«</h5>
<p>rediså’Œmemcachedç›¸æ¯”æœ¬è´¨æ˜¯è§£è€¦ï¼Œç”¨å¤§æ•°æ®è¯´æ³•æ˜¯è®¡ç®—å‘æ•°æ®ç§»åŠ¨</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113409.png" alt="image-20210218095611832"></p>
<h5 id="1-3-liunxä¸‹å¸¸è§çš„rediså‘½ä»¤">1.3 . liunxä¸‹å¸¸è§çš„rediså‘½ä»¤</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#è¿æ¥redis</span><br><span class="line">redis-cli</span><br><span class="line">#è¿æ¥redisæ˜¯6379ç«¯å£çš„8å·åº“ æŒ‡å®šåº“(ä¸åŒåº“æ•°æ®ä¸å¯è§)</span><br><span class="line">redis-cli -p 6379 -n 8</span><br><span class="line">#è¿æ¥redisåä½¿ç”¨helpè¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">help </span><br></pre></td></tr></table></figure>
<h4 id="2-redisç›¸å…³æ•°æ®çš„æ“ä½œå¸¸è§å‘½ä»¤">2.redisç›¸å…³æ•°æ®çš„æ“ä½œå¸¸è§å‘½ä»¤</h4>
<p>åœ¨rediså®¢æˆ·ç«¯ä¸­ä½¿ç”¨helpå‘½ä»¤è¿›è¡Œç›¸å…³æŸ¥è¯¢ç›¸å…³å‘½ä»¤</p>
<h5 id="2-1-Stringsç±»å‹">2.1 Stringsç±»å‹</h5>
<p><a href="https://redis.io/commands#string">Strings æ•°æ®æ“ä½œç›¸å…³æ–‡æ¡£</a></p>
<h6 id="2-1-1-æŸ¥çœ‹stringç±»å‹å¸®åŠ©å‘½ä»¤">2.1.1 æŸ¥çœ‹stringç±»å‹å¸®åŠ©å‘½ä»¤</h6>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">help @string</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113419.png" alt="image-20210219155031906"></p>
<h6 id="2-1-2-stringæ•°æ®ç±»å‹åŠç›¸å…³çš„åº”ç”¨åœºæ™¯">2.1.2  stringæ•°æ®ç±»å‹åŠç›¸å…³çš„åº”ç”¨åœºæ™¯</h6>
<ol>
<li>å­—ç¬¦ä¸²</li>
</ol>
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#setè®¾ç½®keyçš„value</span><br><span class="line">set k1 ooxx nx  ï¼ˆå¸¦nxï¼Œxxå¯ç”¨åœ¨åˆ†å¸ƒå¼é”ä¸­ï¼‰</span><br><span class="line">set k1 ooxx xx</span><br><span class="line">#msetæ‰¹é‡è®¾ç½®</span><br><span class="line">mset k3 k3mest k4 k4mest</span><br><span class="line">#getè·å–keyçš„value</span><br><span class="line">get k1</span><br><span class="line">#mgetæ‰¹é‡è·å–</span><br><span class="line">mget k3 k4</span><br><span class="line">#APPENDåœ¨å­—ç¬¦ä¸²åé¢è¿½åŠ </span><br><span class="line">append k1 &quot; world&quot;</span><br><span class="line">#GETRANGEè·å–æŒ‡å®šèŒƒå›´æ•°æ®</span><br><span class="line">getrange k1 5 10</span><br><span class="line">#strlenè·å–å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">strlen k1</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113426.png" alt="image-20210219155108071"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113517.png" alt="image-20210219160021217"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113555.png" alt="image-20210219160343269"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113600.png" alt="image-20210219160751857"></p>
<ol start="2">
<li>æ•°å€¼</li>
</ol>
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">incr  å°†valueçš„æ•´æ•°å‹+1</span><br><span class="line">incrby å°†valueçš„æ•´æ•°å‹åŠ æŒ‡å®šæ•°</span><br><span class="line">decr </span><br><span class="line">descby</span><br></pre></td></tr></table></figure>
<p><strong>åº”ç”¨åœºæ™¯</strong> ï¼š æŠ¢è´­ï¼Œç§’æ€ï¼Œè¯¦æƒ…é¡µï¼Œç‚¹èµï¼Œè¯„è®ºè§„é¿å¹¶å‘ä¸‹ï¼Œå¯¹æ•°æ®åº“çš„äº‹åŠ¡æ“ä½œå®Œå…¨ç”±rediså†…å­˜æ“ä½œä»£æ›¿ï¼Œé¿å…å› æ•°æ®åº“äº‹åŠ¡å¯¼è‡´å“åº”æ—¶é—´è¶…æ—¶ï¼Œ<strong>ä½†åœ¨é“¶è¡Œç­‰é‡‘èæ¶‰åŠé‡‘é¢ä¸è¦æ”¾åœ¨redisä¸­è¿›è¡Œç›¸å…³è®¡ç®—</strong></p>
<ol start="3">
<li>
<p>bitmap</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setbit  &#x2F;&#x2F;è®¾ç½®bitæ•°å€¼</span><br><span class="line">bitcount  </span><br><span class="line">bitpos</span><br><span class="line">bitop</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>åº”ç”¨åœºæ™¯</strong> ï¼š</p>
<pre><code>1. ç»Ÿè®¡ç”¨æˆ·ç™»é™†å¤©æ•°

	æ–¹æ¡ˆï¼šç”¨æˆ·idä¸ºkeyï¼Œè®¾è®¡é•¿åº¦ä¸º9bitçš„æ•°æ®å³å¯å­˜å‚¨ç”¨æˆ·å½“å¹´æ‰€æœ‰ç™»é™†å¤©æ•°æ•°æ®ï¼Œå½“å¤©ç™»é™†ä¸º1ï¼Œå³å¯ç»Ÿè®¡æŒ‡å®šæ—¶é—´æ®µçš„ç›¸å…³æ•°æ®

2. ç»Ÿè®¡å½“å¤©æ‰€æœ‰ç”¨æˆ·ç™»é™†æƒ…å†µ

	æ–¹æ¡ˆï¼šæ—¥æœŸä¸ºKeyï¼Œè®¾è®¡ä¸€ä¸ªåˆé€‚é•¿åº¦çš„æ•°æ®å­˜å‚¨ï¼Œæ¯ä¸€ä½å¯¹åº”ä¸€ä½å®¢æˆ·ï¼Œç™»é™†åˆ™ä¸º1ï¼Œç»Ÿè®¡æ—¶ç›´æ¥è¿›è¡ŒäºŒè¿›åˆ¶ä¸è¿ç®—ï¼Œåˆ™å¯ä»¥å»é‡ï¼Œç»Ÿè®¡é‚£äº›ç”¨æˆ·ç™»é™†
</code></pre>
<h5 id="2-2-Listsç±»å‹">2.2  Listsç±»å‹</h5>
<h6 id="2-2-1-Listså¸¸è§å‘½ä»¤">2.2.1 Listså¸¸è§å‘½ä»¤</h6>
<p><a href="https://redis.io/commands#list">Listsæ•°æ®ç›¸å…³æ“ä½œå‘½ä»¤</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#lpush å­˜æ”¾é¡ºåºä¸ºf e d c b a</span><br><span class="line">lpush k1 a b c d e f</span><br><span class="line">#rpush å­˜æ”¾é¡ºåºä¸ºa b c d e f</span><br><span class="line">rpush k2 a b c d e f</span><br><span class="line">#å–æ•°æ® lpop</span><br><span class="line">lpop k1 </span><br><span class="line">#lrangeæŒ‰ç…§èŒƒå›´å–</span><br><span class="line">lrange k1 0 -1ï¼ˆå–å…¨éƒ¨ï¼‰</span><br><span class="line">#lindex</span><br><span class="line">#lset</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113620.png" alt="image-20210219205233457"></p>
<h6 id="2-2-2åº”ç”¨åœºæ™¯">2.2.2åº”ç”¨åœºæ™¯</h6>
<ol>
<li>ä½¿ç”¨lpushæ¨¡æ‹Ÿæ ˆï¼Œåè¿›å…ˆå‡º</li>
<li>ä½¿ç”¨rpushæ¨¡æ‹Ÿé˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºï¼ˆä¹°ç¥¨æ’é˜Ÿé—®é¢˜ï¼‰</li>
<li>lindexæ¨¡æ‹Ÿæ•°ç»„ï¼Œç›´æ¥æ ¹æ®ä¸‹æ ‡å–ç›¸å…³æ•°æ®</li>
<li>blpopæ¨¡æ‹Ÿé˜»å¡å•æ’­é˜Ÿåˆ—ï¼ˆblpopä¼šè®©å¯¹åº”keyæœ‰åˆ™å¼¹å‡ºvalueï¼Œæ²¡æœ‰ä¼šé˜»å¡ç­‰å¾…keyæœ‰å€¼ï¼Œå¹¶ä¸”åªä¼šå¼¹å‡ºä¸€æ¬¡ï¼Œå½“å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å¯¹ä¸€ä¸ªkeyä½¿ç”¨blpopåˆ™å¯ä»¥å®ç°é˜»å¡å•æ’­ï¼‰</li>
</ol>
<h5 id="2-3-hashesç±»å‹">2.3 hashesç±»å‹</h5>
<p>ç±»ä¼¼javaä¸­çš„hashmapï¼ˆkeyï¼Œhashmapï¼ˆkeyï¼Œvalueï¼‰ï¼‰ã€‚è¿™é‡Œé¢ç¬¬ä¸€ä¸ªkeyæ˜¯hashesçš„keyï¼Œhashmapï¼ˆkeyï¼Œvalueï¼‰æ‰æ˜¯value</p>
<h6 id="2-3-1-hasheså¸¸è§å‘½ä»¤">2.3.1 hasheså¸¸è§å‘½ä»¤</h6>
<p><a href="https://redis.io/commands#hash">hasheså¸¸è§çš„å‘½ä»¤</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hdel</span><br><span class="line">hget</span><br><span class="line">hset</span><br><span class="line">hlen</span><br><span class="line">hincrbyfloat</span><br></pre></td></tr></table></figure>
<h6 id="2-3-2-åº”ç”¨åœºæ™¯ï¼š">2.3.2 åº”ç”¨åœºæ™¯ï¼š</h6>
<ol>
<li>å¯¹å‘˜å·¥è–ªæ°´è¿›è¡Œç»Ÿè®¡</li>
</ol>
<h5 id="2-4-setsæ•°æ®ç±»å‹">2.4 setsæ•°æ®ç±»å‹</h5>
<p>Redis Set æ˜¯ String çš„æ— åºæ’åˆ—ã€‚<code>SADD</code> æŒ‡ä»¤æŠŠæ–°çš„å…ƒç´ æ·»åŠ åˆ° set ä¸­ã€‚å¯¹ set ä¹Ÿå¯åšä¸€äº›å…¶ä»–çš„æ“ä½œï¼Œæ¯”å¦‚æµ‹è¯•ä¸€ä¸ªç»™å®šçš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå¯¹ä¸åŒ set å–äº¤é›†ï¼Œå¹¶é›†æˆ–å·®ï¼Œç­‰ç­‰ã€‚</p>
<h6 id="2-4-1å¸¸è§å‘½ä»¤">2.4.1å¸¸è§å‘½ä»¤</h6>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sadd &#x2F;&#x2F;æ·»åŠ å…ƒç´ </span><br><span class="line">sadd myset 1 2 3</span><br><span class="line">smembers &#x2F;&#x2F;è¯»å–é›†åˆå…ƒç´ </span><br><span class="line">smembers myset</span><br><span class="line">sismember &#x2F;&#x2F;åˆ¤æ–­å…ƒç´ å­˜åœ¨</span><br><span class="line">sismember myset 3 &#x2F;&#x2F;å­˜åœ¨è¿”å›1ï¼Œä¸å­˜åœ¨ä¸º0</span><br><span class="line"> SINTER  &#x2F;&#x2F;è·å–å¤šä¸ªé›†åˆçš„äº¤é›†</span><br><span class="line"> SUNIONSTORE  &#x2F;&#x2F;å¤šä¸ªé›†åˆå–å¹¶é›†</span><br></pre></td></tr></table></figure>
<h6 id="2-4-2-åº”ç”¨åœºæ™¯">2.4.2 åº”ç”¨åœºæ™¯</h6>
<ol>
<li>
<p>å…¬å¹³æŠ½å¥–(éšæœºäº‹ä»¶) ï¼š  SRANDMEMBER key countï¼ˆç”¨æˆ·ä½œä¸ºvalueï¼‰</p>
<p>â€‹						æ­£æ•°ï¼šå–å‡ºä¸€ä¸ªå»é‡çš„ç»“æœé›†ï¼ˆä¸èƒ½è¶…è¿‡å·²æœ‰é›†ï¼‰</p>
<p>â€‹						è´Ÿæ•°ï¼šå–å‡ºä¸€ä¸ªå¸¦é‡å¤çš„ç»“æœé›†ï¼Œä¸€å®šæ»¡è¶³ä½ è¦çš„æ•°é‡å¦‚æœï¼š</p>
<p>â€‹						0ï¼Œä¸è¿”å›</p>
</li>
</ol>
<h5 id="2-5-sorted-setsæ•°æ®ç±»å‹">2.5 sorted setsæ•°æ®ç±»å‹</h5>
<h6 id="2-5-1-å¸¸è§å‘½ä»¤">2.5.1 å¸¸è§å‘½ä»¤</h6>
<p><a href="https://redis.io/commands#sorted_set">sorted setså¸¸è§å‘½ä»¤</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zadd</span><br><span class="line">zmenmber</span><br><span class="line">zinter</span><br><span class="line">zscore &#x2F;&#x2F;æŒ‰ç…§ä»€ä¹ˆæ’åº</span><br></pre></td></tr></table></figure>
<h6 id="2-5-2-æ’åºåº•å±‚å®ç°">2.5.2 æ’åºåº•å±‚å®ç°</h6>
<p>é€šè¿‡Skip listï¼ˆè·³è·ƒè¡¨ï¼‰å®ç°å¢åˆ æŸ¥æ”¹</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113634.png" alt="image-20210220102659707"></p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>rediså¿«çš„åŸå› </title>
    <url>/posts/400dad18/</url>
    <content><![CDATA[<h1>Liunxçš„IO</h1>
<h1>BIO</h1>
<p>åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingï¼Œä¸€ä¸ªå…¸å‹çš„è¯»æ“ä½œæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ã€‚å¯¹äºnetwork ioæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ï¼ˆæ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚<br>
æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303092341.png" alt="image-20210303092341779"></p>
<h1>non-blocking IO</h1>
<p>linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303093047.png" alt="image-20210303093047688"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303092823.png" alt="image-20210303092823060"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚<br>
æ‰€ä»¥ï¼Œç”¨æˆ·è¿›ç¨‹å…¶å®æ˜¯éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚</p>
<h1>å¤šè·¯å¤ç”¨NIO</h1>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303093109.png" alt="image-20210303093109692"></p>
<h3 id="Liunxçš„IOæ¼”å˜">Liunxçš„IOæ¼”å˜</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303093222.png" alt="image-20210303093222430"></p>
<h1>Redisä¸­IO</h1>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303102906.png" alt="image-20210303102906808"></p>
]]></content>
      <categories>
        <category>Redis</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>redisçš„æ¶ˆæ¯è®¢é˜…ï¼Œpipelineï¼Œäº‹åŠ¡</title>
    <url>/posts/d09e787/</url>
    <content><![CDATA[<h5 id="1-Redis-ç®¡é“ï¼ˆPipeliningï¼‰">1.Redis ç®¡é“ï¼ˆPipeliningï¼‰</h5>
<p><a href="http://redis.cn/topics/pipelining.html">Redis ç®¡é“ï¼ˆPipeliningï¼‰</a></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113641.png" alt="image-20210220103817162"></p>
<p>ä¸€æ¬¡è¯·æ±‚/å“åº”æœåŠ¡å™¨èƒ½å®ç°å¤„ç†æ–°çš„è¯·æ±‚å³ä½¿æ—§çš„è¯·æ±‚è¿˜æœªè¢«å“åº”ã€‚è¿™æ ·å°±å¯ä»¥å°†<em>å¤šä¸ªå‘½ä»¤</em>å‘é€åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…å›å¤ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­¥éª¤ä¸­è¯»å–è¯¥ç­”å¤ã€‚</p>
<p><strong>é‡è¦è¯´æ˜</strong>: ä½¿ç”¨ç®¡é“å‘é€å‘½ä»¤æ—¶ï¼ŒæœåŠ¡å™¨å°†è¢«è¿«å›å¤ä¸€ä¸ªé˜Ÿåˆ—ç­”å¤ï¼Œå ç”¨å¾ˆå¤šå†…å­˜ã€‚å¦‚æœéœ€è¦å‘é€å¤§é‡çš„å‘½ä»¤ï¼Œæœ€å¥½æ˜¯æŒ‰ç…§åˆç†æ•°é‡åˆ†æ‰¹æ¬¡çš„å¤„ç†ï¼Œä¾‹å¦‚10Kçš„å‘½ä»¤ï¼Œè¯»å›å¤ï¼Œç„¶åå†å‘é€å¦ä¸€ä¸ª10kçš„å‘½ä»¤ï¼Œç­‰ç­‰ã€‚è¿™æ ·é€Ÿåº¦å‡ ä¹æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯åœ¨å›å¤è¿™10kå‘½ä»¤é˜Ÿåˆ—éœ€è¦éå¸¸å¤§é‡çš„å†…å­˜ç”¨æ¥ç»„ç»‡è¿”å›æ•°æ®å†…å®¹ã€‚</p>
<h5 id="2-redisçš„æ¶ˆæ¯è®¢é˜…">2. redisçš„æ¶ˆæ¯è®¢é˜…</h5>
<p><a href="http://redis.cn/topics/pubsub.html">redisçš„æ¶ˆæ¯è®¢é˜…</a></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303110111.png" alt="rediså‘å¸ƒè®¢é˜…è¿‡ç¨‹"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUBLISH  &#x2F;&#x2F;å‘å¸ƒæ¶ˆæ¯</span><br><span class="line">SUBSCRIBE foo bar</span><br><span class="line">SUBSCRIBE  &#x2F;&#x2F;æ¥æ”¶æŒ‡å®šé˜Ÿåˆ—æ¶ˆæ¯</span><br><span class="line">SUBSCRIBE foo</span><br></pre></td></tr></table></figure>
<h5 id="3-redisçš„äº‹åŠ¡">3. redisçš„äº‹åŠ¡</h5>
<p><a href="http://redis.cn/topics/transactions.html">redisçš„äº‹åŠ¡</a></p>
<p><a href="http://redis.cn/commands/multi.html">MULTI</a> ã€ <a href="http://redis.cn/commands/exec.html">EXEC</a> ã€ <a href="http://redis.cn/commands/discard.html">DISCARD</a> å’Œ <a href="http://redis.cn/commands/watch.html">WATCH</a> æ˜¯ Redis äº‹åŠ¡ç›¸å…³çš„å‘½ä»¤ã€‚äº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œ å¹¶ä¸”å¸¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªé‡è¦çš„ä¿è¯ï¼š</p>
<ul>
<li>äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li>
<li>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚</li>
</ul>
<p><a href="http://redis.cn/commands/exec.html">EXEC</a> å‘½ä»¤è´Ÿè´£è§¦å‘å¹¶æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼š</p>
<ul>
<li>
<p>å¦‚æœå®¢æˆ·ç«¯åœ¨ä½¿ç”¨ <a href="http://redis.cn/commands/multi.html">MULTI</a> å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ä¹‹åï¼Œå´å› ä¸ºæ–­çº¿è€Œæ²¡æœ‰æˆåŠŸæ‰§è¡Œ <a href="http://redis.cn/commands/exec.html">EXEC</a> ï¼Œé‚£ä¹ˆäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
</li>
<li>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå®¢æˆ·ç«¯æˆåŠŸåœ¨å¼€å¯äº‹åŠ¡ä¹‹åæ‰§è¡Œ <a href="http://redis.cn/commands/exec.html">EXEC</a> ï¼Œé‚£ä¹ˆäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æ‰§è¡Œ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303101618.png" alt=""></p>
<blockquote>
<p>å¼€å¯äº‹åŠ¡ï¼Œä¿®æ”¹k2 çš„å€¼ï¼Œä½†æ˜¯<font  color=red>æ²¡æœ‰è¿›è¡Œäº‹åŠ¡çš„æäº¤ï¼Œå¯¼è‡´ä¿®æ”¹ä¸æˆåŠŸ</font></p>
</blockquote>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303102359.png" alt="image-20210303102359486"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303102525.png" alt=""></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303102720.png" alt=""></p>
<blockquote>
<p>ç”±äºredisæ˜¯å•çº¿ç¨‹ï¼Œå½“<font  color=red>2çš„äº‹åŠ¡(exec)å…ˆåˆ°è¾¾ï¼Œåˆ™å…ˆå›æ‰§è¡Œ2çš„äº‹åŠ¡ï¼Œåˆ™äº‹åŠ¡1æ— æ³•è·å–åˆ°k1çš„å€¼</font></p>
<p>å½“<font  color=red>1çš„äº‹åŠ¡(exec)å…ˆåˆ°è¾¾ï¼Œåˆ™å…ˆå›æ‰§è¡Œ1çš„äº‹åŠ¡ï¼Œåˆ™äº‹åŠ¡1èƒ½è·å–åˆ°k1çš„å€¼</font></p>
</blockquote>
</li>
</ul>
<blockquote>
<p><code> AOF æ–¹å¼åšæŒä¹…åŒ–</code>çš„æ—¶å€™ï¼ŒRedis ä¼šä½¿ç”¨å•ä¸ª write(2) å‘½ä»¤å°†äº‹åŠ¡å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚ç„¶è€Œï¼Œå¦‚æœ Redis æœåŠ¡å™¨å› ä¸ºæŸäº›åŸå› è¢«ç®¡ç†å‘˜æ€æ­»ï¼Œæˆ–è€…é‡ä¸ŠæŸç§ç¡¬ä»¶æ•…éšœï¼Œé‚£ä¹ˆå¯èƒ½åªæœ‰éƒ¨åˆ†äº‹åŠ¡å‘½ä»¤ä¼šè¢«æˆåŠŸå†™å…¥åˆ°ç£ç›˜ä¸­ã€‚å¦‚æœ Redis åœ¨é‡æ–°å¯åŠ¨æ—¶å‘ç° AOF æ–‡ä»¶å‡ºäº†è¿™æ ·çš„é—®é¢˜ï¼Œé‚£ä¹ˆå®ƒä¼šé€€å‡ºï¼Œå¹¶æ±‡æŠ¥ä¸€ä¸ªé”™è¯¯ã€‚</p>
<p>Redis (2.2ç‰ˆæœ¬å¼€å§‹)è¿˜å¯ä»¥é€šè¿‡ä¹è§‚é”ï¼ˆoptimistic lockï¼‰å®ç° CAS ï¼ˆcheck-and-setï¼‰æ“ä½œ</p>
</blockquote>
<h6 id="ç”¨æ³•">ç”¨æ³•</h6>
<p><a href="http://redis.cn/commands/multi.html">MULTI</a> å‘½ä»¤ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å› <code>OK</code> ã€‚ <a href="http://redis.cn/commands/multi.html">MULTI</a> æ‰§è¡Œä¹‹åï¼Œ å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œ è¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œ è€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œ å½“ <a href="http://redis.cn/commands/exec.html">EXEC</a>å‘½ä»¤è¢«è°ƒç”¨æ—¶ï¼Œ æ‰€æœ‰é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œ é€šè¿‡è°ƒç”¨ <a href="http://redis.cn/commands/discard.html">DISCARD</a> ï¼Œ å®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œ å¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªäº‹åŠ¡ä¾‹å­ï¼Œ å®ƒåŸå­åœ°å¢åŠ äº† <code>foo</code> å’Œ <code>bar</code> ä¸¤ä¸ªé”®çš„å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">&gt; INCR foo</span><br><span class="line">QUEUED</span><br><span class="line">&gt; INCR bar</span><br><span class="line">QUEUED</span><br><span class="line">&gt; EXEC</span><br><span class="line">1) (integer) 1</span><br><span class="line">2) (integer) 1</span><br></pre></td></tr></table></figure>
<p><a href="http://redis.cn/commands/exec.html">EXEC</a> å‘½ä»¤çš„å›å¤æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æ‰§è¡Œäº‹åŠ¡ä¸­çš„å‘½ä»¤æ‰€äº§ç”Ÿçš„å›å¤ã€‚ å…¶ä¸­ï¼Œ å›å¤å…ƒç´ çš„å…ˆåé¡ºåºå’Œå‘½ä»¤å‘é€çš„å…ˆåé¡ºåºä¸€è‡´ã€‚</p>
<p>å½“å®¢æˆ·ç«¯å¤„äºäº‹åŠ¡çŠ¶æ€æ—¶ï¼Œ æ‰€æœ‰ä¼ å…¥çš„å‘½ä»¤éƒ½ä¼šè¿”å›ä¸€ä¸ªå†…å®¹ä¸º <code>QUEUED</code> çš„çŠ¶æ€å›å¤ï¼ˆstatus replyï¼‰ï¼Œ è¿™äº›è¢«å…¥é˜Ÿçš„å‘½ä»¤å°†åœ¨ EXEC å‘½ä»¤è¢«è°ƒç”¨æ—¶æ‰§è¡Œ</p>
<h6 id="äº‹åŠ¡ä¸­çš„é”™è¯¯">äº‹åŠ¡ä¸­çš„é”™è¯¯</h6>
<ul>
<li>äº‹åŠ¡åœ¨æ‰§è¡Œ <a href="http://redis.cn/commands/exec.html">EXEC</a> ä¹‹å‰ï¼Œå…¥é˜Ÿçš„å‘½ä»¤å¯èƒ½ä¼šå‡ºé”™ã€‚æ¯”å¦‚è¯´ï¼Œå‘½ä»¤å¯èƒ½ä¼šäº§ç”Ÿè¯­æ³•é”™è¯¯ï¼ˆå‚æ•°æ•°é‡é”™è¯¯ï¼Œå‚æ•°åé”™è¯¯ï¼Œç­‰ç­‰ï¼‰ï¼Œæˆ–è€…å…¶ä»–æ›´ä¸¥é‡çš„é”™è¯¯ï¼Œæ¯”å¦‚å†…å­˜ä¸è¶³ï¼ˆå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ <code>maxmemory</code> è®¾ç½®äº†æœ€å¤§å†…å­˜é™åˆ¶çš„è¯ï¼‰ã€‚</li>
<li>å‘½ä»¤å¯èƒ½åœ¨ <a href="http://redis.cn/commands/exec.html">EXEC</a> è°ƒç”¨ä¹‹åå¤±è´¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œäº‹åŠ¡ä¸­çš„å‘½ä»¤å¯èƒ½å¤„ç†äº†é”™è¯¯ç±»å‹çš„é”®ï¼Œæ¯”å¦‚å°†åˆ—è¡¨å‘½ä»¤ç”¨åœ¨äº†å­—ç¬¦ä¸²é”®ä¸Šé¢ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚</li>
</ul>
<p>æœåŠ¡å™¨ä¼šå¯¹å‘½ä»¤å…¥é˜Ÿå¤±è´¥çš„æƒ…å†µè¿›è¡Œè®°å½•ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯è°ƒç”¨ <a href="http://redis.cn/commands/exec.html">EXEC</a> å‘½ä»¤æ—¶ï¼Œ<strong>æ‹’ç»æ‰§è¡Œå¹¶è‡ªåŠ¨æ”¾å¼ƒè¿™ä¸ªäº‹åŠ¡</strong>ã€‚</p>
<h6 id="Redis-ä¸æ”¯æŒå›æ»šï¼ˆroll-backï¼‰åŸå› ">Redis ä¸æ”¯æŒå›æ»šï¼ˆroll backï¼‰åŸå› </h6>
<ul>
<li>Redis å‘½ä»¤åªä¼šå› ä¸ºé”™è¯¯çš„è¯­æ³•è€Œå¤±è´¥ï¼ˆå¹¶ä¸”è¿™äº›é—®é¢˜ä¸èƒ½åœ¨å…¥é˜Ÿæ—¶å‘ç°ï¼‰ï¼Œæˆ–æ˜¯å‘½ä»¤ç”¨åœ¨äº†é”™è¯¯ç±»å‹çš„é”®ä¸Šé¢ï¼šè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œä»å®ç”¨æ€§çš„è§’åº¦æ¥è¯´ï¼Œ<strong>å¤±è´¥çš„å‘½ä»¤æ˜¯ç”±ç¼–ç¨‹é”™è¯¯é€ æˆçš„ï¼Œè€Œè¿™äº›é”™è¯¯åº”è¯¥åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­è¢«å‘ç°ï¼Œè€Œä¸åº”è¯¥å‡ºç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­</strong>ã€‚</li>
<li>å› ä¸º<strong>ä¸éœ€è¦å¯¹å›æ»šè¿›è¡Œæ”¯æŒ</strong>ï¼Œæ‰€ä»¥ Redis çš„å†…éƒ¨å¯ä»¥ä¿æŒ<strong>ç®€å•ä¸”å¿«é€Ÿ</strong>ã€‚</li>
</ul>
<h5 id="4-å¸ƒéš†è¿‡æ»¤å™¨">4.å¸ƒéš†è¿‡æ»¤å™¨</h5>
<p><a href="https://github.com/RedisBloom/RedisBloom">ç¬¬ä¸‰æ–¹å®ç°çš„redisçš„å¸ƒéš†è¿‡æ»¤å™¨</a></p>
<h6 id="redisæ·»åŠ è¿‡æ»¤å™¨çš„æ„ä¹‰">redisæ·»åŠ è¿‡æ»¤å™¨çš„æ„ä¹‰</h6>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303094333.png" alt="image-20210303094333858"></p>
<h6 id="redisçš„å¸ƒéš†è¿‡æ»¤å™¨å®ç°">redisçš„å¸ƒéš†è¿‡æ»¤å™¨å®ç°</h6>
<ol>
<li>Clientè‡ªå·±æ‰¿è½½ï¼Œ<strong>å®ç°bloomç®—æ³•å¹¶æ‰¿è½½bitmap</strong></li>
<li>Clientå®ç°bloomç®—æ³•ï¼Œå¯¹åº”redisçš„bitmap</li>
<li>rediså®‰è£…bloomæ’ä»¶</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303094514.png" alt="image-20210303094514053"></p>
<blockquote>
<p>ç¬¬ä¸‰æ–¹å®ç°redisçš„ç›¸å…³åŠŸèƒ½ï¼š <a href="https://redis.io/modules">https://redis.io/modules</a></p>
</blockquote>
<h5 id="5-redisçš„LRUï¼ˆLeast-Recently-Usedï¼‰æ·˜æ±°ç­–ç•¥">5.redisçš„LRUï¼ˆLeast Recently Usedï¼‰æ·˜æ±°ç­–ç•¥</h5>
<p><a href="http://redis.cn/topics/lru-cache.html">å°†rediså½“åšä½¿ç”¨LRUç®—æ³•çš„ç¼“å­˜æ¥ä½¿ç”¨</a></p>
<p><strong>LRUæ˜¯Rediså”¯ä¸€æ”¯æŒçš„å›æ”¶æ–¹æ³•</strong>ï¼ŒRedisçš„<code>maxmemory</code>æŒ‡ä»¤ç”¨äºå°†å¯ç”¨å†…å­˜é™åˆ¶æˆä¸€ä¸ªå›ºå®šå¤§å°ï¼Œè¿˜åŒ…æ‹¬äº†Redisä½¿ç”¨çš„LRUç®—æ³•ï¼Œè¿™ä¸ªå®é™…ä¸Šåªæ˜¯è¿‘ä¼¼çš„LRUã€‚</p>
<p><strong>Redisçš„LRUç®—æ³•å¹¶éå®Œæ•´çš„å®ç°</strong>ã€‚è¿™æ„å‘³ç€<strong>Rediså¹¶æ²¡åŠæ³•é€‰æ‹©æœ€ä½³å€™é€‰æ¥è¿›è¡Œå›æ”¶</strong>ï¼Œä¹Ÿå°±æ˜¯æœ€ä¹…æœªè¢«è®¿é—®çš„é”®ã€‚ç›¸åå®ƒä¼šå°è¯•è¿è¡Œä¸€ä¸ªè¿‘ä¼¼LRUçš„ç®—æ³•ï¼Œ<strong>é€šè¿‡å¯¹å°‘é‡keysè¿›è¡Œå–æ ·ï¼Œç„¶åå›æ”¶å…¶ä¸­ä¸€ä¸ªæœ€å¥½çš„keyï¼ˆè¢«è®¿é—®æ—¶é—´è¾ƒæ—©çš„ï¼‰</strong>ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303094057.png" alt=""></p>
<h6 id="å›æ”¶ç­–ç•¥">å›æ”¶ç­–ç•¥</h6>
<p>ä»¥ä¸‹çš„ç­–ç•¥æ˜¯å¯ç”¨çš„:</p>
<ul>
<li><strong>noeviction</strong>:è¿”å›é”™è¯¯å½“å†…å­˜é™åˆ¶è¾¾åˆ°å¹¶ä¸”å®¢æˆ·ç«¯å°è¯•æ‰§è¡Œä¼šè®©æ›´å¤šå†…å­˜è¢«ä½¿ç”¨çš„å‘½ä»¤ï¼ˆå¤§éƒ¨åˆ†çš„å†™å…¥æŒ‡ä»¤ï¼Œä½†DELå’Œå‡ ä¸ªä¾‹å¤–ï¼‰</li>
<li><strong>allkeys-lru</strong>: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</li>
<li><strong>volatile-lru</strong>: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</li>
<li><strong>allkeys-random</strong>: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</li>
<li><strong>volatile-random</strong>: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ã€‚</li>
<li><strong>volatile-ttl</strong>: å›æ”¶åœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œå¹¶ä¸”ä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰è¾ƒçŸ­çš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</li>
</ul>
<h6 id="å›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ"><strong>å›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ</strong></h6>
<p>ç†è§£å›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œæ˜¯éå¸¸é‡è¦çš„:</p>
<ul>
<li>ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ®ã€‚</li>
<li>Rediæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryçš„é™åˆ¶, åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚</li>
<li>ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«æ‰§è¡Œï¼Œç­‰ç­‰ã€‚</li>
<li>æ‰€ä»¥æˆ‘ä»¬ä¸æ–­åœ°ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œï¼Œé€šè¿‡ä¸æ–­è¾¾åˆ°è¾¹ç•Œç„¶åä¸æ–­åœ°å›æ”¶å›åˆ°è¾¹ç•Œä»¥ä¸‹ã€‚</li>
</ul>
<p>å¦‚æœä¸€ä¸ªå‘½ä»¤çš„ç»“æœå¯¼è‡´å¤§é‡å†…å­˜è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚å¾ˆå¤§çš„é›†åˆçš„äº¤é›†ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é”®ï¼‰ï¼Œä¸ç”¨å¤šä¹…å†…å­˜é™åˆ¶å°±ä¼šè¢«è¿™ä¸ªå†…å­˜ä½¿ç”¨é‡è¶…è¶Šã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>redisæŒä¹…åŒ–</title>
    <url>/posts/dcfaa904/</url>
    <content><![CDATA[<h5 id="1-redisçš„æŒä¹…åŒ–æ–¹å¼">1. redisçš„æŒä¹…åŒ–æ–¹å¼</h5>
<ol>
<li>
<p>RDBæŒä¹…åŒ–</p>
<p>åŸç†æ˜¯å°†<strong>Reidsåœ¨å†…å­˜ä¸­çš„æ•°æ®åº“è®°å½•å®šæ—¶dumpåˆ°ç£ç›˜ä¸Šçš„RDBæŒä¹…åŒ–</strong></p>
</li>
<li>
<p>AOFæŒä¹…åŒ–</p>
</li>
</ol>
<pre><code>åŸç†æ˜¯å°†**Reidsçš„æ“ä½œæ—¥å¿—ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥æ–‡ä»¶**

[ä¸¤ç§æŒä¹…åŒ–æ–¹å¼åŒºåˆ«](https://www.cnblogs.com/zxs117/p/11242026.html)

äºŒè€…é€‰æ‹©çš„æ ‡å‡†ï¼Œå°±æ˜¯çœ‹ç³»ç»Ÿæ˜¯æ„¿æ„ç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼Œæ¢å–æ›´é«˜çš„ç¼“å­˜ä¸€è‡´æ€§ï¼ˆaofï¼‰ï¼Œè¿˜æ˜¯æ„¿æ„å†™æ“ä½œé¢‘ç¹çš„æ—¶å€™ï¼Œä¸å¯ç”¨å¤‡ä»½æ¥æ¢å–æ›´é«˜çš„æ€§èƒ½ï¼Œå¾…æ‰‹åŠ¨è¿è¡Œsaveçš„æ—¶å€™ï¼Œå†åšå¤‡ä»½ï¼ˆrdbï¼‰ã€‚rdbè¿™ä¸ªå°±æ›´æœ‰äº› eventually consistentçš„æ„æ€äº†ã€‚ä¸è¿‡ç”Ÿäº§ç¯å¢ƒå…¶å®æ›´å¤šéƒ½æ˜¯äºŒè€…ç»“åˆä½¿ç”¨çš„ã€‚
</code></pre>
<h5 id="2-RDBæŒä¹…åŒ–">2.RDBæŒä¹…åŒ–</h5>
<p><strong>åŸç†</strong> :åœ¨liunxç³»ç»Ÿç³»ç»Ÿä¸­ï¼Œ<strong>è¿›ç¨‹ä¹‹é—´çš„æ•°æ®æ˜¯éš”ç¦»çš„</strong>ï¼Œåœ¨ä½¿ç”¨exportçš„ç¯å¢ƒå˜é‡ï¼Œ<strong>çˆ¶å­è¿›ç¨‹çš„ä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹çš„æ•°æ®</strong></p>
<p>RDBæŒä¹…åŒ–æ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œå®é™…æ“ä½œè¿‡ç¨‹æ˜¯<strong>forkä¸€ä¸ªå­è¿›ç¨‹</strong>ï¼Œå…ˆå°†<strong>æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶</strong>ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303093740.png" alt=""></p>
<h6 id="2-1-RDBçš„ä¼˜ç¼ºç‚¹">2.1 RDBçš„ä¼˜ç¼ºç‚¹</h6>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>è¿˜åŸé€Ÿåº¦å¿«</strong>ï¼ˆç±»ä¼¼javaçš„å¯¹è±¡åºåˆ—åŒ–ï¼Œå¯å¿«é€Ÿè¿˜åŸï¼‰</li>
<li><strong>æ•´ä¸ªRedisæ•°æ®åº“å°†åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å¯¹äºæ–‡ä»¶å¤‡ä»½è€Œè¨€æ˜¯éå¸¸å®Œç¾çš„</strong>ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æ‰“ç®—æ¯ä¸ªå°æ—¶å½’æ¡£ä¸€æ¬¡æœ€è¿‘24å°æ—¶çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜è¦æ¯å¤©å½’æ¡£ä¸€æ¬¡æœ€è¿‘30å¤©çš„æ•°æ®ã€‚é€šè¿‡è¿™æ ·çš„å¤‡ä»½ç­–ç•¥ï¼Œä¸€æ—¦ç³»ç»Ÿå‡ºç°ç¾éš¾æ€§æ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å®¹æ˜“çš„è¿›è¡Œæ¢å¤ã€‚</li>
</ol>
<p><strong>å¼Šç«¯</strong>ï¼š</p>
<ol>
<li>å¦‚æœä½ æƒ³ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼Œå³æœ€å¤§é™åº¦çš„é¿å…æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆ<strong>RDBå°†ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å› ä¸ºç³»ç»Ÿä¸€æ—¦åœ¨å®šæ—¶æŒä¹…åŒ–å®Œæˆä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢å¤±</strong>ã€‚</li>
<li>ç”±äºRDBæ˜¯é€šè¿‡forkå­è¿›ç¨‹æ¥ååŠ©å®Œæˆæ•°æ®æŒä¹…åŒ–å·¥ä½œçš„ï¼Œå› æ­¤ï¼Œ<strong>å¦‚æœå½“æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨åœæ­¢æœåŠ¡å‡ ç™¾æ¯«ç§’ï¼Œç”šè‡³æ˜¯1ç§’é’Ÿã€‚</strong></li>
</ol>
<blockquote>
<p>forkå‘½ä»¤åªæ˜¯åˆ›å»ºè¿›ç¨‹ï¼Œå¹¶ä¸ä¼šåœ¨æ­¤æ—¶è¿›è¡Œå¤åˆ¶ï¼Œå› æ­¤åˆ›å»ºè¿›ç¨‹çš„é€Ÿåº¦å˜å¿«</p>
<p>forkå‡ºæ¥çš„çˆ¶å­è¿›ç¨‹å…·æœ‰ <strong>ç›¸åŒä½†æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´</strong>å› ä¸ºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä»–ä»¬éƒ½æœ‰è‡ªå·±ç§æœ‰çš„åœ°å€ç©ºé—´ï¼Œå½“çˆ¶è¿›ç¨‹æˆ–è€…å­è¿›ç¨‹å•ç‹¬æ”¹å˜æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å½¼æ­¤ï¼Œç±»ä¼¼äºc++çš„å†™å®æ‹·è´çš„å½¢å¼è‡ªå»ºä¸€ä¸ªå‰¯æœ¬</p>
<p><a href="https://blog.csdn.net/weixin_40853073/article/details/81873398?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.control&amp;dist_request_id=4254810a-f10f-43c5-8965-6b775b5a3682&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.control">forkå‘½ä»¤è¯¦ç»†è¯´æ˜</a></p>
</blockquote>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113700.png" alt="image-20210221233300160"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303093910.png" alt="image-20210303093910862"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226151043.png" alt="image-20210226151042967"></p>
<h5 id="3-AOFæŒä¹…åŒ–">3. AOFæŒä¹…åŒ–</h5>
<p>AOFæŒä¹…åŒ–ä»¥<strong>æ—¥å¿—çš„å½¢å¼</strong>è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„<strong>æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œ</strong>ï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚</p>
<blockquote>
<p>å½“redisåŒæ—¶å¼€å¯RDBå’ŒAOFå¤‡ä»½ï¼Œredisæ¢å¤æ˜¯åªä¼šä¾æ®AOFçš„å¤‡ä»½ï¼ˆAOFçš„æ•°æ®ä¸¢å¤±è¾ƒå°‘ï¼‰</p>
</blockquote>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113653.png" alt="image-20210221233312115"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226151129.png" alt="image-20210226151129085"></p>
<h6 id="3-1-AOFçš„ä¼˜ç¼ºç‚¹">3.1 AOFçš„ä¼˜ç¼ºç‚¹</h6>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<p>1). è¯¥æœºåˆ¶å¯ä»¥å¸¦æ¥<strong>æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå³æ•°æ®æŒä¹…æ€§</strong>ã€‚Redisä¸­æä¾›äº†3ä¸­åŒæ­¥ç­–ç•¥ï¼Œå³æ¯ç§’åŒæ­¥ã€æ¯ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥ã€‚äº‹å®ä¸Šï¼Œæ¯ç§’åŒæ­¥ä¹Ÿæ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå…¶æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œæ‰€å·®çš„æ˜¯ä¸€æ—¦ç³»ç»Ÿå‡ºç°å®•æœºç°è±¡ï¼Œé‚£ä¹ˆè¿™ä¸€ç§’é’Ÿä¹‹å†…ä¿®æ”¹çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚è€Œæ¯ä¿®æ”¹åŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºåŒæ­¥æŒä¹…åŒ–ï¼Œå³æ¯æ¬¡å‘ç”Ÿçš„æ•°æ®å˜åŒ–éƒ½ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å¯ä»¥é¢„è§ï¼Œè¿™ç§æ–¹å¼åœ¨æ•ˆç‡ä¸Šæ˜¯æœ€ä½çš„ã€‚</p>
<p>2). ç”±äºè¯¥æœºåˆ¶å¯¹æ—¥å¿—æ–‡ä»¶çš„<strong>å†™å…¥æ“ä½œé‡‡ç”¨çš„æ˜¯appendæ¨¡å¼ï¼Œå› æ­¤åœ¨å†™å…¥è¿‡ç¨‹ä¸­å³ä½¿å‡ºç°å®•æœºç°è±¡ï¼Œä¹Ÿä¸ä¼šç ´åæ—¥å¿—æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨çš„å†…å®¹</strong>ã€‚ç„¶è€Œå¦‚æœæˆ‘ä»¬æœ¬æ¬¡æ“ä½œåªæ˜¯å†™å…¥äº†ä¸€åŠæ•°æ®å°±å‡ºç°äº†ç³»ç»Ÿå´©æºƒé—®é¢˜ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåœ¨Redisä¸‹ä¸€æ¬¡å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥<strong>é€šè¿‡redis-check-aofå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</strong></p>
<p>3). å¦‚æœ<strong>æ—¥å¿—è¿‡å¤§ï¼ŒRediså¯ä»¥è‡ªåŠ¨å¯ç”¨rewriteæœºåˆ¶</strong>ã€‚å³Redisä»¥appendæ¨¡å¼ä¸æ–­çš„å°†ä¿®æ”¹æ•°æ®å†™å…¥åˆ°è€çš„ç£ç›˜æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶Redisè¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç”¨äºè®°å½•æ­¤æœŸé—´æœ‰å“ªäº›ä¿®æ”¹å‘½ä»¤è¢«æ‰§è¡Œã€‚å› æ­¤åœ¨è¿›è¡Œrewriteåˆ‡æ¢æ—¶å¯ä»¥æ›´å¥½çš„ä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚</p>
<blockquote>
<p>redis4.0ä»¥å‰ï¼šrewriteå…¶å®æ˜¯åˆ é™¤æŠµæ¶ˆçš„å‘½ä»¤ï¼ˆåˆ›å»ºå’Œåˆ é™¤ï¼‰ï¼Œåˆå¹¶é‡å¤çš„å‘½åã€‚æœ€ç»ˆä¼šç”Ÿæˆé‡å¤å‘½ä»¤</p>
<p>redis4.0ä»¥åï¼šå°†è€çš„æ•°æ®RDBåˆ°AOFä¸­ï¼Œå°†å¢é‡çš„ä»¥æŒ‡ä»¤çš„æ–¹å¼appendåˆ°aofä¸­ï¼ˆå®é™…å°±æ˜¯æ··åˆRDB+AOFçš„æŒä¹…åŒ–æ–¹å¼ï¼‰</p>
</blockquote>
<p>4). <strong>AOFåŒ…å«ä¸€ä¸ªæ ¼å¼æ¸…æ™°ã€æ˜“äºç†è§£çš„æ—¥å¿—æ–‡ä»¶ç”¨äºè®°å½•æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶å®Œæˆæ•°æ®çš„é‡å»º</strong>ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<p>1). å¯¹äºç›¸åŒæ•°é‡çš„æ•°æ®é›†è€Œè¨€ï¼ŒAOFæ–‡ä»¶é€šå¸¸è¦å¤§äºRDBæ–‡ä»¶ã€‚<strong>RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</strong></p>
<p>2). æ ¹æ®åŒæ­¥ç­–ç•¥çš„ä¸åŒï¼Œ<strong>AOFåœ¨è¿è¡Œæ•ˆç‡ä¸Šå¾€å¾€ä¼šæ…¢äºRDB</strong>ã€‚æ€»ä¹‹ï¼Œæ¯ç§’åŒæ­¥ç­–ç•¥çš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼ŒåŒæ­¥ç¦ç”¨ç­–ç•¥çš„æ•ˆç‡å’ŒRDBä¸€æ ·é«˜æ•ˆã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>redisé›†ç¾¤</title>
    <url>/posts/b153a32a/</url>
    <content><![CDATA[<h5 id="1-å•èŠ‚ç‚¹redisçš„ç¼ºé™·">1.å•èŠ‚ç‚¹redisçš„ç¼ºé™·</h5>
<ul>
<li>å•ç‚¹æ•…éšœå¯¼è‡´æœåŠ¡ä¸å¯ç”¨</li>
<li>redisçš„å®¹é‡ä¼˜å…ˆ</li>
<li>redisçš„æœåŠ¡å‹åŠ›</li>
</ul>
<h5 id="2-é›†ç¾¤çš„AKFåŸåˆ™">2. é›†ç¾¤çš„AKFåŸåˆ™</h5>
<p><a href="https://www.cnblogs.com/-wenli/p/13584796.html">AKFåŸåˆ™</a></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113708.png" alt="image-20210222095931709"></p>
<blockquote>
<p>xè½´ï¼šå…¨é‡ï¼Œé•œåƒ</p>
<p>Yè½´ï¼šä¸šåŠ¡ï¼ŒåŠŸèƒ½</p>
<p>Zè½´ï¼šä¼˜å…ˆçº§ï¼Œé€»è¾‘å†æ‹†åˆ†</p>
</blockquote>
<h6 id="2-1-redisä½¿ç”¨AKFåŸåˆ™æ‰©å±•ä¸ºé›†ç¾¤äº§ç”Ÿçš„é—®é¢˜">2.1 redisä½¿ç”¨AKFåŸåˆ™æ‰©å±•ä¸ºé›†ç¾¤äº§ç”Ÿçš„é—®é¢˜</h6>
<p>é€šè¿‡AKFä¸€å˜å¤š ï¼š<strong>æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong></p>
<blockquote>
<p>Xè½´ï¼šredisçš„ä¸»ä»å¤åˆ¶</p>
<p>yè½´ï¼šredisçš„é›†ç¾¤</p>
<p>zè½´ï¼šredisçš„é›†ç¾¤ï¼ˆæ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼‰</p>
</blockquote>
<p>â€‹</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223113717.png" alt="image-20210222102653774"></p>
<h5 id="3-CAPåŸåˆ™">3. CAPåŸåˆ™</h5>
<p><a href="https://baike.baidu.com/item/CAP%E5%8E%9F%E5%88%99/5712863?fr=aladdin">CAPåŸåˆ™ç™¾ç§‘</a></p>
<p>CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<a href="https://baike.baidu.com/item/%E4%B8%80%E8%87%B4%E6%80%A7/9840083">ä¸€è‡´æ€§</a>ï¼ˆConsistencyï¼‰ã€<a href="https://baike.baidu.com/item/%E5%8F%AF%E7%94%A8%E6%80%A7/109628">å¯ç”¨æ€§</a>ï¼ˆAvailabilityï¼‰ã€<a href="https://baike.baidu.com/item/%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7/23734073">åˆ†åŒºå®¹é”™æ€§</a>ï¼ˆPartition toleranceï¼‰ã€‚CAP åŸåˆ™æŒ‡çš„æ˜¯ï¼Œè¿™ä¸‰ä¸ª<a href="https://baike.baidu.com/item/%E8%A6%81%E7%B4%A0/5261200">è¦ç´ </a>æœ€å¤šåªèƒ½åŒæ—¶å®ç°ä¸¤ç‚¹ï¼Œä¸å¯èƒ½ä¸‰è€…å…¼é¡¾ã€‚</p>
<h5 id="4-Redisçš„å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰">4. Redisçš„å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰</h5>
<p><a href="http://redis.cn/topics/replication.html">redisçš„å¤åˆ¶</a></p>
<p>Redisä½¿ç”¨é»˜è®¤çš„<strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä½å»¶è¿Ÿå’Œé«˜æ€§èƒ½ï¼Œæ˜¯ç»å¤§å¤šæ•° Redis ç”¨ä¾‹çš„è‡ªç„¶å¤åˆ¶æ¨¡å¼ã€‚ä½†æ˜¯ï¼Œä» Redis æœåŠ¡å™¨ä¼šå¼‚æ­¥åœ°ç¡®è®¤å…¶ä»ä¸» Redis æœåŠ¡å™¨å‘¨æœŸæ¥æ”¶åˆ°çš„æ•°æ®é‡ã€‚</p>
<blockquote>
<p>ä¸»ä»æ¨¡å¼ï¼Œä»èŠ‚ç‚¹ä¸æ”¯æŒå†™å…¥ï¼Œå¦‚æœä¸»èŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªé›†ç¾¤å°±ä¼šå¤±å»å†™çš„èƒ½åŠ›ï¼Œä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ã€‚</p>
<p>redisæ­å»ºè¯»å†™åˆ†ç¦»çš„æ—¶å€™ï¼Œ<strong>å½“è¿æ¥åˆ°ä»èŠ‚ç‚¹å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œå‘½ä»¤ä¼šé»˜è®¤é‡å®šå‘åˆ°ä¸»èŠ‚ç‚¹å»</strong></p>
</blockquote>
<h6 id="4-1-rediså¤åˆ¶çš„é‡è¦ç»†èŠ‚">4.1. rediså¤åˆ¶çš„é‡è¦ç»†èŠ‚</h6>
<ul>
<li>Redis ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œslave å’Œ master ä¹‹é—´å¼‚æ­¥åœ°ç¡®è®¤å¤„ç†çš„æ•°æ®é‡</li>
<li>ä¸€ä¸ª master å¯ä»¥æ‹¥æœ‰å¤šä¸ª slave</li>
<li>slave å¯ä»¥æ¥å—å…¶ä»– slave çš„è¿æ¥ã€‚é™¤äº†å¤šä¸ª slave å¯ä»¥è¿æ¥åˆ°åŒä¸€ä¸ª master ä¹‹å¤–ï¼Œ slave ä¹‹é—´ä¹Ÿå¯ä»¥åƒå±‚å çŠ¶çš„ç»“æ„ï¼ˆcascading-like structureï¼‰è¿æ¥åˆ°å…¶ä»– slave ã€‚è‡ª Redis 4.0 èµ·ï¼Œæ‰€æœ‰çš„ sub-slave å°†ä¼šä» master æ”¶åˆ°å®Œå…¨ä¸€æ ·çš„å¤åˆ¶æµã€‚</li>
<li>Redis å¤åˆ¶åœ¨ master ä¾§æ˜¯éé˜»å¡çš„ã€‚è¿™æ„å‘³ç€ master åœ¨ä¸€ä¸ªæˆ–å¤šä¸ª slave è¿›è¡Œåˆæ¬¡åŒæ­¥æˆ–è€…æ˜¯éƒ¨åˆ†é‡åŒæ­¥æ—¶ï¼Œå¯ä»¥ç»§ç»­å¤„ç†æŸ¥è¯¢è¯·æ±‚ã€‚</li>
<li>å¤åˆ¶åœ¨ slave ä¾§å¤§éƒ¨åˆ†ä¹Ÿæ˜¯éé˜»å¡çš„ã€‚å½“ slave è¿›è¡Œåˆæ¬¡åŒæ­¥æ—¶ï¼Œå®ƒå¯ä»¥ä½¿ç”¨æ—§æ•°æ®é›†å¤„ç†æŸ¥è¯¢è¯·æ±‚ï¼Œå‡è®¾ä½ åœ¨ redis.conf ä¸­é…ç½®äº†è®© Redis è¿™æ ·åšçš„è¯ã€‚å¦åˆ™ï¼Œä½ å¯ä»¥é…ç½®å¦‚æœå¤åˆ¶æµæ–­å¼€ï¼Œ Redis slave ä¼šè¿”å›ä¸€ä¸ª error ç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯ï¼Œåœ¨åˆæ¬¡åŒæ­¥ä¹‹åï¼Œæ—§æ•°æ®é›†å¿…é¡»è¢«åˆ é™¤ï¼ŒåŒæ—¶åŠ è½½æ–°çš„æ•°æ®é›†ã€‚ slave åœ¨è¿™ä¸ªçŸ­æš‚çš„æ—¶é—´çª—å£å†…ï¼ˆå¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼Œä¼šæŒç»­è¾ƒé•¿æ—¶é—´ï¼‰ï¼Œä¼šé˜»å¡åˆ°æ¥çš„è¿æ¥è¯·æ±‚ã€‚è‡ª Redis 4.0 å¼€å§‹ï¼Œå¯ä»¥é…ç½® Redis ä½¿åˆ é™¤æ—§æ•°æ®é›†çš„æ“ä½œåœ¨å¦ä¸€ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­è¿›è¡Œï¼Œä½†æ˜¯ï¼ŒåŠ è½½æ–°æ•°æ®é›†çš„æ“ä½œä¾ç„¶éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œå¹¶ä¸”ä¼šé˜»å¡ slave ã€‚</li>
<li>å¤åˆ¶æ—¢å¯ä»¥è¢«ç”¨åœ¨å¯ä¼¸ç¼©æ€§ï¼Œä»¥ä¾¿åªè¯»æŸ¥è¯¢å¯ä»¥æœ‰å¤šä¸ª slave è¿›è¡Œï¼ˆä¾‹å¦‚ O(N) å¤æ‚åº¦çš„æ…¢æ“ä½œå¯ä»¥è¢«ä¸‹æ”¾åˆ° slave ï¼‰ï¼Œæˆ–è€…ä»…ç”¨äºæ•°æ®å®‰å…¨ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨å¤åˆ¶æ¥é¿å… master å°†å…¨éƒ¨æ•°æ®é›†å†™å…¥ç£ç›˜é€ æˆçš„å¼€é”€ï¼šä¸€ç§å…¸å‹çš„æŠ€æœ¯æ˜¯é…ç½®ä½ çš„ master Redis.conf ä»¥é¿å…å¯¹ç£ç›˜è¿›è¡ŒæŒä¹…åŒ–ï¼Œç„¶åè¿æ¥ä¸€ä¸ª slave ï¼Œå…¶é…ç½®ä¸ºä¸å®šæœŸä¿å­˜æˆ–æ˜¯å¯ç”¨ AOFã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªè®¾ç½®å¿…é¡»å°å¿ƒå¤„ç†ï¼Œå› ä¸ºé‡æ–°å¯åŠ¨çš„ master ç¨‹åºå°†ä»ä¸€ä¸ªç©ºæ•°æ®é›†å¼€å§‹ï¼šå¦‚æœä¸€ä¸ª slave è¯•å›¾ä¸å®ƒåŒæ­¥ï¼Œé‚£ä¹ˆè¿™ä¸ª slave ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚</li>
</ul>
<h6 id="Redis-å¤åˆ¶åŠŸèƒ½çš„ç»†èŠ‚è¿‡ç¨‹">Redis å¤åˆ¶åŠŸèƒ½çš„ç»†èŠ‚è¿‡ç¨‹</h6>
<p>master å¼€å¯ä¸€ä¸ª<strong>åå°ä¿å­˜è¿›ç¨‹ï¼Œä»¥ä¾¿äºç”Ÿäº§ä¸€ä¸ª RDB æ–‡ä»¶</strong>ã€‚åŒæ—¶å®ƒå¼€å§‹ç¼“å†²æ‰€æœ‰ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ–°çš„å†™å…¥å‘½ä»¤ã€‚å½“åå°ä¿å­˜å®Œæˆæ—¶ï¼Œ master å°†æ•°æ®é›†æ–‡ä»¶ä¼ è¾“ç»™ slaveï¼Œ slaveå°†ä¹‹ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œç„¶ååŠ è½½æ–‡ä»¶åˆ°å†…å­˜ã€‚å†ç„¶å master ä¼šå‘é€æ‰€æœ‰ç¼“å†²çš„å‘½ä»¤å‘ç»™ slaveã€‚è¿™ä¸ªè¿‡ç¨‹ä»¥æŒ‡ä»¤æµçš„å½¢å¼å®Œæˆå¹¶ä¸”å’Œ Redis åè®®æœ¬èº«çš„æ ¼å¼ç›¸åŒã€‚</p>
<p>ä½ å¯ä»¥ç”¨ telnet è‡ªå·±è¿›è¡Œå°è¯•ã€‚åœ¨æœåŠ¡å™¨æ­£åœ¨åšä¸€äº›å·¥ä½œçš„åŒæ—¶è¿æ¥åˆ° Redis ç«¯å£å¹¶å‘å‡º <a href="https://redis.io/commands/sync">SYNC</a> å‘½ä»¤ã€‚ä½ å°†ä¼šçœ‹åˆ°ä¸€ä¸ªæ‰¹é‡ä¼ è¾“ï¼Œå¹¶ä¸”ä¹‹åæ¯ä¸€ä¸ª master æ¥æ”¶åˆ°çš„å‘½ä»¤éƒ½å°†åœ¨ telnet å›è¯ä¸­è¢«é‡æ–°å‘å‡ºã€‚äº‹å®ä¸Š SYNC æ˜¯ä¸€ä¸ªæ—§åè®®ï¼Œåœ¨æ–°çš„ Redis å®ä¾‹ä¸­å·²ç»ä¸å†è¢«ä½¿ç”¨ï¼Œä½†æ˜¯å…¶ä»ç„¶å‘åå…¼å®¹ï¼šä½†å®ƒä¸å…è®¸éƒ¨åˆ†é‡åŒæ­¥ï¼Œæ‰€ä»¥ç°åœ¨ <strong>PSYNC</strong> è¢«ç”¨æ¥æ›¿ä»£ SYNCã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226145730.png" alt="image-20210226145730728"></p>
<h5 id="5-Redisä¸­å“¨å…µsentinel">5. Redisä¸­å“¨å…µsentinel</h5>
<p><a href="http://redis.cn/topics/sentinel.html">Redis çš„ Sentinel æ–‡æ¡£</a></p>
<p>Redis çš„ Sentinel ç³»ç»Ÿç”¨äºç®¡ç†å¤šä¸ª Redis æœåŠ¡å™¨ï¼ˆinstanceï¼‰ï¼Œ è¯¥ç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªä»»åŠ¡ï¼š</p>
<ul>
<li><strong>ç›‘æ§ï¼ˆMonitoring</strong>ï¼‰ï¼š Sentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li>
<li><strong>æé†’ï¼ˆNotificationï¼‰</strong>ï¼š å½“è¢«ç›‘æ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œ Sentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚</li>
<li><strong>è‡ªåŠ¨æ•…éšœè¿ç§»ï¼ˆAutomatic failoverï¼‰</strong>ï¼š å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œ Sentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œ å®ƒä¼š<strong>å°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨</strong>ï¼Œ å¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»æœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼› å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œ é›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œ ä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚</li>
</ul>
<p>Redis Sentinel æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼Œ ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ¶æ„ä¸­è¿è¡Œå¤šä¸ª Sentinel è¿›ç¨‹ï¼ˆprogressï¼‰ï¼Œ è¿™äº›è¿›ç¨‹ä½¿ç”¨<strong>æµè¨€åè®®ï¼ˆgossip protocols)<strong>æ¥æ¥æ”¶å…³äºä¸»æœåŠ¡å™¨æ˜¯å¦ä¸‹çº¿çš„ä¿¡æ¯ï¼Œ å¹¶ä½¿ç”¨</strong>æŠ•ç¥¨åè®®</strong>ï¼ˆagreement protocolsï¼‰æ¥å†³å®šæ˜¯å¦æ‰§è¡Œè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œ ä»¥åŠé€‰æ‹©å“ªä¸ªä»æœåŠ¡å™¨ä½œä¸ºæ–°çš„ä¸»æœåŠ¡å™¨</p>
<blockquote>
<p>åœ¨æ­¤æ—¶sentinelé›†ç¾¤ä¼šåœ¨å†…éƒ¨å…ˆé€‰ä¸¾å‡ºä¸€ä¸ªleaderï¼Œç„¶åç”±è¿™ä¸ªleaderå¯¹é›†ç¾¤ä¸­æŸä¸ªå‡ºç°é—®é¢˜çš„ä¸»masterè¿›è¡Œæ•…éšœè¿ç§»ï¼ˆé€‰å‡ºä»èŠ‚ç‚¹å½“masterï¼‰</p>
</blockquote>
<h6 id="å®¢è§‚ä¸‹çº¿å’Œä¸»è§‚ä¸‹çº¿">å®¢è§‚ä¸‹çº¿å’Œä¸»è§‚ä¸‹çº¿</h6>
<ul>
<li>ä¸»è§‚ä¸‹çº¿ï¼ˆSubjectively Downï¼Œ ç®€ç§° SDOWNï¼‰æŒ‡çš„æ˜¯å•ä¸ª Sentinel å®ä¾‹å¯¹æœåŠ¡å™¨åšå‡ºçš„ä¸‹çº¿åˆ¤æ–­ã€‚</li>
<li>å®¢è§‚ä¸‹çº¿ï¼ˆObjectively Downï¼Œ ç®€ç§° ODOWNï¼‰æŒ‡çš„æ˜¯å¤šä¸ª Sentinel å®ä¾‹åœ¨å¯¹åŒä¸€ä¸ªæœåŠ¡å™¨åšå‡º SDOWN åˆ¤æ–­ï¼Œ å¹¶ä¸”é€šè¿‡ SENTINEL is-master-down-by-addr å‘½ä»¤äº’ç›¸äº¤æµä¹‹åï¼Œ å¾—å‡ºçš„æœåŠ¡å™¨ä¸‹çº¿åˆ¤æ–­ã€‚ ï¼ˆä¸€ä¸ª Sentinel å¯ä»¥é€šè¿‡å‘å¦ä¸€ä¸ª Sentinel å‘é€ SENTINEL is-master-down-by-addr å‘½ä»¤æ¥è¯¢é—®å¯¹æ–¹æ˜¯å¦è®¤ä¸ºç»™å®šçš„æœåŠ¡å™¨å·²ä¸‹çº¿ã€‚ï¼‰</li>
</ul>
<p>å®¢è§‚ä¸‹çº¿æ¡ä»¶<strong>åªé€‚ç”¨äºä¸»æœåŠ¡å™¨</strong>ï¼š å¯¹äºä»»ä½•å…¶ä»–ç±»å‹çš„ Redis å®ä¾‹ï¼Œ Sentinel åœ¨å°†å®ƒä»¬åˆ¤æ–­ä¸ºä¸‹çº¿å‰ä¸éœ€è¦è¿›è¡Œåå•†ï¼Œ æ‰€ä»¥ä»æœåŠ¡å™¨æˆ–è€…å…¶ä»– Sentinel æ°¸è¿œä¸ä¼šè¾¾åˆ°å®¢è§‚ä¸‹çº¿æ¡ä»¶ã€‚</p>
<p>ä»ä¸»è§‚ä¸‹çº¿çŠ¶æ€åˆ‡æ¢åˆ°å®¢è§‚ä¸‹çº¿çŠ¶æ€å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼çš„æ³•å®šäººæ•°ç®—æ³•ï¼ˆstrong quorum algorithmï¼‰ï¼Œ è€Œæ˜¯ä½¿ç”¨äº†<strong>æµè¨€åè®®</strong>ï¼š å¦‚æœ <strong>Sentinel åœ¨ç»™å®šçš„æ—¶é—´èŒƒå›´å†…ï¼Œ ä»å…¶ä»– Sentinel é‚£é‡Œæ¥æ”¶åˆ°äº†è¶³å¤Ÿæ•°é‡çš„ä¸»æœåŠ¡å™¨ä¸‹çº¿æŠ¥å‘Šï¼Œ é‚£ä¹ˆ Sentinel å°±ä¼šå°†ä¸»æœåŠ¡å™¨çš„çŠ¶æ€ä»ä¸»è§‚ä¸‹çº¿æ”¹å˜ä¸ºå®¢è§‚ä¸‹çº¿</strong>ã€‚ å¦‚æœä¹‹åå…¶ä»– Sentinel ä¸å†æŠ¥å‘Šä¸»æœåŠ¡å™¨å·²ä¸‹çº¿ï¼Œ é‚£ä¹ˆå®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚</p>
<h5 id="6-Redisé›†ç¾¤">6.Redisé›†ç¾¤</h5>
<p><a href="http://redis.cn/topics/cluster-tutorial.html">redisé›†ç¾¤æ•™ç¨‹</a></p>
<h6 id="Redisé›†ç¾¤çš„æ‹†åˆ†æ–¹æ¡ˆ">Redisé›†ç¾¤çš„æ‹†åˆ†æ–¹æ¡ˆ</h6>
<ul>
<li>æ•°æ®å¯ä»¥åˆ†ç±»ï¼Œäº¤é›†ä¸å¤š</li>
<li>æ•°æ®æ²¡åŠæ³•æ‹†åˆ†,ç”¨ä¸€è‡´æ€§hashç®—æ³•è¿›è¡Œæ‹†åˆ†(redis-cluster)</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226152546.png" alt="image-20210226152546200"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226153455.png" alt="image-20210226153454965"></p>
<h6 id="ä¸€è‡´æ€§hashç®—æ³•">ä¸€è‡´æ€§hashç®—æ³•</h6>
<p>å¸Œç®—æ³•å°±æ˜¯å°†ä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶å€¼æ˜ å°„ä¸ºè¾ƒçŸ­çš„å›ºå®šé•¿åº¦çš„å”¯ä¸€çš„äºŒè¿›åˆ¶å€¼(å³å“ˆå¸Œå€¼)ã€‚æ•²é»‘æ¿ï¼Œå“ˆå¸Œç®—æ³•çš„å…¥å‚å¯ä»¥æ˜¯ä»»æ„é•¿åº¦ï¼Œè€Œå‡ºå‚æ˜¯å›ºå®šé•¿åº¦è€Œä¸”å”¯ä¸€ã€‚ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°±æ˜¯ï¼Œå…ˆæ„é€ ä¸€ä¸ª0åˆ°2^32çš„æ•´æ•°ç¯(hashç¯ï¼Œjavaä¸­å¯ç”¨SortedMapå®ç°)ï¼Œæ ¹æ®ç¼“å­˜æœåŠ¡å™¨åç§°(ä¹Ÿå¯ä»¥æ˜¯ip:port)è®¡ç®—å‡ºhashå€¼ï¼Œæ ¹æ®å…¶hashå€¼å°†ç¼“å­˜æœåŠ¡å™¨æ”¾ç½®åœ¨hashç¯ä¸Šã€‚æ¯æ¬¡æ ¹æ®è¦ç¼“å­˜çš„keyè®¡ç®—å¾—åˆ°hashå€¼ï¼Œåœ¨hashç¯ä¸Šé¡ºæ—¶é’ˆæŸ¥æ‰¾è·ç¦»æœ€è¿‘çš„ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹(SortedMap.tailMap(key)å®ç°)ï¼Œè¿›è¡Œset/setæ“ä½œ<br>
<img src="https://gitee.com/CNRF/image/raw/master/img/20210226153659.png" alt="image-20210226153659880"></p>
<p><strong>ä¸€è‡´æ€§hashç®—æ³•çš„é—®é¢˜</strong></p>
<p>1.åŠ å‡ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹ä¼šé€ æˆhashç¯éƒ¨åˆ†æ•°æ®æ— æ³•å‘½ä¸­ï¼›</p>
<p>2.å°‘é‡ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹æ—¶ï¼Œæ•°æ®åˆ†å¸ƒä¸å‡åŒ€ï¼ŒåŒæ—¶ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹å˜åŒ–å°†å½±å“å¤§èŒƒå›´æ•°æ®;</p>
<p>3.æ™®é€šçš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºéœ€è¦å¢åŠ ä¸€å€æˆ–å‡æ‰ä¸€åŠç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹æ‰èƒ½ä¿æŒæ•°æ®è´Ÿè½½å‡è¡¡ï¼›</p>
<p>å½“åªæœ‰å°‘é‡ç¼“å­˜æœåŠ¡å™¨åˆæƒ³å°½é‡ä¿è¯è´Ÿè½½å‡è¡¡æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ä¸‹é¢çš„åŠæ³•ï¼šå°†ä¸€ä¸ªç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹è™šæ‹Ÿæˆä¸€ç»„ï¼Œæ¯”å¦‚æŸå°ç¼“å­˜æœåŠ¡å™¨ä¸º192.168.2.1:6379ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶è™šæ‹Ÿæˆä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ•°ç»„ï¼Œä¸º192.168.2.1:6379-1ï¼Œ192.168.2.1:6379-2ï¼Œ192.168.2.1:6379-3â€¦â€¦ç„¶ååˆ†åˆ«è®¡ç®—æ•°ç»„é‡Œçš„å…ƒç´ çš„hashå€¼å¹¶æ˜ å°„åˆ°hashç¯ä¸Šï¼Œæ¯å°ç¼“å­˜æœåŠ¡å™¨éƒ½å¦‚æ­¤å¤„ç†ã€‚å½“ä¸åŒkeyçš„ç¼“å­˜è·¯ç”±åˆ°è™šæ‹ŸèŠ‚ç‚¹æ—¶ï¼Œæœ€ç»ˆéƒ½æ˜¯æŒ‡å‘çœŸå®çš„ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹ã€‚é€šè¿‡è¿™æ ·å¢åŠ èŠ‚ç‚¹çš„æ–¹å¼ï¼Œå¯ä»¥ä¸€å®šæ¦‚ç‡ä¸Šä½¿æ•°æ®è·¯ç”±å‡è¡¡</p>
<h6 id="redis-cluster">redis-cluster</h6>
<p>Redis-Clusteré‡‡ç”¨æ— ä¸­å¿ƒç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œæ•´ä¸ªé›†ç¾¤çŠ¶æ€,æ¯ä¸ªèŠ‚ç‚¹éƒ½å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹è¿æ¥ã€‚</p>
<p>å…¶ç»“æ„ç‰¹ç‚¹ï¼š</p>
<p>1ã€æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚</p>
<p>2ã€èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚</p>
<p>3ã€å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</p>
<p>4ã€redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰,cluster è´Ÿè´£ç»´æŠ¤node&lt;-&gt;slot&lt;-&gt;valueã€‚</p>
<p>5ã€Redisé›†ç¾¤é¢„åˆ†å¥½16384ä¸ªæ¡¶ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œæ ¹æ® CRC16(key) mod 16384çš„å€¼ï¼Œå†³å®šå°†ä¸€ä¸ªkeyæ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ã€‚</p>
<p><strong>a.redis clusterèŠ‚ç‚¹åˆ†é…</strong><br>
ç°åœ¨æˆ‘ä»¬æ˜¯ä¸‰ä¸ªä¸»èŠ‚ç‚¹åˆ†åˆ«æ˜¯ï¼šA, B, C ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ä¸€å°æœºå™¨ä¸Šçš„ä¸‰ä¸ªç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸‰å°ä¸åŒçš„æœåŠ¡å™¨ã€‚é‚£ä¹ˆï¼Œé‡‡ç”¨å“ˆå¸Œæ§½ (hash slot)çš„æ–¹å¼æ¥åˆ†é…16384ä¸ªslot çš„è¯ï¼Œå®ƒä»¬ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«æ‰¿æ‹…çš„slot åŒºé—´æ˜¯ï¼š</p>
<ul>
<li>
<p>èŠ‚ç‚¹Aè¦†ç›–0ï¼5460;</p>
</li>
<li>
<p>èŠ‚ç‚¹Bè¦†ç›–5461ï¼10922;</p>
</li>
<li>
<p>èŠ‚ç‚¹Cè¦†ç›–10923ï¼16383.</p>
<p>è·å–æ•°æ®:<br>
å¦‚æœå­˜å…¥ä¸€ä¸ªå€¼ï¼ŒæŒ‰ç…§redis clusterå“ˆå¸Œæ§½çš„<a href="http://lib.csdn.net/base/datastructure">ç®—æ³•</a>ï¼š CRC16(â€˜keyâ€™)384 = 6782ã€‚ é‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸ªkey çš„å­˜å‚¨åˆ†é…åˆ° B ä¸Šäº†ã€‚åŒæ ·ï¼Œå½“æˆ‘è¿æ¥(A,B,C)ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æƒ³è·å–â€™keyâ€™è¿™ä¸ªkeyæ—¶ï¼Œä¹Ÿä¼šè¿™æ ·çš„ç®—æ³•ï¼Œç„¶åå†…éƒ¨è·³è½¬åˆ°BèŠ‚ç‚¹ä¸Šè·å–æ•°æ®</p>
<p>æ–°å¢ä¸€ä¸ªä¸»èŠ‚ç‚¹:<br>
æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹Dï¼Œredis clusterçš„è¿™ç§åšæ³•æ˜¯ä»å„ä¸ªèŠ‚ç‚¹çš„å‰é¢å„æ‹¿å–ä¸€éƒ¨åˆ†slotåˆ°Dä¸Šï¼Œæˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„å®è·µä¸­å®éªŒã€‚å¤§è‡´å°±ä¼šå˜æˆè¿™æ ·ï¼š</p>
</li>
<li>
<p>èŠ‚ç‚¹Aè¦†ç›–1365-5460</p>
</li>
<li>
<p>èŠ‚ç‚¹Bè¦†ç›–6827-10922</p>
</li>
<li>
<p>èŠ‚ç‚¹Cè¦†ç›–12288-16383</p>
</li>
<li>
<p>èŠ‚ç‚¹Dè¦†ç›–0-1364,5461-6826,10923-12287</p>
</li>
</ul>
<p>åŒæ ·åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œç§»åŠ¨å®Œæˆåå°±å¯ä»¥åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹äº†ã€‚</p>
<p><strong>b.Redis Clusterä¸»ä»æ¨¡å¼</strong><br>
redis cluster ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼ŒåŠ å…¥äº†ä¸»ä»æ¨¡å¼ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æä¾›æ•°æ®å­˜å–ï¼Œä»èŠ‚ç‚¹åˆ™æ˜¯ä»ä¸»èŠ‚ç‚¹æ‹‰å–æ•°æ®å¤‡ä»½ï¼Œå½“è¿™ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå°±ä¼šæœ‰è¿™ä¸ªä»èŠ‚ç‚¹é€‰å–ä¸€ä¸ªæ¥å……å½“ä¸»èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯é›†ç¾¤ä¸ä¼šæŒ‚æ‰</p>
<p>ä¸Šé¢é‚£ä¸ªä¾‹å­é‡Œ, é›†ç¾¤æœ‰ABCä¸‰ä¸ªä¸»èŠ‚ç‚¹, å¦‚æœè¿™3ä¸ªèŠ‚ç‚¹éƒ½æ²¡æœ‰åŠ å…¥ä»èŠ‚ç‚¹ï¼Œå¦‚æœBæŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°±æ— æ³•è®¿é—®æ•´ä¸ªé›†ç¾¤äº†ã€‚Aå’ŒCçš„slotä¹Ÿæ— æ³•è®¿é—®ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨é›†ç¾¤å»ºç«‹çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¸ºæ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æ·»åŠ äº†ä»èŠ‚ç‚¹, æ¯”å¦‚åƒè¿™æ ·, é›†ç¾¤åŒ…å«ä¸»èŠ‚ç‚¹Aã€Bã€C, ä»¥åŠä»èŠ‚ç‚¹A1ã€B1ã€C1, é‚£ä¹ˆå³ä½¿BæŒ‚æ‰ç³»ç»Ÿä¹Ÿå¯ä»¥ç»§ç»­æ­£ç¡®å·¥ä½œã€‚</p>
<p>B1èŠ‚ç‚¹æ›¿ä»£äº†BèŠ‚ç‚¹ï¼Œæ‰€ä»¥Redisé›†ç¾¤å°†ä¼šé€‰æ‹©B1èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œé›†ç¾¤å°†ä¼šç»§ç»­æ­£ç¡®åœ°æä¾›æœåŠ¡ã€‚ å½“Bé‡æ–°å¼€å¯åï¼Œå®ƒå°±ä¼šå˜æˆB1çš„ä»èŠ‚ç‚¹ã€‚</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œå¦‚æœ<strong>èŠ‚ç‚¹Bå’ŒB1åŒæ—¶æŒ‚äº†ï¼ŒRedisé›†ç¾¤å°±æ— æ³•ç»§ç»­æ­£ç¡®åœ°æä¾›æœåŠ¡äº†</strong>ã€‚</p>
<h5 id="8-Redisé›†ç¾¤çš„ä»£ç†">8.Redisé›†ç¾¤çš„ä»£ç†</h5>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226154729.png" alt="image-20210226154729661"></p>
<p><a href="https://blog.csdn.net/qq_34944535/article/details/106803261?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-5.control&amp;dist_request_id=46a127bd-e7dd-4660-b485-d998c0726304&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-5.control">redis clusterä»£ç†</a></p>
<p>ç›®å‰å¸‚é¢ä¸Šä¸»æµçš„ä»£ç†åŒ…å«ï¼špredixyã€twemproxyã€codisã€redis-cerberuså››æ¬¾ï¼Œè¿™å››æ¬¾å„æœ‰å„çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬é€ä¸ªå¯¹æ¯”è¿›è¡Œå¯¹æ¯”åˆ†æã€‚</p>
<div class="table-box"><table align="center" border="1" cellpadding="1" cellspacing="1"><tbody><tr><td><strong>ç‰¹æ€§</strong></td><td><strong>predixy</strong></td><td><strong>twemproxy</strong></td><td><strong>codis</strong></td><td><strong>redis-cerberus</strong></td></tr><tr><td>é«˜å¯ç”¨</td><td>Redis Sentinelæˆ–Redis Cluster</td><td>ä¸€è‡´æ€§å“ˆå¸Œ</td><td>Redis Sentinel</td><td>Redis Cluster</td></tr><tr><td>å¯æ‰©å±•</td><td>Keyå“ˆå¸Œåˆ†å¸ƒæˆ–Redis Cluster</td><td>Keyå“ˆå¸Œåˆ†å¸ƒ</td><td>Keyå“ˆå¸Œåˆ†å¸ƒ</td><td>Redis Cluster</td></tr><tr><td>å¼€å‘è¯­è¨€</td><td>C++</td><td>C</td><td>GO</td><td>C++</td></tr><tr><td>å¤šçº¿ç¨‹</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>äº‹åŠ¡</td><td>Redis Sentinelæ¨¡å¼å•Redisç»„ä¸‹æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>BLPOP/BRPOP/BLPOPRPUSH</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Pub/Sub</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Script</td><td>æ”¯æŒload</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Scan</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Select DB</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>Redis Clusteråªæœ‰ä¸€ä¸ªDB</td></tr><tr><td>Auth</td><td>æ”¯æŒå®šä¹‰å¤šä¸ªå¯†ç ï¼Œç»™äºˆä¸åŒè¯»å†™åŠç®¡ç†æƒé™å’ŒKeyè®¿é—®ç©ºé—´</td><td>ä¸æ”¯æŒ</td><td>åŒredis</td><td>ä¸æ”¯æŒ</td></tr><tr><td>è¯»ä»èŠ‚ç‚¹</td><td>æ”¯æŒï¼Œå¯å®šä¹‰ä¸°å¯Œè§„åˆ™è¯»æŒ‡å®šçš„ä»èŠ‚ç‚¹</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒï¼Œç®€å•è§„åˆ™</td><td>æ”¯æŒï¼Œç®€å•è§„åˆ™</td></tr><tr><td>å¤šæœºæˆ¿æ”¯æŒ</td><td>æ”¯æŒï¼Œå¯å®šä¹‰ä¸°å¯Œè§„åˆ™è°ƒåº¦æµé‡</td><td>ä¸æ”¯æŒ</td><td>æœ‰é™æ”¯æŒ</td><td>æœ‰é™æ”¯æŒ</td></tr><tr><td>ç»Ÿè®¡ä¿¡æ¯</td><td>ä¸°å¯Œ</td><td>ä¸°å¯Œ</td><td>ä¸°å¯Œ</td><td>ç®€å•</td></tr></tbody></table></div>
]]></content>
      <categories>
        <category>Redis</category>
        <category>ä¸€è‡´æ€§Hashç®—æ³•</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>ä¸€è‡´æ€§Hashç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis çš„å‡»ç©¿ï¼Œç©¿é€ï¼Œé›ªå´©ï¼Œåˆ†å¸ƒå¼é”ï¼Œç¼“å­˜ä¸€è‡´æ€§</title>
    <url>/posts/8f6adc3b/</url>
    <content><![CDATA[<h5 id="1-Redis-çš„å‡»ç©¿ï¼Œç©¿é€ï¼Œé›ªå´©">1. Redis çš„å‡»ç©¿ï¼Œç©¿é€ï¼Œé›ªå´©</h5>
<h6 id="1-1-Redis-å‡»ç©¿">1.1 Redis å‡»ç©¿</h6>
<p><strong>äº§ç”ŸåŸå› </strong>ï¼šåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œåœ¨æŸä¸€æ—¶é—´ç‚¹ï¼Œ<strong>åœ¨é«˜é¢‘è·å–çš„keyåœ¨æ­¤æ—¶è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚ç›´æ¥è¯·æ±‚åˆ°æœåŠ¡å™¨ä¸Š</strong>ï¼Œå¯¼è‡´ç¼“å­˜å‡»ç©¿</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>
<p>å¯ä»¥å°†<strong>çƒ­ç‚¹æ•°æ®è®¾ç½®ä¸ºæ°¸è¿œä¸è¿‡æœŸ</strong>ï¼›</p>
</li>
<li>
<p>åŸºäº <strong>redis</strong> or <strong>zookeeper</strong> å®ç°äº’æ–¥é”ï¼Œç­‰å¾…ç¬¬ä¸€ä¸ªè¯·æ±‚æ„å»ºå®Œç¼“å­˜ä¹‹åï¼Œå†é‡Šæ”¾é”ï¼Œè¿›è€Œå…¶å®ƒè¯·æ±‚æ‰èƒ½é€šè¿‡è¯¥ key è®¿é—®æ•°æ®ã€‚</p>
<blockquote>
<p>redisçš„åˆ†å¸ƒå¼é”ä¸»è¦æ˜¯é€šè¿‡  setnx å‘½ä»¤ï¼Œè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼Œåªæœ‰è¿”å›æ˜¯okçš„æ‰èƒ½å»æ•°æ®åº“ä¸­è·å–æ•°æ®</p>
<p><strong>äº§ç”Ÿé—®é¢˜</strong>ï¼šåœ¨dbç«¯è¶…æ—¶å¯¼è‡´é”è¿‡æœŸ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š é€šè¿‡<strong>zookeeper</strong> å®ç°åˆ†å¸ƒå¼é”</p>
</blockquote>
</li>
</ul>
<h6 id="1-2-Redisç©¿é€">1.2 Redisç©¿é€</h6>
<p>ä¸€èˆ¬æ˜¯å‡ºç°è¿™ç§æƒ…å†µæ˜¯å› ä¸ºæ¶æ„é¢‘ç¹æŸ¥è¯¢æ‰ä¼šå¯¹ç³»ç»Ÿé€ æˆå¾ˆå¤§çš„é—®é¢˜: <strong>keyç¼“å­˜å¹¶ä¸”æ•°æ®åº“ä¸å­˜åœ¨</strong>ï¼Œæ‰€ä»¥<strong>æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šæŸ¥è¯¢æ•°æ®åº“ä»è€Œå¯¼è‡´æ•°æ®åº“å´©æºƒ</strong>ã€‚</p>
<p>**è§£å†³æ–¹æ¡ˆï¼š**ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨</p>
<blockquote>
<p>å¸ƒéš†è¿‡æ»¤å™¨ç¼ºç‚¹ï¼šåªèƒ½å¢åŠ ä¸èƒ½åˆ é™¤</p>
<p>å¯ä½¿ç”¨å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ ï¼Œè®¾ç½®ç©ºkey</p>
</blockquote>
<h6 id="1-3-Redisé›ªå´©">1.3 Redisé›ªå´©</h6>
<p>é›ªå´©æŒ‡çš„æ˜¯<strong>å¤šä¸ªkey</strong>æŸ¥è¯¢å¹¶ä¸”å‡ºç°<strong>é«˜å¹¶å‘</strong>ï¼Œç¼“å­˜ä¸­å¤±æ•ˆæˆ–è€…æŸ¥ä¸åˆ°ï¼Œç„¶åéƒ½å»dbæŸ¥è¯¢ï¼Œä»è€Œå¯¼è‡´dbå‹åŠ›çªç„¶é£™å‡ï¼Œä»è€Œå´©æºƒã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>
<p>æ—¶ç‚¹æ€§æ— å…³:<strong>å‡åŒ€çš„è®¾è®¡è¿‡æœŸæ—¶é—´</strong></p>
</li>
<li>
<p>æ—¶ç‚¹æ€§æœ‰å…³:<strong>å¼ºä¾èµ–å‡»ç©¿çš„æ–¹æ¡ˆ</strong></p>
<p>â€‹					ä¹Ÿå¯åœ¨<strong>ç¨‹åºè®¾è®¡çš„æ—¶å€™åœ¨ä¸šåŠ¡å±‚è¿›è¡Œæ—¶ç‚¹è¿›è¡Œè¯·æ±‚å»¶æ—¶æ“ä½œ</strong></p>
<p>â€‹					å½“çŸ¥é“<strong>æ—¶ç‚¹ä¹‹åçš„æ•°æ®ä¹Ÿå¯ä»¥è¿›è¡Œé¢„åŠ è½½å·¥ä½œ</strong></p>
</li>
<li>
<p>äº‹å‰ï¼šredis é«˜å¯ç”¨ï¼Œä¸»ä»+å“¨å…µï¼Œredis clusterï¼Œé¿å…å…¨ç›˜å´©æºƒã€‚</p>
</li>
<li>
<p>äº‹ä¸­ï¼šæœ¬åœ° ehcache ç¼“å­˜ + hystrix é™æµ&amp;é™çº§ï¼Œé¿å… MySQL è¢«æ‰“æ­»ã€‚</p>
</li>
<li>
<p>äº‹åï¼šredis æŒä¹…åŒ–ï¼Œä¸€æ—¦é‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</p>
<blockquote>
<p>æ—¶ç‚¹æ€§æœ‰å…³æŒ‡<strong>æŸä¸€ä¸ªæ—¶é—´æ®µæŸäº›keyå¿…é¡»è¦è¿‡æœŸä½¿ç”¨æ–°æ•°æ®</strong></p>
</blockquote>
</li>
</ul>
<h5 id="2-Redis-çš„åˆ†å¸ƒå¼é”å®ç°">2. Redis  çš„åˆ†å¸ƒå¼é”å®ç°</h5>
<p>æœ€å¥½æ˜¯ä½¿ç”¨zookeeperå®ç°åˆ†å¸ƒå¼é”</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åŸç†éœ€è¦ä¸‰ä¸ªå…³é”®å…ƒç´ </span><br><span class="line">1. setnx</span><br><span class="line">2.è¿‡æœŸæ—¶é—´</span><br><span class="line">3.å¤šçº¿ç¨‹ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œå»¶é•¿è¿‡æœŸ</span><br></pre></td></tr></table></figure>
<h6 id="2-1-RedisåŠ é”å®ç°">2.1 RedisåŠ é”å®ç°</h6>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisTool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOCK_SUCCESS = <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SET_IF_NOT_EXIST = <span class="string">&quot;NX&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SET_WITH_EXPIRE_TIME = <span class="string">&quot;PX&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è¯•è·å–åˆ†å¸ƒå¼é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jedis Rediså®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lockKey é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestId è¯·æ±‚æ ‡è¯†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expireTime è¶…æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">tryGetDistributedLock</span><span class="params">(Jedis jedis, String lockKey, String requestId, <span class="keyword">int</span> expireTime)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String result = jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (LOCK_SUCCESS.equals(result)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-2-redis-è§£é”ä»£ç ">2.2 redis è§£é”ä»£ç </h6>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisTool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Long RELEASE_SUCCESS = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡Šæ”¾åˆ†å¸ƒå¼é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jedis Rediså®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lockKey é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestId è¯·æ±‚æ ‡è¯†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦é‡Šæ”¾æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">releaseDistributedLock</span><span class="params">(Jedis jedis, String lockKey, String requestId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String script = <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">        Object result = jedis.eval(script, Collections.singletonList(lockKey), Collections.singletonList(requestId));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (RELEASE_SUCCESS.equals(result)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Redisçš„å¼Šç«¯">Redisçš„å¼Šç«¯</h6>
<ul>
<li>æ•°æ®åº“äº‹åŠ¡è¶…æ—¶ï¼Œå¯¼è‡´é”è¿‡æœŸ</li>
<li><code>redis cluster</code>é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå‡å¦‚ç°åœ¨<code>Aå®¢æˆ·ç«¯</code>æƒ³è¦åŠ é”ï¼Œå®ƒä¼šæ ¹æ®è·¯ç”±è§„åˆ™é€‰æ‹©ä¸€å°<code>master</code>èŠ‚ç‚¹å†™å…¥<code>key</code> <code>mylock</code>ï¼Œåœ¨åŠ é”æˆåŠŸåï¼Œ<code>master</code>èŠ‚ç‚¹ä¼šæŠŠ<code>key</code>å¼‚æ­¥å¤åˆ¶ç»™å¯¹åº”çš„<code>slave</code>èŠ‚ç‚¹ã€‚å¦‚æœæ­¤æ—¶<code>redis master</code>èŠ‚ç‚¹å®•æœºï¼Œä¸ºä¿è¯é›†ç¾¤å¯ç”¨æ€§ï¼Œä¼šè¿›è¡Œ<code>ä¸»å¤‡åˆ‡æ¢</code>ï¼Œ<code>slave</code>å˜ä¸ºäº†<code>redis master</code>ã€‚<code>Bå®¢æˆ·ç«¯</code>åœ¨æ–°çš„<code>master</code>èŠ‚ç‚¹ä¸ŠåŠ é”æˆåŠŸï¼Œè€Œ<code>Aå®¢æˆ·ç«¯</code>ä¹Ÿä»¥ä¸ºè‡ªå·±è¿˜æ˜¯æˆåŠŸåŠ äº†é”çš„ã€‚æ­¤æ—¶å°±ä¼šå¯¼è‡´åŒä¸€æ—¶é—´å†…å¤šä¸ªå®¢æˆ·ç«¯å¯¹ä¸€ä¸ªåˆ†å¸ƒå¼é”å®Œæˆäº†åŠ é”ï¼Œå¯¼è‡´å„ç§è„æ•°æ®çš„äº§ç”Ÿã€‚</li>
</ul>
<h5 id="Redis-ç¼“å­˜ä¸€è‡´æ€§">Redis ç¼“å­˜ä¸€è‡´æ€§</h5>
<h6 id="å‡ºç°åœºæ™¯">å‡ºç°åœºæ™¯</h6>
<p>åœ¨<strong>é«˜å¹¶å‘çš„æƒ…å†µ</strong>ä¸‹æ¶‰åŠåˆ°æ•°æ®æ›´æ–°ï¼šæ•°æ®åº“å’Œç¼“å­˜æ›´æ–°ï¼Œå°±å®¹æ˜“å‡ºç°<strong>ç¼“å­˜(Redis)å’Œæ•°æ®åº“ï¼ˆMySQLï¼‰é—´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong>ã€‚</p>
<p>ä¸ç®¡æ˜¯å…ˆå†™MySQLæ•°æ®åº“ï¼Œå†åˆ é™¤Redisç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>1.å¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p>
<p>2.å¦‚æœå…ˆå†™äº†åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</p>
<p>å› ä¸º<strong>å†™å’Œè¯»æ˜¯å¹¶å‘</strong>çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåº,å°±ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<h6 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h6>
<p><strong>1.ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥</strong></p>
<p>åœ¨å†™åº“å‰åéƒ½è¿›è¡Œredis.del(key)æ“ä½œï¼Œå¹¶ä¸”è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚</p>
<p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String key,Object data)</span></span>&#123;</span><br><span class="line"> redis.delKey(key);</span><br><span class="line"> db.updateData(data);</span><br><span class="line"> Thread.sleep(<span class="number">500</span>);</span><br><span class="line"> redis.delKey(key);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>å…·ä½“çš„æ­¥éª¤å°±æ˜¯ï¼š</strong></p>
<ul>
<li>å…ˆåˆ é™¤ç¼“å­˜ï¼›</li>
<li>å†å†™æ•°æ®åº“ï¼›</li>
<li>ä¼‘çœ 500æ¯«ç§’ï¼›</li>
<li>å†æ¬¡åˆ é™¤ç¼“å­˜</li>
</ul>
<p><strong>è¯¥æ–¹æ¡ˆçš„å¼Šç«¯</strong></p>
<p>ç»“åˆ<strong>åŒåˆ ç­–ç•¥+ç¼“å­˜è¶…æ—¶è®¾ç½®</strong>ï¼Œè¿™æ ·<strong>æœ€å·®çš„æƒ…å†µå°±æ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ•°æ®å­˜åœ¨ä¸ä¸€è‡´ï¼Œè€Œä¸”åˆå¢åŠ äº†å†™è¯·æ±‚çš„è€—æ—¶ã€‚</strong></p>
<p><strong>2ã€ç¬¬äºŒç§æ–¹æ¡ˆï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)</strong></p>
<p>MySQL binlogå¢é‡è®¢é˜…æ¶ˆè´¹+æ¶ˆæ¯é˜Ÿåˆ—+å¢é‡æ•°æ®æ›´æ–°åˆ°redis</p>
<ul>
<li><strong>è¯»Redis</strong>ï¼šçƒ­æ•°æ®åŸºæœ¬éƒ½åœ¨Redis</li>
<li><strong>å†™MySQL</strong>:å¢åˆ æ”¹éƒ½æ˜¯æ“ä½œMySQL</li>
<li><strong>æ›´æ–°Redisæ•°æ®</strong>ï¼šMySQçš„æ•°æ®æ“ä½œbinlogï¼Œæ¥æ›´æ–°åˆ°Redis</li>
</ul>
<p><strong>1ï¼‰æ•°æ®æ“ä½œä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼š</strong></p>
<ul>
<li>ä¸€ä¸ªæ˜¯å…¨é‡(å°†å…¨éƒ¨æ•°æ®ä¸€æ¬¡å†™å…¥åˆ°redis)</li>
<li>ä¸€ä¸ªæ˜¯å¢é‡ï¼ˆå®æ—¶æ›´æ–°ï¼‰</li>
</ul>
<p>è¿™é‡Œè¯´çš„æ˜¯å¢é‡,æŒ‡çš„æ˜¯mysqlçš„updateã€insertã€delateå˜æ›´æ•°æ®ã€‚</p>
<p><strong>2ï¼‰è¯»å–binlogååˆ†æ ï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—,æ¨é€æ›´æ–°å„å°çš„redisç¼“å­˜æ•°æ®ã€‚</strong></p>
<p>è¿™æ ·ä¸€æ—¦MySQLä¸­äº§ç”Ÿäº†æ–°çš„å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œå°±å¯ä»¥æŠŠbinlogç›¸å…³çš„æ¶ˆæ¯æ¨é€è‡³Redisï¼ŒRediså†æ ¹æ®binlogä¸­çš„è®°å½•ï¼Œå¯¹Redisè¿›è¡Œæ›´æ–°ã€‚</p>
<p>å…¶å®è¿™ç§æœºåˆ¶ï¼Œå¾ˆç±»ä¼¼MySQLçš„ä¸»ä»å¤‡ä»½æœºåˆ¶ï¼Œå› ä¸ºMySQLçš„ä¸»å¤‡ä¹Ÿæ˜¯é€šè¿‡binlogæ¥å®ç°çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p><strong>æ¶ˆæ¯æ¨é€å·¥å…·</strong>ä½ ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ«çš„ç¬¬ä¸‰æ–¹ï¼škafkaã€rabbitMQç­‰æ¥å®ç°æ¨é€æ›´æ–°Redisã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</title>
    <url>/posts/99e6d3f8/</url>
    <content><![CDATA[<h1>è®¾è®¡æ¨¡å¼çš„6å¤§è®¾è®¡åŸåˆ™</h1>
<ol>
<li>å•ä¸€èŒè´£åŸåˆ™</li>
<li>é‡Œæ°æ›¿æ¢åŸåˆ™</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™</li>
<li>æ¥å£éš”ç¦»åŸåˆ™</li>
<li>è¿ªç±³ç‰¹æ³•åˆ™</li>
<li>å¼€é—­åŸåˆ™</li>
</ol>
<h2 id="å•ä¸€èŒè´£åŸåˆ™">å•ä¸€èŒè´£åŸåˆ™</h2>
<p>ä¸€ä¸ªç±»åº”è¯¥æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ï¼Œå¦åˆ™ç±»åº”è¯¥è¢«æ‹†åˆ†ã€‚æ ¸å¿ƒå°±æ˜¯æ§åˆ¶ç±»çš„ç²’åº¦å¤§å°ã€å°†å¯¹è±¡è§£è€¦ã€æé«˜å…¶å†…èšæ€§</p>
<h3 id="ä½œç”¨">ä½œç”¨</h3>
<p>1ã€é™ä½ç±»çš„å¤æ‚åº¦ã€‚ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ï¼Œå…¶é€»è¾‘è‚¯å®šè¦æ¯”è´Ÿè´£å¤šé¡¹èŒè´£ç®€å•å¾—å¤šã€‚</p>
<p>2ã€æé«˜ç±»çš„å¯è¯»æ€§ã€‚å¤æ‚æ€§é™ä½ï¼Œè‡ªç„¶å…¶å¯è¯»æ€§ä¼šæé«˜ã€‚</p>
<p>3ã€æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚å¯è¯»æ€§æé«˜ï¼Œé‚£è‡ªç„¶æ›´å®¹æ˜“ç»´æŠ¤äº†ã€‚</p>
<p>4ã€å˜æ›´å¼•èµ·çš„é£é™©é™ä½ã€‚å˜æ›´æ˜¯å¿…ç„¶çš„ï¼Œå¦‚æœå•ä¸€èŒè´£åŸåˆ™éµå®ˆå¾—å¥½ï¼Œå½“ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œå¯ä»¥æ˜¾è‘—é™ä½å¯¹å…¶ä»–åŠŸèƒ½çš„å½±å“ã€‚</p>
<h2 id="é‡Œæ°æ›¿æ¢åŸåˆ™">é‡Œæ°æ›¿æ¢åŸåˆ™</h2>
<p>ç»§æ‰¿å¿…é¡»ç¡®ä¿è¶…ç±»æ‰€æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¸­ä»ç„¶æˆç«‹ã€‚å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½</p>
<h3 id="ä½œç”¨-2">ä½œç”¨</h3>
<ol>
<li>å…‹æœäº†ç»§æ‰¿ä¸­é‡å†™çˆ¶ç±»é€ æˆçš„å¯å¤ç”¨æ€§å˜å·®çš„ç¼ºç‚¹</li>
<li>ä¿è¯äº†åŠ¨ä½œæ­£ç¡®æ€§ã€‚å³ç±»çš„æ‰©å±•ä¸ä¼šç»™å·²æœ‰çš„ç³»ç»Ÿå¼•å…¥æ–°çš„é”™è¯¯ï¼Œé™ä½äº†ä»£ç å‡ºé”™çš„å¯èƒ½æ€§ã€‚</li>
</ol>
<h3 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼</h3>
<p><strong>ç»§æ‰¿ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½å¤–</strong>ï¼Œå°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•</p>
<h2 id="ä¾èµ–å€’ç½®åŸåˆ™">ä¾èµ–å€’ç½®åŸåˆ™</h2>
<p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<font color=red>è¦é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é¢å‘å®ç°ç¼–ç¨‹</font>ã€‚</p>
<h3 id="ä½œç”¨-3">ä½œç”¨</h3>
<ol>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥é™ä½ç±»é—´çš„è€¦åˆæ€§ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥å‡å°‘å¹¶è¡Œå¼€å‘å¼•èµ·çš„é£é™©ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</li>
</ol>
<h3 id="å®ç°æ–¹å¼-2">å®ç°æ–¹å¼</h3>
<ol>
<li>æ¯ä¸ªç±»å°½é‡æä¾›æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…·å¤‡ã€‚</li>
<li>å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æ¥å£æˆ–è€…æ˜¯æŠ½è±¡ç±»ã€‚</li>
<li>ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿã€‚</li>
<li>ä½¿ç”¨ç»§æ‰¿æ—¶å°½é‡éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™</li>
</ol>
<h2 id="æ¥å£éš”ç¦»åŸåˆ™">æ¥å£éš”ç¦»åŸåˆ™</h2>
<p>å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–äºå®ƒä¸ä½¿ç”¨çš„æ–¹æ³•ï¼Œä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š</p>
<h3 id="ä½œç”¨-4">ä½œç”¨</h3>
<ol>
<li>å°†è‡ƒè‚¿åºå¤§çš„æ¥å£åˆ†è§£ä¸ºå¤šä¸ªç²’åº¦å°çš„æ¥å£ï¼Œå¯ä»¥é¢„é˜²å¤–æ¥å˜æ›´çš„æ‰©æ•£ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>æ¥å£éš”ç¦»æé«˜äº†ç³»ç»Ÿçš„å†…èšæ€§ï¼Œå‡å°‘äº†å¯¹å¤–äº¤äº’ï¼Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆæ€§ã€‚</li>
<li>å¦‚æœæ¥å£çš„ç²’åº¦å¤§å°å®šä¹‰åˆç†ï¼Œèƒ½å¤Ÿä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼›ä½†æ˜¯ï¼Œå¦‚æœå®šä¹‰è¿‡å°ï¼Œåˆ™ä¼šé€ æˆæ¥å£æ•°é‡è¿‡å¤šï¼Œä½¿è®¾è®¡å¤æ‚åŒ–ï¼›å¦‚æœå®šä¹‰å¤ªå¤§ï¼Œçµæ´»æ€§é™ä½ï¼Œæ— æ³•æä¾›å®šåˆ¶æœåŠ¡ï¼Œç»™æ•´ä½“é¡¹ç›®å¸¦æ¥æ— æ³•é¢„æ–™çš„é£é™©ã€‚</li>
<li>ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£è¿˜èƒ½å¤Ÿä½“ç°å¯¹è±¡çš„å±‚æ¬¡ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ¥å£çš„ç»§æ‰¿ï¼Œå®ç°å¯¹æ€»æ¥å£çš„å®šä¹‰ã€‚</li>
<li>èƒ½å‡å°‘é¡¹ç›®å·¥ç¨‹ä¸­çš„ä»£ç å†—ä½™ã€‚è¿‡å¤§çš„å¤§æ¥å£é‡Œé¢é€šå¸¸æ”¾ç½®è®¸å¤šä¸ç”¨çš„æ–¹æ³•ï¼Œå½“å®ç°è¿™ä¸ªæ¥å£çš„æ—¶å€™ï¼Œè¢«è¿«è®¾è®¡å†—ä½™çš„ä»£ç ã€‚</li>
</ol>
<h3 id="å®ç°æ–¹å¼-3">å®ç°æ–¹å¼</h3>
<ol>
<li>æ¥å£å°½é‡å°ï¼Œä½†æ˜¯è¦æœ‰é™åº¦ã€‚ä¸€ä¸ªæ¥å£åªæœåŠ¡äºä¸€ä¸ªå­æ¨¡å—æˆ–ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>ä¸ºä¾èµ–æ¥å£çš„ç±»å®šåˆ¶æœåŠ¡ã€‚åªæä¾›è°ƒç”¨è€…éœ€è¦çš„æ–¹æ³•ï¼Œå±è”½ä¸éœ€è¦çš„æ–¹æ³•ã€‚</li>
<li>äº†è§£ç¯å¢ƒï¼Œæ‹’ç»ç›²ä»ã€‚æ¯ä¸ªé¡¹ç›®æˆ–äº§å“éƒ½æœ‰é€‰å®šçš„ç¯å¢ƒå› ç´ ï¼Œç¯å¢ƒä¸åŒï¼Œæ¥å£æ‹†åˆ†çš„æ ‡å‡†å°±ä¸åŒæ·±å…¥äº†è§£ä¸šåŠ¡é€»è¾‘ã€‚</li>
</ol>
<h2 id="è¿ªç±³ç‰¹æ³•åˆ™">è¿ªç±³ç‰¹æ³•åˆ™</h2>
<p>å¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è°ƒç”¨é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§</p>
<h2 id="ä½œç”¨-5">ä½œç”¨</h2>
<ol>
<li>é™ä½äº†ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜äº†æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚</li>
<li>ç”±äºäº²åˆåº¦é™ä½ï¼Œä»è€Œæé«˜äº†ç±»çš„å¯å¤ç”¨ç‡å’Œç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚</li>
</ol>
<h2 id="å®ç°æ–¹å¼-4">å®ç°æ–¹å¼</h2>
<p><strong>é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è°ƒç”¨é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§</strong></p>
<h2 id="å¼€é—­åŸåˆ™">å¼€é—­åŸåˆ™</h2>
<p>å½“åº”ç”¨çš„éœ€æ±‚æ”¹å˜æ—¶ï¼Œåœ¨ä¸ä¿®æ”¹è½¯ä»¶å®ä½“çš„æºä»£ç æˆ–è€…äºŒè¿›åˆ¶ä»£ç çš„å‰æä¸‹ï¼Œå¯ä»¥æ‰©å±•æ¨¡å—çš„åŠŸèƒ½ï¼Œä½¿å…¶æ»¡è¶³æ–°çš„éœ€æ±‚ã€‚</p>
<h2 id="ä½œç”¨-6">ä½œç”¨</h2>
<ol>
<li>æ–¹ä¾¿æµ‹è¯•ï¼›æµ‹è¯•æ—¶åªéœ€è¦å¯¹æ‰©å±•çš„ä»£ç è¿›è¡Œæµ‹è¯•ã€‚</li>
<li>æé«˜ä»£ç çš„å¯å¤ç”¨æ€§ï¼›ç²’åº¦è¶Šå°ï¼Œè¢«å¤ç”¨çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚</li>
<li>æé«˜è½¯ä»¶çš„ç¨³å®šæ€§å’Œå»¶ç»­æ€§ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚</li>
</ol>
<h2 id="å®ç°æ–¹å¼-5">å®ç°æ–¹å¼</h2>
<p>é€šè¿‡â€œæŠ½è±¡çº¦æŸã€å°è£…å˜åŒ–â€æ¥å®ç°å¼€é—­åŸåˆ™ã€‚é€šè¿‡æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸ºè½¯ä»¶å®ä½“å®šä¹‰ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„æŠ½è±¡å±‚ï¼Œè€Œå°†ç›¸åŒçš„å¯å˜å› ç´ å°è£…åœ¨ç›¸åŒçš„å…·ä½“å®ç°ç±»</p>
<h1>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h1>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>æ ¹æ®å…¶<strong>ç›®çš„</strong>ï¼ˆæ¨¡å¼æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼‰å¯åˆ†ä¸º<strong>åˆ›å»ºå‹</strong>(Creational)ï¼Œ<strong>ç»“æ„å‹</strong>(Structural)å’Œ<strong>è¡Œä¸ºå‹</strong>(Behavioral)ä¸‰ç§ï¼š</p>
<ul>
<li>**åˆ›å»ºå‹æ¨¡å¼ï¼š**ä½œç”¨äºå¯¹è±¡çš„åˆ›å»ºï¼Œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»ã€‚å…¶ä¸­å›Šæ‹¬äº†<font color=red>å•ä¾‹ã€åŸå‹ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€å»ºé€ è€…</font>5 ç§åˆ›å»ºå‹æ¨¡å¼ã€‚</li>
<li>**ç»“æ„å‹æ¨¡å¼ï¼š**å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ï¼Œå…¶ä¸­ä»¥<font color=red>ä»£ç†ã€é€‚é…å™¨ã€æ¡¥æ¥ã€è£…é¥°ã€å¤–è§‚ã€äº«å…ƒã€ç»„åˆ</font> 7 ç§ç»“æ„å‹æ¨¡å¼ä¸ºä¸»ã€‚</li>
<li>**è¡Œä¸ºå‹æ¨¡å¼ï¼š**ä½œç”¨äºç±»æˆ–å¯¹è±¡ä¹‹é—´ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚ä¸»è¦åŒ…å«äº†<font color=red>æ¨¡æ¿æ–¹æ³•ã€ç­–ç•¥ã€å‘½ä»¤ã€èŒè´£é“¾ã€çŠ¶æ€ã€è§‚å¯Ÿè€…ã€ä¸­ä»‹è€…ã€è¿­ä»£å™¨ã€è®¿é—®è€…ã€å¤‡å¿˜å½•ã€è§£é‡Šå™¨</font>ç­‰ 11 ç§è¡Œä¸ºå‹æ¨¡å¼ã€‚</li>
</ul>
<h2 id="èŒƒå›´">èŒƒå›´</h2>
<p>æ ¹æ®<strong>èŒƒå›´</strong>ï¼ˆæ¨¡å¼ä¸»è¦æ˜¯ç”¨äºå¤„ç†ç±»ä¹‹é—´å…³ç³»è¿˜æ˜¯å¤„ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼‰å¯åˆ†ä¸º<strong>ç±»æ¨¡å¼</strong>å’Œ<strong>å¯¹è±¡æ¨¡å¼</strong>ä¸¤ç§ï¼š</p>
<ul>
<li>**ç±»æ¨¡å¼ï¼š**ç”¨äºå¤„ç†ç±»ä¸å­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œè¿™äº›å…³ç³»é€šè¿‡ç»§æ‰¿æ¥å»ºç«‹ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ»ä¾¿ç¡®å®šä¸‹æ¥äº†ã€‚<font color=red>å·¥å‚ã€ï¼ˆç±»ï¼‰é€‚é…å™¨ã€æ¨¡æ¿æ–¹æ³•ã€è§£é‡Šå™¨å‡å±äºè¯¥æ¨¡å¼</font>ã€‚</li>
<li>**å¯¹è±¡æ¨¡å¼ï¼š**ç”¨äºå¤„ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œè¿™äº›å…³ç³»å¯ä»¥é€šè¿‡ç»„åˆæˆ–èšåˆæ¥å®ç°ï¼Œåœ¨è¿è¡Œæ—¶åˆ»æ˜¯å¯ä»¥å˜åŒ–çš„ï¼Œæ›´å…·åŠ¨æ€æ€§ã€‚<font color=red>é™¤äº†ä»¥ä¸Š 4 ç§ï¼Œå…¶ä»–çš„éƒ½æ˜¯å¯¹è±¡æ¨¡å¼</font>ã€‚</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304101452.png" alt=""></p>
<h1>è®¾è®¡æ¨¡å¼çš„åŠŸèƒ½</h1>
<ol>
<li>**å•ä¾‹ï¼ˆSingletonï¼‰æ¨¡å¼ï¼š**æŸä¸ªç±»åªèƒ½ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œè¯¥ç±»æä¾›äº†ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ä¾›å¤–éƒ¨è·å–è¯¥å®ä¾‹ï¼Œå…¶æ‹“å±•æ˜¯æœ‰é™å¤šä¾‹æ¨¡å¼ã€‚</li>
<li>**åŸå‹ï¼ˆPrototypeï¼‰æ¨¡å¼ï¼š**å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œé€šè¿‡å¯¹å…¶è¿›è¡Œå¤åˆ¶è€Œå…‹éš†å‡ºå¤šä¸ªå’ŒåŸå‹ç±»ä¼¼çš„æ–°å®ä¾‹ã€‚</li>
<li>**å·¥å‚ï¼ˆFactory Methodï¼‰æ¨¡å¼ï¼š**å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºäº§å“çš„æ¥å£ï¼Œç”±å­ç±»å†³å®šç”Ÿäº§ä»€ä¹ˆäº§å“ã€‚</li>
<li>**æŠ½è±¡å·¥å‚ï¼ˆAbstractFactoryï¼‰æ¨¡å¼ï¼š**æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“æ—çš„æ¥å£ï¼Œå…¶æ¯ä¸ªå­ç±»å¯ä»¥ç”Ÿäº§ä¸€ç³»åˆ—ç›¸å…³çš„äº§å“ã€‚</li>
<li>**å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼ï¼š**å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡åˆ†è§£æˆå¤šä¸ªç›¸å¯¹ç®€å•çš„éƒ¨åˆ†ï¼Œç„¶åæ ¹æ®ä¸åŒéœ€è¦åˆ†åˆ«åˆ›å»ºå®ƒä»¬ï¼Œæœ€åæ„å»ºæˆè¯¥å¤æ‚å¯¹è±¡ã€‚</li>
<li>**ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼ï¼š**ä¸ºæŸå¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚å³å®¢æˆ·ç«¯é€šè¿‡ä»£ç†é—´æ¥åœ°è®¿é—®è¯¥å¯¹è±¡ï¼Œä»è€Œé™åˆ¶ã€å¢å¼ºæˆ–ä¿®æ”¹è¯¥å¯¹è±¡çš„ä¸€äº›ç‰¹æ€§ã€‚</li>
<li>**é€‚é…å™¨ï¼ˆAdapterï¼‰æ¨¡å¼ï¼š**å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»èƒ½ä¸€èµ·å·¥ä½œã€‚</li>
<li>**æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼ï¼š**å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚å®ƒæ˜¯ç”¨ç»„åˆå…³ç³»ä»£æ›¿ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œä»è€Œé™ä½äº†æŠ½è±¡å’Œå®ç°è¿™ä¸¤ä¸ªå¯å˜ç»´åº¦çš„è€¦åˆåº¦ã€‚</li>
<li>**è£…é¥°ï¼ˆDecoratorï¼‰æ¨¡å¼ï¼š**åŠ¨æ€çš„ç»™å¯¹è±¡å¢åŠ ä¸€äº›èŒè´£ï¼Œå³å¢åŠ å…¶é¢å¤–çš„åŠŸèƒ½ã€‚</li>
<li>**å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼ï¼š**ä¸ºå¤šä¸ªå¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œä½¿è¿™äº›å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è¢«è®¿é—®ã€‚</li>
<li>**äº«å…ƒï¼ˆFlyweightï¼‰æ¨¡å¼ï¼š**è¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚</li>
<li>**ç»„åˆï¼ˆCompositeï¼‰æ¨¡å¼ï¼š**å°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶å±‚æ¬¡ç»“æ„ï¼Œä½¿ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡å…·æœ‰ä¸€è‡´çš„è®¿é—®æ€§ã€‚</li>
<li>**æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateMethodï¼‰æ¨¡å¼ï¼š**å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜è¯¥ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</li>
<li>**ç­–ç•¥ï¼ˆStrategyï¼‰æ¨¡å¼ï¼š**å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„æ”¹å˜ä¸ä¼šå½±å“ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</li>
<li>**å‘½ä»¤ï¼ˆCommandï¼‰æ¨¡å¼ï¼š**å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚</li>
<li>**èŒè´£é“¾ï¼ˆChain of Responsibilityï¼‰æ¨¡å¼ï¼š**æŠŠè¯·æ±‚ä»é“¾ä¸­çš„ä¸€ä¸ªå¯¹è±¡ä¼ åˆ°ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œç›´åˆ°è¯·æ±‚è¢«å“åº”é€šè¿‡è¿™ç§æ–¹å¼å»é™¤å¯¹è±¡ä¹‹é—´çš„è€¦åˆã€‚</li>
<li>**çŠ¶æ€ï¼ˆStateï¼‰æ¨¡å¼ï¼š**å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºèƒ½åŠ›ã€‚</li>
<li>**è§‚å¯Ÿè€…ï¼ˆObserverï¼‰æ¨¡å¼ï¼š**å¤šä¸ªå¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒæŠŠè¿™ç§æ”¹å˜é€šçŸ¥ç»™å…¶ä»–å¤šä¸ªå¯¹è±¡ï¼Œä»è€Œå½±å“å…¶ä»–å¯¹è±¡çš„è¡Œä¸ºã€‚</li>
<li>**ä¸­ä»‹è€…ï¼ˆMediatorï¼‰æ¨¡å¼ï¼š**å®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥ç®€åŒ–åŸæœ‰å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œé™ä½ç³»ç»Ÿä¸­å¯¹è±¡é—´çš„è€¦åˆåº¦ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´ä¸å¿…ç›¸äº’äº†è§£ã€‚</li>
<li>**è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¨¡å¼ï¼š**æä¾›ä¸€ç§æ–¹æ³•æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</li>
<li>**è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼ï¼š**åœ¨ä¸æ”¹å˜é›†åˆå…ƒç´ çš„å‰æä¸‹ï¼Œä¸ºä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›å¤šç§è®¿é—®æ–¹å¼ï¼Œå³æ¯ä¸ªå…ƒç´ æœ‰å¤šä¸ªè®¿é—®è€…å¯¹è±¡è®¿é—®ã€‚</li>
<li>**å¤‡å¿˜å½•ï¼ˆMementoï¼‰æ¨¡å¼ï¼š**åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œè·å–å¹¶ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åæ¢å¤å®ƒã€‚</li>
<li>**è§£é‡Šå™¨ï¼ˆInterpreterï¼‰æ¨¡å¼ï¼š**æä¾›å¦‚ä½•å®šä¹‰è¯­è¨€çš„æ”¾æ³•ï¼Œä»¥åŠå¯¹è¯­è¨€å¥å­çš„è§£é‡Šæ–¹æ³•ï¼Œå³è§£é‡Šå™¨ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisåˆ†å¸ƒå¼é”å®ç°</title>
    <url>/posts/bfb49b3b/</url>
    <content><![CDATA[<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>ç³»ç»Ÿä¸­ä¿®æ”¹å·²æœ‰æ•°æ®æ—¶ï¼Œéœ€è¦å…ˆè¯»å–ï¼Œç„¶åè¿›è¡Œä¿®æ”¹ä¿å­˜ï¼Œæ­¤æ—¶å¾ˆå®¹æ˜“é‡åˆ°å¹¶å‘é—®é¢˜ã€‚ç”±äºä¿®æ”¹å’Œä¿å­˜ä¸æ˜¯åŸå­æ“ä½œï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œéƒ¨åˆ†å¯¹æ•°æ®çš„æ“ä½œå¯èƒ½ä¼šä¸¢å¤±ã€‚<font color=red> åœ¨å•æœåŠ¡å™¨ç³»ç»Ÿæˆ‘ä»¬å¸¸ç”¨æœ¬åœ°é”æ¥é¿å…å¹¶å‘å¸¦æ¥çš„é—®é¢˜ï¼Œç„¶è€Œï¼Œå½“æœåŠ¡é‡‡ç”¨é›†ç¾¤æ–¹å¼éƒ¨ç½²æ—¶ï¼Œæœ¬åœ°é”æ— æ³•åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ç”Ÿæ•ˆï¼Œè¿™æ—¶å€™ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å°±éœ€è¦åˆ†å¸ƒå¼é”æ¥å®ç°ã€‚</font></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210319153632.png" alt="image-20210319153632272"></p>
<h2 id="å®ç°">å®ç°</h2>
<p>Redis é”ä¸»è¦åˆ©ç”¨ Redis çš„ setnx å‘½ä»¤ã€‚</p>
<ul>
<li>
<p><strong>åŠ é”å‘½ä»¤</strong>ï¼šSETNX key valueï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œå¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œå¹¶è¿”å›æˆåŠŸï¼Œå¦åˆ™è¿”å›å¤±è´¥ã€‚<strong>KEY æ˜¯é”çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€èˆ¬æŒ‰ä¸šåŠ¡æ¥å†³å®šå‘½å</strong>ã€‚</p>
</li>
<li>
<p><strong>è§£é”å‘½ä»¤</strong>ï¼šDEL keyï¼Œé€šè¿‡åˆ é™¤é”®å€¼å¯¹é‡Šæ”¾é”ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥é€šè¿‡ SETNX å‘½ä»¤æ¥è·å–é”ã€‚</p>
</li>
<li>
<p><strong>é”è¶…æ—¶</strong>ï¼šEXPIRE key timeout, è®¾ç½® key çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥ä¿è¯å³ä½¿é”æ²¡æœ‰è¢«æ˜¾å¼é‡Šæ”¾ï¼Œé”ä¹Ÿå¯ä»¥åœ¨ä¸€å®šæ—¶é—´åè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…èµ„æºè¢«æ°¸è¿œé”ä½ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210320105659.png" alt="åŠ é”æµç¨‹"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210320105725.png" alt="è§£é”æµç¨‹"></p>
</li>
</ul>
<h3 id="è‡ªå®šä¹‰å®ç°">è‡ªå®šä¹‰å®ç°</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockServiceRedisImpl</span> <span class="keyword">implements</span> <span class="title">LockService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Log log = LogFactory.getLog(LockServiceRedisImpl.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String SET_SUCCESS = <span class="string">&quot;OK&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String KEY_PRE = <span class="string">&quot;REDIS_LOCK_&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyyMMddHHmmssSSS&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> RedisConnection redisConnection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer dbIndex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer lockExpirseTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer tryExpirseTime;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedisConnection</span><span class="params">(RedisConnection redisConnection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.redisConnection = redisConnection;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDbIndex</span><span class="params">(Integer dbIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dbIndex = dbIndex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLockExpirseTime</span><span class="params">(Integer lockExpirseTime)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.lockExpirseTime = lockExpirseTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTryExpirseTime</span><span class="params">(Integer tryExpirseTime)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.tryExpirseTime = tryExpirseTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">lock</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        jedis = redisConnection.getJedis();</span><br><span class="line">        jedis.select(dbIndex);</span><br><span class="line">        key = KEY_PRE + key;</span><br><span class="line">        String value = fetchLockValue();</span><br><span class="line">        <span class="keyword">if</span> (SET_SUCCESS.equals(jedis.set(key, value, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, lockExpirseTime))) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;Reids Lock key : &quot;</span> + key + <span class="string">&quot;,value : &quot;</span> + value);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">tryLock</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        jedis = redisConnection.getJedis();</span><br><span class="line">        jedis.select(dbIndex);</span><br><span class="line">        key = KEY_PRE + key;</span><br><span class="line">        String value = fetchLockValue();</span><br><span class="line">        Long firstTryTime = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (SET_SUCCESS.equals(jedis.set(key, value, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, lockExpirseTime))) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;Reids Lock key : &quot;</span> + key + <span class="string">&quot;,value : &quot;</span> + value);</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(<span class="string">&quot;Redis lock failure,waiting try next&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> ((<span class="keyword">new</span> Date().getTime() - tryExpirseTime * <span class="number">1000</span>) &lt; firstTryTime);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">unLock</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">    Long RELEASE_SUCCESS = <span class="number">1L</span>;</span><br><span class="line">    Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        jedis = redisConnection.getJedis();</span><br><span class="line">        jedis.select(dbIndex);</span><br><span class="line">        key = KEY_PRE + key;</span><br><span class="line">        String command = <span class="string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1])==ARGV[1] then return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (RELEASE_SUCCESS.equals(jedis.eval(command, Collections.singletonList(key), Collections.singletonList(value)))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”ŸæˆåŠ é”çš„å”¯ä¸€å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å”¯ä¸€å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">fetchLockValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UUID.randomUUID().toString() + <span class="string">&quot;_&quot;</span> + df.format(<span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="redissonå®ç°">redissonå®ç°</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Config config = <span class="keyword">new</span> Config();</span><br><span class="line">config.useClusterServers()</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.101:7001&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.101:7002&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.101:7003&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.102:7001&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.102:7002&quot;</span>)</span><br><span class="line">.addNodeAddress(<span class="string">&quot;redis://192.168.31.102:7003&quot;</span>);</span><br><span class="line"></span><br><span class="line">RedissonClient redisson = Redisson.create(config);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RLock lock = redisson.getLock(<span class="string">&quot;anyLock&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line">lock.unlock();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">redlockç®—æ³•redissonä½¿ç”¨</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">RedissonClient redisson = Redisson.create(config);</span><br><span class="line">RLock lock1 = redisson.getFairLock(<span class="string">&quot;lock1&quot;</span>);</span><br><span class="line">RLock lock2 = redisson.getFairLock(<span class="string">&quot;lock2&quot;</span>);</span><br><span class="line">RLock lock3 = redisson.getFairLock(<span class="string">&quot;lock3&quot;</span>);</span><br><span class="line">RedissonRedLock multiLock = <span class="keyword">new</span> RedissonRedLock(lock1, lock2, lock3);</span><br><span class="line">multiLock.lock();</span><br><span class="line">multiLock.unlock();</span><br></pre></td></tr></table></figure>
<p>åªéœ€è¦é€šè¿‡å®ƒçš„apiä¸­çš„lockå’Œunlockå³å¯å®Œæˆåˆ†å¸ƒå¼é”ï¼Œredissonå¸®æˆ‘ä»¬è€ƒè™‘äº†å¾ˆå¤šç»†èŠ‚ï¼š</p>
<ul>
<li>redissonæ‰€æœ‰æŒ‡ä»¤éƒ½é€šè¿‡luaè„šæœ¬æ‰§è¡Œï¼Œredisæ”¯æŒluaè„šæœ¬åŸå­æ€§æ‰§è¡Œ</li>
<li>redissonè®¾ç½®ä¸€ä¸ªkeyçš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30s,å¦‚æœæŸä¸ªå®¢æˆ·ç«¯æŒæœ‰ä¸€ä¸ªé”è¶…è¿‡äº†30sæ€ä¹ˆåŠï¼Ÿ<br>
redissonä¸­æœ‰ä¸€ä¸ª<code>watchdog</code>çš„æ¦‚å¿µï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯çœ‹é—¨ç‹—ï¼Œå®ƒä¼šåœ¨ä½ è·å–é”ä¹‹åï¼Œæ¯éš”10ç§’å¸®ä½ æŠŠkeyçš„è¶…æ—¶æ—¶é—´è®¾ä¸º30s<br>
è¿™æ ·çš„è¯ï¼Œå°±ç®—ä¸€ç›´æŒæœ‰é”ä¹Ÿä¸ä¼šå‡ºç°keyè¿‡æœŸäº†ï¼Œå…¶ä»–çº¿ç¨‹è·å–åˆ°é”çš„é—®é¢˜äº†ã€‚</li>
<li>redissonçš„â€œçœ‹é—¨ç‹—â€é€»è¾‘ä¿è¯äº†æ²¡æœ‰æ­»é”å‘ç”Ÿã€‚<br>
(å¦‚æœæœºå™¨å®•æœºäº†ï¼Œçœ‹é—¨ç‹—ä¹Ÿå°±æ²¡äº†ã€‚æ­¤æ—¶å°±ä¸ä¼šå»¶é•¿keyçš„è¿‡æœŸæ—¶é—´ï¼Œåˆ°äº†30sä¹‹åå°±ä¼šè‡ªåŠ¨è¿‡æœŸäº†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è·å–åˆ°é”)</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210320104911.png" alt="image-20210320104911157"></p>
<p>å…¶å®ç°ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ é”é€»è¾‘</span></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">RFuture&lt;Long&gt; <span class="title">tryAcquireAsync</span><span class="params">(<span class="keyword">long</span> leaseTime, TimeUnit unit, <span class="keyword">final</span> <span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaseTime != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> tryLockInnerAsync(leaseTime, unit, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ä¸€æ®µluaè„šæœ¬ï¼Œè®¾ç½®ä¸€äº›keyã€è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    RFuture&lt;Long&gt; ttlRemainingFuture = tryLockInnerAsync(commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(), TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    ttlRemainingFuture.addListener(<span class="keyword">new</span> FutureListener&lt;Long&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(Future&lt;Long&gt; future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!future.isSuccess()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Long ttlRemaining = future.getNow();</span><br><span class="line">            <span class="comment">// lock acquired</span></span><br><span class="line">            <span class="keyword">if</span> (ttlRemaining == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// çœ‹é—¨ç‹—é€»è¾‘</span></span><br><span class="line">                scheduleExpirationRenewal(threadId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ttlRemainingFuture;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;T&gt; <span class="function">RFuture&lt;T&gt; <span class="title">tryLockInnerAsync</span><span class="params">(<span class="keyword">long</span> leaseTime, TimeUnit unit, <span class="keyword">long</span> threadId, RedisStrictCommand&lt;T&gt; command)</span> </span>&#123;</span><br><span class="line">    internalLockLeaseTime = unit.toMillis(leaseTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> commandExecutor.evalWriteAsync(getName(), LongCodec.INSTANCE, command,</span><br><span class="line">              <span class="string">&quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hset&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;</span>,</span><br><span class="line">                Collections.&lt;Object&gt;singletonList(getName()), internalLockLeaseTime, getLockName(threadId));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// çœ‹é—¨ç‹—æœ€ç»ˆä¼šè°ƒç”¨äº†è¿™é‡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleExpirationRenewal</span><span class="params">(<span class="keyword">final</span> <span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (expirationRenewalMap.containsKey(getEntryName())) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªä»»åŠ¡ä¼šå»¶è¿Ÿ10sæ‰§è¡Œ</span></span><br><span class="line">    Timeout task = commandExecutor.getConnectionManager().newTimeout(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Timeout timeout)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿™ä¸ªæ“ä½œä¼šå°†keyçš„è¿‡æœŸæ—¶é—´é‡æ–°è®¾ç½®ä¸º30s</span></span><br><span class="line">            RFuture&lt;Boolean&gt; future = renewExpirationAsync(threadId);</span><br><span class="line"></span><br><span class="line">            future.addListener(<span class="keyword">new</span> FutureListener&lt;Boolean&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(Future&lt;Boolean&gt; future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    expirationRenewalMap.remove(getEntryName());</span><br><span class="line">                    <span class="keyword">if</span> (!future.isSuccess()) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;Can&#x27;t update lock &quot;</span> + getName() + <span class="string">&quot; expiration&quot;</span>, future.cause());</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (future.getNow()) &#123;</span><br><span class="line">                        <span class="comment">// reschedule itself</span></span><br><span class="line">                        <span class="comment">// é€šè¿‡é€’å½’è°ƒç”¨æœ¬æ–¹æ³•ï¼Œæ— é™å¾ªç¯å»¶é•¿è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                        scheduleExpirationRenewal(threadId);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;, internalLockLeaseTime / <span class="number">3</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (expirationRenewalMap.putIfAbsent(getEntryName(), <span class="keyword">new</span> ExpirationEntry(threadId, task)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        task.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Redis</category>
        <category>åˆ†å¸ƒå¼é”</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼é”</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸå‹æ¨¡å¼</title>
    <url>/posts/91ad9ce3/</url>
    <content><![CDATA[<h1>åŸå‹æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰æ˜¯ç”¨äº<strong>åˆ›å»ºé‡å¤çš„å¯¹è±¡ï¼ŒåŒæ—¶åˆèƒ½ä¿è¯æ€§èƒ½</strong>ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p>è¿™ç§æ¨¡å¼æ˜¯å®ç°äº†ä¸€ä¸ªåŸå‹æ¥å£ï¼Œè¯¥æ¥å£ç”¨äºåˆ›å»ºå½“å‰å¯¹è±¡çš„å…‹éš†ã€‚å½“ç›´æ¥åˆ›å»ºå¯¹è±¡çš„ä»£ä»·æ¯”è¾ƒå¤§æ—¶ï¼Œåˆ™é‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚<strong>ä¾‹å¦‚</strong>ï¼Œä¸€ä¸ªå¯¹è±¡éœ€è¦åœ¨ä¸€ä¸ªé«˜ä»£ä»·çš„æ•°æ®åº“æ“ä½œä¹‹åè¢«åˆ›å»ºã€‚æˆ‘ä»¬å¯ä»¥ç¼“å­˜è¯¥å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶è¿”å›å®ƒçš„å…‹éš†ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æ›´æ–°æ•°æ®åº“ï¼Œä»¥æ­¤æ¥å‡å°‘æ•°æ®åº“è°ƒç”¨ã€‚</p>
<h1>åŸå‹æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="åŸå‹æ¨¡å¼çš„ä¼˜ç‚¹">åŸå‹æ¨¡å¼çš„ä¼˜ç‚¹</h2>
<ul>
<li><a href="http://c.biancheng.net/java/">Java</a> è‡ªå¸¦çš„åŸå‹æ¨¡å¼åŸºäºå†…å­˜äºŒè¿›åˆ¶æµçš„å¤åˆ¶ï¼Œåœ¨æ€§èƒ½ä¸Šæ¯”ç›´æ¥ new ä¸€ä¸ªå¯¹è±¡æ›´åŠ ä¼˜è‰¯ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨æ·±å…‹éš†æ–¹å¼ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼å°†å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œç®€åŒ–äº†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼ˆä¾‹å¦‚æ¢å¤åˆ°å†å²æŸä¸€çŠ¶æ€ï¼‰ï¼Œå¯è¾…åŠ©å®ç°æ’¤é”€æ“ä½œã€‚</li>
</ul>
<h2 id="åŸå‹æ¨¡å¼çš„ç¼ºç‚¹">åŸå‹æ¨¡å¼çš„ç¼ºç‚¹</h2>
<ul>
<li>éœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»éƒ½é…ç½®ä¸€ä¸ª clone æ–¹æ³•</li>
<li>clone æ–¹æ³•ä½äºç±»çš„å†…éƒ¨ï¼Œå½“å¯¹å·²æœ‰ç±»è¿›è¡Œæ”¹é€ çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹ä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</li>
<li>å½“å®ç°æ·±å…‹éš†æ—¶ï¼Œéœ€è¦ç¼–å†™è¾ƒä¸ºå¤æ‚çš„ä»£ç ï¼Œè€Œä¸”å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤šé‡åµŒå¥—å¼•ç”¨æ—¶ï¼Œä¸ºäº†å®ç°æ·±å…‹éš†ï¼Œæ¯ä¸€å±‚å¯¹è±¡å¯¹åº”çš„ç±»éƒ½å¿…é¡»æ”¯æŒæ·±å…‹éš†ï¼Œå®ç°èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤ï¼Œæ·±å…‹éš†ã€æµ…å…‹éš†éœ€è¦è¿ç”¨å¾—å½“ã€‚</li>
</ul>
<h1>åŸå‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯</h1>
<ul>
<li>å¯¹è±¡ä¹‹é—´ç›¸åŒæˆ–ç›¸ä¼¼ï¼Œå³åªæ˜¯ä¸ªåˆ«çš„å‡ ä¸ªå±æ€§ä¸åŒçš„æ—¶å€™ã€‚</li>
<li>åˆ›å»ºå¯¹è±¡æˆæœ¬è¾ƒå¤§ï¼Œä¾‹å¦‚åˆå§‹åŒ–æ—¶é—´é•¿ï¼Œå ç”¨CPUå¤ªå¤šï¼Œæˆ–è€…å ç”¨ç½‘ç»œèµ„æºå¤ªå¤šç­‰ï¼Œéœ€è¦ä¼˜åŒ–èµ„æºã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦ç¹ççš„æ•°æ®å‡†å¤‡æˆ–è®¿é—®æƒé™ç­‰ï¼Œéœ€è¦æé«˜æ€§èƒ½æˆ–è€…æé«˜å®‰å…¨æ€§ã€‚</li>
<li>ç³»ç»Ÿä¸­å¤§é‡ä½¿ç”¨è¯¥ç±»å¯¹è±¡ï¼Œä¸”å„ä¸ªè°ƒç”¨è€…éƒ½éœ€è¦ç»™å®ƒçš„å±æ€§é‡æ–°èµ‹å€¼ã€‚</li>
</ul>
<blockquote>
<p>åœ¨ Spring ä¸­ï¼ŒåŸå‹æ¨¡å¼åº”ç”¨çš„éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚ scope=â€˜prototypeâ€™ã€JSON.parseObject() ç­‰éƒ½æ˜¯åŸå‹æ¨¡å¼çš„å…·ä½“åº”ç”¨ã€‚</p>
</blockquote>
<h1>åŸå‹æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>åŸå‹æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p>
<ol>
<li>æŠ½è±¡åŸå‹ç±»ï¼šè§„å®šäº†å…·ä½“åŸå‹å¯¹è±¡å¿…é¡»å®ç°çš„æ¥å£ã€‚</li>
<li>å…·ä½“åŸå‹ç±»ï¼šå®ç°æŠ½è±¡åŸå‹ç±»çš„ clone() æ–¹æ³•ï¼Œå®ƒæ˜¯å¯è¢«å¤åˆ¶çš„å¯¹è±¡ã€‚</li>
<li>è®¿é—®ç±»ï¼šä½¿ç”¨å…·ä½“åŸå‹ç±»ä¸­çš„ clone() æ–¹æ³•æ¥å¤åˆ¶æ–°çš„å¯¹è±¡ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304141905.png" alt="åŸå‹æ¨¡å¼çš„ç»“æ„å›¾"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p>åŸå‹æ¨¡å¼çš„å…‹éš†åˆ†ä¸ºæµ…å…‹éš†å’Œæ·±å…‹éš†ã€‚</p>
<ul>
<li>æµ…å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å±æ€§å’ŒåŸæ¥å¯¹è±¡å®Œå…¨ç›¸åŒï¼Œå¯¹äºéåŸºæœ¬ç±»å‹å±æ€§ï¼Œä»æŒ‡å‘åŸæœ‰å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</li>
<li>æ·±å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå±æ€§ä¸­å¼•ç”¨çš„å…¶ä»–å¯¹è±¡ä¹Ÿä¼šè¢«å…‹éš†ï¼Œä¸å†æŒ‡å‘åŸæœ‰å¯¹è±¡åœ°å€ã€‚</li>
</ul>
<blockquote>
<p>Java ä¸­çš„ Object ç±»æä¾›äº†æµ…å…‹éš†çš„ clone() æ–¹æ³•ï¼Œå…·ä½“åŸå‹ç±»åªè¦å®ç° Cloneable æ¥å£å°±å¯å®ç°å¯¹è±¡çš„æµ…å…‹éš†ï¼Œè¿™é‡Œçš„ Cloneable æ¥å£å°±æ˜¯æŠ½è±¡åŸå‹ç±»ã€‚</p>
</blockquote>
<h3 id="å®ç°ä»£ç ">å®ç°ä»£ç </h3>
<p>åˆ›å»ºä¸€ä¸ªå®ç°äº†Cloneableæ¥å£çš„æŠ½è±¡ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> åŸå‹æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> å¿…é¡»å®ç°Cloneable</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">Shape</span>  <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">Clone</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Object clone=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            clone=<span class="keyword">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæ‰©å±•äº†ä¸Šé¢æŠ½è±¡ç±»çš„å®ä½“ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> åŸå‹æ¨¡å¼;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Square</span><span class="params">()</span></span>&#123;</span><br><span class="line">        type = <span class="string">&quot;Square&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Inside Square::draw() method.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> åŸå‹æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span>  <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        type = <span class="string">&quot;Circle&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Inside Circle::draw() method.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> åŸå‹æ¨¡å¼;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span><span class="params">()</span></span>&#123;</span><br><span class="line">       type = <span class="string">&quot;Rectangle&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Inside Rectangle::draw() method.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ä¾‹åŒ–å®ä½“ç±»ï¼Œå¹¶æŠŠå®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ª <em>Hashtable</em> ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> åŸå‹æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Hashtable&lt;String, Shape&gt; shapeMap = <span class="keyword">new</span> Hashtable&lt;String, Shape&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title">getShape</span><span class="params">(String shapeId)</span> </span>&#123;</span><br><span class="line">        Shape cachedShape = shapeMap.get(shapeId);</span><br><span class="line">        <span class="keyword">return</span> (Shape) cachedShape.ShapeClone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹æ¯ç§å½¢çŠ¶éƒ½è¿è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¹¶åˆ›å»ºè¯¥å½¢çŠ¶</span></span><br><span class="line">    <span class="comment">// shapeMap.put(shapeKey, shape);</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ·»åŠ ä¸‰ç§å½¢çŠ¶</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Circle circle = <span class="keyword">new</span> Circle();</span><br><span class="line">        circle.setId(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        shapeMap.put(circle.getId(),circle);</span><br><span class="line"></span><br><span class="line">        Square square = <span class="keyword">new</span> Square();</span><br><span class="line">        square.setId(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        shapeMap.put(square.getId(),square);</span><br><span class="line"></span><br><span class="line">        Rectangle rectangle = <span class="keyword">new</span> Rectangle();</span><br><span class="line">        rectangle.setId(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        shapeMap.put(rectangle.getId(),rectangle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><em>PrototypePatternDemo</em> ä½¿ç”¨ <em>ShapeCache</em> ç±»æ¥è·å–å­˜å‚¨åœ¨ <em>Hashtable</em> ä¸­çš„å½¢çŠ¶çš„å…‹éš†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> åŸå‹æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrototypePatternDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShapeCache.loadCache();</span><br><span class="line"></span><br><span class="line">        Shape clonedShape = ShapeCache.getShape(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Shape1 : &quot;</span> + clonedShape.getType());</span><br><span class="line"></span><br><span class="line">        Shape clonedShape2 = ShapeCache.getShape(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Shape2 : &quot;</span> + clonedShape2.getType());</span><br><span class="line"></span><br><span class="line">        Shape clonedShape3 = ShapeCache.getShape(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Shape3 : &quot;</span> + clonedShape3.getType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304120514.png" alt=""></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å•ä¾‹æ¨¡å¼</title>
    <url>/posts/f1601c3e/</url>
    <content><![CDATA[<h1>å•ä¾‹æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚</li>
<li>å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚</li>
<li>å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚</li>
</ul>
<h1>å•ä¾‹æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h3 id="ä¼˜ç‚¹ï¼š">ä¼˜ç‚¹ï¼š</h3>
<ol>
<li>å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ã€‚</li>
<li>é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚</li>
<li>å•ä¾‹æ¨¡å¼è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œå¯ä»¥ä¼˜åŒ–å’Œå…±äº«èµ„æºçš„è®¿é—®ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹ï¼š">ç¼ºç‚¹ï¼š</h3>
<ol>
<li>å•ä¾‹æ¨¡å¼ä¸€èˆ¬æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å›°éš¾ã€‚å¦‚æœè¦æ‰©å±•ï¼Œåˆ™é™¤äº†ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œæ²¡æœ‰ç¬¬äºŒç§é€”å¾„ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚</li>
<li>åœ¨å¹¶å‘æµ‹è¯•ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸åˆ©äºä»£ç è°ƒè¯•ã€‚åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå•ä¾‹ä¸­çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¸èƒ½æ¨¡æ‹Ÿç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡</li>
<li>å•ä¾‹æ¨¡å¼çš„åŠŸèƒ½ä»£ç é€šå¸¸å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¦‚æœåŠŸèƒ½è®¾è®¡ä¸åˆç†ï¼Œåˆ™å¾ˆå®¹æ˜“è¿èƒŒå•ä¸€èŒè´£åŸåˆ™ã€‚</li>
</ol>
<p>**æ³¨æ„äº‹é¡¹ï¼š**getInstance() æ–¹æ³•ä¸­éœ€è¦ä½¿ç”¨åŒæ­¥é” synchronized (Singleton.class) é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥é€ æˆ instance è¢«å¤šæ¬¡å®ä¾‹åŒ–ã€‚</p>
<h1>ä½¿ç”¨åœºæ™¯</h1>
<ol start="3">
<li>éœ€è¦é¢‘ç¹åˆ›å»ºçš„ä¸€äº›ç±»ï¼Œä½¿ç”¨å•ä¾‹å¯ä»¥é™ä½ç³»ç»Ÿçš„å†…å­˜å‹åŠ›ï¼Œå‡å°‘ GCã€‚</li>
<li>æŸç±»åªè¦æ±‚ç”Ÿæˆä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚ä¸€ä¸ªç­ä¸­çš„ç­é•¿ã€æ¯ä¸ªäººçš„èº«ä»½è¯å·ç­‰ã€‚</li>
<li>æŸäº›ç±»åˆ›å»ºå®ä¾‹æ—¶å ç”¨èµ„æºè¾ƒå¤šï¼Œæˆ–å®ä¾‹åŒ–è€—æ—¶è¾ƒé•¿ï¼Œä¸”ç»å¸¸ä½¿ç”¨ã€‚</li>
<li>æŸç±»éœ€è¦é¢‘ç¹å®ä¾‹åŒ–ï¼Œè€Œåˆ›å»ºçš„å¯¹è±¡åˆé¢‘ç¹è¢«é”€æ¯çš„æ—¶å€™ï¼Œå¦‚å¤šçº¿ç¨‹çš„çº¿ç¨‹æ± ã€ç½‘ç»œè¿æ¥æ± ç­‰ã€‚</li>
<li>å½“å¯¹è±¡éœ€è¦è¢«å…±äº«çš„åœºåˆã€‚ç”±äºå•ä¾‹æ¨¡å¼åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå…±äº«è¯¥å¯¹è±¡å¯ä»¥èŠ‚çœå†…å­˜ï¼Œå¹¶åŠ å¿«å¯¹è±¡è®¿é—®é€Ÿåº¦ã€‚å¦‚ Web ä¸­çš„é…ç½®å¯¹è±¡ã€æ•°æ®åº“çš„è¿æ¥æ± ç­‰ã€‚</li>
<li>é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡ã€‚</li>
<li>å¯¹äºä¸€äº›æ§åˆ¶ç¡¬ä»¶çº§åˆ«çš„æ“ä½œï¼Œæˆ–è€…ä»ç³»ç»Ÿä¸Šæ¥è®²åº”å½“æ˜¯å•ä¸€æ§åˆ¶é€»è¾‘çš„æ“ä½œï¼Œå¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šå®Œå…¨ä¹±å¥—ã€‚</li>
</ol>
<h1>å•ä¾‹æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<h2 id="å•ä¾‹æ¨¡å¼çš„ç»“æ„">å•ä¾‹æ¨¡å¼çš„ç»“æ„</h2>
<p>å•ä¾‹æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ã€‚</p>
<ul>
<li>
<p>å•ä¾‹ç±»ï¼šåŒ…å«ä¸€ä¸ªå®ä¾‹ä¸”èƒ½è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹çš„ç±»ã€‚</p>
</li>
<li>
<p>è®¿é—®ç±»ï¼šä½¿ç”¨å•ä¾‹çš„ç±»ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304140937.png" alt="image-20210304140937556"></p>
</li>
</ul>
<h2 id="å•ä¾‹æ¨¡å¼çš„å®ç°">å•ä¾‹æ¨¡å¼çš„å®ç°</h2>
<h3 id="é¥¿æ±‰å¼">é¥¿æ±‰å¼</h3>
<p>**æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š**å¦</p>
<p>**æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š**æ˜¯</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton01</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton01 instance = <span class="keyword">new</span> Singleton01();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton01</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton01 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨">æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨</h3>
<p>**æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š**æ˜¯</p>
<p>**æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š**å¦</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton02</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton02 instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton02</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton02 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton02();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨3">æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨3</h2>
<p>**æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š**æ˜¯</p>
<p>**æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š**æ˜¯</p>
<p>**ç¼ºç‚¹ï¼š**å¿…é¡»åŠ é” synchronized æ‰èƒ½ä¿è¯å•ä¾‹ï¼Œä½†åŠ é”ä¼šå½±å“æ•ˆç‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>  æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton03</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton03 instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton03</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton03 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton03();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="æ‡’æ±‰å¼ï¼ˆåŒæ£€é”-åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼‰">æ‡’æ±‰å¼ï¼ˆåŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼‰)</h3>
<p>**æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š**æ˜¯</p>
<p>**æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š**æ˜¯</p>
<p>**ä¼˜ç‚¹ï¼š**é‡‡ç”¨åŒé”æœºåˆ¶ï¼Œå®‰å…¨ä¸”åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹èƒ½ä¿æŒé«˜æ€§èƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æ‡’æ±‰å¼ï¼ˆåŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼‰)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton04</span> </span>&#123;</span><br><span class="line">    <span class="comment">//volatileä¿è¯äº†çº¿ç¨‹é—´æ•°æ®çš„å¯è§æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton04 singleton;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton04</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton04 <span class="title">getSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton04.class) &#123;</span><br><span class="line">                <span class="comment">//åœ¨æ­¤å†æ¬¡æ£€éªŒæ˜¯ä¸ºäº†é˜²æ­¢è·å–é”çš„è¿‡ç¨‹ä¸­ï¼Œè¢«å…¶ä»–çº¿ç¨‹å®ä¾‹åŒ–</span></span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    singleton = <span class="keyword">new</span> Singleton04();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é™æ€å†…éƒ¨ç±»">é™æ€å†…éƒ¨ç±»</h3>
<p>**æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š**æ˜¯</p>
<p>**æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š**æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton05</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton05 INSTANCE = <span class="keyword">new</span> Singleton05();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton05</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton05 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æšä¸¾">æšä¸¾</h3>
<p>**æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š**å¦</p>
<p>**æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š**æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Singleton06</span> </span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whateverMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å·¥å‚æ–¹æ³•æ¨¡å¼</title>
    <url>/posts/48598499/</url>
    <content><![CDATA[<h1>å·¥å‚æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>å·¥å‚æ¨¡å¼æ ¹æ®æŠ½è±¡ç¨‹åº¦çš„ä¸åŒåˆ†ä¸ºä¸‰ç§ï¼š<strong>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆä¹Ÿå«é™æ€å·¥å‚æ¨¡å¼ï¼‰</strong>ã€<strong>å·¥å‚æ–¹æ³•æ¨¡å¼</strong>ã€ä»¥åŠ<strong>æŠ½è±¡å·¥å‚æ¨¡å¼</strong>ã€‚å·¥å‚æ¨¡å¼æ˜¯ç¼–ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„ä¸€ç§æ¨¡å¼</p>
<p>åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p>
<h1>å·¥å‚æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ul>
<li>ç”¨æˆ·åªéœ€è¦çŸ¥é“å…·ä½“å·¥å‚çš„åç§°å°±å¯å¾—åˆ°æ‰€è¦çš„äº§å“ï¼Œæ— é¡»çŸ¥é“äº§å“çš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ã€‚</li>
<li>çµæ´»æ€§å¢å¼ºï¼Œå¯¹äºæ–°äº§å“çš„åˆ›å»ºï¼Œåªéœ€å¤šå†™ä¸€ä¸ªç›¸åº”çš„å·¥å‚ç±»ã€‚</li>
<li>å…¸å‹çš„è§£è€¦æ¡†æ¶ã€‚é«˜å±‚æ¨¡å—åªéœ€è¦çŸ¥é“äº§å“çš„æŠ½è±¡ç±»ï¼Œæ— é¡»å…³å¿ƒå…¶ä»–å®ç°ç±»ï¼Œæ»¡è¶³è¿ªç±³ç‰¹æ³•åˆ™ã€ä¾èµ–å€’ç½®åŸåˆ™å’Œé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</li>
</ul>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<ul>
<li>ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦</li>
<li>å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦</li>
</ul>
<h1>ä½¿ç”¨åœºæ™¯</h1>
<ul>
<li>æ•°æ®åº“è®¿é—®ï¼Œå½“ç”¨æˆ·ä¸çŸ¥é“æœ€åç³»ç»Ÿé‡‡ç”¨å“ªä¸€ç±»æ•°æ®åº“ï¼Œä»¥åŠæ•°æ®åº“å¯èƒ½æœ‰å˜åŒ–æ—¶</li>
<li>æ—¥å¿—è®°å½•å™¨ï¼šè®°å½•å¯èƒ½è®°å½•åˆ°æœ¬åœ°ç¡¬ç›˜ã€ç³»ç»Ÿäº‹ä»¶ã€è¿œç¨‹æœåŠ¡å™¨ç­‰ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è®°å½•æ—¥å¿—åˆ°ä»€ä¹ˆåœ°æ–¹ã€‚</li>
</ul>
<h1>æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼ç”±æŠ½è±¡å·¥å‚ã€å…·ä½“å·¥å‚ã€æŠ½è±¡äº§å“å’Œå…·ä½“äº§å“ç­‰4ä¸ªè¦ç´ æ„æˆ</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ã€‚</p>
<ol>
<li><strong>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰</strong>ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³• newProduct() æ¥åˆ›å»ºäº§å“ã€‚</li>
<li><strong>å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰</strong>ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li>
<li><strong>æŠ½è±¡äº§å“ï¼ˆProductï¼‰</strong>ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li>
<li><strong>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰</strong>ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304143145.png" alt="å·¥å‚æ–¹æ³•æ¨¡å¼çš„ç»“æ„å›¾"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p><strong>(1)  åˆ›å»ºæŠ½è±¡å·¥å‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å·¥å‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>(2) åˆ›å»ºå…·ä½“å·¥å‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å·¥å‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;inside Rectangle Method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å·¥å‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;inside Square Method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å·¥å‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;inside Circle Method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>ï¼ˆ3ï¼‰ æŠ½è±¡äº§å“</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å·¥å‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨ getShape æ–¹æ³•è·å–å½¢çŠ¶ç±»å‹çš„å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shape <span class="title">getShape</span><span class="params">(String shapeType)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( shapeType== <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (shapeType.equals(<span class="string">&quot;Rectangle&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Rectangle();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (shapeType.equals(<span class="string">&quot;Square&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Square();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (shapeType.equals(<span class="string">&quot;Circle&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Circle();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>ï¼ˆ4ï¼‰ å…·ä½“äº§å“</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å·¥å‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryTestDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShapeFactory shapeFactory = <span class="keyword">new</span> ShapeFactory();</span><br><span class="line">        shapeFactory.getShape(<span class="string">&quot;Circle&quot;</span>).draw();</span><br><span class="line">        shapeFactory.getShape(<span class="string">&quot;Rectangle&quot;</span>).draw();</span><br><span class="line">        shapeFactory.getShape(<span class="string">&quot;Square&quot;</span>).draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304144247.png" alt="image-20210304144247402"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å»ºé€ è€…æ¨¡å¼</title>
    <url>/posts/fe816c3c/</url>
    <content><![CDATA[<h1>å»ºé€ è€…æ¨¡å¼å®šä¹‰å’Œç‰¹ç‚¹</h1>
<p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šæŒ‡å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„é€ ä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å®ƒæ˜¯å°†ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡åˆ†è§£ä¸ºå¤šä¸ªç®€å•çš„å¯¹è±¡ï¼Œç„¶åä¸€æ­¥ä¸€æ­¥æ„å»ºè€Œæˆã€‚å®ƒå°†å˜ä¸ä¸å˜ç›¸åˆ†ç¦»ï¼Œå³äº§å“çš„ç»„æˆéƒ¨åˆ†æ˜¯ä¸å˜çš„ï¼Œä½†æ¯ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥çµæ´»é€‰æ‹©çš„ã€‚</p>
<p>ä¸€ä¸ª Builder ç±»ä¼šä¸€æ­¥ä¸€æ­¥æ„é€ æœ€ç»ˆçš„å¯¹è±¡ã€‚è¯¥ Builder ç±»æ˜¯ç‹¬ç«‹äºå…¶ä»–å¯¹è±¡çš„ã€‚</p>
<h1>å»ºé€ è€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ol>
<li>å°è£…æ€§å¥½ï¼Œæ„å»ºå’Œè¡¨ç¤ºåˆ†ç¦»ã€‚</li>
<li>æ‰©å±•æ€§å¥½ï¼Œå„ä¸ªå…·ä½“çš„å»ºé€ è€…ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰åˆ©äºç³»ç»Ÿçš„è§£è€¦</li>
<li>å®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå»ºé€ è€…å¯ä»¥å¯¹åˆ›å»ºè¿‡ç¨‹é€æ­¥ç»†åŒ–ï¼Œè€Œä¸å¯¹å…¶å®ƒæ¨¡å—äº§ç”Ÿä»»ä½•å½±å“ï¼Œä¾¿äºæ§åˆ¶ç»†èŠ‚é£é™©ã€‚</li>
</ol>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<ol>
<li>äº§å“çš„ç»„æˆéƒ¨åˆ†å¿…é¡»ç›¸åŒï¼Œè¿™é™åˆ¶äº†å…¶ä½¿ç”¨èŒƒå›´ã€‚</li>
<li>å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¦‚æœäº§å“å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œåˆ™å»ºé€ è€…ä¹Ÿè¦åŒæ­¥ä¿®æ”¹ï¼ŒåæœŸç»´æŠ¤æˆæœ¬è¾ƒå¤§ã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„åº”ç”¨åœºæ™¯">æ¨¡å¼çš„åº”ç”¨åœºæ™¯</h2>
<ul>
<li>ç›¸åŒçš„æ–¹æ³•ï¼Œä¸åŒçš„æ‰§è¡Œé¡ºåºï¼Œäº§ç”Ÿä¸åŒçš„ç»“æœã€‚</li>
<li>å¤šä¸ªéƒ¨ä»¶æˆ–é›¶ä»¶ï¼Œéƒ½å¯ä»¥è£…é…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œä½†æ˜¯äº§ç”Ÿçš„ç»“æœåˆä¸ç›¸åŒã€‚</li>
<li>äº§å“ç±»éå¸¸å¤æ‚ï¼Œæˆ–è€…äº§å“ç±»ä¸­ä¸åŒçš„è°ƒç”¨é¡ºåºäº§ç”Ÿä¸åŒçš„ä½œç”¨ã€‚</li>
<li>åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ç‰¹åˆ«å¤æ‚ï¼Œå‚æ•°å¤šï¼Œè€Œä¸”å¾ˆå¤šå‚æ•°éƒ½å…·æœ‰é»˜è®¤å€¼</li>
</ul>
<h1>æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼ç”±<font color=red>äº§å“ã€æŠ½è±¡å»ºé€ è€…ã€å…·ä½“å»ºé€ è€…ã€æŒ‡æŒ¥è€…ç­‰ 4 ä¸ªè¦ç´ æ„æˆ</font>ï¼Œç°åœ¨æˆ‘ä»¬æ¥åˆ†æå…¶åŸºæœ¬ç»“æ„å’Œå®ç°æ–¹æ³•ã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹</p>
<ol>
<li>äº§å“è§’è‰²ï¼ˆProductï¼‰ï¼šå®ƒæ˜¯åŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶çš„å¤æ‚å¯¹è±¡ï¼Œç”±å…·ä½“å»ºé€ è€…æ¥åˆ›å»ºå…¶å„ä¸ªé›¶éƒ¨ä»¶ã€‚</li>
<li>æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰ï¼šå®ƒæ˜¯ä¸€ä¸ªåŒ…å«åˆ›å»ºäº§å“å„ä¸ªå­éƒ¨ä»¶çš„æŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œé€šå¸¸è¿˜åŒ…å«ä¸€ä¸ªè¿”å›å¤æ‚äº§å“çš„æ–¹æ³• getResult()ã€‚</li>
<li>å…·ä½“å»ºé€ è€…(Concrete Builderï¼‰ï¼šå®ç° Builder æ¥å£ï¼Œå®Œæˆå¤æ‚äº§å“çš„å„ä¸ªéƒ¨ä»¶çš„å…·ä½“åˆ›å»ºæ–¹æ³•ã€‚</li>
<li>æŒ‡æŒ¥è€…ï¼ˆDirectorï¼‰ï¼šå®ƒè°ƒç”¨å»ºé€ è€…å¯¹è±¡ä¸­çš„éƒ¨ä»¶æ„é€ ä¸è£…é…æ–¹æ³•å®Œæˆå¤æ‚å¯¹è±¡çš„åˆ›å»ºï¼Œåœ¨æŒ‡æŒ¥è€…ä¸­ä¸æ¶‰åŠå…·ä½“äº§å“çš„ä¿¡æ¯ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304144916.png" alt="å»ºé€ è€…æ¨¡å¼çš„ç»“æ„å›¾"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p>(1) äº§å“è§’è‰²ï¼šåŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶çš„å¤æ‚å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å»ºé€ è€…æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> äº§å“è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String partA;</span><br><span class="line">    <span class="keyword">private</span> String partB;</span><br><span class="line">    <span class="keyword">private</span> String partC;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPartA</span><span class="params">(String partA)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.partA = partA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPartB</span><span class="params">(String partB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.partB = partB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPartC</span><span class="params">(String partC)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.partC = partC;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ˜¾ç¤ºäº§å“çš„ç‰¹æ€§</span></span><br><span class="line">        System.out.println(partA);</span><br><span class="line">        System.out.println(partB);</span><br><span class="line">        System.out.println(partC);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(2) æŠ½è±¡å»ºé€ è€…ï¼šåŒ…å«åˆ›å»ºäº§å“å„ä¸ªå­éƒ¨ä»¶çš„æŠ½è±¡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å»ºé€ è€…æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æŠ½è±¡å»ºé€ è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartA(<span class="string">&quot;å»ºé€  PartA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartB(<span class="string">&quot;å»ºé€  PartB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartC(<span class="string">&quot;å»ºé€  PartC&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å»ºé€ è€…æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æŠ½è±¡å»ºé€ è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder1</span> <span class="keyword">extends</span> <span class="title">Builder</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartA(<span class="string">&quot;å»ºé€  PartA1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartB(<span class="string">&quot;å»ºé€  PartB1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartC(<span class="string">&quot;å»ºé€  PartC1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(3) å…·ä½“å»ºé€ è€…ï¼šå®ç°äº†æŠ½è±¡å»ºé€ è€…æ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å»ºé€ è€…æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> å…·ä½“å»ºé€ è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartA(<span class="string">&quot;å»ºé€  PartA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartB(<span class="string">&quot;å»ºé€  PartB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPartC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setPartC(<span class="string">&quot;å»ºé€  PartC&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(4) æŒ‡æŒ¥è€…ï¼šè°ƒç”¨å»ºé€ è€…ä¸­çš„æ–¹æ³•å®Œæˆå¤æ‚å¯¹è±¡çš„åˆ›å»ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å»ºé€ è€…æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æŒ‡æŒ¥è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Builder builder;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.builder = builder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//äº§å“æ„å»ºä¸ç»„è£…æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        builder.buildPartA();</span><br><span class="line">        builder.buildPartB();</span><br><span class="line">        builder.buildPartC();</span><br><span class="line">        <span class="keyword">return</span> builder.getResult();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(5) å®¢æˆ·ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å»ºé€ è€…æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> å®¢æˆ·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuilderDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Builder builder = <span class="keyword">new</span> ConcreteBuilder();</span><br><span class="line">        Director director = <span class="keyword">new</span> Director(builder);</span><br><span class="line">        Product product = director.construct();</span><br><span class="line">        product.show();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Builder builder1 = <span class="keyword">new</span> ConcreteBuilder1();</span><br><span class="line">        Director director1 = <span class="keyword">new</span> Director(builder1);</span><br><span class="line">        Product product1 = director1.construct();</span><br><span class="line">        product1.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304150813.png" alt="image-20210304150813406"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç†æ¨¡å¼</title>
    <url>/posts/7b510e10/</url>
    <content><![CDATA[<h1>ä»£ç†æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>ä»£ç†æ¨¡å¼çš„å®šä¹‰ï¼šç”±äºæŸäº›åŸå› éœ€è¦ç»™æŸå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚è¿™æ—¶ï¼Œè®¿é—®å¯¹è±¡ä¸é€‚åˆæˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨ç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ä½œä¸ºè®¿é—®å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„ä¸­ä»‹ã€‚</p>
<h1>ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ol>
<li>ä»£ç†å¯¹è±¡å¯ä»¥æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼›</li>
<li>ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œå¢åŠ äº†ç¨‹åºçš„å¯æ‰©å±•æ€§</li>
<li>èŒè´£æ¸…æ™°</li>
</ol>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<ol>
<li>ç”±äºåœ¨å®¢æˆ·ç«¯å’ŒçœŸå®ä¸»é¢˜ä¹‹é—´å¢åŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤æœ‰äº›ç±»å‹çš„ä»£ç†æ¨¡å¼å¯èƒ½ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢</li>
<li>ä»£ç†æ¨¡å¼ä¼šé€ æˆç³»ç»Ÿè®¾è®¡ä¸­ç±»çš„æ•°é‡å¢åŠ </li>
<li>å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼›</li>
</ol>
<h1>ä»£ç†æ¨¡å¼çš„åº”ç”¨åœºæ™¯</h1>
<ul>
<li><strong>è¿œç¨‹ä»£ç†</strong>ï¼Œè¿™ç§æ–¹å¼é€šå¸¸æ˜¯ä¸ºäº†éšè—ç›®æ ‡å¯¹è±¡å­˜åœ¨äºä¸åŒåœ°å€ç©ºé—´çš„äº‹å®ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è®¿é—®ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ç”³è¯·æŸäº›ç½‘ç›˜ç©ºé—´æ—¶ï¼Œä¼šåœ¨ç”¨æˆ·çš„æ–‡ä»¶ç³»ç»Ÿä¸­å»ºç«‹ä¸€ä¸ªè™šæ‹Ÿçš„ç¡¬ç›˜ï¼Œç”¨æˆ·è®¿é—®è™šæ‹Ÿç¡¬ç›˜æ—¶å®é™…è®¿é—®çš„æ˜¯ç½‘ç›˜ç©ºé—´ã€‚</li>
<li><strong>è™šæ‹Ÿä»£ç†</strong>ï¼Œè¿™ç§æ–¹å¼é€šå¸¸ç”¨äºè¦åˆ›å»ºçš„ç›®æ ‡å¯¹è±¡å¼€é”€å¾ˆå¤§æ—¶ã€‚ä¾‹å¦‚ï¼Œä¸‹è½½ä¸€å¹…å¾ˆå¤§çš„å›¾åƒéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå› æŸç§è®¡ç®—æ¯”è¾ƒå¤æ‚è€ŒçŸ­æ—¶é—´æ— æ³•å®Œæˆï¼Œè¿™æ—¶å¯ä»¥å…ˆç”¨å°æ¯”ä¾‹çš„è™šæ‹Ÿä»£ç†æ›¿æ¢çœŸå®çš„å¯¹è±¡ï¼Œæ¶ˆé™¤ç”¨æˆ·å¯¹æœåŠ¡å™¨æ…¢çš„æ„Ÿè§‰ã€‚</li>
<li><strong>å®‰å…¨ä»£ç†</strong>ï¼Œè¿™ç§æ–¹å¼é€šå¸¸ç”¨äºæ§åˆ¶ä¸åŒç§ç±»å®¢æˆ·å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®æƒé™ã€‚</li>
<li><strong>æ™ºèƒ½æŒ‡å¼•</strong>ï¼Œä¸»è¦ç”¨äºè°ƒç”¨ç›®æ ‡å¯¹è±¡æ—¶ï¼Œä»£ç†é™„åŠ ä¸€äº›é¢å¤–çš„å¤„ç†åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¢åŠ è®¡ç®—çœŸå®å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°çš„åŠŸèƒ½ï¼Œè¿™æ ·å½“è¯¥å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨æ—¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨é‡Šæ”¾å®ƒã€‚</li>
<li><strong>å»¶è¿ŸåŠ è½½</strong>ï¼ŒæŒ‡ä¸ºäº†æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå»¶è¿Ÿå¯¹ç›®æ ‡çš„åŠ è½½ã€‚ä¾‹å¦‚ï¼Œ<a href="http://c.biancheng.net/hibernate/">Hibernate</a> ä¸­å°±å­˜åœ¨å±æ€§çš„å»¶è¿ŸåŠ è½½å’Œå…³è”è¡¨çš„å»¶æ—¶åŠ è½½ã€‚</li>
</ul>
<h1>ä»£ç†æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<p>ä»£ç†æ¨¡å¼çš„ç»“æ„æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯é€šè¿‡å®šä¹‰ä¸€ä¸ªç»§æ‰¿æŠ½è±¡ä¸»é¢˜çš„ä»£ç†æ¥åŒ…å«çœŸå®ä¸»é¢˜ï¼Œä»è€Œå®ç°å¯¹çœŸå®ä¸»é¢˜çš„è®¿é—®ï¼Œä¸‹é¢æ¥åˆ†æå…¶åŸºæœ¬ç»“æ„å’Œå®ç°æ–¹æ³•</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>ä»£ç†æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ã€‚</p>
<ol>
<li>**æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ç±»ï¼š**é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»å£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†å¯¹è±¡å®ç°çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li>
<li>**çœŸå®ä¸»é¢˜ï¼ˆReal Subjectï¼‰ç±»ï¼š**å®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„å…·ä½“ä¸šåŠ¡ï¼Œæ˜¯ä»£ç†å¯¹è±¡æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯æœ€ç»ˆè¦å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
<li>**ä»£ç†ï¼ˆProxyï¼‰ç±»ï¼š**æä¾›äº†ä¸çœŸå®ä¸»é¢˜ç›¸åŒçš„æ¥å£ï¼Œå…¶å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®ã€æ§åˆ¶æˆ–æ‰©å±•çœŸå®ä¸»é¢˜çš„åŠŸèƒ½ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304162617.png" alt="image-20210304162617527"></p>
<p>åœ¨ä»£ç ä¸­ï¼Œä¸€èˆ¬ä»£ç†ä¼šè¢«ç†è§£ä¸ºä»£ç å¢å¼ºï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨åŸä»£ç é€»è¾‘å‰åå¢åŠ ä¸€äº›ä»£ç é€»è¾‘ï¼Œè€Œä½¿è°ƒç”¨è€…æ— æ„ŸçŸ¥ã€‚</p>
<p>æ ¹æ®ä»£ç†çš„åˆ›å»ºæ—¶æœŸï¼Œä»£ç†æ¨¡å¼åˆ†ä¸º<strong>é™æ€ä»£ç†</strong>å’Œ<strong>åŠ¨æ€ä»£ç†</strong>ã€‚</p>
<ul>
<li><strong>é™æ€</strong>ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºä»£ç†ç±»æˆ–ç‰¹å®šå·¥å…·è‡ªåŠ¨ç”Ÿæˆæºä»£ç å†å¯¹å…¶ç¼–è¯‘ï¼Œåœ¨ç¨‹åºè¿è¡Œå‰ä»£ç†ç±»çš„ .class æ–‡ä»¶å°±å·²ç»å­˜åœ¨äº†ã€‚</li>
<li><strong>åŠ¨æ€</strong>ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œè¿ç”¨åå°„æœºåˆ¶åŠ¨æ€åˆ›å»ºè€Œæˆ</li>
</ul>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ä»£ç†æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>çœŸå®ä¸»é¢˜ï¼ˆReal Subjectï¼‰ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ä»£ç†æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>   çœŸå®ä¸»é¢˜ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealImage</span> <span class="keyword">implements</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RealImage</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">        loadFromDisk(fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadFromDisk</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Loading&quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä»£ç†ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ä»£ç†æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> ä»£ç†ï¼ˆProxyï¼‰ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyImage</span> <span class="keyword">implements</span> <span class="title">Image</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RealImage realImage;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyImage</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(realImage == <span class="keyword">null</span>)&#123;</span><br><span class="line">            realImage = <span class="keyword">new</span> RealImage(fileName);</span><br><span class="line">        &#125;</span><br><span class="line">        realImage.display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ä»£ç†æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Image image = <span class="keyword">new</span> ProxyImage(<span class="string">&quot;ä»£ç†æ¨¡å¼&quot;</span>);</span><br><span class="line">        image.display();</span><br><span class="line">        System.out.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        image.display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304164220.png" alt="image-20210304164220816"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¡¥æ¥æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</title>
    <url>/posts/2a7709eb/</url>
    <content><![CDATA[<h1>æ¡¥æ¥æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼çš„å®šä¹‰å¦‚ä¸‹ï¼šå°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚å®ƒæ˜¯ç”¨ç»„åˆå…³ç³»ä»£æ›¿ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œä»è€Œé™ä½äº†æŠ½è±¡å’Œå®ç°è¿™ä¸¤ä¸ªå¯å˜ç»´åº¦çš„è€¦åˆåº¦ã€‚</p>
<h1>æ¡¥æ¥æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ol>
<li>æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œæ‰©å±•èƒ½åŠ›å¼º</li>
<li>ç¬¦åˆå¼€é—­åŸåˆ™</li>
<li>å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>ç”±äºèšåˆå…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡åŒ–è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ï¼Œèƒ½æ­£ç¡®åœ°è¯†åˆ«å‡ºç³»ç»Ÿä¸­ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ã€‚</li>
</ol>
<h1>æ¡¥æ¥æ¨¡å¼çš„åº”ç”¨åœºæ™¯</h1>
<p>å½“ä¸€ä¸ªç±»å†…éƒ¨å…·å¤‡ä¸¤ç§æˆ–å¤šç§å˜åŒ–ç»´åº¦æ—¶ï¼Œä½¿ç”¨æ¡¥æ¥æ¨¡å¼å¯ä»¥è§£è€¦è¿™äº›å˜åŒ–çš„ç»´åº¦ï¼Œä½¿é«˜å±‚ä»£ç æ¶æ„ç¨³å®šã€‚</p>
<ol>
<li>å½“ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•æ—¶</li>
<li>å½“ä¸€ä¸ªç³»ç»Ÿä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ æ—¶ã€‚</li>
<li>å½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§æ—¶ã€‚</li>
</ol>
<p>æ¡¥æ¥æ¨¡å¼çš„ä¸€ä¸ªå¸¸è§ä½¿ç”¨åœºæ™¯å°±æ˜¯<strong>æ›¿æ¢ç»§æ‰¿</strong>ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç»§æ‰¿æ‹¥æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚ï¼ŒæŠ½è±¡ã€å°è£…ã€å¤šæ€ç­‰ï¼Œçˆ¶ç±»å°è£…å…±æ€§ï¼Œå­ç±»å®ç°ç‰¹æ€§ã€‚ç»§æ‰¿å¯ä»¥å¾ˆå¥½çš„å®ç°ä»£ç å¤ç”¨ï¼ˆå°è£…ï¼‰çš„åŠŸèƒ½ï¼Œä½†è¿™ä¹Ÿæ˜¯<strong>ç»§æ‰¿çš„ä¸€å¤§ç¼ºç‚¹</strong>ã€‚å› ä¸ºçˆ¶ç±»æ‹¥æœ‰çš„æ–¹æ³•ï¼Œå­ç±»ä¹Ÿä¼šç»§æ‰¿å¾—åˆ°ï¼Œæ— è®ºå­ç±»éœ€ä¸éœ€è¦ï¼Œè¿™è¯´æ˜<strong>ç»§æ‰¿å…·å¤‡å¼ºä¾µå…¥æ€§ï¼ˆçˆ¶ç±»ä»£ç ä¾µå…¥å­ç±»ï¼‰</strong>ï¼ŒåŒæ—¶ä¼šå¯¼è‡´å­ç±»è‡ƒè‚¿ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªåŸåˆ™ä¸ºä¼˜å…ˆä½¿ç”¨ç»„åˆ/èšåˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚</p>
<h1>æ¡¥æ¥æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<p>å¯ä»¥å°†æŠ½è±¡åŒ–éƒ¨åˆ†ä¸å®ç°åŒ–éƒ¨åˆ†åˆ†å¼€ï¼Œå–æ¶ˆäºŒè€…çš„ç»§æ‰¿å…³ç³»ï¼Œæ”¹ç”¨ç»„åˆå…³ç³»ã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p>
<ol>
<li>**æŠ½è±¡åŒ–ï¼ˆAbstractionï¼‰è§’è‰²ï¼š**å®šä¹‰æŠ½è±¡ç±»ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li>**æ‰©å±•æŠ½è±¡åŒ–ï¼ˆRefined Abstractionï¼‰è§’è‰²ï¼š**æ˜¯æŠ½è±¡åŒ–è§’è‰²çš„å­ç±»ï¼Œå®ç°çˆ¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¹¶é€šè¿‡ç»„åˆå…³ç³»è°ƒç”¨å®ç°åŒ–è§’è‰²ä¸­çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li>
<li>**å®ç°åŒ–ï¼ˆImplementorï¼‰è§’è‰²ï¼š**å®šä¹‰å®ç°åŒ–è§’è‰²çš„æ¥å£ï¼Œä¾›æ‰©å±•æŠ½è±¡åŒ–è§’è‰²è°ƒç”¨ã€‚</li>
<li>**å…·ä½“å®ç°åŒ–ï¼ˆConcrete Implementorï¼‰è§’è‰²ï¼š**ç»™å‡ºå®ç°åŒ–è§’è‰²æ¥å£çš„å…·ä½“å®ç°ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304164850.png" alt=" æ¡¥æ¥æ¨¡å¼çš„ç»“æ„å›¾"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<ol>
<li>
<p><strong>æŠ½è±¡åŒ–ï¼ˆAbstractionï¼‰è§’è‰²ï¼š</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¡¥æ¥æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æŠ½è±¡åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Abstraction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Implementor imple;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Abstraction</span><span class="params">(Implementor imple)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imple = imple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ‰©å±•æŠ½è±¡åŒ–ï¼ˆRefined Abstractionï¼‰è§’è‰²ï¼š</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¡¥æ¥æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æ‰©å±•æŠ½è±¡åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefinedAbstraction</span> <span class="keyword">extends</span> <span class="title">Abstraction</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">RefinedAbstraction</span><span class="params">(Implementor imple)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(imple);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰©å±•æŠ½è±¡åŒ–(Refined Abstraction)è§’è‰²è¢«è®¿é—®&quot;</span>);</span><br><span class="line">        imple.OperationImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å®ç°åŒ–ï¼ˆImplementorï¼‰è§’è‰²ï¼š</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¡¥æ¥æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>  å®ç°åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Implementor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OperationImpl</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å…·ä½“å®ç°åŒ–ï¼ˆConcrete Implementorï¼‰è§’è‰²ï¼š</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¡¥æ¥æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteImplementorA</span>  <span class="keyword">implements</span>  <span class="title">Implementor</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OperationImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…·ä½“å®ç°åŒ–(Concrete Implementor)è§’è‰²è¢«è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æµ‹è¯•</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¡¥æ¥æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BridgeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">       Implementor implementor  = <span class="keyword">new</span> ConcreteImplementorA();</span><br><span class="line">       Abstraction A = <span class="keyword">new</span> RefinedAbstraction(implementor);</span><br><span class="line">       A.Operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤–è§‚æ¨¡å¼</title>
    <url>/posts/f7de8aa8/</url>
    <content><![CDATA[<h1>å¤–è§‚æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼åˆå«ä½œé—¨é¢æ¨¡å¼ï¼Œæ˜¯ä¸€ç§é€šè¿‡ä¸ºå¤šä¸ªå¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œè€Œä½¿è¿™äº›å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è¢«è®¿é—®çš„æ¨¡å¼ã€‚<font color=red>è¯¥æ¨¡å¼å¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºä¸ç”¨å…³å¿ƒå†…éƒ¨å­ç³»ç»Ÿçš„å…·ä½“ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦ï¼Œæé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚</font></p>
<h1>å¤–è§‚æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ol>
<li>é™ä½äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ã€‚</li>
<li>å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚</li>
<li>é™ä½äº†å¤§å‹è½¯ä»¶ç³»ç»Ÿä¸­çš„ç¼–è¯‘ä¾èµ–æ€§ï¼Œç®€åŒ–äº†ç³»ç»Ÿåœ¨ä¸åŒå¹³å°ä¹‹é—´çš„ç§»æ¤è¿‡ç¨‹ï¼Œå› ä¸ºç¼–è¯‘ä¸€ä¸ªå­ç³»ç»Ÿä¸ä¼šå½±å“å…¶ä»–çš„å­ç³»ç»Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å¤–è§‚å¯¹è±¡ã€‚</li>
</ol>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<ol>
<li>ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼Œå¾ˆå®¹æ˜“å¸¦æ¥æœªçŸ¥é£é™©ã€‚</li>
<li>ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¦‚æœè¦æ”¹ä¸œè¥¿å¾ˆéº»çƒ¦ï¼Œç»§æ‰¿é‡å†™éƒ½ä¸åˆé€‚ã€‚</li>
</ol>
<h1>å¤–è§‚æ¨¡å¼çš„åº”ç”¨åœºæ™¯</h1>
<ol>
<li>å¯¹åˆ†å±‚ç»“æ„ç³»ç»Ÿæ„å»ºæ—¶ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰å­ç³»ç»Ÿä¸­æ¯å±‚çš„å…¥å£ç‚¹å¯ä»¥ç®€åŒ–å­ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>å½“ä¸€ä¸ªå¤æ‚ç³»ç»Ÿçš„å­ç³»ç»Ÿå¾ˆå¤šæ—¶ï¼Œå¤–è§‚æ¨¡å¼å¯ä»¥ä¸ºç³»ç»Ÿè®¾è®¡ä¸€ä¸ªç®€å•çš„æ¥å£ä¾›å¤–ç•Œè®¿é—®</li>
<li>å½“å®¢æˆ·ç«¯ä¸å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„è”ç³»æ—¶ï¼Œå¼•å…¥å¤–è§‚æ¨¡å¼å¯å°†å®ƒä»¬åˆ†ç¦»ï¼Œä»è€Œæé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ã€‚</li>
</ol>
<h1>å¤–è§‚æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼çš„ç»“æ„æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ã€‚å®ƒåŒ…å«äº†å¯¹å„ä¸ªå­ç³»ç»Ÿçš„å¼•ç”¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å®ƒè®¿é—®å„ä¸ªå­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚ç°åœ¨æ¥åˆ†æå…¶åŸºæœ¬ç»“æ„å’Œå®ç°æ–¹æ³•ã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p>
<ol>
<li>å¤–è§‚ï¼ˆFacadeï¼‰è§’è‰²ï¼šä¸ºå¤šä¸ªå­ç³»ç»Ÿå¯¹å¤–æä¾›ä¸€ä¸ªå…±åŒçš„æ¥å£ã€‚</li>
<li>å­ç³»ç»Ÿï¼ˆSub Systemï¼‰è§’è‰²ï¼šå®ç°ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå®¢æˆ·å¯ä»¥é€šè¿‡å¤–è§‚è§’è‰²è®¿é—®å®ƒã€‚</li>
<li>å®¢æˆ·ï¼ˆClientï¼‰è§’è‰²ï¼šé€šè¿‡ä¸€ä¸ªå¤–è§‚è§’è‰²è®¿é—®å„ä¸ªå­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210305110932.png" alt="å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼çš„ç»“æ„å›¾"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p>å¤–è§‚è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å¤–è§‚æ¨¡å¼;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeMaker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Shape circle;</span><br><span class="line">    <span class="keyword">private</span> Shape rectangle;</span><br><span class="line">    <span class="keyword">private</span> Shape square;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShapeMaker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        circle = <span class="keyword">new</span> Circle();</span><br><span class="line">        rectangle = <span class="keyword">new</span> Rectangle();</span><br><span class="line">        square = <span class="keyword">new</span> Square();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        circle.draw();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRectangle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        rectangle.draw();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawSquare</span><span class="params">()</span></span>&#123;</span><br><span class="line">        square.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å­ç³»ç»Ÿè§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å¤–è§‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å¤–è§‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/5 11:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Square::draw()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å¤–è§‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Rectangle::draw()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å¤–è§‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Circle::draw()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> å¤–è§‚æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FacadeDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShapeMaker shapeMaker = <span class="keyword">new</span> ShapeMaker();</span><br><span class="line">        shapeMaker.drawCircle();</span><br><span class="line">        shapeMaker.drawRectangle();</span><br><span class="line">        shapeMaker.drawSquare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210305112226.png" alt="image-20210305112226482"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è£…é¥°æ¨¡å¼</title>
    <url>/posts/e671036b/</url>
    <content><![CDATA[<h1>è£…é¥°æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šæŒ‡åœ¨ä¸æ”¹å˜ç°æœ‰å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™è¯¥å¯¹è±¡å¢åŠ ä¸€äº›èŒè´£ï¼ˆå³å¢åŠ å…¶é¢å¤–åŠŸèƒ½ï¼‰çš„æ¨¡å¼ï¼Œå®ƒå±äºå¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p>
<h1>è£…é¥°æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ul>
<li>è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚</li>
<li>é€šè¿‡ä½¿ç”¨ä¸ç”¨è£…é¥°ç±»åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥å®ç°ä¸åŒæ•ˆæœ</li>
</ul>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<p>è£…é¥°å™¨æ¨¡å¼ä¼šå¢åŠ è®¸å¤šå­ç±»ï¼Œè¿‡åº¦ä½¿ç”¨ä¼šå¢åŠ ç¨‹åºå¾—å¤æ‚æ€§ã€‚</p>
<h1>è£…é¥°å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯</h1>
<ol>
<li>æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚</li>
<li>åŠ¨æ€å¢åŠ åŠŸèƒ½ï¼ŒåŠ¨æ€æ’¤é”€</li>
<li>å½“éœ€è¦é€šè¿‡å¯¹ç°æœ‰çš„ä¸€ç»„åŸºæœ¬åŠŸèƒ½è¿›è¡Œæ’åˆ—ç»„åˆè€Œäº§ç”Ÿéå¸¸å¤šçš„åŠŸèƒ½æ—¶ï¼Œé‡‡ç”¨ç»§æ‰¿å…³ç³»å¾ˆéš¾å®ç°ï¼Œè€Œé‡‡ç”¨è£…é¥°å™¨æ¨¡å¼å´å¾ˆå¥½å®ç°ã€‚</li>
</ol>
<h1>è£…é¥°å™¨æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h1>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ä¼šä½¿ç”¨ç»§æ‰¿æ–¹å¼æ¥å®ç°ã€‚ä½†ç»§æ‰¿å…·æœ‰é™æ€ç‰¹å¾ï¼Œè€¦åˆåº¦é«˜ï¼Œå¹¶ä¸”éšç€æ‰©å±•åŠŸèƒ½çš„å¢å¤šï¼Œå­ç±»ä¼šå¾ˆè†¨èƒ€ã€‚å¦‚æœä½¿ç”¨ç»„åˆå…³ç³»æ¥åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼ˆå³è£…é¥°å¯¹è±¡ï¼‰æ¥åŒ…è£¹çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨ä¿æŒçœŸå®å¯¹è±¡çš„ç±»ç»“æ„ä¸å˜çš„å‰æä¸‹ï¼Œä¸ºå…¶æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œè¿™å°±æ˜¯è£…é¥°å™¨æ¨¡å¼çš„ç›®æ ‡ã€‚ä¸‹é¢æ¥åˆ†æå…¶åŸºæœ¬ç»“æ„å’Œå®ç°æ–¹æ³•</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>è£…é¥°å™¨æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ã€‚</p>
<ol>
<li>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ä»¥è§„èŒƒå‡†å¤‡æ¥æ”¶é™„åŠ è´£ä»»çš„å¯¹è±¡ã€‚</li>
<li>å…·ä½“æ„ä»¶ï¼ˆConcreteComponentï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡æ„ä»¶ï¼Œé€šè¿‡è£…é¥°è§’è‰²ä¸ºå…¶æ·»åŠ ä¸€äº›èŒè´£ã€‚</li>
<li>æŠ½è±¡è£…é¥°ï¼ˆDecoratorï¼‰è§’è‰²ï¼šç»§æ‰¿æŠ½è±¡æ„ä»¶ï¼Œå¹¶åŒ…å«å…·ä½“æ„ä»¶çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å…¶å­ç±»æ‰©å±•å…·ä½“æ„ä»¶çš„åŠŸèƒ½ã€‚</li>
<li>å…·ä½“è£…é¥°ï¼ˆConcreteDecoratorï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è£…é¥°çš„ç›¸å…³æ–¹æ³•ï¼Œå¹¶ç»™å…·ä½“æ„ä»¶å¯¹è±¡æ·»åŠ é™„åŠ çš„è´£ä»»ã€‚</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210304172754.png" alt="image-20210304172754153"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> è£…é¥°æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æŠ½è±¡æ„ä»¶è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…·ä½“æ„ä»¶ï¼ˆConcreteComponentï¼‰è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> è£…é¥°æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> å…·ä½“æ„ä»¶è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºå…·ä½“æ„ä»¶è§’è‰²&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨å…·ä½“æ„ä»¶è§’è‰²çš„æ–¹æ³•operation()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æŠ½è±¡è£…é¥°ï¼ˆDecoratorï¼‰è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> è£…é¥°æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æŠ½è±¡è£…é¥°è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span>  <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  Component component;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.component = component;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        component.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…·ä½“è£…é¥°ï¼ˆConcreteDecoratorï¼‰è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> è£…é¥°æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteDecorator</span> <span class="keyword">extends</span>  <span class="title">Decorator</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteDecorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.operation();</span><br><span class="line">        addedFunction();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addedFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸ºå…·ä½“æ„ä»¶è§’è‰²å¢åŠ é¢å¤–çš„åŠŸèƒ½addedFunction()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> è£…é¥°æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecoratorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Component p = <span class="keyword">new</span> ConcreteComponent();</span><br><span class="line">        p.operation();</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------------------&quot;</span>);</span><br><span class="line">        Component d = <span class="keyword">new</span> ConcreteDecorator(p);</span><br><span class="line">        d.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»„åˆæ¨¡å¼</title>
    <url>/posts/df879792/</url>
    <content><![CDATA[<h2 id="ç»„åˆæ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">ç»„åˆæ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>ç»„åˆï¼ˆComposite Patternï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šæœ‰æ—¶åˆå«ä½œæ•´ä½“-éƒ¨åˆ†ï¼ˆPart-Wholeï¼‰æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§å°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶çš„å±‚æ¬¡ç»“æ„çš„æ¨¡å¼ï¼Œç”¨æ¥è¡¨ç¤ºâ€œæ•´ä½“-éƒ¨åˆ†â€çš„å…³ç³»ï¼Œä½¿ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡å…·æœ‰ä¸€è‡´çš„è®¿é—®æ€§ã€‚</p>
<p>ç»„åˆæ¨¡å¼ä¸€èˆ¬ç”¨æ¥æè¿°æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œå®ƒå°†å¯¹è±¡ç»„ç»‡åˆ°æ ‘å½¢ç»“æ„ä¸­ï¼Œé¡¶å±‚çš„èŠ‚ç‚¹è¢«ç§°ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ä¸‹é¢å¯ä»¥åŒ…å«æ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ï¼Œæ ‘æèŠ‚ç‚¹ä¸‹é¢åˆå¯ä»¥åŒ…å«æ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ï¼Œæ ‘å½¢ç»“æ„å›¾å¦‚ä¸‹ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316145847.png" alt="image-20210316145847712"></p>
<p>ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ<font color=red>å…¶å®æ ¹èŠ‚ç‚¹å’Œæ ‘æèŠ‚ç‚¹æœ¬è´¨ä¸Šå±äºåŒä¸€ç§æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½œä¸ºå®¹å™¨ä½¿ç”¨ï¼›è€Œå¶å­èŠ‚ç‚¹ä¸æ ‘æèŠ‚ç‚¹åœ¨è¯­ä¹‰ä¸Šä¸å±äºç”¨ä¸€ç§ç±»å‹ã€‚ä½†æ˜¯åœ¨ç»„åˆæ¨¡å¼ä¸­ï¼Œä¼šæŠŠæ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹çœ‹ä½œå±äºåŒä¸€ç§æ•°æ®ç±»å‹ï¼ˆç”¨ç»Ÿä¸€æ¥å£å®šä¹‰ï¼‰ï¼Œè®©å®ƒä»¬å…·å¤‡ä¸€è‡´è¡Œä¸ºã€‚</font></p>
<p>è¿™æ ·ï¼Œåœ¨ç»„åˆæ¨¡å¼ä¸­ï¼Œæ•´ä¸ªæ ‘å½¢ç»“æ„ä¸­çš„å¯¹è±¡éƒ½å±äºåŒä¸€ç§ç±»å‹ï¼Œå¸¦æ¥çš„å¥½å¤„å°±æ˜¯ç”¨æˆ·ä¸éœ€è¦è¾¨åˆ«æ˜¯æ ‘æèŠ‚ç‚¹è¿˜æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ“ä½œï¼Œç»™ç”¨æˆ·çš„ä½¿ç”¨å¸¦æ¥æå¤§çš„ä¾¿åˆ©ã€‚</p>
<h2 id="ç»„åˆæ¨¡å¼çš„ä¼˜ç¼ºç‚¹">ç»„åˆæ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹ï¼š">ä¼˜ç‚¹ï¼š</h3>
<ol>
<li>ç»„åˆæ¨¡å¼ä½¿å¾—å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä¸€è‡´åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ï¼Œæ— é¡»å…³å¿ƒè‡ªå·±å¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯ç»„åˆå¯¹è±¡ï¼Œè¿™ç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç </li>
<li>æ›´å®¹æ˜“åœ¨ç»„åˆä½“å†…åŠ å…¥æ–°çš„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå› ä¸ºåŠ å…¥äº†æ–°çš„å¯¹è±¡è€Œæ›´æ”¹æºä»£ç ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ï¼›</li>
</ol>
<h3 id="ç¼ºç‚¹ï¼š">ç¼ºç‚¹ï¼š</h3>
<ol>
<li>ä¸å®¹æ˜“é™åˆ¶å®¹å™¨ä¸­çš„æ„ä»¶</li>
<li>ä¸å®¹æ˜“ç”¨ç»§æ‰¿çš„æ–¹æ³•æ¥å¢åŠ æ„ä»¶çš„æ–°åŠŸèƒ½ï¼›</li>
<li>è®¾è®¡è¾ƒå¤æ‚ï¼Œå®¢æˆ·ç«¯éœ€è¦èŠ±æ›´å¤šæ—¶é—´ç†æ¸…ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼›</li>
</ol>
<h2 id="ç»„åˆæ¨¡å¼çš„ç»“æ„ä¸å®ç°">ç»„åˆæ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<p>ç»„åˆæ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p>
<ol>
<li>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰è§’è‰²ï¼šå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ ‘å¶æ„ä»¶å’Œæ ‘ææ„ä»¶å£°æ˜å…¬å…±æ¥å£ï¼Œå¹¶å®ç°å®ƒä»¬çš„é»˜è®¤è¡Œä¸ºã€‚åœ¨é€æ˜å¼çš„ç»„åˆæ¨¡å¼ä¸­æŠ½è±¡æ„ä»¶è¿˜å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼›åœ¨å®‰å…¨å¼çš„ç»„åˆæ¨¡å¼ä¸­ä¸å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼Œç®¡ç†å·¥ä½œç”±æ ‘ææ„ä»¶å®Œæˆã€‚ï¼ˆæ€»çš„æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œå®šä¹‰ä¸€äº›é€šç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚æ–°å¢ã€åˆ é™¤ï¼‰</li>
<li>æ ‘å¶æ„ä»¶ï¼ˆLeafï¼‰è§’è‰²ï¼šæ˜¯ç»„åˆä¸­çš„å¶èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç”¨äºç»§æ‰¿æˆ–å®ç°æŠ½è±¡æ„ä»¶ã€‚</li>
<li>æ ‘ææ„ä»¶ï¼ˆCompositeï¼‰è§’è‰² / ä¸­é—´æ„ä»¶ï¼šæ˜¯ç»„åˆä¸­çš„åˆ†æ”¯èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒæœ‰å­èŠ‚ç‚¹ï¼Œç”¨äºç»§æ‰¿å’Œå®ç°æŠ½è±¡æ„ä»¶ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨å’Œç®¡ç†å­éƒ¨ä»¶ï¼Œé€šå¸¸åŒ…å« Add()ã€Remove()ã€GetChild() ç­‰æ–¹æ³•ã€‚</li>
</ol>
<h3 id="å®ç°">å®ç°</h3>
<p>ä¸€ä¸ªç±» <em>Employee</em>ï¼Œè¯¥ç±»è¢«å½“ä½œç»„åˆæ¨¡å‹ç±»ã€‚<em>CompositePatternDemo</em> ç±»ä½¿ç”¨ <em>Employee</em> ç±»æ¥æ·»åŠ éƒ¨é—¨å±‚æ¬¡ç»“æ„ï¼Œå¹¶æ‰“å°æ‰€æœ‰å‘˜å·¥ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316150302.png" alt="image-20210316150302711"></p>
<p>åˆ›å»º <em>Employee</em> ç±»ï¼Œè¯¥ç±»å¸¦æœ‰ <em>Employee</em> å¯¹è±¡çš„åˆ—è¡¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ç»„åˆæ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String dept;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; subordinates;</span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String name,String dept, <span class="keyword">int</span> sal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.dept = dept;</span><br><span class="line">        <span class="keyword">this</span>.salary = sal;</span><br><span class="line">        subordinates = <span class="keyword">new</span> ArrayList&lt;Employee&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Employee e)</span> </span>&#123;</span><br><span class="line">        subordinates.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Employee e)</span> </span>&#123;</span><br><span class="line">        subordinates.remove(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getSubordinates</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subordinates;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;Employee :[ Name : &quot;</span>+ name</span><br><span class="line">                +<span class="string">&quot;, dept : &quot;</span>+ dept + <span class="string">&quot;, salary :&quot;</span></span><br><span class="line">                + salary+<span class="string">&quot; ]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ç»„åˆæ¨¡å¼;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositePatternDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Employee CEO = <span class="keyword">new</span> Employee(<span class="string">&quot;John&quot;</span>,<span class="string">&quot;CEO&quot;</span>, <span class="number">30000</span>);</span><br><span class="line"></span><br><span class="line">        Employee headSales = <span class="keyword">new</span> Employee(<span class="string">&quot;Robert&quot;</span>,<span class="string">&quot;Head Sales&quot;</span>, <span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line">        Employee headMarketing = <span class="keyword">new</span> Employee(<span class="string">&quot;Michel&quot;</span>,<span class="string">&quot;Head Marketing&quot;</span>, <span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line">        Employee clerk1 = <span class="keyword">new</span> Employee(<span class="string">&quot;Laura&quot;</span>,<span class="string">&quot;Marketing&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        Employee clerk2 = <span class="keyword">new</span> Employee(<span class="string">&quot;Bob&quot;</span>,<span class="string">&quot;Marketing&quot;</span>, <span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">        Employee salesExecutive1 = <span class="keyword">new</span> Employee(<span class="string">&quot;Richard&quot;</span>,<span class="string">&quot;Sales&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        Employee salesExecutive2 = <span class="keyword">new</span> Employee(<span class="string">&quot;Rob&quot;</span>,<span class="string">&quot;Sales&quot;</span>, <span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">        CEO.add(headSales);</span><br><span class="line">        CEO.add(headMarketing);</span><br><span class="line"></span><br><span class="line">        headSales.add(salesExecutive1);</span><br><span class="line">        headSales.add(salesExecutive2);</span><br><span class="line"></span><br><span class="line">        headMarketing.add(clerk1);</span><br><span class="line">        headMarketing.add(clerk2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰“å°è¯¥ç»„ç»‡çš„æ‰€æœ‰å‘˜å·¥</span></span><br><span class="line">        System.out.println(CEO);</span><br><span class="line">        <span class="keyword">for</span> (Employee headEmployee : CEO.getSubordinates()) &#123;</span><br><span class="line">            System.out.println(headEmployee);</span><br><span class="line">            <span class="keyword">for</span> (Employee employee : headEmployee.getSubordinates()) &#123;</span><br><span class="line">                System.out.println(employee);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316150735.png" alt="image-20210316150735908"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>äº«å…ƒæ¨¡å¼</title>
    <url>/posts/e19da94a/</url>
    <content><![CDATA[<h1>äº«å…ƒæ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h1>
<p>äº«å…ƒï¼ˆFlyweightï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šè¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚å®ƒé€šè¿‡å…±äº«å·²ç»å­˜åœ¨çš„å¯¹è±¡æ¥å¤§å¹…åº¦å‡å°‘éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ•°é‡ã€é¿å…å¤§é‡ç›¸ä¼¼ç±»çš„å¼€é”€ï¼Œä»è€Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚</p>
<p>äº«å…ƒæ¨¡å¼å°è¯•é‡ç”¨ç°æœ‰çš„åŒç±»å¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„å¯¹è±¡ï¼Œåˆ™åˆ›å»ºæ–°å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š<font color=red>çº¿ç¨‹æ± ï¼Œè¿æ¥æ± ç­‰</font></p>
<h1>äº«å…ƒæ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h1>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<p>ç›¸åŒå¯¹è±¡åªè¦ä¿å­˜ä¸€ä»½ï¼Œè¿™é™ä½äº†ç³»ç»Ÿä¸­å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿä¸­ç»†ç²’åº¦å¯¹è±¡ç»™å†…å­˜å¸¦æ¥çš„å‹åŠ›ã€‚</p>
<h1>ç¼ºç‚¹</h1>
<ol>
<li>ä¸ºäº†ä½¿å¯¹è±¡å¯ä»¥å…±äº«ï¼Œéœ€è¦å°†ä¸€äº›ä¸èƒ½å…±äº«çš„çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œè¿™å°†å¢åŠ ç¨‹åºçš„å¤æ‚æ€§ã€‚</li>
<li>è¯»å–äº«å…ƒæ¨¡å¼çš„å¤–éƒ¨çŠ¶æ€ä¼šä½¿å¾—è¿è¡Œæ—¶é—´ç¨å¾®å˜é•¿ã€‚</li>
</ol>
<h1>äº«å…ƒæ¨¡å¼çš„åº”ç”¨åœºæ™¯</h1>
<p><strong>äº«å…ƒæ¨¡å¼å…¶å®æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸€ä¸ªæ”¹è¿›æœºåˆ¶</strong>ï¼Œäº«å…ƒæ¨¡å¼åŒæ ·è¦æ±‚åˆ›å»ºä¸€ä¸ªæˆ–ä¸€ç»„å¯¹è±¡ï¼Œå¹¶ä¸”å°±æ˜¯é€šè¿‡å·¥å‚æ–¹æ³•æ¨¡å¼ç”Ÿæˆå¯¹è±¡çš„ï¼Œåªä¸è¿‡äº«å…ƒæ¨¡å¼ä¸ºå·¥å‚æ–¹æ³•æ¨¡å¼å¢åŠ äº†ç¼“å­˜è¿™ä¸€åŠŸèƒ½ã€‚</p>
<ol>
<li>ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸åŒæˆ–ç›¸ä¼¼çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡è€—è´¹å¤§é‡çš„å†…å­˜èµ„æºã€‚</li>
<li>å¤§éƒ¨åˆ†çš„å¯¹è±¡å¯ä»¥æŒ‰ç…§å†…éƒ¨çŠ¶æ€è¿›è¡Œåˆ†ç»„ï¼Œä¸”å¯å°†ä¸åŒéƒ¨åˆ†å¤–éƒ¨åŒ–ï¼Œè¿™æ ·æ¯ä¸€ä¸ªç»„åªéœ€ä¿å­˜ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ã€‚</li>
<li>ç”±äºäº«å…ƒæ¨¡å¼éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªä¿å­˜äº«å…ƒçš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥åº”å½“åœ¨æœ‰è¶³å¤Ÿå¤šçš„äº«å…ƒå®ä¾‹æ—¶æ‰å€¼å¾—ä½¿ç”¨äº«å…ƒæ¨¡å¼ã€‚</li>
</ol>
<h2 id="äº«å…ƒæ¨¡å¼çš„ç»“æ„ä¸å®ç°">äº«å…ƒæ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<p>äº«å…ƒæ¨¡å¼çš„å®šä¹‰æå‡ºäº†ä¸¤ä¸ªè¦æ±‚ï¼Œç»†ç²’åº¦å’Œå…±äº«å¯¹è±¡ã€‚å› ä¸ºè¦æ±‚ç»†ç²’åº¦ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°ä¼šä½¿å¯¹è±¡æ•°é‡å¤šä¸”æ€§è´¨ç›¸è¿‘ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å°†è¿™äº›å¯¹è±¡çš„ä¿¡æ¯åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ã€‚</p>
<ul>
<li>å†…éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å…±äº«å‡ºæ¥çš„ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨äº«å…ƒä¿¡æ¯å†…éƒ¨ï¼Œå¹¶ä¸”ä¸å›éšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼›</li>
<li>å¤–éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å¾—ä»¥ä¾èµ–çš„ä¸€ä¸ªæ ‡è®°ï¼Œéšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼Œä¸å¯å…±äº«ã€‚</li>
</ul>
<p>æ¯”å¦‚ï¼Œè¿æ¥æ± ä¸­çš„è¿æ¥å¯¹è±¡ï¼Œä¿å­˜åœ¨è¿æ¥å¯¹è±¡ä¸­çš„ç”¨æˆ·åã€å¯†ç ã€è¿æ¥URLç­‰ä¿¡æ¯ï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°±è®¾ç½®å¥½äº†ï¼Œä¸ä¼šéšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼Œè¿™äº›ä¸ºå†…éƒ¨çŠ¶æ€ã€‚è€Œå½“æ¯ä¸ªè¿æ¥è¦è¢«å›æ”¶åˆ©ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒæ ‡è®°ä¸ºå¯ç”¨çŠ¶æ€ï¼Œè¿™äº›ä¸ºå¤–éƒ¨çŠ¶æ€ã€‚</p>
<p>äº«å…ƒæ¨¡å¼çš„æœ¬è´¨æ˜¯ç¼“å­˜å…±äº«å¯¹è±¡ï¼Œé™ä½å†…å­˜æ¶ˆè€—ã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h2>
<p>äº«å…ƒæ¨¡å¼çš„ä¸»è¦è§’è‰²æœ‰å¦‚ä¸‹ã€‚</p>
<ol>
<li>æŠ½è±¡äº«å…ƒè§’è‰²ï¼ˆFlyweightï¼‰ï¼šæ˜¯æ‰€æœ‰çš„å…·ä½“äº«å…ƒç±»çš„åŸºç±»ï¼Œä¸ºå…·ä½“äº«å…ƒè§„èŒƒéœ€è¦å®ç°çš„å…¬å…±æ¥å£ï¼Œéäº«å…ƒçš„å¤–éƒ¨çŠ¶æ€ä»¥å‚æ•°çš„å½¢å¼é€šè¿‡æ–¹æ³•ä¼ å…¥ã€‚</li>
<li>å…·ä½“äº«å…ƒï¼ˆConcrete Flyweightï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡äº«å…ƒè§’è‰²ä¸­æ‰€è§„å®šçš„æ¥å£ã€‚</li>
<li>éäº«å…ƒï¼ˆUnsharable Flyweight)è§’è‰²ï¼šæ˜¯ä¸å¯ä»¥å…±äº«çš„å¤–éƒ¨çŠ¶æ€ï¼Œå®ƒä»¥å‚æ•°çš„å½¢å¼æ³¨å…¥å…·ä½“äº«å…ƒçš„ç›¸å…³æ–¹æ³•ä¸­ã€‚</li>
<li>äº«å…ƒå·¥å‚ï¼ˆFlyweight Factoryï¼‰è§’è‰²ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚å½“å®¢æˆ·å¯¹è±¡è¯·æ±‚ä¸€ä¸ªäº«å…ƒå¯¹è±¡æ—¶ï¼Œäº«å…ƒå·¥å‚æ£€æŸ»ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆè¦æ±‚çš„äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨åˆ™æä¾›ç»™å®¢æˆ·ï¼›å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº«å…ƒå¯¹è±¡ã€‚</li>
</ol>
<p>äº«å…ƒæ¨¡å¼çš„ç»“æ„å›¾ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>UnsharedConcreteFlyweight æ˜¯éäº«å…ƒè§’è‰²ï¼Œé‡Œé¢åŒ…å«äº†éå…±äº«çš„å¤–éƒ¨çŠ¶æ€ä¿¡æ¯ infoï¼›</li>
<li>Flyweight æ˜¯æŠ½è±¡äº«å…ƒè§’è‰²ï¼Œé‡Œé¢åŒ…å«äº†äº«å…ƒæ–¹æ³• operation(UnsharedConcreteFlyweight state)ï¼Œéäº«å…ƒçš„å¤–éƒ¨çŠ¶æ€ä»¥å‚æ•°çš„å½¢å¼é€šè¿‡è¯¥æ–¹æ³•ä¼ å…¥ï¼›</li>
<li>ConcreteFlyweight æ˜¯å…·ä½“äº«å…ƒè§’è‰²ï¼ŒåŒ…å«äº†å…³é”®å­— keyï¼Œå®ƒå®ç°äº†æŠ½è±¡äº«å…ƒæ¥å£ï¼›</li>
<li>FlyweightFactory æ˜¯äº«å…ƒå·¥å‚è§’è‰²ï¼Œå®ƒæ˜¯å…³é”®å­— key æ¥ç®¡ç†å…·ä½“äº«å…ƒï¼›</li>
<li>å®¢æˆ·è§’è‰²é€šè¿‡äº«å…ƒå·¥å‚è·å–å…·ä½“äº«å…ƒï¼Œå¹¶è®¿é—®å…·ä½“äº«å…ƒçš„ç›¸å…³æ–¹æ³•ã€‚</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210305113805.png" alt="image-20210305113805940"></p>
<h2 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h2>
<p>äº«å…ƒè§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> äº«å…ƒæ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> äº«å…ƒæ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/5 11:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> radius;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(String color)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setX</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setY</span><span class="params">(<span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRadius</span><span class="params">(<span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Circle: Draw() [Color : &quot;</span> + color</span><br><span class="line">                +<span class="string">&quot;, x : &quot;</span> + x +<span class="string">&quot;, y :&quot;</span> + y +<span class="string">&quot;, radius :&quot;</span> + radius);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>äº«å…ƒå·¥å‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> äº«å…ƒæ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, Shape&gt; circleMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title">getCircle</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        Circle circle = (Circle)circleMap.get(color);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(circle == <span class="keyword">null</span>) &#123;</span><br><span class="line">            circle = <span class="keyword">new</span> Circle(color);</span><br><span class="line">            circleMap.put(color, circle);</span><br><span class="line">            System.out.println(<span class="string">&quot;Creating circle of color : &quot;</span> + color);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> circle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·è§’è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> äº«å…ƒæ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/5 11:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyweightDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String colors[] =</span><br><span class="line">            &#123; <span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;White&quot;</span>, <span class="string">&quot;Black&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">20</span>; ++i) &#123;</span><br><span class="line">            Circle circle =</span><br><span class="line">                    (Circle)ShapeFactory.getCircle(getRandomColor());</span><br><span class="line">            circle.setX(getRandomX());</span><br><span class="line">            circle.setY(getRandomY());</span><br><span class="line">            circle.setRadius(<span class="number">100</span>);</span><br><span class="line">            circle.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getRandomColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> colors[(<span class="keyword">int</span>)(Math.random()*colors.length)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRandomX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)(Math.random()*<span class="number">100</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRandomY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)(Math.random()*<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210305112815.png" alt="image-20210305112815359"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼</title>
    <url>/posts/5029c2a3/</url>
    <content><![CDATA[<h2 id="æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰æ¨¡å¼çš„å®šä¹‰å¦‚ä¸‹ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜è¯¥ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚å®ƒæ˜¯ä¸€ç§ç±»è¡Œä¸ºå‹æ¨¡å¼ã€‚</p>
<h2 id="æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>å®ƒå°è£…äº†ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚å®ƒæŠŠè®¤ä¸ºæ˜¯<font color=red>ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»ä¸­å®ç°ï¼Œè€ŒæŠŠå¯å˜éƒ¨åˆ†ç®—æ³•ç”±å­ç±»ç»§æ‰¿å®ç°ï¼Œä¾¿äºå­ç±»ç»§ç»­æ‰©å±•ã€‚</font></li>
<li>å®ƒåœ¨çˆ¶ç±»ä¸­æå–äº†å…¬å…±çš„éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºä»£ç å¤ç”¨ã€‚</li>
<li>éƒ¨åˆ†æ–¹æ³•æ˜¯ç”±å­ç±»å®ç°çš„ï¼Œå› æ­¤å­ç±»å¯ä»¥é€šè¿‡æ‰©å±•æ–¹å¼å¢åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡ï¼Œé—´æ¥åœ°å¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ã€‚</li>
<li>çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°ï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœä¼šå½±å“çˆ¶ç±»çš„ç»“æœï¼Œè¿™å¯¼è‡´ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒæé«˜äº†ä»£ç é˜…è¯»çš„éš¾åº¦ã€‚</li>
<li>ç”±äºç»§æ‰¿å…³ç³»è‡ªèº«çš„ç¼ºç‚¹ï¼Œå¦‚æœçˆ¶ç±»æ·»åŠ æ–°çš„æŠ½è±¡æ–¹æ³•ï¼Œåˆ™æ‰€æœ‰å­ç±»éƒ½è¦æ”¹ä¸€éã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p>
<h4 id="æŠ½è±¡ç±»-æŠ½è±¡æ¨¡æ¿ï¼ˆAbstract-Classï¼‰">æŠ½è±¡ç±»/æŠ½è±¡æ¨¡æ¿ï¼ˆAbstract Classï¼‰</h4>
<p>æŠ½è±¡æ¨¡æ¿ç±»ï¼Œè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ã€‚å®ƒç”±ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œè‹¥å¹²ä¸ªåŸºæœ¬æ–¹æ³•æ„æˆã€‚è¿™äº›æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ã€‚</p>
<ol>
<li>æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•</li>
<li>åŸºæœ¬æ–¹æ³•ï¼šæ˜¯æ•´ä¸ªç®—æ³•ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ç§ç±»å‹ã€‚
<ul>
<li>æŠ½è±¡æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å£°æ˜ï¼Œç”±å…·ä½“å­ç±»å®ç°ã€‚</li>
<li>å…·ä½“æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼Œåœ¨å…·ä½“å­ç±»ä¸­å¯ä»¥ç»§æ‰¿æˆ–é‡å†™å®ƒã€‚</li>
<li>é’©å­æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„ç©ºæ–¹æ³•ä¸¤ç§ã€‚</li>
</ul>
</li>
</ol>
<h4 id="å…·ä½“å­ç±»-å…·ä½“å®ç°ï¼ˆConcrete-Classï¼‰">å…·ä½“å­ç±»/å…·ä½“å®ç°ï¼ˆConcrete Classï¼‰</h4>
<p>å…·ä½“å®ç°ç±»ï¼Œå®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ä¸€ä¸ªç»„æˆæ­¥éª¤ã€‚</p>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>åˆ›å»ºä¸€ä¸ªå®šä¹‰æ“ä½œçš„ <em>Game</em> æŠ½è±¡ç±»ï¼Œå…¶ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•è®¾ç½®ä¸º finalï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¢«é‡å†™ã€‚<em>Cricket</em> å’Œ <em>Football</em> æ˜¯æ‰©å±•äº† <em>Game</em> çš„å®ä½“ç±»ï¼Œå®ƒä»¬é‡å†™äº†æŠ½è±¡ç±»çš„æ–¹æ³•</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316151254.png" alt="image-20210316151254751"></p>
<h4 id="æŠ½è±¡ç±»">æŠ½è±¡ç±»</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/16 15:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">Game</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">startPlay</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">endPlay</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//æ¨¡æ¿</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–æ¸¸æˆ</span></span><br><span class="line">        initialize();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å§‹æ¸¸æˆ</span></span><br><span class="line">        startPlay();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»“æŸæ¸¸æˆ</span></span><br><span class="line">        endPlay();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="å…·ä½“å­ç±»">å…·ä½“å­ç±»</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/16 15:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cricket</span>  <span class="keyword">extends</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cricket Game Initialized! Start playing.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">startPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cricket Game Started. Enjoy the game!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">endPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cricket Game Finished!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/16 15:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Football</span> <span class="keyword">extends</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Football Game Initialized! Start playing.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">startPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Football Game Started. Enjoy the game!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">endPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Football Game Finished!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•ç±»">æµ‹è¯•ç±»</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wmx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/16 15:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplatePatternDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Game game = <span class="keyword">new</span> Cricket();</span><br><span class="line">        game.play();</span><br><span class="line">        Game game2 = <span class="keyword">new</span> Football();</span><br><span class="line">          game2.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316151812.png" alt="image-20210316151812573"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ç­–ç•¥æ¨¡å¼</title>
    <url>/posts/72e3b671/</url>
    <content><![CDATA[<h2 id="ç­–ç•¥æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">ç­–ç•¥æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>ç­–ç•¥ï¼ˆStrategyï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šè¯¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ç­–ç•¥æ¨¡å¼å±äºå¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œå®ƒé€šè¿‡å¯¹ç®—æ³•è¿›è¡Œå°è£…ï¼ŒæŠŠä½¿ç”¨ç®—æ³•çš„è´£ä»»å’Œç®—æ³•çš„å®ç°åˆ†å‰²å¼€æ¥ï¼Œå¹¶å§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡å¯¹è¿™äº›ç®—æ³•è¿›è¡Œç®¡ç†ã€‚</p>
<h2 id="ç­–ç•¥æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">ç­–ç•¥æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>å¤šé‡æ¡ä»¶è¯­å¥ä¸æ˜“ç»´æŠ¤ï¼Œè€Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è¯­å¥ï¼Œå¦‚ ifâ€¦else è¯­å¥ã€switchâ€¦case è¯­å¥ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼æä¾›äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æ—ï¼Œæ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠç®—æ³•æ—çš„å…¬å…±ä»£ç è½¬ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…é‡å¤çš„ä»£ç ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼å¯ä»¥æä¾›ç›¸åŒè¡Œä¸ºçš„ä¸åŒå®ç°ï¼Œå®¢æˆ·å¯ä»¥æ ¹æ®ä¸åŒæ—¶é—´æˆ–ç©ºé—´è¦æ±‚é€‰æ‹©ä¸åŒçš„ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹å¼€é—­åŸåˆ™çš„å®Œç¾æ”¯æŒï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸä»£ç çš„æƒ…å†µä¸‹ï¼Œçµæ´»å¢åŠ æ–°ç®—æ³•ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼æŠŠç®—æ³•çš„ä½¿ç”¨æ”¾åˆ°ç¯å¢ƒç±»ä¸­ï¼Œè€Œç®—æ³•çš„å®ç°ç§»åˆ°å…·ä½“ç­–ç•¥ç±»ä¸­ï¼Œå®ç°äº†äºŒè€…çš„åˆ†ç¦»ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>å®¢æˆ·ç«¯å¿…é¡»ç†è§£æ‰€æœ‰ç­–ç•¥ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼é€ æˆå¾ˆå¤šçš„ç­–ç•¥ç±»ï¼Œå¢åŠ ç»´æŠ¤éš¾åº¦ã€‚</li>
</ol>
<h2 id="ç­–ç•¥æ¨¡å¼çš„ç»“æ„ä¸å®ç°">ç­–ç•¥æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<p>ç­–ç•¥æ¨¡å¼æ˜¯å‡†å¤‡ä¸€ç»„ç®—æ³•ï¼Œå¹¶å°†è¿™ç»„ç®—æ³•å°è£…åˆ°ä¸€ç³»åˆ—çš„ç­–ç•¥ç±»é‡Œé¢ï¼Œä½œä¸ºä¸€ä¸ªæŠ½è±¡ç­–ç•¥ç±»çš„å­ç±»ã€‚ç­–ç•¥æ¨¡å¼çš„é‡å¿ƒä¸æ˜¯å¦‚ä½•å®ç°ç®—æ³•ï¼Œè€Œæ˜¯å¦‚ä½•ç»„ç»‡è¿™äº›ç®—æ³•ï¼Œä»è€Œè®©ç¨‹åºç»“æ„æ›´åŠ çµæ´»ï¼Œå…·æœ‰æ›´å¥½çš„ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§</p>
<h4 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h4>
<p>ç­–ç•¥æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ã€‚</p>
<ol>
<li>æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰ç±»ï¼šå®šä¹‰äº†ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œå„ç§ä¸åŒçš„ç®—æ³•ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™ä¸ªæ¥å£ï¼Œç¯å¢ƒè§’è‰²ä½¿ç”¨è¿™ä¸ªæ¥å£è°ƒç”¨ä¸åŒçš„ç®—æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»å®ç°ã€‚</li>
<li>å…·ä½“ç­–ç•¥ï¼ˆConcrete Strategyï¼‰ç±»ï¼šå®ç°äº†æŠ½è±¡ç­–ç•¥å®šä¹‰çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„ç®—æ³•å®ç°ã€‚</li>
<li>ç¯å¢ƒï¼ˆContextï¼‰ç±»ï¼šæŒæœ‰ä¸€ä¸ªç­–ç•¥ç±»çš„å¼•ç”¨ï¼Œæœ€ç»ˆç»™å®¢æˆ·ç«¯è°ƒç”¨ã€‚</li>
</ol>
<h4 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h4>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316152609.png" alt="image-20210316152609333"></p>
<p>åˆ›å»ºä¸€ä¸ªå®šä¹‰æ´»åŠ¨çš„ <em>Strategy</em> æ¥å£å’Œå®ç°äº† <em>Strategy</em> æ¥å£çš„å®ä½“ç­–ç•¥ç±»ã€‚<em>Context</em> æ˜¯ä¸€ä¸ªä½¿ç”¨äº†æŸç§ç­–ç•¥çš„ç±»ã€‚<em>StrategyPatternDemo</em>ä½¿ç”¨ <em>Context</em> å’Œç­–ç•¥å¯¹è±¡æ¥æ¼”ç¤º Context åœ¨å®ƒæ‰€é…ç½®æˆ–ä½¿ç”¨çš„ç­–ç•¥æ”¹å˜æ—¶çš„è¡Œä¸ºå˜åŒ–ã€‚</p>
<h5 id="æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰ç±»">æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰ç±»</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="å…·ä½“ç­–ç•¥ï¼ˆConcrete-Strategyï¼‰ç±»">å…·ä½“ç­–ç•¥ï¼ˆConcrete Strategyï¼‰ç±»</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationAdd</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> num1 + num2;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationSubtract</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> num1 - num2;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationMultiply</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> num1 * num2;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Context-ç±»"><em>Context</em> ç±»</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Strategy strategy;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(Strategy strategy)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">executeStrategy</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> strategy.doOperation(num1, num2);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æµ‹è¯•ç±»">æµ‹è¯•ç±»</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StrategyPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Context context = <span class="keyword">new</span> Context(<span class="keyword">new</span> OperationAdd());    </span><br><span class="line">      System.out.println(<span class="string">&quot;10 + 5 = &quot;</span> + context.executeStrategy(<span class="number">10</span>, <span class="number">5</span>));</span><br><span class="line"> </span><br><span class="line">      context = <span class="keyword">new</span> Context(<span class="keyword">new</span> OperationSubtract());      </span><br><span class="line">      System.out.println(<span class="string">&quot;10 - 5 = &quot;</span> + context.executeStrategy(<span class="number">10</span>, <span class="number">5</span>));</span><br><span class="line"> </span><br><span class="line">      context = <span class="keyword">new</span> Context(<span class="keyword">new</span> OperationMultiply());    </span><br><span class="line">      System.out.println(<span class="string">&quot;10 * 5 = &quot;</span> + context.executeStrategy(<span class="number">10</span>, <span class="number">5</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316153313.png" alt="image-20210316153313630"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘½ä»¤æ¨¡å¼</title>
    <url>/posts/78134e07/</url>
    <content><![CDATA[<h2 id="å‘½ä»¤æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">å‘½ä»¤æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>å‘½ä»¤ï¼ˆCommandï¼‰æ¨¡å¼çš„å®šä¹‰å¦‚ä¸‹ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚è¿™æ ·ä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œè¿™æ ·æ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå‚¨å­˜ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ ä¸ç®¡ç†ã€‚</p>
<h2 id="å‘½ä»¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">å‘½ä»¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>é€šè¿‡å¼•å…¥ä¸­é—´ä»¶ï¼ˆæŠ½è±¡æ¥å£ï¼‰é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚</li>
<li>æ‰©å±•æ€§è‰¯å¥½ï¼Œå¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿ã€‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼å¢åŠ ä¸åˆ é™¤å‘½ä»¤ä¸ä¼šå½±å“å…¶ä»–ç±»ï¼Œä¸”æ»¡è¶³â€œå¼€é—­åŸåˆ™â€ã€‚</li>
<li>å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆï¼Œå°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ã€‚</li>
<li>æ–¹ä¾¿å®ç° Undo å’Œ Redo æ“ä½œã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸åé¢ä»‹ç»çš„å¤‡å¿˜å½•æ¨¡å¼ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤é”€ä¸æ¢å¤ã€‚</li>
<li>å¯ä»¥åœ¨ç°æœ‰å‘½ä»¤çš„åŸºç¡€ä¸Šï¼Œå¢åŠ é¢å¤–åŠŸèƒ½ã€‚æ¯”å¦‚æ—¥å¿—è®°å½•ï¼Œç»“åˆè£…é¥°å™¨æ¨¡å¼ä¼šæ›´åŠ çµæ´»ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>å¯èƒ½äº§ç”Ÿå¤§é‡å…·ä½“çš„å‘½ä»¤ç±»ã€‚å› ä¸ºæ¯ä¸€ä¸ªå…·ä½“æ“ä½œéƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</li>
<li>å‘½ä»¤æ¨¡å¼çš„ç»“æœå…¶å®å°±æ˜¯æ¥æ”¶æ–¹çš„æ‰§è¡Œç»“æœï¼Œä½†æ˜¯ä¸ºäº†ä»¥å‘½ä»¤çš„å½¢å¼è¿›è¡Œæ¶æ„ã€è§£è€¦è¯·æ±‚ä¸å®ç°ï¼Œå¼•å…¥äº†é¢å¤–ç±»å‹ç»“æ„ï¼ˆå¼•å…¥äº†è¯·æ±‚æ–¹ä¸æŠ½è±¡å‘½ä»¤æ¥å£ï¼‰ï¼Œå¢åŠ äº†ç†è§£ä¸Šçš„å›°éš¾</li>
</ol>
<h2 id="å‘½ä»¤æ¨¡å¼çš„ç»“æ„ä¸å®ç°">å‘½ä»¤æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<p>å¯ä»¥å°†ç³»ç»Ÿä¸­çš„ç›¸å…³æ“ä½œæŠ½è±¡æˆå‘½ä»¤ï¼Œä½¿è°ƒç”¨è€…ä¸å®ç°è€…ç›¸å…³åˆ†ç¦»ï¼Œå…¶ç»“æ„å¦‚ä¸‹ã€‚</p>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰è§’è‰²ï¼šå£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£ï¼Œæ‹¥æœ‰æ‰§è¡Œå‘½ä»¤çš„æŠ½è±¡æ–¹æ³• execute()ã€‚</li>
<li>å…·ä½“å‘½ä»¤ç±»ï¼ˆConcrete Commandï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡å‘½ä»¤ç±»çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚</li>
<li>å®ç°è€…/æ¥æ”¶è€…ï¼ˆReceiverï¼‰è§’è‰²ï¼šæ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…ã€‚</li>
<li>è°ƒç”¨è€…/è¯·æ±‚è€…ï¼ˆInvokerï¼‰è§’è‰²ï¼šæ˜¯è¯·æ±‚çš„å‘é€è€…ï¼Œå®ƒé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸ç›´æ¥è®¿é—®æ¥æ”¶è€…ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>å»ºä½œä¸ºå‘½ä»¤çš„æ¥å£ <em>Order</em>ï¼Œç„¶ååˆ›å»ºä½œä¸ºè¯·æ±‚çš„ <em>Stock</em> ç±»ã€‚å®ä½“å‘½ä»¤ç±» <em>BuyStock</em> å’Œ <em>SellStock</em>ï¼Œå®ç°äº† <em>Order</em> æ¥å£ï¼Œå°†æ‰§è¡Œå®é™…çš„å‘½ä»¤å¤„ç†ã€‚åˆ›å»ºä½œä¸ºè°ƒç”¨å¯¹è±¡çš„ç±» <em>Broker</em>ï¼Œå®ƒæ¥å—è®¢å•å¹¶èƒ½ä¸‹è®¢å•ã€‚<em>Broker</em> å¯¹è±¡ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼ŒåŸºäºå‘½ä»¤çš„ç±»å‹ç¡®å®šå“ªä¸ªå¯¹è±¡æ‰§è¡Œå“ªä¸ªå‘½ä»¤ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316154017.png" alt="image-20210316154017050"></p>
<h4 id="æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰">æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å…·ä½“å‘½ä»¤ç±»ï¼ˆConcrete-Commandï¼‰">å…·ä½“å‘½ä»¤ç±»ï¼ˆConcrete Commandï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stock</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String name = <span class="string">&quot;ABC&quot;</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> quantity = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Stock [ Name: &quot;</span>+name+<span class="string">&quot;, </span></span><br><span class="line"><span class="string">         Quantity: &quot;</span> + quantity +<span class="string">&quot; ] bought&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Stock [ Name: &quot;</span>+name+<span class="string">&quot;, </span></span><br><span class="line"><span class="string">         Quantity: &quot;</span> + quantity +<span class="string">&quot; ] sold&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®ç°è€…-æ¥æ”¶è€…ï¼ˆReceiverï¼‰">å®ç°è€…/æ¥æ”¶è€…ï¼ˆReceiverï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyStock</span> <span class="keyword">implements</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Stock abcStock;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">BuyStock</span><span class="params">(Stock abcStock)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.abcStock = abcStock;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      abcStock.buy();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SellStock</span> <span class="keyword">implements</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Stock abcStock;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">SellStock</span><span class="params">(Stock abcStock)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.abcStock = abcStock;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      abcStock.sell();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è°ƒç”¨è€…-è¯·æ±‚è€…ï¼ˆInvokerï¼‰">è°ƒç”¨è€…/è¯·æ±‚è€…ï¼ˆInvokerï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Broker</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> List&lt;Order&gt; orderList = <span class="keyword">new</span> ArrayList&lt;Order&gt;(); </span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeOrder</span><span class="params">(Order order)</span></span>&#123;</span><br><span class="line">      orderList.add(order);      </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">placeOrders</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (Order order : orderList) &#123;</span><br><span class="line">         order.execute();</span><br><span class="line">      &#125;</span><br><span class="line">      orderList.clear();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Stock abcStock = <span class="keyword">new</span> Stock();</span><br><span class="line"> </span><br><span class="line">      BuyStock buyStockOrder = <span class="keyword">new</span> BuyStock(abcStock);</span><br><span class="line">      SellStock sellStockOrder = <span class="keyword">new</span> SellStock(abcStock);</span><br><span class="line"> </span><br><span class="line">      Broker broker = <span class="keyword">new</span> Broker();</span><br><span class="line">      broker.takeOrder(buyStockOrder);</span><br><span class="line">      broker.takeOrder(sellStockOrder);</span><br><span class="line"> </span><br><span class="line">      broker.placeOrders();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316154944.png" alt="image-20210316154944139"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è§‚å¯Ÿè€…æ¨¡å¼</title>
    <url>/posts/9a246216/</url>
    <content><![CDATA[<h2 id="è§‚å¯Ÿè€…æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">è§‚å¯Ÿè€…æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šæŒ‡å¤šä¸ªå¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œ<strong>å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°</strong>ã€‚è¿™ç§æ¨¡å¼æœ‰æ—¶åˆç§°ä½œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€æ¨¡å‹-è§†å›¾æ¨¡å¼ï¼Œå®ƒæ˜¯å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚</p>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ã€‚ç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ã€‚</li>
<li>ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æ²¡æœ‰å®Œå…¨è§£é™¤ï¼Œè€Œä¸”æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨ã€‚</li>
<li>å½“è§‚å¯Ÿè€…å¯¹è±¡å¾ˆå¤šæ—¶ï¼Œé€šçŸ¥çš„å‘å¸ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå½±å“ç¨‹åºçš„æ•ˆç‡ã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰è§’è‰²ï¼šä¹Ÿå«æŠ½è±¡ç›®æ ‡ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç”¨äºä¿å­˜è§‚å¯Ÿè€…å¯¹è±¡çš„èšé›†ç±»å’Œå¢åŠ ã€åˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ–¹æ³•ï¼Œä»¥åŠé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æŠ½è±¡æ–¹æ³•ã€‚</li>
<li>å…·ä½“ä¸»é¢˜ï¼ˆConcrete Subjectï¼‰è§’è‰²ï¼šä¹Ÿå«å…·ä½“ç›®æ ‡ç±»ï¼Œå®ƒå®ç°æŠ½è±¡ç›®æ ‡ä¸­çš„é€šçŸ¥æ–¹æ³•ï¼Œå½“å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡ã€‚</li>
<li>æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰è§’è‰²ï¼šå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªæ›´æ–°è‡ªå·±çš„æŠ½è±¡æ–¹æ³•ï¼Œå½“æ¥åˆ°å…·ä½“ä¸»é¢˜çš„æ›´æ”¹é€šçŸ¥æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcrete Observerï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è§‚å¯Ÿè€…ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ç›®æ ‡çš„æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>ä½¿ç”¨ä¸‰ä¸ªç±» Subjectã€Observer å’Œ Clientã€‚Subject å¯¹è±¡å¸¦æœ‰ç»‘å®šè§‚å¯Ÿè€…åˆ° Client å¯¹è±¡å’Œä» Client å¯¹è±¡è§£ç»‘è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»º <em>Subject</em> ç±»ã€<em>Observer</em> æŠ½è±¡ç±»å’Œæ‰©å±•äº†æŠ½è±¡ç±» <em>Observer</em> çš„å®ä½“ç±»ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316161241.png" alt="image-20210316161241381"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> List&lt;Observer&gt; observers </span><br><span class="line">      = <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.state = state;</span><br><span class="line">      notifyAllObservers();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">      observers.add(observer);      </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyAllObservers</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">         observer.update();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> Subject subject;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">BinaryObserver</span><span class="params">(Subject subject)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.subject = subject;</span><br><span class="line">      <span class="keyword">this</span>.subject.attach(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println( <span class="string">&quot;Binary String: &quot;</span> </span><br><span class="line">      + Integer.toBinaryString( subject.getState() ) ); </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OctalObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">OctalObserver</span><span class="params">(Subject subject)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.subject = subject;</span><br><span class="line">      <span class="keyword">this</span>.subject.attach(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     System.out.println( <span class="string">&quot;Octal String: &quot;</span> </span><br><span class="line">     + Integer.toOctalString( subject.getState() ) ); </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HexaObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">HexaObserver</span><span class="params">(Subject subject)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.subject = subject;</span><br><span class="line">      <span class="keyword">this</span>.subject.attach(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println( <span class="string">&quot;Hex String: &quot;</span> </span><br><span class="line">      + Integer.toHexString( subject.getState() ).toUpperCase() ); </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Subject subject = <span class="keyword">new</span> Subject();</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">new</span> HexaObserver(subject);</span><br><span class="line">      <span class="keyword">new</span> OctalObserver(subject);</span><br><span class="line">      <span class="keyword">new</span> BinaryObserver(subject);</span><br><span class="line"> </span><br><span class="line">      System.out.println(<span class="string">&quot;First state change: 15&quot;</span>);   </span><br><span class="line">      subject.setState(<span class="number">15</span>);</span><br><span class="line">     System.out.println(<span class="string">&quot;===========================&quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;Second state change: 10&quot;</span>);  </span><br><span class="line">      subject.setState(<span class="number">10</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316162206.png" alt="image-20210316162206246"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è´£ä»»é“¾æ¨¡å¼</title>
    <url>/posts/6208627e/</url>
    <content><![CDATA[<h2 id="è´£ä»»é“¾æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">è´£ä»»é“¾æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>è´£ä»»é“¾ï¼ˆChain of Responsibilityï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œäºæ˜¯å°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p>
<p><font color=red>åœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œå®¢æˆ·åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°è´£ä»»é“¾ä¸Šå³å¯ï¼Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨è¿›è¡Œä¼ é€’ã€‚æ‰€ä»¥è´£ä»»é“¾å°†è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„å¤„ç†è€…è§£è€¦äº†ã€‚</font></p>
<p>è´£ä»»é“¾æ¨¡å¼çš„æœ¬è´¨æ˜¯<strong>è§£è€¦è¯·æ±‚ä¸å¤„ç†</strong>ï¼Œè®©è¯·æ±‚åœ¨å¤„ç†é“¾ä¸­èƒ½è¿›è¡Œä¼ é€’ä¸è¢«å¤„ç†ï¼›ç†è§£è´£ä»»é“¾æ¨¡å¼åº”å½“ç†è§£å…¶æ¨¡å¼ï¼Œè€Œä¸æ˜¯å…¶å…·ä½“å®ç°ã€‚è´£ä»»é“¾æ¨¡å¼çš„ç‹¬åˆ°ä¹‹å¤„æ˜¯å°†å…¶èŠ‚ç‚¹å¤„ç†è€…ç»„åˆæˆäº†é“¾å¼ç»“æ„ï¼Œå¹¶å…è®¸èŠ‚ç‚¹è‡ªèº«å†³å®šæ˜¯å¦è¿›è¡Œè¯·æ±‚å¤„ç†æˆ–è½¬å‘ï¼Œç›¸å½“äºè®©è¯·æ±‚æµåŠ¨èµ·æ¥ã€‚</p>
<h2 id="è´£ä»»é“¾æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">è´£ä»»é“¾æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚è¯¥æ¨¡å¼ä½¿å¾—ä¸€ä¸ªå¯¹è±¡æ— é¡»çŸ¥é“åˆ°åº•æ˜¯å“ªä¸€ä¸ªå¯¹è±¡å¤„ç†å…¶è¯·æ±‚ä»¥åŠé“¾çš„ç»“æ„ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…ä¹Ÿæ— é¡»æ‹¥æœ‰å¯¹æ–¹çš„æ˜ç¡®ä¿¡æ¯ã€‚</li>
<li>å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li>
<li>å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚</li>
<li>è´£ä»»é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥ã€‚æ¯ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶ä»–æ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„ if æˆ–è€… ifÂ·Â·Â·else è¯­å¥ã€‚</li>
<li>è´£ä»»åˆ†æ‹…ã€‚æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸è¯¥å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</li>
<li>å¯¹æ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠå¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ã€‚</li>
<li>èŒè´£é“¾å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºèŒè´£é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚å¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<p>èŒè´£é“¾æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ã€‚</p>
<ol>
<li>æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚</li>
<li>å…·ä½“å¤„ç†è€…ï¼ˆConcrete Handlerï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯¥è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚</li>
<li>å®¢æˆ·ç±»ï¼ˆClientï¼‰è§’è‰²ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚</li>
</ol>
<p>å»ºæŠ½è±¡ç±» <em>AbstractLogger</em>ï¼Œå¸¦æœ‰è¯¦ç»†çš„æ—¥å¿—è®°å½•çº§åˆ«ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸‰ç§ç±»å‹çš„è®°å½•å™¨ï¼Œéƒ½æ‰©å±•äº† <em>AbstractLogger</em>ã€‚æ¯ä¸ªè®°å½•å™¨æ¶ˆæ¯çš„çº§åˆ«æ˜¯å¦å±äºè‡ªå·±çš„çº§åˆ«ï¼Œå¦‚æœæ˜¯åˆ™ç›¸åº”åœ°æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™å°†ä¸æ‰“å°å¹¶æŠŠæ¶ˆæ¯ä¼ ç»™ä¸‹ä¸€ä¸ªè®°å½•å™¨ã€‚</p>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316155839.png" alt="image-20210316155839797"></p>
<h4 id="æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰">æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractLogger</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> INFO = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> DEBUG = <span class="number">2</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> ERROR = <span class="number">3</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">int</span> level;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">   <span class="keyword">protected</span> AbstractLogger nextLogger;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNextLogger</span><span class="params">(AbstractLogger nextLogger)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.nextLogger = nextLogger;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logMessage</span><span class="params">(<span class="keyword">int</span> level, String message)</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.level &lt;= level)&#123;</span><br><span class="line">         write(message);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(nextLogger !=<span class="keyword">null</span>)&#123;</span><br><span class="line">         nextLogger.logMessage(level, message);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String message)</span></span>;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å…·ä½“å¤„ç†è€…ï¼ˆConcrete-Handlerï¼‰">å…·ä½“å¤„ç†è€…ï¼ˆConcrete Handlerï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsoleLogger</span> <span class="keyword">extends</span> <span class="title">AbstractLogger</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ConsoleLogger</span><span class="params">(<span class="keyword">int</span> level)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.level = level;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String message)</span> </span>&#123;    </span><br><span class="line">      System.out.println(<span class="string">&quot;Standard Console::Logger: &quot;</span> + message);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorLogger</span> <span class="keyword">extends</span> <span class="title">AbstractLogger</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ErrorLogger</span><span class="params">(<span class="keyword">int</span> level)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.level = level;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String message)</span> </span>&#123;    </span><br><span class="line">      System.out.println(<span class="string">&quot;Error Console::Logger: &quot;</span> + message);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileLogger</span> <span class="keyword">extends</span> <span class="title">AbstractLogger</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">FileLogger</span><span class="params">(<span class="keyword">int</span> level)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.level = level;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String message)</span> </span>&#123;    </span><br><span class="line">      System.out.println(<span class="string">&quot;File::Logger: &quot;</span> + message);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®¢æˆ·ç±»ï¼ˆClientï¼‰">å®¢æˆ·ç±»ï¼ˆClientï¼‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AbstractLogger <span class="title">getChainOfLoggers</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        AbstractLogger errorLogger = <span class="keyword">new</span> ErrorLogger(AbstractLogger.ERROR);</span><br><span class="line">        AbstractLogger fileLogger = <span class="keyword">new</span> FileLogger(AbstractLogger.DEBUG);</span><br><span class="line">        AbstractLogger consoleLogger = <span class="keyword">new</span> ConsoleLogger(AbstractLogger.INFO);</span><br><span class="line"></span><br><span class="line">        errorLogger.setNextLogger(fileLogger);</span><br><span class="line">        fileLogger.setNextLogger(consoleLogger);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> errorLogger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•ç±»">æµ‹è¯•ç±»</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChainPatternDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AbstractLogger loggerChain = Client.getChainOfLoggers();</span><br><span class="line"></span><br><span class="line">        loggerChain.logMessage(AbstractLogger.INFO, <span class="string">&quot;This is an information.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        loggerChain.logMessage(AbstractLogger.DEBUG,</span><br><span class="line">                <span class="string">&quot;This is a debug level information.&quot;</span>);</span><br><span class="line">   			System.out.println(<span class="string">&quot;=========================&quot;</span>);</span><br><span class="line">        loggerChain.logMessage(AbstractLogger.ERROR,</span><br><span class="line">                <span class="string">&quot;This is an error information.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316160844.png" alt="image-20210316160844800"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸­ä»‹è€…æ¨¡å¼</title>
    <url>/posts/d036071c/</url>
    <content><![CDATA[<h2 id="ä¸­ä»‹è€…æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">ä¸­ä»‹è€…æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>ä¸­ä»‹è€…ï¼ˆMediatorï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ¾æ•£ï¼Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…æ¨¡å¼åˆå«è°ƒåœæ¨¡å¼ï¼Œå®ƒæ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„å…¸å‹åº”ç”¨ã€‚</p>
<h2 id="ä¸­ä»‹è€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">ä¸­ä»‹è€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>ç±»ä¹‹é—´å„å¸å…¶èŒï¼Œç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ã€‚</li>
<li>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—å¯¹è±¡æ˜“äºç‹¬ç«‹åœ°è¢«å¤ç”¨ã€‚</li>
<li>å°†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šå…³è”è½¬å˜ä¸ºä¸€å¯¹ä¸€çš„å…³è”ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—ç³»ç»Ÿæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<p>ä¸­ä»‹è€…æ¨¡å¼å°†åŸæœ¬å¤šä¸ªå¯¹è±¡ç›´æ¥çš„ç›¸äº’ä¾èµ–å˜æˆäº†ä¸­ä»‹è€…å’Œå¤šä¸ªåŒäº‹ç±»çš„ä¾èµ–å…³ç³»ã€‚å½“åŒäº‹ç±»è¶Šå¤šæ—¶ï¼Œä¸­ä»‹è€…å°±ä¼šè¶Šè‡ƒè‚¿ï¼Œå˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>æŠ½è±¡ä¸­ä»‹è€…ï¼ˆMediatorï¼‰è§’è‰²ï¼šå®ƒæ˜¯ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•ã€‚</li>
<li>å…·ä½“ä¸­ä»‹è€…ï¼ˆConcrete Mediatorï¼‰è§’è‰²ï¼šå®ç°ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ª List æ¥ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œå› æ­¤å®ƒä¾èµ–äºåŒäº‹è§’è‰²ã€‚</li>
<li>æŠ½è±¡åŒäº‹ç±»ï¼ˆColleagueï¼‰è§’è‰²ï¼šå®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½ã€‚</li>
<li>å…·ä½“åŒäº‹ç±»ï¼ˆConcrete Colleagueï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>èŠå¤©å®¤å®ä¾‹æ¥æ¼”ç¤ºä¸­ä»‹è€…æ¨¡å¼ã€‚å®ä¾‹ä¸­ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥å‘èŠå¤©å®¤å‘é€æ¶ˆæ¯ï¼ŒèŠå¤©å®¤å‘æ‰€æœ‰çš„ç”¨æˆ·æ˜¾ç¤ºæ¶ˆæ¯ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç±» <em>ChatRoom</em> å’Œ <em>User</em>ã€‚<em>User</em> å¯¹è±¡ä½¿ç”¨ <em>ChatRoom</em> æ–¹æ³•æ¥åˆ†äº«ä»–ä»¬çš„æ¶ˆæ¯ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316164827.png" alt="image-20210316164827842"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> <span class="comment">//ä¸­ä»‹è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatRoom</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showMessage</span><span class="params">(User user, String message)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="keyword">new</span> Date().toString()</span><br><span class="line">         + <span class="string">&quot; [&quot;</span> + user.getName() +<span class="string">&quot;] : &quot;</span> + message);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name  = name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">      ChatRoom.showMessage(<span class="keyword">this</span>,message);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediatorPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      User robert = <span class="keyword">new</span> User(<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">      User john = <span class="keyword">new</span> User(<span class="string">&quot;John&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      robert.sendMessage(<span class="string">&quot;Hi! John!&quot;</span>);</span><br><span class="line">      john.sendMessage(<span class="string">&quot;Hello! Robert!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316165112.png" alt="image-20210316165112042"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿­ä»£å™¨æ¨¡å¼</title>
    <url>/posts/9055d217/</url>
    <content><![CDATA[<h2 id="è¿­ä»£å™¨æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">è¿­ä»£å™¨æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šæä¾›ä¸€ä¸ªå¯¹è±¡æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚è¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚<strong>JDKä¸­æœ‰æ•°ç»„ç­‰è¿­ä»£å™¨çš„å®ç°</strong></p>
<h2 id="è¿­ä»£å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">è¿­ä»£å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚</li>
<li>éå†ä»»åŠ¡äº¤ç”±è¿­ä»£å™¨å®Œæˆï¼Œè¿™ç®€åŒ–äº†èšåˆç±»ã€‚</li>
<li>å®ƒæ”¯æŒä»¥ä¸åŒæ–¹å¼éå†ä¸€ä¸ªèšåˆï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†ã€‚</li>
<li>å¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ã€‚</li>
<li>å°è£…æ€§è‰¯å¥½ï¼Œä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<p>å¢åŠ äº†ç±»çš„ä¸ªæ•°ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>æŠ½è±¡èšåˆï¼ˆAggregateï¼‰è§’è‰²ï¼šå®šä¹‰å­˜å‚¨ã€æ·»åŠ ã€åˆ é™¤èšåˆå¯¹è±¡ä»¥åŠåˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚</li>
<li>å…·ä½“èšåˆï¼ˆConcreteAggregateï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡èšåˆç±»ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“è¿­ä»£å™¨çš„å®ä¾‹ã€‚</li>
<li>æŠ½è±¡è¿­ä»£å™¨ï¼ˆIteratorï¼‰è§’è‰²ï¼šå®šä¹‰è®¿é—®å’Œéå†èšåˆå…ƒç´ çš„æ¥å£ï¼Œé€šå¸¸åŒ…å« hasNext()ã€first()ã€next() ç­‰æ–¹æ³•ã€‚</li>
<li>å…·ä½“è¿­ä»£å™¨ï¼ˆConcretelteratorï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è¿­ä»£å™¨æ¥å£ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆå¯¹èšåˆå¯¹è±¡çš„éå†ï¼Œè®°å½•éå†çš„å½“å‰ä½ç½®ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>åˆ›å»ºä¸€ä¸ªå™è¿°å¯¼èˆªæ–¹æ³•çš„ <em>Iterator</em> æ¥å£å’Œä¸€ä¸ªè¿”å›è¿­ä»£å™¨çš„ <em>Container</em> æ¥å£ã€‚å®ç°äº† <em>Container</em> æ¥å£çš„å®ä½“ç±»å°†è´Ÿè´£å®ç° <em>Iterator</em> æ¥å£ã€‚</p>
<p><em>IteratorPatternDemo</em>ï¼Œæˆ‘ä»¬çš„æ¼”ç¤ºç±»ä½¿ç”¨å®ä½“ç±» <em>NamesRepository</em> æ¥æ‰“å° <em>NamesRepository</em> ä¸­å­˜å‚¨ä¸ºé›†åˆçš„ <em>Names</em>ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316165435.png" alt="image-20210316165435461"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Iterator <span class="title">getIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameRepository</span> <span class="keyword">implements</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String[] names = &#123;<span class="string">&quot;Robert&quot;</span> , <span class="string">&quot;John&quot;</span> ,<span class="string">&quot;Julie&quot;</span> , <span class="string">&quot;Lora&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Iterator <span class="title">getIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> NameIterator();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">NameIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">int</span> index;</span><br><span class="line"> </span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(index &lt; names.length)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(<span class="keyword">this</span>.hasNext())&#123;</span><br><span class="line">            <span class="keyword">return</span> names[index++];</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;     </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IteratorPatternDemo</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      NameRepository namesRepository = <span class="keyword">new</span> NameRepository();</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span>(Iterator iter = namesRepository.getIterator(); iter.hasNext();)&#123;</span><br><span class="line">         String name = (String)iter.next();</span><br><span class="line">         System.out.println(<span class="string">&quot;Name : &quot;</span> + name);</span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316165737.png" alt="image-20210316165737380"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¿é—®è€…æ¨¡å¼</title>
    <url>/posts/64b51ed9/</url>
    <content><![CDATA[<h2 id="è®¿é—®è€…æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">è®¿é—®è€…æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šå°†ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œåˆ†ç¦»å‡ºæ¥å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œä½¿å…¶åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å¯ä»¥æ·»åŠ ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œï¼Œä¸ºæ•°æ®ç»“æ„ä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›å¤šç§è®¿é—®æ–¹å¼ã€‚å®ƒå°†å¯¹æ•°æ®çš„æ“ä½œä¸æ•°æ®ç»“æ„è¿›è¡Œåˆ†ç¦»ï¼Œæ˜¯è¡Œä¸ºç±»æ¨¡å¼ä¸­æœ€å¤æ‚çš„ä¸€ç§æ¨¡å¼ã€‚</p>
<h2 id="è®¿é—®è€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">è®¿é—®è€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>æ‰©å±•æ€§å¥½ã€‚èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</li>
<li>å¤ç”¨æ€§å¥½ã€‚å¯ä»¥é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¤ç”¨ç¨‹åº¦ã€‚</li>
<li>çµæ´»æ€§å¥½ã€‚è®¿é—®è€…æ¨¡å¼å°†æ•°æ®ç»“æ„ä¸ä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œè§£è€¦ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–è€Œä¸å½±å“ç³»ç»Ÿçš„æ•°æ®ç»“æ„ã€‚</li>
<li>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚è®¿é—®è€…æ¨¡å¼æŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œä½¿æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>å¢åŠ æ–°çš„å…ƒç´ ç±»å¾ˆå›°éš¾ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»ï¼Œéƒ½è¦åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œè¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</li>
<li>ç ´åå°è£…ã€‚è®¿é—®è€…æ¨¡å¼ä¸­å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿™ç ´åäº†å¯¹è±¡çš„å°è£…æ€§ã€‚</li>
<li>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚è®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»ã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>æŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªè®¿é—®å…·ä½“å…ƒç´ çš„æ¥å£ï¼Œä¸ºæ¯ä¸ªå…·ä½“å…ƒç´ ç±»å¯¹åº”ä¸€ä¸ªè®¿é—®æ“ä½œ visit() ï¼Œè¯¥æ“ä½œä¸­çš„å‚æ•°ç±»å‹æ ‡è¯†äº†è¢«è®¿é—®çš„å…·ä½“å…ƒç´ ã€‚</li>
<li>å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è®¿é—®è€…è§’è‰²ä¸­å£°æ˜çš„å„ä¸ªè®¿é—®æ“ä½œï¼Œç¡®å®šè®¿é—®è€…è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶è¯¥åšä»€ä¹ˆã€‚</li>
<li>æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰è§’è‰²ï¼šå£°æ˜ä¸€ä¸ªåŒ…å«æ¥å—æ“ä½œ accept() çš„æ¥å£ï¼Œè¢«æ¥å—çš„è®¿é—®è€…å¯¹è±¡ä½œä¸º accept() æ–¹æ³•çš„å‚æ•°ã€‚</li>
<li>å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å…ƒç´ è§’è‰²æä¾›çš„ accept() æ“ä½œï¼Œå…¶æ–¹æ³•ä½“é€šå¸¸éƒ½æ˜¯ visitor.visit(this) ï¼Œå¦å¤–å…·ä½“å…ƒç´ ä¸­å¯èƒ½è¿˜åŒ…å«æœ¬èº«ä¸šåŠ¡é€»è¾‘çš„ç›¸å…³æ“ä½œã€‚</li>
<li>å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰è§’è‰²ï¼šæ˜¯ä¸€ä¸ªåŒ…å«å…ƒç´ è§’è‰²çš„å®¹å™¨ï¼Œæä¾›è®©è®¿é—®è€…å¯¹è±¡éå†å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„æ–¹æ³•ï¼Œé€šå¸¸ç”± Listã€Setã€Map ç­‰èšåˆç±»å®ç°</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>å»ºä¸€ä¸ªå®šä¹‰æ¥å—æ“ä½œçš„ <em>ComputerPart</em> æ¥å£ã€‚<em>Keyboard</em>ã€<em>Mouse</em>ã€<em>Monitor</em> å’Œ <em>Computer</em> æ˜¯å®ç°äº† <em>ComputerPart</em> æ¥å£çš„å®ä½“ç±»ã€‚æˆ‘ä»¬å°†å®šä¹‰å¦ä¸€ä¸ªæ¥å£ <em>ComputerPartVisitor</em>ï¼Œå®ƒå®šä¹‰äº†è®¿é—®è€…ç±»çš„æ“ä½œã€‚<em>Computer</em> ä½¿ç”¨å®ä½“è®¿é—®è€…æ¥æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316170048.png" alt="image-20210316170048207"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComputerPart</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Keyboard</span>  <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</span><br><span class="line">      computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Monitor</span>  <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</span><br><span class="line">      computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mouse</span>  <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</span><br><span class="line">      computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   ComputerPart[] parts;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Computer</span><span class="params">()</span></span>&#123;</span><br><span class="line">      parts = <span class="keyword">new</span> ComputerPart[] &#123;<span class="keyword">new</span> Mouse(), <span class="keyword">new</span> Keyboard(), <span class="keyword">new</span> Monitor()&#125;;      </span><br><span class="line">   &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parts.length; i++) &#123;</span><br><span class="line">         parts[i].accept(computerPartVisitor);</span><br><span class="line">      &#125;</span><br><span class="line">      computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComputerPartVisitor</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Computer computer)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Mouse mouse)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Keyboard keyboard)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Monitor monitor)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComputerPartDisplayVisitor</span> <span class="keyword">implements</span> <span class="title">ComputerPartVisitor</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Computer computer)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying Computer.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Mouse mouse)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying Mouse.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Keyboard keyboard)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying Keyboard.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Monitor monitor)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying Monitor.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisitorPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">      ComputerPart computer = <span class="keyword">new</span> Computer();</span><br><span class="line">      computer.accept(<span class="keyword">new</span> ComputerPartDisplayVisitor());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>çŠ¶æ€æ¨¡å¼</title>
    <url>/posts/8acb1976/</url>
    <content><![CDATA[<h2 id="çŠ¶æ€æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">çŠ¶æ€æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>çŠ¶æ€ï¼ˆStateï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šå¯¹æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼ŒæŠŠå¤æ‚çš„â€œåˆ¤æ–­é€»è¾‘â€æå–åˆ°ä¸åŒçš„çŠ¶æ€å¯¹è±¡ä¸­ï¼Œå…è®¸çŠ¶æ€å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚</p>
<h2 id="çŠ¶æ€æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">çŠ¶æ€æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>ç»“æ„æ¸…æ™°ï¼ŒçŠ¶æ€æ¨¡å¼å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–åˆ°ä¸€ä¸ªçŠ¶æ€ä¸­ï¼Œå¹¶ä¸”å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ï¼Œæ»¡è¶³â€œå•ä¸€èŒè´£åŸåˆ™â€ã€‚</li>
<li>å°†çŠ¶æ€è½¬æ¢æ˜¾ç¤ºåŒ–ï¼Œå‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚å°†ä¸åŒçš„çŠ¶æ€å¼•å…¥ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä¼šä½¿å¾—çŠ¶æ€è½¬æ¢å˜å¾—æ›´åŠ æ˜ç¡®ï¼Œä¸”å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚</li>
<li>çŠ¶æ€ç±»èŒè´£æ˜ç¡®ï¼Œæœ‰åˆ©äºç¨‹åºçš„æ‰©å±•ã€‚é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¾ˆå®¹æ˜“åœ°å¢åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿçš„ç±»ä¸å¯¹è±¡çš„ä¸ªæ•°ã€‚</li>
<li>çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚</li>
<li>çŠ¶æ€æ¨¡å¼å¯¹å¼€é—­åŸåˆ™çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ï¼Œå¯¹äºå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢åŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºç ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢åˆ°æ–°å¢çŠ¶æ€ï¼Œè€Œä¸”ä¿®æ”¹æŸä¸ªçŠ¶æ€ç±»çš„è¡Œä¸ºä¹Ÿéœ€è¦ä¿®æ”¹å¯¹åº”ç±»çš„æºç ã€‚</li>
</ol>
<h2 id="çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°">çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h4 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h4>
<ol>
<li>ç¯å¢ƒç±»ï¼ˆContextï¼‰è§’è‰²ï¼šä¹Ÿç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·ç«¯éœ€è¦çš„æ¥å£ï¼Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå½“å‰çŠ¶æ€ï¼Œå¹¶è´Ÿè´£å…·ä½“çŠ¶æ€çš„åˆ‡æ¢ã€‚</li>
<li>æŠ½è±¡çŠ¶æ€ï¼ˆStateï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ç¯å¢ƒå¯¹è±¡ä¸­çš„ç‰¹å®šçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œä¸ºã€‚</li>
<li>å…·ä½“çŠ¶æ€ï¼ˆConcrete Stateï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºï¼Œå¹¶ä¸”åœ¨éœ€è¦çš„æƒ…å†µä¸‹è¿›è¡ŒçŠ¶æ€åˆ‡æ¢ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>åˆ›å»ºä¸€ä¸ª <em>State</em> æ¥å£å’Œå®ç°äº† <em>State</em> æ¥å£çš„å®ä½“çŠ¶æ€ç±»ã€‚<em>Context</em> æ˜¯ä¸€ä¸ªå¸¦æœ‰æŸä¸ªçŠ¶æ€çš„ç±»ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316172712.png" alt="image-20210316172712601"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAction</span><span class="params">(Context context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAction</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Player is in start state&quot;</span>);</span><br><span class="line">      context.setState(<span class="keyword">this</span>); </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Start State&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAction</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Player is in stop state&quot;</span>);</span><br><span class="line">      context.setState(<span class="keyword">this</span>); </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Stop State&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> State state;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">()</span></span>&#123;</span><br><span class="line">      state = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.state = state;     </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatePatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Context context = <span class="keyword">new</span> Context();</span><br><span class="line"> </span><br><span class="line">      StartState startState = <span class="keyword">new</span> StartState();</span><br><span class="line">      startState.doAction(context);</span><br><span class="line"> </span><br><span class="line">      System.out.println(context.getState().toString());</span><br><span class="line"> </span><br><span class="line">      StopState stopState = <span class="keyword">new</span> StopState();</span><br><span class="line">      stopState.doAction(context);</span><br><span class="line"> </span><br><span class="line">      System.out.println(context.getState().toString());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316172958.png" alt="image-20210316172958002"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>é€‚é…å™¨æ¨¡å¼</title>
    <url>/posts/f5c535ea/</url>
    <content><![CDATA[<h2 id="é€‚é…å™¨æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">é€‚é…å™¨æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰çš„å®šä¹‰å¦‚ä¸‹ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»èƒ½ä¸€èµ·å·¥ä½œã€‚</p>
<h2 id="é€‚é…å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">é€‚é…å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>å®¢æˆ·ç«¯é€šè¿‡é€‚é…å™¨å¯ä»¥é€æ˜åœ°è°ƒç”¨ç›®æ ‡æ¥å£ã€‚</li>
<li>å¤ç”¨äº†ç°å­˜çš„ç±»ï¼Œç¨‹åºå‘˜ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ä»£ç è€Œé‡ç”¨ç°æœ‰çš„é€‚é…è€…ç±»ã€‚</li>
<li>å°†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»è§£è€¦ï¼Œè§£å†³äº†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»æ¥å£ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li>
<li>åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸­ç¬¦åˆå¼€é—­åŸåˆ™</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</li>
<li>å¢åŠ ä»£ç é˜…è¯»éš¾åº¦ï¼Œé™ä½ä»£ç å¯è¯»æ€§ï¼Œè¿‡å¤šä½¿ç”¨é€‚é…å™¨ä¼šä½¿ç³»ç»Ÿä»£ç å˜å¾—å‡Œä¹±ã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<p>ç±»é€‚é…å™¨æ¨¡å¼å¯é‡‡ç”¨å¤šé‡ç»§æ‰¿æ–¹å¼å®ç°</p>
<p>å¯¹è±¡é€‚é…å™¨æ¨¡å¼å¯é‡†ç”¨å°†ç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å®ç°çš„ç»„ä»¶å¼•å…¥é€‚é…å™¨ç±»ä¸­ï¼Œè¯¥ç±»åŒæ—¶å®ç°å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£ã€‚ç°åœ¨æ¥ä»‹ç»å®ƒä»¬çš„åŸºæœ¬ç»“æ„ã€‚</p>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>ç›®æ ‡ï¼ˆTargetï¼‰æ¥å£ï¼šå½“å‰ç³»ç»Ÿä¸šåŠ¡æ‰€æœŸå¾…çš„æ¥å£ï¼Œå®ƒå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ã€‚</li>
<li>é€‚é…è€…ï¼ˆAdapteeï¼‰ç±»ï¼šå®ƒæ˜¯è¢«è®¿é—®å’Œé€‚é…çš„ç°å­˜ç»„ä»¶åº“ä¸­çš„ç»„ä»¶æ¥å£ã€‚</li>
<li>é€‚é…å™¨ï¼ˆAdapterï¼‰ç±»ï¼šå®ƒæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œé€šè¿‡ç»§æ‰¿æˆ–å¼•ç”¨é€‚é…è€…çš„å¯¹è±¡ï¼ŒæŠŠé€‚é…è€…æ¥å£è½¬æ¢æˆç›®æ ‡æ¥å£ï¼Œè®©å®¢æˆ·æŒ‰ç›®æ ‡æ¥å£çš„æ ¼å¼è®¿é—®é€‚é…è€…ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>ä¸€ä¸ª <em>MediaPlayer</em> æ¥å£å’Œä¸€ä¸ªå®ç°äº† <em>MediaPlayer</em> æ¥å£çš„å®ä½“ç±» <em>AudioPlayer</em>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<em>AudioPlayer</em> å¯ä»¥æ’­æ”¾ mp3 æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªæ¥å£ <em>AdvancedMediaPlayer</em> å’Œå®ç°äº† <em>AdvancedMediaPlayer</em> æ¥å£çš„å®ä½“ç±»ã€‚è¯¥ç±»å¯ä»¥æ’­æ”¾ vlc å’Œ mp4 æ ¼å¼çš„æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦è®© <em>AudioPlayer</em> æ’­æ”¾å…¶ä»–æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°äº† <em>MediaPlayer</em> æ¥å£çš„é€‚é…å™¨ç±» <em>MediaAdapter</em>ï¼Œå¹¶ä½¿ç”¨ <em>AdvancedMediaPlayer</em> å¯¹è±¡æ¥æ’­æ”¾æ‰€éœ€çš„æ ¼å¼ã€‚</p>
<p><em>AudioPlayer</em> ä½¿ç”¨é€‚é…å™¨ç±» <em>MediaAdapter</em> ä¼ é€’æ‰€éœ€çš„éŸ³é¢‘ç±»å‹ï¼Œä¸éœ€è¦çŸ¥é“èƒ½æ’­æ”¾æ‰€éœ€æ ¼å¼éŸ³é¢‘çš„å®é™…ç±»ã€‚<em>AdapterPatternDemo</em> ç±»ä½¿ç”¨ <em>AudioPlayer</em> ç±»æ¥æ’­æ”¾å„ç§æ ¼å¼ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316171754.png" alt="image-20210316171754786"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MediaPlayer</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String audioType, String fileName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdvancedMediaPlayer</span> </span>&#123; </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playVlc</span><span class="params">(String fileName)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMp4</span><span class="params">(String fileName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VlcPlayer</span> <span class="keyword">implements</span> <span class="title">AdvancedMediaPlayer</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playVlc</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Playing vlc file. Name: &quot;</span>+ fileName);      </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMp4</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mp4Player</span> <span class="keyword">implements</span> <span class="title">AdvancedMediaPlayer</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playVlc</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMp4</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Playing mp4 file. Name: &quot;</span>+ fileName);      </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediaAdapter</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   AdvancedMediaPlayer advancedMusicPlayer;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MediaAdapter</span><span class="params">(String audioType)</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>) )&#123;</span><br><span class="line">         advancedMusicPlayer = <span class="keyword">new</span> VlcPlayer();       </span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>))&#123;</span><br><span class="line">         advancedMusicPlayer = <span class="keyword">new</span> Mp4Player();</span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String audioType, String fileName)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>))&#123;</span><br><span class="line">         advancedMusicPlayer.playVlc(fileName);</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>))&#123;</span><br><span class="line">         advancedMusicPlayer.playMp4(fileName);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudioPlayer</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span> </span>&#123;</span><br><span class="line">   MediaAdapter mediaAdapter; </span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String audioType, String fileName)</span> </span>&#123;    </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//æ’­æ”¾ mp3 éŸ³ä¹æ–‡ä»¶çš„å†…ç½®æ”¯æŒ</span></span><br><span class="line">      <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;mp3&quot;</span>))&#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;Playing mp3 file. Name: &quot;</span>+ fileName);         </span><br><span class="line">      &#125; </span><br><span class="line">      <span class="comment">//mediaAdapter æä¾›äº†æ’­æ”¾å…¶ä»–æ–‡ä»¶æ ¼å¼çš„æ”¯æŒ</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>) </span><br><span class="line">         || audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>))&#123;</span><br><span class="line">         mediaAdapter = <span class="keyword">new</span> MediaAdapter(audioType);</span><br><span class="line">         mediaAdapter.play(audioType, fileName);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;Invalid media. &quot;</span>+</span><br><span class="line">            audioType + <span class="string">&quot; format not supported&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      AudioPlayer audioPlayer = <span class="keyword">new</span> AudioPlayer();</span><br><span class="line"> </span><br><span class="line">      audioPlayer.play(<span class="string">&quot;mp3&quot;</span>, <span class="string">&quot;beyond the horizon.mp3&quot;</span>);</span><br><span class="line">      audioPlayer.play(<span class="string">&quot;mp4&quot;</span>, <span class="string">&quot;alone.mp4&quot;</span>);</span><br><span class="line">      audioPlayer.play(<span class="string">&quot;vlc&quot;</span>, <span class="string">&quot;far far away.vlc&quot;</span>);</span><br><span class="line">      audioPlayer.play(<span class="string">&quot;avi&quot;</span>, <span class="string">&quot;mind me.avi&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316172211.png" alt="image-20210316172211689"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£é‡Šå™¨æ¨¡å¼</title>
    <url>/posts/30cf0cd2/</url>
    <content><![CDATA[<h2 id="è§£é‡Šå™¨æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">è§£é‡Šå™¨æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>è§£é‡Šå™¨ï¼ˆInterpreterï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šç»™åˆ†æå¯¹è±¡å®šä¹‰ä¸€ä¸ªè¯­è¨€ï¼Œå¹¶å®šä¹‰è¯¥è¯­è¨€çš„æ–‡æ³•è¡¨ç¤ºï¼Œå†è®¾è®¡ä¸€ä¸ªè§£æå™¨æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨ç¼–è¯‘è¯­è¨€çš„æ–¹å¼æ¥åˆ†æåº”ç”¨ä¸­çš„å®ä¾‹ã€‚è¿™ç§æ¨¡å¼å®ç°äº†æ–‡æ³•è¡¨è¾¾å¼å¤„ç†çš„æ¥å£ï¼Œè¯¥æ¥å£è§£é‡Šä¸€ä¸ªç‰¹å®šçš„ä¸Šä¸‹æ–‡ã€‚</p>
<h2 id="è§£é‡Šå™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">è§£é‡Šå™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li>æ‰©å±•æ€§å¥½ã€‚ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•ã€‚</li>
<li>å®¹æ˜“å®ç°ã€‚åœ¨è¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥å®ç°å…¶æ–‡æ³•è¾ƒä¸ºå®¹æ˜“ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ol>
<li>æ‰§è¡Œæ•ˆç‡è¾ƒä½ã€‚è§£é‡Šå™¨æ¨¡å¼ä¸­é€šå¸¸ä½¿ç”¨å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨ï¼Œå½“è¦è§£é‡Šçš„å¥å­è¾ƒå¤æ‚æ—¶ï¼Œå…¶è¿è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚</li>
<li>ä¼šå¼•èµ·ç±»è†¨èƒ€ã€‚è§£é‡Šå™¨æ¨¡å¼ä¸­çš„æ¯æ¡è§„åˆ™è‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå½“åŒ…å«çš„æ–‡æ³•è§„åˆ™å¾ˆå¤šæ—¶ï¼Œç±»çš„ä¸ªæ•°å°†æ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç®¡ç†ä¸ç»´æŠ¤ã€‚</li>
<li>å¯åº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œéœ€è¦å®šä¹‰è¯­è¨€æ–‡æ³•çš„åº”ç”¨å®ä¾‹éå¸¸å°‘ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼å¾ˆå°‘è¢«ä½¿ç”¨åˆ°ã€‚</li>
</ol>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>æŠ½è±¡è¡¨è¾¾å¼ï¼ˆAbstract Expressionï¼‰è§’è‰²ï¼šå®šä¹‰è§£é‡Šå™¨çš„æ¥å£ï¼Œçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦åŒ…å«è§£é‡Šæ–¹æ³• interpret()ã€‚</li>
<li>ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆTerminal Expressionï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸ç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯ä¸€ä¸ªç»ˆç»“ç¬¦éƒ½æœ‰ä¸€ä¸ªå…·ä½“ç»ˆç»“è¡¨è¾¾å¼ä¸ä¹‹ç›¸å¯¹åº”ã€‚</li>
<li>éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆNonterminal Expressionï¼‰è§’è‰²ï¼šä¹Ÿæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸éç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚</li>
<li>ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²ï¼šé€šå¸¸åŒ…å«å„ä¸ªè§£é‡Šå™¨éœ€è¦çš„æ•°æ®æˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ é€’è¢«æ‰€æœ‰è§£é‡Šå™¨å…±äº«çš„æ•°æ®ï¼Œåé¢çš„è§£é‡Šå™¨å¯ä»¥ä»è¿™é‡Œè·å–è¿™äº›å€¼ã€‚</li>
<li>å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šä¸»è¦ä»»åŠ¡æ˜¯å°†éœ€è¦åˆ†æçš„å¥å­æˆ–è¡¨è¾¾å¼è½¬æ¢æˆä½¿ç”¨è§£é‡Šå™¨å¯¹è±¡æè¿°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åè°ƒç”¨è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒè§’è‰²é—´æ¥è®¿é—®è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>åˆ›å»ºä¸€ä¸ªæ¥å£ <em>Expression</em> å’Œå®ç°äº† <em>Expression</em> æ¥å£çš„å®ä½“ç±»ã€‚å®šä¹‰ä½œä¸ºä¸Šä¸‹æ–‡ä¸­ä¸»è¦è§£é‡Šå™¨çš„ <em>TerminalExpression</em> ç±»ã€‚å…¶ä»–çš„ç±» <em>OrExpression</em>ã€<em>AndExpression</em> ç”¨äºåˆ›å»ºç»„åˆå¼è¡¨è¾¾å¼ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316173630.png" alt="image-20210316173630671"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TerminalExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String data;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TerminalExpression</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.data = data; </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(context.contains(data))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">private</span> Expression expr1 = <span class="keyword">null</span>;</span><br><span class="line">   <span class="keyword">private</span> Expression expr2 = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">OrExpression</span><span class="params">(Expression expr1, Expression expr2)</span> </span>&#123; </span><br><span class="line">      <span class="keyword">this</span>.expr1 = expr1;</span><br><span class="line">      <span class="keyword">this</span>.expr2 = expr2;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span> </span>&#123;      </span><br><span class="line">      <span class="keyword">return</span> expr1.interpret(context) || expr2.interpret(context);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">private</span> Expression expr1 = <span class="keyword">null</span>;</span><br><span class="line">   <span class="keyword">private</span> Expression expr2 = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">AndExpression</span><span class="params">(Expression expr1, Expression expr2)</span> </span>&#123; </span><br><span class="line">      <span class="keyword">this</span>.expr1 = expr1;</span><br><span class="line">      <span class="keyword">this</span>.expr2 = expr2;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span> </span>&#123;      </span><br><span class="line">      <span class="keyword">return</span> expr1.interpret(context) &amp;&amp; expr2.interpret(context);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterpreterPatternDemo</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//è§„åˆ™ï¼šRobert å’Œ John æ˜¯ç”·æ€§</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">getMaleExpression</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Expression robert = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">      Expression john = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> OrExpression(robert, john);    </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//è§„åˆ™ï¼šJulie æ˜¯ä¸€ä¸ªå·²å©šçš„å¥³æ€§</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">getMarriedWomanExpression</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Expression julie = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;Julie&quot;</span>);</span><br><span class="line">      Expression married = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;Married&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> AndExpression(julie, married);    </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Expression isMale = getMaleExpression();</span><br><span class="line">      Expression isMarriedWoman = getMarriedWomanExpression();</span><br><span class="line"> </span><br><span class="line">      System.out.println(<span class="string">&quot;John is male? &quot;</span> + isMale.interpret(<span class="string">&quot;John&quot;</span>));</span><br><span class="line">      System.out.println(<span class="string">&quot;Julie is a married women? &quot;</span> </span><br><span class="line">      + isMarriedWoman.interpret(<span class="string">&quot;Married Julie&quot;</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316173942.png" alt="image-20210316173942497"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤‡å¿˜å½•æ¨¡å¼</title>
    <url>/posts/c3176455/</url>
    <content><![CDATA[<h2 id="å¤‡å¿˜å½•æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹">å¤‡å¿˜å½•æ¨¡å¼çš„å®šä¹‰ä¸ç‰¹ç‚¹</h2>
<p>å¤‡å¿˜å½•ï¼ˆMementoï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå½“éœ€è¦æ—¶èƒ½å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚è¯¥æ¨¡å¼åˆå«å¿«ç…§æ¨¡å¼ã€‚</p>
<h2 id="å¤‡å¿˜å½•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">å¤‡å¿˜å½•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>
<ol>
<li>æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚å½“ç”¨æˆ·éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚</li>
<li>å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–ï¼Œå…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯ã€‚</li>
<li>ç®€åŒ–äº†å‘èµ·äººç±»ã€‚å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<p>èµ„æºæ¶ˆè€—å¤§ã€‚å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚</p>
<h2 id="æ¨¡å¼çš„ç»“æ„ä¸å®ç°">æ¨¡å¼çš„ç»“æ„ä¸å®ç°</h2>
<h3 id="æ¨¡å¼çš„ç»“æ„">æ¨¡å¼çš„ç»“æ„</h3>
<ol>
<li>å‘èµ·äººï¼ˆOriginatorï¼‰è§’è‰²ï¼šè®°å½•å½“å‰æ—¶åˆ»çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤å¤‡å¿˜å½•æ•°æ®çš„åŠŸèƒ½ï¼Œå®ç°å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®¿é—®å¤‡å¿˜å½•é‡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚</li>
<li>å¤‡å¿˜å½•ï¼ˆMementoï¼‰è§’è‰²ï¼šè´Ÿè´£å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æä¾›è¿™äº›å†…éƒ¨çŠ¶æ€ç»™å‘èµ·äººã€‚</li>
<li>ç®¡ç†è€…ï¼ˆCaretakerï¼‰è§’è‰²ï¼šå¯¹å¤‡å¿˜å½•è¿›è¡Œç®¡ç†ï¼Œæä¾›ä¿å­˜ä¸è·å–å¤‡å¿˜å½•çš„åŠŸèƒ½ï¼Œä½†å…¶ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œè®¿é—®ä¸ä¿®æ”¹ã€‚</li>
</ol>
<h3 id="æ¨¡å¼çš„å®ç°">æ¨¡å¼çš„å®ç°</h3>
<p>å¤‡å¿˜å½•æ¨¡å¼ä½¿ç”¨ä¸‰ä¸ªç±» <em>Memento</em>ã€<em>Originator</em> å’Œ <em>CareTaker</em>ã€‚Memento åŒ…å«äº†è¦è¢«æ¢å¤çš„å¯¹è±¡çš„çŠ¶æ€ã€‚Originator åˆ›å»ºå¹¶åœ¨ Memento å¯¹è±¡ä¸­å­˜å‚¨çŠ¶æ€ã€‚Caretaker å¯¹è±¡è´Ÿè´£ä» Memento ä¸­æ¢å¤å¯¹è±¡çš„çŠ¶æ€ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316174209.png" alt="image-20210316174209023"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Memento</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String state;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Memento</span><span class="params">(String state)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.state = state;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Originator</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String state;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.state = state;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> Memento <span class="title">saveStateToMemento</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Memento(state);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getStateFromMemento</span><span class="params">(Memento Memento)</span></span>&#123;</span><br><span class="line">      state = Memento.getState();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CareTaker</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> List&lt;Memento&gt; mementoList = <span class="keyword">new</span> ArrayList&lt;Memento&gt;();</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Memento state)</span></span>&#123;</span><br><span class="line">      mementoList.add(state);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> Memento <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> mementoList.get(index);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MementoPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Originator originator = <span class="keyword">new</span> Originator();</span><br><span class="line">      CareTaker careTaker = <span class="keyword">new</span> CareTaker();</span><br><span class="line">      originator.setState(<span class="string">&quot;State #1&quot;</span>);</span><br><span class="line">      originator.setState(<span class="string">&quot;State #2&quot;</span>);</span><br><span class="line">      careTaker.add(originator.saveStateToMemento());</span><br><span class="line">      originator.setState(<span class="string">&quot;State #3&quot;</span>);</span><br><span class="line">      careTaker.add(originator.saveStateToMemento());</span><br><span class="line">      originator.setState(<span class="string">&quot;State #4&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      System.out.println(<span class="string">&quot;Current State: &quot;</span> + originator.getState());    </span><br><span class="line">      originator.getStateFromMemento(careTaker.get(<span class="number">0</span>));</span><br><span class="line">      System.out.println(<span class="string">&quot;First saved State: &quot;</span> + originator.getState());</span><br><span class="line">      originator.getStateFromMemento(careTaker.get(<span class="number">1</span>));</span><br><span class="line">      System.out.println(<span class="string">&quot;Second saved State: &quot;</span> + originator.getState());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210316174409.png" alt="image-20210316174409229"></p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoåšå®¢ä¼˜åŒ–Next7ä¸»é¢˜ä¼˜åŒ–</title>
    <url>/posts/33ffdf26/</url>
    <content><![CDATA[<h1>è®¾ç½®ç«™ç‚¹åç­‰</h1>
<p>æ‰“å¼€<strong>æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code></strong></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">ä¸‰æ‰ç”Ÿçš„ä¸ªäººç¬”è®°</span>   <span class="comment">#æ ‡é¢˜</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">ä¸‰æ‰ç”Ÿçš„ä¸ªäººç¬”è®°</span>  <span class="comment">#æ ‡é¢˜</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">ä¸‰æ‰ç”Ÿçš„ä¸ªäººç¬”è®°</span> <span class="comment">#æ ‡é¢˜</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">CNRF</span>     <span class="comment">#ä½œè€…åç§°</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span>  <span class="comment">#è®¾ç½®ç®€ä½“ä¸­æ–‡</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">UTC</span>	<span class="comment">#è®¾ç½®æ—¶åŒº</span></span><br></pre></td></tr></table></figure>
<h1>é€‰æ‹©scheme</h1>
<p>åœ¨ä¸»ç›®å½•çš„\source_data\next.ymlä¸­ï¼Œ,æŸ¥æ‰¾<code>scheme</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#scheme: Muse</span></span><br><span class="line"><span class="comment">#scheme: Mist</span></span><br><span class="line"><span class="comment">#scheme: Pisces</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Gemini</span></span><br></pre></td></tr></table></figure>
<h1>è®¾ç½®èœå•åŠå¯¹åº”é¡µé¢</h1>
<p>åœ¨ä¸»ç›®å½•çš„\source_data\next.ymlä¸­ï¼ŒæŸ¥æ‰¾<code>menu</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">home</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">archive</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || sitemap</span></span><br><span class="line">  <span class="attr">commonweal:</span> <span class="string">/404/</span> <span class="string">||</span> <span class="string">heartbeat</span></span><br></pre></td></tr></table></figure>
<p>å»æ‰<code>#</code>æ³¨é‡Šå³å¯æ˜¾ç¤ºå¯¹åº”çš„èœå•é¡¹ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ–°çš„èœå•é¡¹ã€‚ <code>||</code>ä¹‹å‰çš„å€¼æ˜¯ç›®æ ‡é“¾æ¥ï¼Œä¹‹åçš„æ˜¯åˆ†ç±»é¡µé¢çš„å›¾æ ‡ï¼Œå›¾æ ‡åç§°æ¥è‡ªäºFontAwesome iconã€‚è‹¥æ²¡æœ‰é…ç½®å›¾æ ‡ï¼Œé»˜è®¤ä¼šä½¿ç”¨é—®å·å›¾æ ‡ã€‚</p>
<p>æ–°æ·»åŠ çš„èœå•éœ€è¦ç¿»è¯‘å¯¹åº”çš„ä¸­æ–‡<br>
æ‰“å¼€<code>hexo/theme/next/languages/zh-CN.yml</code>ï¼Œåœ¨menuä¸‹è‡ªå®šä¹‰ï¼Œå¦‚ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">resources:</span> <span class="string">èµ„æº</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®æ–°å¢çš„èœå•</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">hexo new page &quot;commonweal&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨<strong>ä¸»ç›®å½•ä¸‹source</strong>æ–°å»º404.html</p>
<blockquote>
<p><strong>Hexo é»˜è®¤ä¼šæ¸²æŸ“æ‰€æœ‰çš„ HTML å’Œ Markdown æ–‡ä»¶</strong>ã€‚</p>
</blockquote>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨æ–‡ä»¶å¼€å¤´åŠ ä¸Š <code>layout: false</code> ä¸€è¡Œæ¥é¿å…æ¸²æŸ“ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">+layout: false</span><br><span class="line">+---</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>404<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">homePageUrl</span>=<span class="string">&quot;/&quot;</span> <span class="attr">homePageName</span>=<span class="string">&quot;è¿”å›&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1>è®¾å®šç«™ç‚¹å»ºç«‹æ—¶é—´</h1>
<p>æ‰“å¼€**<code>themes/next/</code>ä¸‹çš„<code>_config.yml</code>**ï¼ŒæŸ¥æ‰¾<code>since</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="comment"># Specify the date when the site was setup.</span></span><br><span class="line">  <span class="comment"># If not defined, current year will be used.</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">2015</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤æ˜¾ç¤ºå½“å‰å¹´ä»½</strong>ã€‚</p>
<h1>è®¾ç½®å¤´åƒ</h1>
<p>æ‰“å¼€<code>themes/next/</code>ä¸‹çš„<code>_config.yml</code>ï¼ŒæŸ¥æ‰¾<code>avatar</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Sidebar Avatar</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">/images/avatar111.png</span>  <span class="comment"># è®¾ç½®å¤´åƒèµ„æºçš„ä½ç½®</span></span><br><span class="line">  <span class="attr">rounded:</span> <span class="literal">true</span>            <span class="comment"># å¼€å¯åœ†å½¢å¤´åƒ</span></span><br><span class="line">  <span class="attr">opacity:</span> <span class="number">1</span>               <span class="comment"># ä¸é€æ˜çš„æ¯”ä¾‹ï¼š0å°±æ˜¯å®Œå…¨é€æ˜</span></span><br><span class="line">  <span class="attr">rotated:</span> <span class="literal">false</span>           <span class="comment"># ä¸å¼€å¯æ—‹è½¬</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224210106.png" alt="image-20210224210106776"></p>
<p><code>avatar</code>çš„å€¼æ˜¯<strong>å›¾ç‰‡çš„é“¾æ¥åœ°å€</strong>(å®Œæ•´çš„URI æˆ–è€… ç«™å†…çš„ç›¸å¯¹åœ°å€çš†å¯)</p>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®Œæ•´çš„URI</td>
<td><a href="http://example.com/avatar.png">http://example.com/avatar.png</a></td>
</tr>
<tr>
<td>ç«™ç‚¹å†…åœ°å€</td>
<td>å›¾ç‰‡æ”¾è‡³<code>themes/next/source/images/</code>é…ç½®ä¸ºï¼š<code>avatar: /images/å›¾ç‰‡å</code></td>
</tr>
<tr>
<td>ç«™ç‚¹å†…åœ°å€</td>
<td>å›¾ç‰‡æ”¾è‡³<strong>æ ¹ç›®å½•ä¸‹</strong><code>source/uploads/</code>(åˆå§‹æ— uploadsæ–‡ä»¶å¤¹ï¼Œè‡ªè¡Œåˆ›å»º)ç›®å½•ä¸‹é…ç½®ä¸ºï¼š<code>avatar: /uploads/å›¾ç‰‡å</code></td>
</tr>
</tbody>
</table>
<h1>ç½‘ç«™å›¾æ ‡è®¾ç½®</h1>
<ul>
<li>
<p>å›¾æ ‡ç´ æç½‘ç«™ï¼š<a href="https://www.iconfont.cn/">iconfont</a>ï¼›<a href="https://www.easyicon.net/">easyicon</a></p>
</li>
<li>
<p>ä¸‹è½½16x16ä»¥åŠ32x32å¤§å°çš„<strong>PNGæ ¼å¼å›¾æ ‡</strong>ï¼Œç½®äº<code>/themes/next/source/images/</code>ä¸‹</p>
</li>
<li>
<p>æ‰“å¼€**<code>source/_data</code>ä¸‹çš„<code>next.yml</code>**ï¼ŒæŸ¥æ‰¾<code>favicon</code></p>
  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">favicon:</span></span><br><span class="line">  <span class="attr">small:</span> <span class="string">/images/favicon-16x16-next.png</span></span><br><span class="line">  <span class="attr">medium:</span> <span class="string">/images/favicon-32x32-next.png</span></span><br><span class="line">  <span class="attr">apple_touch_icon:</span> <span class="string">/images/apple-touch-icon-next.png</span></span><br><span class="line">  <span class="attr">safari_pinned_tab:</span> <span class="string">/images/logo.svg</span></span><br><span class="line">  <span class="comment">#android_manifest: /images/manifest.json</span></span><br><span class="line">  <span class="comment">#ms_browserconfig: /images/browserconfig.xml</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹smallå’Œmediumçš„è·¯å¾„ä¸ºä¸‹è½½çš„å›¾æ ‡è·¯å¾„</p>
</li>
</ul>
<h1>é…ç½®hexoæœ¬åœ°æœç´¢</h1>
<h2 id="æœ¬åœ°æœç´¢çš„åŸç†">æœ¬åœ°æœç´¢çš„åŸç†</h2>
<p>å¯¹äºåŠ¨æ€ç½‘ç«™æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ php å®ç°ã€‚ä½†æ˜¯ï¼ŒHexo åšå®¢æ˜¯é™æ€ç½‘ç«™ï¼Œç”¨ä¸äº† phpã€‚</p>
<p>NexT ä¸»é¢˜å·²ç»å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒç”¨äº† Hexo çš„æ‹“å±•åŒ… <code>hexo-generator-searchdb</code>ï¼Œé¢„å…ˆç”Ÿæˆäº†ä¸€ä¸ªæ–‡æœ¬åº“ <code>search.xml</code>ï¼Œç„¶åä¼ åˆ°äº†ç½‘ç«™é‡Œé¢ã€‚åœ¨æœ¬åœ°æœç´¢çš„æ—¶å€™ï¼ŒNexT ç›´æ¥ç”¨ javascript è°ƒç”¨äº†è¿™ä¸ªæ–‡ä»¶ï¼Œä»è€Œå®ç°äº†é™æ€ç½‘ç«™çš„æœ¬åœ°æœç´¢ã€‚</p>
<h2 id="è®¾ç½®è¿‡ç¨‹">è®¾ç½®è¿‡ç¨‹</h2>
<p>å®‰è£…æ’ä»¶:</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-search --save #å®‰è£… hexo-generator-search</span><br><span class="line">npm install hexo-generator-searchdb --save #å®‰è£… hexo-generator-searchdb</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬ä¿®æ”¹ç«™ç‚¹é…ç½®<code>_config.yml</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°æœç´¢</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
<ul>
<li>pathï¼šç´¢å¼•æ–‡ä»¶çš„è·¯å¾„ï¼Œç›¸å¯¹äºç«™ç‚¹æ ¹ç›®å½•</li>
<li>fieldï¼šæœç´¢èŒƒå›´ï¼Œé»˜è®¤æ˜¯ postï¼Œè¿˜å¯ä»¥é€‰æ‹© pageã€allï¼Œè®¾ç½®æˆ all è¡¨ç¤ºæœç´¢æ‰€æœ‰é¡µé¢</li>
<li>limitï¼šé™åˆ¶æœç´¢çš„æ¡ç›®æ•°</li>
</ul>
<p>ç„¶åä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶next.yml`ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Local Search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If auto, trigger search by changing input.</span></span><br><span class="line">  <span class="comment"># If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># Unescape html strings to the readable one.</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Preload the search data when the page loads.</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h1>é…ç½® hexo ç«™ç‚¹çš„ footer ä¿¡æ¯</h1>
<p>åº•éƒ¨ <code>footer</code> å¯ä»¥å¼€å…³æ˜¾ç¤º hexo ä¿¡æ¯ã€theme ä¿¡æ¯ã€å»ºç«™æ—¶é—´ç­‰ä¸ªæ€§åŒ–é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">2018</span>        <span class="comment"># å»ºç«™å¼€å§‹æ—¶é—´</span></span><br><span class="line">  <span class="attr">icon:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user</span>       <span class="comment"># è®¾ç½® å»ºç«™åˆå§‹æ—¶é—´å’Œè‡³ä»Šæ—¶é—´ä¸­é—´çš„å›¾æ ‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ª&#x27;å°äººåƒ&#x27;ï¼Œæ›´æ”¹userä¸ºheartå¯ä»¥å˜æˆä¸€ä¸ªå¿ƒ</span></span><br><span class="line">    <span class="attr">animated:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">&quot;#808080&quot;</span> <span class="comment"># æ›´æ”¹å›¾æ ‡çš„é¢œè‰²ï¼Œçº¢è‰²ä¸º&#x27;#ff0000&#x27;</span></span><br><span class="line">  <span class="attr">powered:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span>     <span class="comment"># å¼€å¯hexoé©±åŠ¨</span></span><br><span class="line">    <span class="attr">version:</span> <span class="literal">true</span>    <span class="comment"># å¼€å¯hexoç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span>     <span class="comment"># å¼€å¯ä¸»é¢˜é©±åŠ¨</span></span><br><span class="line">    <span class="attr">version:</span> <span class="literal">true</span>    <span class="comment"># å¼€å¯ä¸»é¢˜ç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="attr">custom_text:</span> <span class="string">Hosted</span> <span class="string">by</span> <span class="string">&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">rel=&quot;external</span> <span class="string">nofollow&quot;</span> <span class="string">href=&quot;https://pages.coding.me&quot;&gt;&lt;b&gt;Coding</span> <span class="string">Pages&lt;/b&gt;&lt;/a&gt;</span> <span class="comment"># è¿™é‡Œçš„åº•éƒ¨æ ‡è¯†æ˜¯ä¸ºäº†æ·»åŠ coding pageæœåŠ¡æ—¶çš„ç‰ˆæƒå£°æ˜ æ‰“å¼€æ³¨é‡Šå°±å¯ä»¥çœ‹åˆ°åº•éƒ¨æœ‰ä¸€ä¸ª hosted by coding pages</span></span><br></pre></td></tr></table></figure>
<h1>é¦–é¡µæ–‡ç« ä¸å±•ç¤ºå…¨æ–‡æ˜¾ç¤ºæ‘˜è¦</h1>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">scroll_to_more:</span> <span class="literal">true</span>      <span class="comment"># ç‚¹å‡»é˜…è¯»å…¨æ–‡åæ˜¯å¦è·³åˆ°&lt;!--more--&gt;æ ‡è®°å¤„,è®¾ä¸ºfalseæ—¶ç‚¹å‡»é˜…è¯»å…¨æ–‡å¯ä»¥ä»å¤´é˜…è¯»</span></span><br><span class="line"></span><br><span class="line"><span class="attr">save_scroll:</span> <span class="literal">false</span>        <span class="comment"># è‡ªåŠ¨ä¿å­˜æ¯ç¯‡æ–‡ç« æˆ–é¡µé¢ä¸Šä¸€æ¬¡æ»šåŠ¨çš„åœ°æ–¹</span></span><br><span class="line"></span><br><span class="line"><span class="attr">excerpt_description:</span> <span class="literal">true</span> <span class="comment"># è‡ªåŠ¨åœ¨é¦–é¡µå¯¹æ–‡ç« è¿›è¡Œæ‘˜è¦æè¿°ä½œä¸ºå‰è¨€æ–‡æœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auto_excerpt:</span>   <span class="comment"># æ˜¯å¦è‡ªåŠ¨æˆªå–æ‘˜è¦</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span> <span class="comment"># è®¾ç½®ä¸ºtrueåˆ™è‡ªåŠ¨æˆªå–150å­—å½“åšé¦–é¡µæ‘˜è¦</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">150</span>   <span class="comment"># è‡ªåŠ¨æˆªå–çš„å­—æ•°</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„éœ€è¦åœ¨mdæ–‡ä»¶å‰é¢åŠ <strong>yaml front matter</strong>ä¸­ç›¸å…³å…ƒç´ </p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">centoså®‰è£…redis</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2021-01 23:47:44</span> </span><br><span class="line"><span class="attr">categories:</span> <span class="string">&quot;redis&quot;</span> </span><br><span class="line"><span class="attr">tags:</span> </span><br><span class="line">     <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">æ ‡ç­¾äºŒ</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;centos7 å®‰è£…redis&quot;</span></span><br></pre></td></tr></table></figure>
<h1>é¦–é¡µæ–‡ç« å±æ€§</h1>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">item_text:</span> <span class="literal">false</span>    <span class="comment"># è®¾ä¸ºtrue å¯ä»¥ä¸€è¡Œæ˜¾ç¤ºï¼Œæ–‡ç« çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line">  <span class="attr">created_at:</span> <span class="literal">true</span>    <span class="comment"># æ˜¾ç¤ºåˆ›å»ºæ—¶é—´</span></span><br><span class="line">  <span class="attr">updated_at:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>     <span class="comment"># æ˜¾ç¤ºä¿®æ”¹çš„æ—¶é—´</span></span><br><span class="line">    <span class="attr">another_day:</span> <span class="literal">true</span> <span class="comment"># è®¾trueæ—¶ï¼Œå¦‚æœåˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´ä¸€æ ·åˆ™æ˜¾ç¤ºä¸€ä¸ªæ—¶é—´</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="literal">true</span>    <span class="comment"># æ˜¾ç¤ºåˆ†ç±»ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<h1>é¡µé¢é˜…è¯»ç»Ÿè®¡</h1>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span>              <span class="comment"># è®¾true å¼€å¯</span></span><br><span class="line">  <span class="attr">total_visitors:</span> <span class="literal">true</span>       <span class="comment"># æ€»é˜…è¯»äººæ•°ï¼ˆuvæ•°ï¼‰</span></span><br><span class="line">  <span class="attr">total_visitors_icon:</span> <span class="string">user</span>  <span class="comment"># é˜…è¯»æ€»äººæ•°çš„å›¾æ ‡</span></span><br><span class="line">  <span class="attr">total_views:</span> <span class="literal">true</span>          <span class="comment"># æ€»é˜…è¯»æ¬¡æ•°ï¼ˆpvæ•°ï¼‰</span></span><br><span class="line">  <span class="attr">total_views_icon:</span> <span class="string">eye</span>      <span class="comment"># é˜…è¯»æ€»æ¬¡æ•°çš„å›¾æ ‡</span></span><br><span class="line">  <span class="attr">post_views:</span> <span class="literal">true</span>           <span class="comment"># å¼€å¯å†…å®¹é˜…è¯»æ¬¡æ•°</span></span><br><span class="line">  <span class="attr">post_views_icon:</span> <span class="string">eye</span>       <span class="comment"># å†…å®¹é¡µé˜…è¯»æ•°çš„å›¾æ ‡</span></span><br></pre></td></tr></table></figure>
<h1>å­—æ•°ç»Ÿè®¡ã€é˜…è¯»æ—¶é•¿</h1>
<p>é¦–å…ˆå®‰è£…æ’ä»¶ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm install hexo-symbols-count-<span class="built_in">time</span> --save #è¿è¡Œä¸€æ¬¡ä¼šæŠ¥é”™å¯¼è‡´é…ç½®ä¸ç”Ÿæ•ˆ</span><br><span class="line">npm install hexo-symbols-count-<span class="built_in">time</span> --save</span><br></pre></td></tr></table></figure>
<p>ä¸»é¢˜é…ç½®æ–‡ä»¶<code>_config.yml</code> ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span>  <span class="comment"># falseä¼šæ˜¾ç¤ºä¸€è¡Œ</span></span><br><span class="line">  <span class="attr">item_text_post:</span> <span class="literal">true</span>  <span class="comment"># æ˜¾ç¤ºå±æ€§åç§°,è®¾ä¸ºfalseååªæ˜¾ç¤ºå›¾æ ‡å’Œç»Ÿè®¡æ•°å­—,ä¸æ˜¾ç¤ºå±æ€§çš„æ–‡å­—</span></span><br><span class="line">  <span class="attr">item_text_total:</span> <span class="literal">true</span> <span class="comment"># åº•éƒ¨footeræ˜¯å¦æ˜¾ç¤ºå­—æ•°ç»Ÿè®¡å±æ€§æ–‡å­—</span></span><br><span class="line">  <span class="attr">awl:</span> <span class="number">4</span>                <span class="comment"># è®¡ç®—å­—æ•°çš„ä¸€ä¸ªè®¾ç½®,æ²¡è®¾ç½®è¿‡</span></span><br><span class="line">  <span class="attr">wpm:</span> <span class="number">275</span>              <span class="comment"># ä¸€åˆ†é’Ÿé˜…è¯»çš„å­—æ•°</span></span><br></pre></td></tr></table></figure>
<p>ç«™ç‚¹é…ç½®æ–‡ä»¶<code>next.yml</code> æ–°å¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line"> <span class="comment">#æ–‡ç« å†…æ˜¯å¦æ˜¾ç¤º</span></span><br><span class="line">  <span class="attr">symbols:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">time:</span> <span class="literal">true</span></span><br><span class="line"> <span class="comment"># ç½‘é¡µåº•éƒ¨æ˜¯å¦æ˜¾ç¤º</span></span><br><span class="line">  <span class="attr">total_symbols:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_time:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h1>å†…å®¹é¡µé‡Œçš„ä»£ç å—æ–°å¢å¤åˆ¶æŒ‰é’®</h1>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span>      <span class="comment"># å¢åŠ å¤åˆ¶æŒ‰é’®çš„å¼€å…³</span></span><br><span class="line">    <span class="attr">show_result:</span> <span class="literal">false</span> <span class="comment"># ç‚¹å‡»å¤åˆ¶å®Œåæ˜¯å¦æ˜¾ç¤º å¤åˆ¶æˆåŠŸ ç»“æœæç¤º</span></span><br></pre></td></tr></table></figure>
<h1>é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ</h1>
<p>é¼ æ ‡çš„ç‚¹å‡»çº¢å¿ƒç‰¹æ•ˆ<br>
åœ¨/themes/next/source/js/srcä¸‹æ–°å»ºæ–‡ä»¶clicklove.js ï¼Œæ¥ç€æŠŠä¸‹é¢çš„ä»£ç æ‹·è´ç²˜è´´åˆ° clicklove.js æ–‡ä»¶ä¸­ï¼š7.8 nextæ²¡æœ‰srcæ–‡ä»¶å¤¹ï¼Œå…ˆå»ºä¸€ä¸ªsrcæ–‡ä»¶å¤¹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params">e,t,a</span>)</span>&#123;<span class="function"><span class="keyword">function</span> <span class="title">n</span>(<span class="params"></span>)</span>&#123;c(<span class="string">&quot;.heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: &#x27;&#x27;;width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;&quot;</span>),o(),r()&#125;<span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params"></span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> e=<span class="number">0</span>;e&lt;d.length;e++)d[e].alpha&lt;=<span class="number">0</span>?(t.body.removeChild(d[e].el),d.splice(e,<span class="number">1</span>)):(d[e].y--,d[e].scale+=<span class="number">.004</span>,d[e].alpha-=<span class="number">.013</span>,d[e].el.style.cssText=<span class="string">&quot;left:&quot;</span>+d[e].x+<span class="string">&quot;px;top:&quot;</span>+d[e].y+<span class="string">&quot;px;opacity:&quot;</span>+d[e].alpha+<span class="string">&quot;;transform:scale(&quot;</span>+d[e].scale+<span class="string">&quot;,&quot;</span>+d[e].scale+<span class="string">&quot;) rotate(45deg);background:&quot;</span>+d[e].color+<span class="string">&quot;;z-index:99999&quot;</span>);requestAnimationFrame(r)&#125;<span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> t=<span class="string">&quot;function&quot;</span>==<span class="keyword">typeof</span> e.onclick&amp;&amp;e.onclick;e.onclick=<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;t&amp;&amp;t(),i(e)&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">var</span> a=t.createElement(<span class="string">&quot;div&quot;</span>);a.className=<span class="string">&quot;heart&quot;</span>,d.push(&#123;<span class="attr">el</span>:a,<span class="attr">x</span>:e.clientX-<span class="number">5</span>,<span class="attr">y</span>:e.clientY-<span class="number">5</span>,<span class="attr">scale</span>:<span class="number">1</span>,<span class="attr">alpha</span>:<span class="number">1</span>,<span class="attr">color</span>:s()&#125;),t.body.appendChild(a)&#125;<span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">var</span> a=t.createElement(<span class="string">&quot;style&quot;</span>);a.type=<span class="string">&quot;text/css&quot;</span>;<span class="keyword">try</span>&#123;a.appendChild(t.createTextNode(e))&#125;<span class="keyword">catch</span>(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName(<span class="string">&quot;head&quot;</span>)[<span class="number">0</span>].appendChild(a)&#125;<span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">&quot;rgb(&quot;</span>+~~(<span class="number">255</span>*<span class="built_in">Math</span>.random())+<span class="string">&quot;,&quot;</span>+~~(<span class="number">255</span>*<span class="built_in">Math</span>.random())+<span class="string">&quot;,&quot;</span>+~~(<span class="number">255</span>*<span class="built_in">Math</span>.random())+<span class="string">&quot;)&quot;</span>&#125;<span class="keyword">var</span> d=[];e.requestAnimationFrame=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="built_in">setTimeout</span>(e,<span class="number">1e3</span>/<span class="number">60</span>)&#125;&#125;(),n()&#125;(<span class="built_in">window</span>,<span class="built_in">document</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨\themes\next\layout_layout.swigæ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ --&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;/js/src/clicklove.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224214118.png" alt="image-20210224214118864"></p>
<h1>æ·»åŠ ç½‘é¡µé¡¶éƒ¨è¿›åº¦åŠ è½½æ¡</h1>
<p>åœ¨ä¸»ç›®å½•ä¸‹è½½å®‰è£…Progress moduleï¼Œå¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;theme-next&#x2F;theme-next-pace source&#x2F;lib&#x2F;pace</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pace:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Themes list:</span></span><br><span class="line">  <span class="comment"># big-counter | bounce | barber-shop | center-atom | center-circle | center-radar | center-simple</span></span><br><span class="line">  <span class="comment"># corner-indicator | fill-left | flat-top | flash | loading-bar | mac-osx | material | minimal</span></span><br><span class="line">  <span class="comment">#theme: minimal</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">pace-theme-minimal</span></span><br></pre></td></tr></table></figure>
<h1>Footer / é¡µè„šè®¾ç½®</h1>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="comment"># Specify the date when the site was setup. If not defined, current year will be used.</span></span><br><span class="line">  <span class="comment">#since: 2015</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Icon between year and copyright info.</span></span><br><span class="line">  <span class="attr">icon:</span></span><br><span class="line">    <span class="comment"># Icon name in Font Awesome. See: https://fontawesome.com/v4.7.0/icons/</span></span><br><span class="line">    <span class="comment"># `heart` is recommended with animation in red (#ff0000).</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user</span></span><br><span class="line">    <span class="comment"># If you want to animate the icon, set it to true.</span></span><br><span class="line">    <span class="comment">## å›¾æ ‡çš„ä¸€ä¸ªåŠ¨ç”»æ•ˆæœï¼Œç±»ä¼¼äºå¿ƒè·³</span></span><br><span class="line">    <span class="attr">animated:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Change the color of icon, using Hex Code.</span></span><br><span class="line">    <span class="comment"># å›¾æ ‡é¢œè‰²ï¼Œå¯æ ¼å±€éœ€è¦è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">&quot;#808080&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># If not defined, `author` from Hexo `_config.yml` will be used.</span></span><br><span class="line">  <span class="attr">copyright:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Powered by Hexo å­—æ ·ï¼Œä¸å–œæ¬¢å¯ä»¥è®¾ç½®ä¸º false</span></span><br><span class="line">  <span class="attr">powered:</span></span><br><span class="line">    <span class="comment"># Hexo link (Powered by Hexo).</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Version info of Hexo after Hexo link (vX.X.X).</span></span><br><span class="line">    <span class="attr">version:</span> <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># ä¸»é¢˜å­—æ ·ï¼Œä¸å–œæ¬¢å¯ä»¥ false</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="comment"># Theme &amp; scheme info link (Theme - NexT.scheme).</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Version info of NexT after scheme info (vX.X.X).</span></span><br><span class="line">    <span class="attr">version:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Beian ICP and gongan information for Chinese users. See: http://www.beian.miit.gov.cn, http://www.beian.gov.cn</span></span><br><span class="line">  <span class="comment"># å¤‡æ¡ˆä¿¡æ¯ï¼Œå¦‚æœç½‘ç«™æœ‰å¤‡æ¡ˆå·ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¡«å†™å¤‡æ¡ˆå·</span></span><br><span class="line">  <span class="attr">beian:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">icp:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>Creative Commons / æ–‡ç« ç‰ˆæƒ</h1>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Creative Commons 4.0 International License.</span></span><br><span class="line"><span class="comment"># See: https://creativecommons.org/share-your-work/licensing-types-examples</span></span><br><span class="line"><span class="comment"># Available values of license: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</span></span><br><span class="line"><span class="comment"># You can set a language value if you prefer a translated version of CC license, e.g. deed.zh</span></span><br><span class="line"><span class="comment"># CC licenses are available in 39 languages, you can find the specific and correct abbreviation you need on https://creativecommons.org</span></span><br><span class="line"><span class="attr">creative_commons:</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">by-nc-sa</span></span><br><span class="line">  <span class="attr">sidebar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">post:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">language:</span></span><br></pre></td></tr></table></figure>
<p>åœ¨æ–‡ç«  .md æ–‡ä»¶ä¸­çš„ä¸Šéƒ¨ï¼Œæ·»åŠ  copyright: trueã€‚</p>
<h1>å¼€å¯æ–‡ç« ç›®å½•</h1>
<p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<strong>next.ym</strong>l</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Table of Contents in the Sidebar</span></span><br><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Automatically add list number to toc.</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, all words will placed on next lines if header width longer then sidebar width.</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, all level of TOC in a post will be displayed, rather than the activated part of it.</span></span><br><span class="line">  <span class="attr">expand_all:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Maximum heading depth of generated toc. You can set it in one post through `toc_max_depth` in Front-matter.</span></span><br><span class="line">  <span class="attr">max_depth:</span> <span class="number">6</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>GitHub Fork Me</h1>
<p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<strong>next.ym</strong>l</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># `Follow me on GitHub` banner in the top-right corner.</span></span><br><span class="line"><span class="attr">github_banner:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">permalink:</span> <span class="string">https://github.com/CNRF</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Follow</span> <span class="string">me</span> <span class="string">on</span> <span class="string">GitHub</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>bookmark</h1>
<p>Bookmarkæ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œå…è®¸ç”¨æˆ·ä¿å­˜ä»–ä»¬çš„é˜…è¯»è¿›åº¦ã€‚ç”¨æˆ·åªéœ€å•å‡»é¡µé¢å·¦ä¸Šè§’çš„ä¹¦ç­¾å›¾æ ‡å³å¯ä¿å­˜æ»šåŠ¨ä½ç½®ã€‚å½“ä»–ä»¬ä¸‹æ¬¡è®¿é—®æ‚¨çš„åšå®¢æ—¶ï¼Œä»–ä»¬å¯ä»¥è‡ªåŠ¨æ¢å¤æ¯ä¸ªé¡µé¢çš„æœ€åæ»šåŠ¨ä½ç½®ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">bookmark:</span>	</span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Customize the color of the bookmark.	</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;#222&quot;</span>	</span><br><span class="line">  <span class="comment"># If auto, save the reading progress when closing the page or clicking the bookmark-icon.	</span></span><br><span class="line">  <span class="comment"># If manual, only save it by clicking the bookmark-icon.	</span></span><br><span class="line">  <span class="attr">save:</span> <span class="string">auto</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>æ·»åŠ lazyload</h1>
<p>å¯¹äºå›¾ç‰‡è¿›è¡Œå»¶è¿ŸåŠ è½½ï¼Œè®¿é—®åˆ°å›¾ç‰‡ä½ç½®æ—¶æ‰å»è¯·æ±‚å›¾ç‰‡èµ„æºï¼Œè¿™æ ·å¯ä»¥æé«˜åšå®¢çš„è®¿é—®é€Ÿåº¦ï¼ŒèŠ‚çœæµé‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;theme-next&#x2F;theme-next-jquery-lazyload source&#x2F;lib&#x2F;jquery_lazyload</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>æ˜¾ç¤ºå½“å‰æµè§ˆè¿›åº¦</h1>
<p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<strong>next.ym</strong>l</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Scroll percent label in b2t button.# # æ˜¯å¦æ˜¾ç¤ºé¡µé¢æµè§ˆç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="attr">scrollpercent:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224220253.png" alt="image-20210224220253001"></p>
<h1>æ”¯æŒæ•°å­¦å…¬å¼</h1>
<p>å¯èƒ½åœ¨ä¸€äº›æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªå…¬å¼ï¼Œmakdownæ˜¯æ”¯æŒçš„ï¼Œnextä¹Ÿæ”¯æŒã€‚</p>
<p>Next ä¸»é¢˜æä¾›äº†ä¸¤ä¸ªæ¸²æŸ“å¼•æ“ï¼Œåˆ†åˆ«æ˜¯ mathjax å’Œkatexï¼Œåè€…ç›¸å¯¹å‰è€…æ¥è¯´æ¸²æŸ“é€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”ä¸éœ€è¦ JavaScript çš„é¢å¤–æ”¯æŒï¼Œä½†åè€…æ”¯æŒçš„åŠŸèƒ½ç°åœ¨è¿˜ä¸å¦‚å‰è€…ä¸°å¯Œï¼Œå…·ä½“çš„å¯¹æ¯”å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://theme-next.org/docs/third-party-services/math-equations%E3%80%82">https://theme-next.org/docs/third-party-services/math-equationsã€‚</a></p>
<p>è¿™é‡Œé€‰æ‹© mathjax ,é€šè¿‡ä¿®æ”¹é…ç½®å³å¯å¯ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo npm uninstall hexo-renderer-marked --save</span><br><span class="line">sudo npm install hexo-renderer-kramed --save</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä½¿ç”¨çš„æ—¶å€™éœ€è¦åœ¨ <strong>æ–‡ç« å¼€å¤´åŠ ä¸Šmathjax: true</strong></p>
<h1>æ·»åŠ éŸ³ä¹å’Œè§†é¢‘</h1>
<h2 id="ç½‘æ˜“äº‘">ç½‘æ˜“äº‘</h2>
<p>æ‰“å¼€ç½‘æ˜“äº‘ï¼Œæ‰¾åˆ°ä½ æƒ³è¦æ·»åŠ çš„æ­Œæ›²æˆ–è€…æ­Œå•ï¼Œç‚¹ç”Ÿæˆ<code>å¤–é“¾æ’­æ”¾å™¨</code> ç„¶åå¤åˆ¶ä»£ç </p>
<p>å°†ä»£ç æ”¾åˆ°â€¦<code>/themes/hexo-theme-next/layout/_macro/sidebar.swig</code>æ–‡ä»¶ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!--æ–°å¢163æ’­æ”¾å™¨--&gt;</span><br><span class="line">&lt;iframe frameborder&#x3D;&quot;no&quot; border&#x3D;&quot;0&quot; marginwidth&#x3D;&quot;0&quot; marginheight&#x3D;&quot;0&quot; width&#x3D;298 height&#x3D;52 src&#x3D;&quot;&#x2F;&#x2F;music.163.com&#x2F;outchain&#x2F;player?type&#x3D;0&amp;id&#x3D;756579097&amp;auto&#x3D;0&amp;height&#x3D;32&quot;&gt;&lt;&#x2F;iframe&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210225094310.png" alt="image-20210225094310438"></p>
<h2 id="è§†é¢‘">è§†é¢‘</h2>
<p>1ï¼‰ç›´æ¥ç”¨ HTML çš„æ ‡ç­¾ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p>
<p>å¤åˆ¶<br>
Your browser does not support the video tag.<br>
2ï¼‰ç”¨æ’ä»¶ï¼Œå¯æ”¯æŒå¼¹å¹•ï¼Œé¦–å…ˆåœ¨ç«™ç‚¹æ–‡ä»¶å¤¹æ ¹ç›®å½•å®‰è£…æ’ä»¶ï¼š</p>
<p>å¤åˆ¶<br>
npm install hexo-tag-dplayer --save<br>
ç„¶åæ–‡ç« ä¸­çš„å†™æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% dplayer â€œurl&#x3D;https:&#x2F;&#x2F;ä»€ä¹ˆä»€ä¹ˆä»€ä¹ˆ.mp4â€ â€œhttps:&#x2F;&#x2F;å°é¢å›¾.jpgâ€ â€œapi&#x3D;https:&#x2F;&#x2F;api.prprpr.me&#x2F;dplayer&#x2F;â€ â€œid&#x3D;â€ â€œloop&#x3D;falseâ€ %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% dplayer &quot;url&#x3D;https:&#x2F;&#x2F;moeplayer.b0.upaiyun.com&#x2F;dplayer&#x2F;hikarunara.mp4&quot; &quot;api&#x3D;https:&#x2F;&#x2F;api.prprpr.me&#x2F;dplayer3&#x2F;&quot; &quot;addition&#x3D;https:&#x2F;&#x2F;api.prprpr.me&#x2F;dplayer3&#x2F;v2&#x2F;bilibili?aid&#x3D;120040&quot; &quot;pic&#x3D;https:&#x2F;&#x2F;moeplayer.b0.upaiyun.com&#x2F;dplayer&#x2F;hikarunara.jpg&quot; &quot;id&#x3D;9E2E3368B56CDBB4&quot; &quot;loop&#x3D;yes&quot; &quot;theme&#x3D;#FADFA3&quot; &quot;autoplay&#x3D;false&quot; &quot;token&#x3D;tokendemo&quot; %&#125;  </span><br><span class="line">&#123;% dplayer &#39;url&#x3D;some.mp4&#39; &quot;id&#x3D;someid&quot; &quot;api&#x3D;https:&#x2F;&#x2F;api.prprpr.me&#x2F;dplayer&#x2F;&quot; &quot;addition&#x3D;&#x2F;some.json&quot; &#39;code&#x3D;player.on(&quot;loadstart&quot;,function()&#123;console.log(&quot;loadstart&quot;)&#125;)&#39; &quot;autoplay&quot; %&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ä½¿ç”¨å¼¹å¹•ï¼Œå¿…é¡»æœ‰apiå’Œidä¸¤é¡¹ï¼Œå¹¶ä¸”è‹¥ä½¿ç”¨çš„æ˜¯å®˜æ–¹çš„ api åœ°å€ï¼ˆå³ä¸Šé¢çš„ï¼‰ï¼Œid çš„å€¼ä¸èƒ½ä¸è¿™ä¸ªåˆ—è¡¨çš„å€¼ä¸€æ ·ã€‚id çš„å€¼è‡ªå·±éšä¾¿å–ï¼Œå”¯ä¸€è¦æ±‚å°±æ˜¯å‰é¢è¿™ç‚¹ã€‚å¦‚æœå”¯ä¸€è¦æ±‚éš¾å€’äº†ä½ ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·å°†ä¸€æ®µä¸ä¼—ä¸åŒçš„æ–‡å­—?ç”Ÿæˆä¸€æ®µçœ‹èµ·æ¥æ¯«æ— æ„ä¹‰çš„å“ˆå¸Œå€¼ï¼Œè¿™æ ·çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¥½å¤šäº†ã€‚</p>
<p>è¦ä½¿ç”¨å¼¹å¹•ï¼Œå¿…é¡»æœ‰apiå’Œidä¸¤é¡¹ï¼Œå¹¶ä¸”è‹¥ä½¿ç”¨çš„æ˜¯å®˜æ–¹çš„ api åœ°å€ï¼ˆå³ä¸Šé¢çš„ï¼‰ï¼Œid çš„å€¼ä¸èƒ½ä¸è¿™ä¸ªåˆ—è¡¨çš„å€¼ä¸€æ ·ã€‚id çš„å€¼è‡ªå·±éšä¾¿å–ï¼Œå”¯ä¸€è¦æ±‚å°±æ˜¯å‰é¢è¿™ç‚¹ã€‚å¦‚æœå”¯ä¸€è¦æ±‚éš¾å€’äº†ä½ ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·å°†ä¸€æ®µä¸ä¼—ä¸åŒçš„æ–‡å­—?ç”Ÿæˆä¸€æ®µçœ‹èµ·æ¥æ¯«æ— æ„ä¹‰çš„å“ˆå¸Œå€¼ï¼Œè¿™æ ·çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¥½å¤šäº†ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸ªæ’ä»¶çš„åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥å» README å’Œè¿™æ’ä»¶çš„ã€Œæ¯äº²ã€Dplayer çš„å®˜æ–¹æ–‡æ¡£çœ‹çœ‹ã€‚</p>
<h1>æ–‡ç« æœ«å°¾ç»Ÿä¸€æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®°</h1>
<p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<strong>next.ym</strong>l</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="attr">postBodyEnd:</span> <span class="string">source/_data/post-body-end.swig</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è·¯å¾„ /source/_data ä¸‹åˆ›å»º/ä¿®æ”¹ post-body-end.swigæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;% <span class="keyword">if</span> not is_index %&#125;</span><br><span class="line">        &lt;div style=<span class="string">&quot;text-align:center;color: #ccc;font-size:14px;&quot;</span>&gt;-------------æœ¬æ–‡ç»“æŸ&lt;i class=<span class="string">&quot;fa fa-paw&quot;</span>&gt;&lt;/i&gt;æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------&lt;/div&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h1>ä¸»é¢˜åŠæ ‡é¢˜æ èƒŒæ™¯å›¾</h1>
<p>é¦–å…ˆä¸»é¢˜é…ç½®æ–‡ä»¶å–æ¶ˆæ³¨é‡Š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">custom_file_path:</span><br><span class="line">  style: <span class="built_in">source</span>/_data/styles.styl</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸»ç›®å½•source/_dataåˆ›å»º/ä¿®æ”¹ <strong>styles.styl</strong>æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  background: url(https://source.unsplash.com/random/1600x900?wallpapers);//è‡ªå·±å–œæ¬¢çš„å›¾ç‰‡åœ°å€</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-attachment</span>:fixed; <span class="comment">//ä¸é‡å¤</span></span><br><span class="line">  <span class="attribute">background-size</span>: cover;      <span class="comment">//å¡«å……</span></span><br><span class="line">  <span class="attribute">background-position</span>:<span class="number">50%</span> <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åšå®¢å†…å®¹é€æ˜åŒ–</span></span><br><span class="line"><span class="comment">//æ–‡ç« å†…å®¹çš„é€æ˜åº¦è®¾ç½®</span></span><br><span class="line"><span class="selector-class">.content-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾§è¾¹æ¡†çš„é€æ˜åº¦è®¾ç½®</span></span><br><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//èœå•æ çš„é€æ˜åº¦è®¾ç½®</span></span><br><span class="line"><span class="selector-class">.header-inner</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: rgba(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœç´¢æ¡†ï¼ˆlocal-searchï¼‰çš„é€æ˜åº¦è®¾ç½®</span></span><br><span class="line"><span class="selector-class">.popup</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>ä¿®æ”¹æ–‡ç« åº•éƒ¨çš„#å·çš„æ ‡ç­¾ï¼Œæ”¹ä¸ºå›¾æ ‡</h1>
<p>ä¿®æ”¹æ¨¡æ¿<code>/themes/next/layout/_macro/post.swig</code></p>
<p>æœç´¢ rel=â€œtagâ€ï¼Œä¿®æ”¹æ­¤è¡Œä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- &lt;a href&#x3D;&quot;&#123;&#123; url_for(tag.path) &#125;&#125;&quot; rel&#x3D;&quot;tag&quot;&gt;&#123;&#123; tag_indicate &#125;&#125; &#123;&#123; tag.name &#125;&#125;&lt;&#x2F;a&gt;</span><br><span class="line">æ›¿æ¢ä¸º</span><br><span class="line"> &lt;a href&#x3D;&quot;&#123;&#123; url_for(tag.path) &#125;&#125;&quot; rel&#x3D;&quot;tag&quot;&gt;&lt;i class&#x3D;&quot;fa fa-tag&quot;&gt;&lt;&#x2F;i&gt; &#123;&#123; tag.name &#125;&#125;&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>
<h1>ä¿®æ”¹æ–‡ç« é“¾æ¥</h1>
<p>åœ¨åšæ¬¡ä¼˜åŒ–ä¹‹å‰ï¼Œhexo-nextæ–‡ç« é“¾æ¥é»˜è®¤çš„ç”Ÿæˆè§„åˆ™æ˜¯ï¼š<code>:year/:month/:day/:title</code>ï¼Œæ˜¯æŒ‰ç…§å¹´ã€æœˆã€æ—¥ã€æ ‡é¢˜æ¥ç”Ÿæˆçš„ã€‚<br>
æ¯”å¦‚ï¼š<code>https://zxiaoxuan.github.io/2019/08/12/hello-world/</code> è¿™æ ·ï¼Œå¦‚æœæ–‡ç« æ ‡é¢˜æ˜¯ä¸­æ–‡çš„è¯ï¼ŒURLé“¾æ¥æ˜¯ä¹Ÿä¼šæ˜¯ä¸­æ–‡ï¼Œ</p>
<p><strong>å®‰è£…æ’ä»¶</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰§è¡Œæ­¤å‘½ä»¤å¯èƒ½ä¼šä¸æˆåŠŸï¼Œæç¤ºä½ ç¼ºå°‘ç›¸åº”çš„ä¾èµ–ï¼Œæ¯”å¦‚babel-eslintã€mini-css-extract-pluginã€webpack-cliâ€¦<br>
ä½¿ç”¨npmå‘½ä»¤å®‰è£…å³å¯ï¼Œæ¯”å¦‚npm install eslint@4.x babel-eslint@8 --save-dev</p>
</blockquote>
<p>ä¿®æ”¹æ ¹ç›®å½•ç«™ç‚¹é…ç½®æ–‡ä»¶<code>config.yml</code>ï¼Œæ”¹ä¸ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">posts/:abbrlink/</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line">	<span class="attr">alg:</span> <span class="string">crc32</span>   <span class="comment">#ç®—æ³•ï¼š crc16(default) and crc32</span></span><br><span class="line">	<span class="attr">rep:</span> <span class="string">hex</span>     <span class="comment">#è¿›åˆ¶ï¼š dec(default) and hex</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„é“¾æ¥å°†ä¼šæ˜¯è¿™æ ·çš„(å®˜æ–¹æ ·ä¾‹)ï¼š<br>
<strong>å››ç§å¯ä¾›é€‰æ‹©</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crc16 &amp; hex</span><br><span class="line">https:&#x2F;&#x2F;post.zz173.com&#x2F;posts&#x2F;66c8.html</span><br><span class="line"></span><br><span class="line">crc16 &amp; dec</span><br><span class="line">https:&#x2F;&#x2F;post.zz173.com&#x2F;posts&#x2F;65535.html</span><br><span class="line">crc32 &amp; hex</span><br><span class="line">https:&#x2F;&#x2F;post.zz173.com&#x2F;posts&#x2F;8ddf18fb.html</span><br><span class="line"></span><br><span class="line">crc32 &amp; dec</span><br><span class="line">https:&#x2F;&#x2F;post.zz173.com&#x2F;posts&#x2F;1690090958.html</span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆå®Œåï¼ŒåŸ<code>md</code>æ–‡ä»¶çš„<code>Front-matter</code> å†…ä¼šå¢åŠ <code>abbrlink</code> å­—æ®µï¼Œå€¼ä¸ºç”Ÿæˆçš„ID ã€‚è¿™ä¸ªå­—æ®µç¡®ä¿äº†åœ¨æˆ‘ä»¬ä¿®æ”¹äº†Front-matter å†…çš„åšå®¢æ ‡é¢˜titleæˆ–åˆ›å»ºæ—¥æœŸdateå­—æ®µä¹‹åè€Œä¸ä¼šæ”¹å˜é“¾æ¥åœ°å€ã€‚</p>
<h1>è®¾ç½®tagç•Œé¢å½©è‰²æ ‡ç­¾</h1>
<p>åœ¨<code>/themes/next/layout/</code>ç›®å½•ä¸‹ï¼Œæ–°å¢<code>tag-color.swig</code>æ–‡ä»¶ï¼ŒåŠ å…¥ä¸‹æ–¹ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">     <span class="keyword">var</span> alltags = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;tag-cloud-tags&#x27;</span>);</span><br><span class="line">     <span class="keyword">var</span> tags = alltags[<span class="number">0</span>].getElementsByTagName(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> i = tags.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">       <span class="keyword">var</span> r=<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">75</span>+<span class="number">130</span>);</span><br><span class="line">       <span class="keyword">var</span> g=<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">75</span>+<span class="number">100</span>);</span><br><span class="line">       <span class="keyword">var</span> b=<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">75</span>+<span class="number">80</span>);</span><br><span class="line">       tags[i].style.background = <span class="string">&quot;rgb(&quot;</span>+r+<span class="string">&quot;,&quot;</span>+g+<span class="string">&quot;,&quot;</span>+b+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .tag-cloud-tags&#123;</span><br><span class="line">    <span class="comment">/*font-family: Helvetica, Tahoma, Arial;*/</span></span><br><span class="line">    <span class="comment">/*font-weight: 100;*/</span></span><br><span class="line">    text-align: center;</span><br><span class="line">    counter-reset: tags;</span><br><span class="line">  &#125;</span><br><span class="line">  .tag-cloud-tags a&#123;</span><br><span class="line">    border-radius: 6px;</span><br><span class="line">    padding-right: 5px;</span><br><span class="line">    padding-left: 5px;</span><br><span class="line">    margin: 8px 5px 0px 0px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .tag-cloud-tags a:hover&#123;</span><br><span class="line">     box-shadow: 0px 5px 15px 0px rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">.4</span>);</span><br><span class="line">     transform: scale(<span class="number">1.1</span>);</span><br><span class="line">     <span class="comment">/*box-shadow: 10px 10px 15px 2px rgba(0,0,0,.12), 0 0 6px 0 rgba(104, 104, 105, 0.1);*/</span></span><br><span class="line">     transition-duration: <span class="number">0.</span>15s;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨/themes/next/layout/page.swig/ä¸­å¼•å…¥tag-color.swigï¼š</p>
<p>åœ¨ä¸‹æ–¹åŠ ä¸Š <code>&#123;% include 'tag-color.swig' %&#125;</code> ä»£ç </p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224235234.png" alt="image-20210224235234310"></p>
<h6 id="æŠŠæ ‡ç­¾æ”¾åˆ°é¦–é¡µ">æŠŠæ ‡ç­¾æ”¾åˆ°é¦–é¡µ</h6>
<p>åœ¨è·¯å¾„ï¼š<code>/themes/next/layout/index.swig</code> ä¸­<code>&#123;% block content %&#125;</code>ä¸‹é¢æ·»åŠ ä¸‹æ–¹ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;tag-cloud&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;tag-cloud-tags&quot; id&#x3D;&quot;tags&quot;&gt;</span><br><span class="line">	&#123;&#123; tagcloud(&#123;min_font: 16, max_font: 16, amount: 300, color: true, start_color: &#39;#fff&#39;, end_color: &#39;#fff&#39;&#125;) &#125;&#125;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line"></span><br><span class="line">&#123;% include &#39;tag-color.swig&#39; %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210224235556.png" alt="image-20210224235556099"></p>
<h1>å½’æ¡£é¡µé¢å¢åŠ æœˆä»½å½’æ¡£</h1>
<p>åœ¨==themes/next/source/css/_common/components/post/post-collapse.styl==æ–°å¢ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®ä¹Ÿæœˆä»½æ ·å¼</span></span><br><span class="line">.collection-month &#123; <span class="comment">//å±æ€§ä¸ä¸€å®šæ˜¯è¿™ä¸ªåå­—ï¼Œå…·ä½“å’Œä½ åœ¨swigæ–‡ä»¶ä¸­ä¸ºå…¶é…ç½®çš„classå€¼æœ‰å…³ï¼Œç…§ç€å®ƒæ¥</span></span><br><span class="line">  font-size: $font-size-largest;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  margin: 60px <span class="number">0</span>;</span><br><span class="line">  position: relative;</span><br><span class="line"></span><br><span class="line">  &amp;::before &#123;</span><br><span class="line">    background: $grey;</span><br><span class="line">    border-radius: <span class="number">50</span>%;</span><br><span class="line">    content: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    height: 8px;</span><br><span class="line">    left: <span class="number">0</span>;</span><br><span class="line">    margin-left: -4px;</span><br><span class="line">    margin-top: -4px;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: <span class="number">50</span>%;</span><br><span class="line">    width: 8px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨==themes/next/layout/_macro/post-collapse.swig==ä¸­æ–°å¢ä»£ç ï¼Œä½ç½®å¦‚å›¾</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">===========================================</span><br><span class="line">     &#123;%- set current_month = <span class="string">&#x27;0&#x27;</span> %&#125;</span><br><span class="line">===========================================</span><br><span class="line"> &#123;%- set month = date(post.date, <span class="string">&#x27;MMM&#x27;</span>) %&#125;</span><br><span class="line">  &#123;%- <span class="keyword">if</span> month !== current_month %&#125;</span><br><span class="line">    &#123;%- set current_month = month %&#125;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;collection-month&quot;</span>&gt;</span><br><span class="line">      &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;collection-header&quot;</span>&gt;&#123;&#123; current_month &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#123;%- endif %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210226093409.png" alt="image-20210226093408957"></p>
]]></content>
      <categories>
        <category>Hexo</category>
        <category>Next</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¼˜åŒ–åˆ†ææ€è·¯</title>
    <url>/posts/d1898e04/</url>
    <content><![CDATA[<h2 id="è°ƒä¼˜åŸåˆ™">è°ƒä¼˜åŸåˆ™</h2>
<p>åœ¨æ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»éµå¾ªä¸€å®šçš„åŸåˆ™ï¼Œå¦åˆ™ï¼Œæœ‰å¯èƒ½å¾—ä¸åˆ°æ­£ç¡®çš„è°ƒä¼˜ç»“æœã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>å¯¹æ€§èƒ½è¿›è¡Œåˆ†ææ—¶ï¼Œè¦å¤šæ–¹é¢åˆ†æç³»ç»Ÿçš„èµ„æºç“¶é¢ˆæ‰€åœ¨ï¼Œå› ä¸ºç³»ç»ŸæŸä¸€æ–¹é¢æ€§èƒ½ä½ï¼Œä¹Ÿè®¸å¹¶ä¸æ˜¯å®ƒè‡ªå·±é€ æˆçš„ï¼Œè€Œæ˜¯å…¶ä»–æ–¹é¢é€ æˆçš„ã€‚å¦‚CPUåˆ©ç”¨ç‡æ˜¯100%æ—¶ï¼Œå¾ˆå¯èƒ½æ˜¯å†…å­˜å®¹é‡å¤ªå°ï¼Œå› ä¸ºCPUå¿™äºå¤„ç†å†…å­˜è°ƒåº¦ã€‚</li>
<li>ä¸€æ¬¡åªå¯¹å½±å“æ€§èƒ½çš„æŸæ–¹é¢çš„ä¸€ä¸ªå‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œå¤šä¸ªå‚æ•°åŒæ—¶è°ƒæ•´çš„è¯ï¼Œå¾ˆéš¾ç•Œå®šæ€§èƒ½çš„å½±å“æ˜¯ç”±å“ªä¸ªå‚æ•°é€ æˆçš„ã€‚</li>
<li>ç”±äºåœ¨è¿›è¡Œç³»ç»Ÿæ€§èƒ½åˆ†ææ—¶ï¼Œæ€§èƒ½åˆ†æå·¥å…·æœ¬èº«ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œå¦‚CPUèµ„æºã€å†…å­˜èµ„æºç­‰ç­‰ã€‚æˆ‘ä»¬å¿…é¡»æ³¨æ„åˆ°è¿™ç‚¹ï¼Œå³åˆ†æå·¥å…·æœ¬èº«è¿è¡Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»ŸæŸæ–¹é¢çš„èµ„æºç“¶é¢ˆæƒ…å†µæ›´åŠ ä¸¥é‡ã€‚</li>
<li>å¿…é¡»ä¿è¯è°ƒä¼˜åçš„ç¨‹åºè¿è¡Œæ­£ç¡®ã€‚</li>
<li>è°ƒä¼˜è¿‡ç¨‹æ˜¯è¿­ä»£æ¸è¿›çš„è¿‡ç¨‹ï¼Œæ¯ä¸€æ¬¡è°ƒä¼˜çš„ç»“æœéƒ½è¦åé¦ˆåˆ°åç»­çš„ä»£ç å¼€å‘ä¸­å»ã€‚</li>
<li>æ€§èƒ½è°ƒä¼˜ä¸èƒ½ä»¥ç‰ºç‰²ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ä¸ºä»£ä»·ã€‚</li>
</ul>
<h2 id="è°ƒä¼˜åˆ†ææ€è·¯">è°ƒä¼˜åˆ†ææ€è·¯</h2>
<ol>
<li>å¾ˆå¤šæƒ…å†µä¸‹å‹æµ‹æµé‡å¹¶æ²¡æœ‰å®Œå…¨è¿›å…¥åˆ°æœåŠ¡ç«¯ï¼Œåœ¨ç½‘ç»œä¸Šå¯èƒ½å°±ä¼šå‡ºç°ç”±äºå„ç§è§„æ ¼ï¼ˆå¸¦å®½ã€æœ€å¤§è¿æ¥æ•°ã€æ–°å»ºè¿æ¥æ•°ç­‰ï¼‰é™åˆ¶ï¼Œå¯¼è‡´å‹æµ‹ç»“æœè¾¾ä¸åˆ°é¢„æœŸã€‚</li>
<li>çœ‹å…³é”®æŒ‡æ ‡æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œéœ€è¦ç¡®å®šæ˜¯å“ªä¸ªåœ°æ–¹æœ‰é—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç«¯é—®é¢˜å¯èƒ½æ€§æ¯”è¾ƒå¤§ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼ˆè¿™ç§æƒ…å†µæ¯”è¾ƒå°ï¼‰ã€‚</li>
<li>å¯¹äºæœåŠ¡å™¨ç«¯é—®é¢˜ï¼Œéœ€è¦å®šä½çš„æ˜¯ç¡¬ä»¶ç›¸å…³æŒ‡æ ‡ï¼Œä¾‹å¦‚CPUï¼ŒMemoryï¼ŒDisk I/Oï¼ŒNetwork I/Oï¼Œå¦‚æœæ˜¯æŸä¸ªç¡¬ä»¶æŒ‡æ ‡æœ‰é—®é¢˜ï¼Œéœ€è¦æ·±å…¥çš„è¿›è¡Œåˆ†æã€‚</li>
<li>å¦‚æœç¡¬ä»¶æŒ‡æ ‡éƒ½æ²¡æœ‰é—®é¢˜ï¼Œéœ€è¦æŸ¥çœ‹æ•°æ®åº“ç›¸å…³æŒ‡æ ‡ï¼Œä¾‹å¦‚ï¼šç­‰å¾…äº‹ä»¶ã€å†…å­˜å‘½ä¸­ç‡ç­‰ã€‚</li>
<li>å¦‚æœä»¥ä¸ŠæŒ‡æ ‡éƒ½æ­£å¸¸ï¼Œåº”ç”¨ç¨‹åºçš„ç®—æ³•ã€ç¼“å†²ã€ç¼“å­˜ã€åŒæ­¥æˆ–å¼‚æ­¥å¯èƒ½æœ‰é—®é¢˜ï¼Œéœ€è¦å…·ä½“æ·±å…¥çš„åˆ†æã€‚</li>
</ol>
<h3 id="å¯èƒ½çš„ç“¶é¢ˆç‚¹">å¯èƒ½çš„ç“¶é¢ˆç‚¹</h3>
<table>
<thead>
<tr>
<th>ç“¶é¢ˆç‚¹</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¡¬ä»¶/è§„æ ¼</td>
<td style="text-align:center">ä¸€èˆ¬æŒ‡çš„æ˜¯CPUã€å†…å­˜ã€ç£ç›˜I/Oæ–¹é¢çš„é—®é¢˜ï¼Œåˆ†ä¸ºæœåŠ¡å™¨ç¡¬ä»¶ç“¶é¢ˆã€ç½‘ç»œç“¶é¢ˆï¼ˆå¯¹å±€åŸŸç½‘å¯ä»¥ä¸è€ƒè™‘ï¼‰ã€‚</td>
</tr>
<tr>
<td>æ“ä½œç³»ç»Ÿ</td>
<td style="text-align:center">ä¸€èˆ¬æŒ‡çš„æ˜¯windowsã€UNIXã€Linuxç­‰æ“ä½œç³»ç»Ÿã€‚<br>ä¾‹å¦‚ï¼Œåœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•å‡ºç°ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è®¾ç½®ä¹Ÿä¸åˆç†ï¼Œè™šæ‹Ÿå†…å­˜çš„äº¤æ¢æ•ˆç‡å°±ä¼šå¤§å¤§é™ä½ï¼Œ<br>ä»è€Œå¯¼è‡´è¡Œä¸ºçš„å“åº”æ—¶é—´å¤§å¤§å¢åŠ ï¼Œè¿™æ—¶è®¤ä¸ºæ“ä½œç³»ç»Ÿä¸Šå‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚</td>
</tr>
<tr>
<td>æ•°æ®åº“</td>
<td style="text-align:center">ä¸€èˆ¬æŒ‡çš„æ˜¯æ•°æ®åº“é…ç½®ç­‰æ–¹é¢çš„é—®é¢˜ã€‚<br>ä¾‹å¦‚ï¼Œç”±äºå‚æ•°é…ç½®ä¸åˆç†ï¼Œå¯¼è‡´æ•°æ®åº“å¤„ç†é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œå¯è®¤ä¸ºæ˜¯æ•°æ®åº“å±‚é¢çš„çš„é—®é¢˜ã€‚</td>
</tr>
</tbody>
</table>
<h2 id="MySQLæ•°æ®åº“ä¼˜åŒ–">MySQLæ•°æ®åº“ä¼˜åŒ–</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309171911.png" alt="image-20210309171911716"></p>
<h3 id="è¿æ¥â€”â€”é…ç½®ä¼˜åŒ–">è¿æ¥â€”â€”é…ç½®ä¼˜åŒ–</h3>
<p>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼š  æœåŠ¡ç«¯è¿æ¥æ•°ä¸å¤Ÿå¯¼è‡´åº”ç”¨ç¨‹åºè·å–ä¸åˆ°è¿æ¥</p>
<p>å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥è§£å†³è¿æ¥æ•°ä¸å¤Ÿçš„é—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>ä»æœåŠ¡ç«¯æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ æœåŠ¡ç«¯çš„å¯ç”¨è¿æ¥æ•°</strong>ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªåº”ç”¨æˆ–è€…å¾ˆå¤šè¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®åº“ï¼Œè¿æ¥æ•°ä¸å¤Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
<li>
<p>ä¿®æ”¹é…ç½®å‚æ•°å¢åŠ å¯ç”¨è¿æ¥æ•°ï¼Œä¿®æ”¹ max_connections çš„å¤§å°</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;max_connections&#x27;</span>; <span class="comment">-- ä¿®æ”¹æœ€å¤§è¿æ¥æ•°ï¼Œå½“æœ‰å¤šä¸ªåº”ç”¨è¿æ¥çš„æ—¶å€™</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åŠæ—¶é‡Šæ”¾ä¸æ´»åŠ¨çš„è¿æ¥ã€‚äº¤äº’å¼å’Œéäº¤äº’å¼çš„å®¢æˆ·ç«¯çš„é»˜è®¤è¶…æ—¶æ—¶ é—´éƒ½æ˜¯ 28800 ç§’ï¼Œ8 å°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå€¼è°ƒå°</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;wait_timeout&#x27;</span>; <span class="comment">--åŠæ—¶é‡Šæ”¾ä¸æ´»åŠ¨çš„è¿æ¥ï¼Œæ³¨æ„ä¸è¦é‡Šæ”¾è¿æ¥æ± è¿˜åœ¨ä½¿ç”¨çš„è¿æ¥</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>ä»å®¢æˆ·ç«¯æ¥è¯´ï¼Œå¯ä»¥å‡å°‘ä»æœåŠ¡ç«¯è·å–çš„è¿æ¥æ•°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¸æ˜¯æ¯ä¸€æ¬¡æ‰§è¡Œ SQL éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¯ä»¥å¼•å…¥è¿æ¥æ± ï¼Œå®ç°è¿æ¥çš„é‡ç”¨</strong>ã€‚</p>
</li>
</ol>
<h3 id="ç¼“å­˜â€”â€”æ¶æ„ä¼˜åŒ–">ç¼“å­˜â€”â€”æ¶æ„ä¼˜åŒ–</h3>
<h4 id="ç¼“å­˜">ç¼“å­˜</h4>
<p>åœ¨åº”ç”¨ç³»ç»Ÿçš„å¹¶å‘æ•°éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œä¼šé€ æˆä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚</li>
<li>ä»åº”ç”¨çš„å±‚é¢æ¥è¯´ï¼Œæ“ä½œæ•°æ®çš„é€Ÿåº¦ä¹Ÿä¼šå—åˆ° å½±å“ã€‚</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p>ç”¨ç¬¬ä¸‰æ–¹çš„ç¼“å­˜æœåŠ¡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ Redisã€‚</p>
<h4 id="é›†ç¾¤ï¼Œä¸»ä»å¤åˆ¶">é›†ç¾¤ï¼Œä¸»ä»å¤åˆ¶</h4>
<p>å¦‚æœå•å°æ•°æ®åº“æœåŠ¡æ»¡è¶³ä¸äº†è®¿é—®éœ€æ±‚ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åšæ•°æ®åº“çš„é›†ç¾¤æ–¹æ¡ˆ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309172434.png" alt="image-20210309172434821"></p>
<p>åšäº†<strong>ä¸»ä»å¤åˆ¶çš„æ–¹æ¡ˆä¹‹åï¼Œæˆ‘ä»¬åªæŠŠæ•°æ®å†™å…¥ master èŠ‚ç‚¹ï¼Œè€Œè¯»çš„è¯·æ±‚å¯ä»¥åˆ†æ‹…åˆ° slave èŠ‚ç‚¹ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ–¹æ¡ˆå«åšè¯»å†™åˆ†ç¦»</strong>ã€‚</p>
<p><strong>è¯»å†™åˆ†ç¦»å¯ä»¥ä¸€å®šç¨‹åº¦ä½å‡è½»æ•°æ®åº“æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ï¼Œä½†æ˜¯éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸»ä»æ•° æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</strong></p>
<h4 id="åˆ†åº“åˆ†è¡¨">åˆ†åº“åˆ†è¡¨</h4>
<p><strong>å‚ç›´åˆ†åº“ï¼Œå‡å°‘å¹¶å‘å‹åŠ›ã€‚æ°´å¹³åˆ†è¡¨ï¼Œè§£å†³å­˜å‚¨ç“¶é¢ˆ</strong></p>
<p>å‚ç›´åˆ†åº“çš„åšæ³•ï¼Œ<strong>æŠŠä¸€ä¸ªæ•°æ®åº“æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†æˆä¸åŒçš„æ•°æ®åº“</strong>ï¼š</p>
<p>æ°´å¹³åˆ†åº“åˆ†è¡¨çš„åšæ³•ï¼Œ<strong>æŠŠå•å¼ è¡¨çš„æ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“</strong>ã€‚</p>
<h3 id="ä¼˜åŒ–å™¨â€”â€”SQL-è¯­å¥åˆ†æä¸ä¼˜åŒ–">ä¼˜åŒ–å™¨â€”â€”SQL è¯­å¥åˆ†æä¸ä¼˜åŒ–</h3>
<h4 id="æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—</h4>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/slow-query-log.html">æ…¢æŸ¥è¯¢æ—¥å¿—</a></p>
<h5 id="æ‰“å¼€æ…¢æ—¥å¿—å¼€å…³">æ‰“å¼€æ…¢æ—¥å¿—å¼€å…³</h5>
<p>å› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯æœ‰ä»£ä»·çš„ï¼ˆè·Ÿ bin logã€optimizer-trace ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥å®ƒé»˜ è®¤æ˜¯å…³é—­çš„ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;slow_query%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†è¿™ä¸ªå¼€å…³ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ§åˆ¶æ‰§è¡Œè¶…è¿‡å¤šé•¿æ—¶é—´çš„ SQL æ‰è®°å½•åˆ°æ…¢æ—¥å¿—ï¼Œé»˜ è®¤æ˜¯ 10 ç§’ã€‚å¦‚æœæ”¹æˆ 0 ç§’çš„è¯å°±æ˜¯è®°å½•æ‰€æœ‰çš„ SQLã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%long_query%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç›´æ¥åŠ¨æ€ä¿®æ”¹å‚æ•°ï¼ˆé‡å¯åå¤±æ•ˆï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> @<span class="variable">@global</span>.slow_query_log<span class="operator">=</span><span class="number">1</span>; <span class="comment">-- 1 å¼€å¯ï¼Œ0 å…³é—­ï¼Œé‡å¯åå¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@global</span>.long_query_time<span class="operator">=</span><span class="number">3</span>; <span class="comment">-- mysql é»˜è®¤çš„æ…¢æŸ¥è¯¢æ—¶é—´æ˜¯ 10 ç§’ï¼Œå¦å¼€ä¸€ä¸ªçª—å£åæ‰ä¼šæŸ¥åˆ°æœ€æ–°å€¼</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%long_query%&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶ my.cnfã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">slow_query_log = ON</span><br><span class="line">long_query_time=2</span><br><span class="line">slow_query_log_file =/var/lib/mysql/localhost-slow.log</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="æ…¢æ—¥å¿—åˆ†æ">æ…¢æ—¥å¿—åˆ†æ</h5>
<h5 id="ç›´æ¥æŸ¥çœ‹æ—¥å¿—å†…å®¹">ç›´æ¥æŸ¥çœ‹æ—¥å¿—å†…å®¹</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;slow_queries&#x27;</span>; <span class="comment">-- æŸ¥çœ‹æœ‰å¤šå°‘æ…¢æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query%&#x27;</span>; <span class="comment">-- è·å–æ…¢æ—¥å¿—ç›®å½•</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /var/lib/mysql/ localhost-slow.log</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨mysqldumpslowå·¥å…·">ä½¿ç”¨mysqldumpslowå·¥å…·</h5>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysqldumpslow.html">**mysqldumpslow-**æ±‡æ€»æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æŸ¥è¯¢ç”¨æ—¶æœ€å¤šçš„ 10 æ¡æ…¢ SQL</span></span><br><span class="line">mysqldumpslow -s t -t 10 -g &#x27;select&#x27; /var/lib/mysql/localhost-slow.log</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309173926.png" alt="image-20210309173926526"></p>
<p>Count ä»£è¡¨è¿™ä¸ª SQL æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼›</p>
<p>Time ä»£è¡¨æ‰§è¡Œçš„æ—¶é—´ï¼Œæ‹¬å·é‡Œé¢æ˜¯ç´¯è®¡æ—¶é—´ï¼›</p>
<p>Lock è¡¨ç¤ºé”å®šçš„æ—¶é—´ï¼Œæ‹¬å·æ˜¯ç´¯è®¡ï¼›</p>
<p>Rows è¡¨ç¤ºè¿”å›çš„è®°å½•æ•°ï¼Œæ‹¬å·æ˜¯ç´¯è®¡ã€‚</p>
<h4 id="SHOW-PROFILE">SHOW PROFILE</h4>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/show-profile.html">SHOW PROFILEè¯­å¥</a></p>
<h5 id="æŸ¥çœ‹æ˜¯å¦å¼€å¯">æŸ¥çœ‹æ˜¯å¦å¼€å¯</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#æŸ¥çœ‹profilingçŠ¶æ€</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@profiling</span>;</span><br><span class="line">#è®¾ç½®å¼€å¯</span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@profiling</span><span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309174257.png" alt="image-20210309174257643"></p>
<h5 id="æŸ¥çœ‹-profile-ç»Ÿè®¡">æŸ¥çœ‹ profile ç»Ÿè®¡</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> profiles;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309174406.png" alt="image-20210309174406930"></p>
<h5 id="æŸ¥è¯¢æŒ‡å®šquery-idè¯¦ç»†ä¿¡æ¯">æŸ¥è¯¢æŒ‡å®šquery_idè¯¦ç»†ä¿¡æ¯</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#ä¸æŒ‡å®šidï¼Œé»˜è®¤æŸ¥æœ€åä¸€æ¡</span><br><span class="line"><span class="keyword">show</span> profile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210309174559.png" alt="image-20210309174559267"></p>
<h4 id="ä½¿ç”¨performance-schema">ä½¿ç”¨performance schema</h4>
<p><a href="https://dev.mysql.com/doc/refman/5.6/en/performance-schema-system-variables.html">performance schema</a></p>
<p><strong>MySQLçš„performance schema ç”¨äºç›‘æ§MySQL serveråœ¨ä¸€ä¸ªè¾ƒä½çº§åˆ«çš„è¿è¡Œè¿‡ç¨‹ä¸­çš„èµ„æºæ¶ˆè€—ã€èµ„æºç­‰å¾…ç­‰æƒ…å†µ</strong>ã€‚</p>
<h5 id="performance-schema">performance schema</h5>
<p>åœ¨mysqlçš„5.7ç‰ˆæœ¬ä¸­ï¼Œæ€§èƒ½æ¨¡å¼æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¦‚æœæƒ³è¦æ˜¾å¼çš„å…³é—­çš„è¯éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥è¿›è¡Œä¿®æ”¹ï¼Œä¼šæŠ¥é”™Variable â€˜performance_schemaâ€™ is a read only variableã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--æŸ¥çœ‹performance_schemaçš„å±æ€§</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;performance_schema&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name      <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span> <span class="keyword">ON</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹performance_schemaçš„å±æ€§å€¼ï¼Œonè¡¨ç¤ºå¼€å¯ï¼Œoffè¡¨ç¤ºå…³é—­</span></span><br><span class="line">[mysqld]</span><br><span class="line">performance_schema<span class="operator">=</span><span class="keyword">ON</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--åˆ‡æ¢æ•°æ®åº“</span></span><br><span class="line">use performance_schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">--æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨,ä¼šçœ‹åˆ°æœ‰å¾ˆå¤šè¡¨å­˜å‚¨ç€ç›¸å…³çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"></span><br><span class="line"><span class="comment">--å¯ä»¥é€šè¿‡show create table tablenameæ¥æŸ¥çœ‹åˆ›å»ºè¡¨çš„æ—¶å€™çš„è¡¨ç»“æ„</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> setup_consumers;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+---------------------------------</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>           <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                    </span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+---------------------------------</span></span><br><span class="line"><span class="operator">|</span> setup_consumers <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `setup_consumers` (</span><br><span class="line">  `NAME` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,                      </span><br><span class="line">  `ENABLED` enum(<span class="string">&#x27;YES&#x27;</span>,<span class="string">&#x27;NO&#x27;</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>               </span><br><span class="line">) ENGINE<span class="operator">=</span>PERFORMANCE_SCHEMA <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="operator">|</span>  </span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+---------------------------------</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)                             </span><br></pre></td></tr></table></figure>
<p>â€‹	instruments: ç”Ÿäº§è€…ï¼Œç”¨äºé‡‡é›†mysqlä¸­å„ç§å„æ ·çš„æ“ä½œäº§ç”Ÿçš„äº‹ä»¶ä¿¡æ¯ï¼Œå¯¹åº”é…ç½®è¡¨ä¸­çš„é…ç½®é¡¹æˆ‘ä»¬å¯ä»¥ç§°ä¸ºç›‘æ§é‡‡é›†é…ç½®é¡¹ã€‚</p>
<p>â€‹		consumers:æ¶ˆè´¹è€…ï¼Œå¯¹åº”çš„æ¶ˆè´¹è€…è¡¨ç”¨äºå­˜å‚¨æ¥è‡ªinstrumentsé‡‡é›†çš„æ•°æ®ï¼Œå¯¹åº”é…ç½®è¡¨ä¸­çš„é…ç½®é¡¹æˆ‘ä»¬å¯ä»¥ç§°ä¸ºæ¶ˆè´¹å­˜å‚¨é…ç½®é¡¹ã€‚</p>
<h5 id="performance-schemaè¡¨çš„åˆ†ç±»">performance_schemaè¡¨çš„åˆ†ç±»</h5>
<p>performance_schemaåº“ä¸‹çš„è¡¨å¯ä»¥æŒ‰ç…§ç›‘è§†ä¸åŒçš„çº¬åº¦å°±è¡Œåˆ†ç»„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--è¯­å¥äº‹ä»¶è®°å½•è¡¨ï¼Œè¿™äº›è¡¨è®°å½•äº†è¯­å¥äº‹ä»¶ä¿¡æ¯ï¼Œå½“å‰è¯­å¥äº‹ä»¶è¡¨events_statements_currentã€å†å²è¯­å¥äº‹ä»¶è¡¨events_statements_historyå’Œé•¿è¯­å¥å†å²äº‹ä»¶è¡¨events_statements_history_longã€ä»¥åŠèšåˆåçš„æ‘˜è¦è¡¨summaryï¼Œå…¶ä¸­ï¼Œsummaryè¡¨è¿˜å¯ä»¥æ ¹æ®å¸å·(account)ï¼Œä¸»æœº(host)ï¼Œç¨‹åº(program)ï¼Œçº¿ç¨‹(thread)ï¼Œç”¨æˆ·(user)å’Œå…¨å±€(global)å†è¿›è¡Œç»†åˆ†)</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%statement%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--ç­‰å¾…äº‹ä»¶è®°å½•è¡¨ï¼Œä¸è¯­å¥äº‹ä»¶ç±»å‹çš„ç›¸å…³è®°å½•è¡¨ç±»ä¼¼ï¼š</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%wait%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--é˜¶æ®µäº‹ä»¶è®°å½•è¡¨ï¼Œè®°å½•è¯­å¥æ‰§è¡Œçš„é˜¶æ®µäº‹ä»¶çš„è¡¨</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%stage%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--äº‹åŠ¡äº‹ä»¶è®°å½•è¡¨ï¼Œè®°å½•äº‹åŠ¡ç›¸å…³çš„äº‹ä»¶çš„è¡¨</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%transaction%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--ç›‘æ§æ–‡ä»¶ç³»ç»Ÿå±‚è°ƒç”¨çš„è¡¨</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%file%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--ç›‘è§†å†…å­˜ä½¿ç”¨çš„è¡¨</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%memory%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--åŠ¨æ€å¯¹performance_schemaè¿›è¡Œé…ç½®çš„é…ç½®è¡¨</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%setup%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="performance-schemaçš„ç®€å•é…ç½®ä¸ä½¿ç”¨">performance_schemaçš„ç®€å•é…ç½®ä¸ä½¿ç”¨</h5>
<p>æ•°æ®åº“åˆšåˆšåˆå§‹åŒ–å¹¶å¯åŠ¨æ—¶ï¼Œå¹¶éæ‰€æœ‰instruments(äº‹ä»¶é‡‡é›†é¡¹ï¼Œåœ¨é‡‡é›†é¡¹çš„é…ç½®è¡¨ä¸­æ¯ä¸€é¡¹éƒ½æœ‰ä¸€ä¸ªå¼€å…³å­—æ®µï¼Œæˆ–ä¸ºYESï¼Œæˆ–ä¸ºNO)å’Œconsumers(ä¸é‡‡é›†é¡¹ç±»ä¼¼ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„äº‹ä»¶ç±»å‹ä¿å­˜è¡¨é…ç½®é¡¹ï¼Œä¸ºYESå°±è¡¨ç¤ºå¯¹åº”çš„è¡¨ä¿å­˜æ€§èƒ½æ•°æ®ï¼Œä¸ºNOå°±è¡¨ç¤ºå¯¹åº”çš„è¡¨ä¸ä¿å­˜æ€§èƒ½æ•°æ®)éƒ½å¯ç”¨äº†ï¼Œæ‰€ä»¥é»˜è®¤ä¸ä¼šæ”¶é›†æ‰€æœ‰çš„äº‹ä»¶ï¼Œå¯èƒ½ä½ éœ€è¦æ£€æµ‹çš„äº‹ä»¶å¹¶æ²¡æœ‰æ‰“å¼€ï¼Œéœ€è¦è¿›è¡Œè®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªè¯­å¥æ‰“å¼€å¯¹åº”çš„instrumentså’Œconsumersï¼ˆè¡Œè®¡æ•°å¯èƒ½ä¼šå› MySQLç‰ˆæœ¬è€Œå¼‚)ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--æ‰“å¼€ç­‰å¾…äº‹ä»¶çš„é‡‡é›†å™¨é…ç½®é¡¹å¼€å…³ï¼Œéœ€è¦ä¿®æ”¹setup_instrumentsé…ç½®è¡¨ä¸­å¯¹åº”çš„é‡‡é›†å™¨é…ç½®é¡¹</span></span><br><span class="line">UPDATE setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;wait%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--æ‰“å¼€ç­‰å¾…äº‹ä»¶çš„ä¿å­˜è¡¨é…ç½®å¼€å…³ï¼Œä¿®æ”¹setup_consumersé…ç½®è¡¨ä¸­å¯¹åº”çš„é…ç½®é¡¹</span></span><br><span class="line">UPDATE setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%wait%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--å½“é…ç½®å®Œæˆä¹‹åå¯ä»¥æŸ¥çœ‹å½“å‰serveræ­£åœ¨åšä»€ä¹ˆï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢events_waits_currentè¡¨æ¥å¾—çŸ¥ï¼Œè¯¥è¡¨ä¸­æ¯ä¸ªçº¿ç¨‹åªåŒ…å«ä¸€è¡Œæ•°æ®ï¼Œç”¨äºæ˜¾ç¤ºæ¯ä¸ªçº¿ç¨‹çš„æœ€æ–°ç›‘è§†äº‹ä»¶</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> events_waits_current\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">            THREAD_ID: <span class="number">11</span></span><br><span class="line">             EVENT_ID: <span class="number">570</span></span><br><span class="line">         END_EVENT_ID: <span class="number">570</span></span><br><span class="line">           EVENT_NAME: wait<span class="operator">/</span>synch<span class="operator">/</span>mutex<span class="operator">/</span>innodb<span class="operator">/</span>buf_dblwr_mutex</span><br><span class="line">               SOURCE: </span><br><span class="line">          TIMER_START: <span class="number">4508505105239280</span></span><br><span class="line">            TIMER_END: <span class="number">4508505105270160</span></span><br><span class="line">           TIMER_WAIT: <span class="number">30880</span></span><br><span class="line">                SPINS: <span class="keyword">NULL</span></span><br><span class="line">        OBJECT_SCHEMA: <span class="keyword">NULL</span></span><br><span class="line">          OBJECT_NAME: <span class="keyword">NULL</span></span><br><span class="line">           INDEX_NAME: <span class="keyword">NULL</span></span><br><span class="line">          OBJECT_TYPE: <span class="keyword">NULL</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">67918392</span></span><br><span class="line">     NESTING_EVENT_ID: <span class="keyword">NULL</span></span><br><span class="line">   NESTING_EVENT_TYPE: <span class="keyword">NULL</span></span><br><span class="line">            OPERATION: lock</span><br><span class="line">      NUMBER_OF_BYTES: <span class="keyword">NULL</span></span><br><span class="line">                FLAGS: <span class="keyword">NULL</span></span><br><span class="line"><span class="comment">/*è¯¥ä¿¡æ¯è¡¨ç¤ºçº¿ç¨‹idä¸º11çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…buf_dblwr_mutexé”ï¼Œç­‰å¾…äº‹ä»¶ä¸º30880</span></span><br><span class="line"><span class="comment">å±æ€§è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">	id:äº‹ä»¶æ¥è‡ªå“ªä¸ªçº¿ç¨‹ï¼Œäº‹ä»¶ç¼–å·æ˜¯å¤šå°‘</span></span><br><span class="line"><span class="comment">	event_name:è¡¨ç¤ºæ£€æµ‹åˆ°çš„å…·ä½“çš„å†…å®¹</span></span><br><span class="line"><span class="comment">	source:è¡¨ç¤ºè¿™ä¸ªæ£€æµ‹ä»£ç åœ¨å“ªä¸ªæºæ–‡ä»¶ä¸­ä»¥åŠè¡Œå·</span></span><br><span class="line"><span class="comment">	timer_start:è¡¨ç¤ºè¯¥äº‹ä»¶çš„å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="comment">	timer_end:è¡¨ç¤ºè¯¥äº‹ä»¶çš„ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="comment">	timer_wait:è¡¨ç¤ºè¯¥äº‹ä»¶æ€»çš„èŠ±è´¹æ—¶é—´</span></span><br><span class="line"><span class="comment">æ³¨æ„ï¼š_currentè¡¨ä¸­æ¯ä¸ªçº¿ç¨‹åªä¿ç•™ä¸€æ¡è®°å½•ï¼Œä¸€æ—¦çº¿ç¨‹å®Œæˆå·¥ä½œï¼Œè¯¥è¡¨ä¸­ä¸ä¼šå†è®°å½•è¯¥çº¿ç¨‹çš„äº‹ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">_historyè¡¨ä¸­è®°å½•æ¯ä¸ªçº¿ç¨‹åº”è¯¥æ‰§è¡Œå®Œæˆçš„äº‹ä»¶ä¿¡æ¯ï¼Œä½†æ¯ä¸ªçº¿ç¨‹çš„äº‹ä»¶ä¿¡æ¯åªä¼šè®°å½•10æ¡ï¼Œå†å¤šå°±ä¼šè¢«è¦†ç›–ï¼Œ*_history_longè¡¨ä¸­è®°å½•æ‰€æœ‰çº¿ç¨‹çš„äº‹ä»¶ä¿¡æ¯ï¼Œä½†æ€»è®°å½•æ•°é‡æ˜¯10000ï¼Œè¶…è¿‡å°±ä¼šè¢«è¦†ç›–æ‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> thread_id,event_id,event_name,timer_wait <span class="keyword">from</span> events_waits_history <span class="keyword">order</span> <span class="keyword">by</span> thread_id limit <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">summaryè¡¨æä¾›æ‰€æœ‰äº‹ä»¶çš„æ±‡æ€»ä¿¡æ¯ï¼Œè¯¥ç»„ä¸­çš„è¡¨ä»¥ä¸åŒçš„æ–¹å¼æ±‡æ€»äº‹ä»¶æ•°æ®ï¼ˆå¦‚ï¼šæŒ‰ç”¨æˆ·ï¼ŒæŒ‰ä¸»æœºï¼ŒæŒ‰çº¿ç¨‹ç­‰ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼šè¦æŸ¥çœ‹å“ªäº›instrumentså ç”¨æœ€å¤šçš„æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡å¯¹events_waits_summary_global_by_event_nameè¡¨çš„COUNT_STARæˆ–SUM_TIMER_WAITåˆ—è¿›è¡ŒæŸ¥è¯¢ï¼ˆè¿™ä¸¤åˆ—æ˜¯å¯¹äº‹ä»¶çš„è®°å½•æ•°æ‰§è¡ŒCOUNTï¼ˆ*ï¼‰ã€äº‹ä»¶è®°å½•çš„TIMER_WAITåˆ—æ‰§è¡ŒSUMï¼ˆTIMER_WAITï¼‰ç»Ÿè®¡è€Œæ¥ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> EVENT_NAME,COUNT_STAR <span class="keyword">FROM</span> events_waits_summary_global_by_event_name  <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span> LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">instanceè¡¨è®°å½•äº†å“ªäº›ç±»å‹çš„å¯¹è±¡ä¼šè¢«æ£€æµ‹ã€‚è¿™äº›å¯¹è±¡åœ¨è¢«serverä½¿ç”¨æ—¶ï¼Œåœ¨è¯¥è¡¨ä¸­å°†ä¼šäº§ç”Ÿä¸€æ¡äº‹ä»¶è®°å½•ï¼Œä¾‹å¦‚ï¼Œfile_instancesè¡¨åˆ—å‡ºäº†æ–‡ä»¶I/Oæ“ä½œåŠå…¶å…³è”æ–‡ä»¶å</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> file_instances limit <span class="number">20</span>; </span><br></pre></td></tr></table></figure>
<h5 id="å¸¸ç”¨é…ç½®é¡¹çš„å‚æ•°è¯´æ˜">å¸¸ç”¨é…ç½®é¡¹çš„å‚æ•°è¯´æ˜</h5>
<h6 id="å¯åŠ¨é€‰é¡¹">å¯åŠ¨é€‰é¡¹</h6>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">performance_schema_consumer_events_statements_current<span class="operator">=</span><span class="literal">TRUE</span></span><br><span class="line">æ˜¯å¦åœ¨mysql serverå¯åŠ¨æ—¶å°±å¼€å¯events_statements_currentè¡¨çš„è®°å½•åŠŸèƒ½(è¯¥è¡¨è®°å½•å½“å‰çš„è¯­å¥äº‹ä»¶ä¿¡æ¯)ï¼Œå¯åŠ¨ä¹‹åä¹Ÿå¯ä»¥åœ¨setup_consumersè¡¨ä¸­ä½¿ç”¨UPDATEè¯­å¥è¿›è¡ŒåŠ¨æ€æ›´æ–°setup_consumersé…ç½®è¡¨ä¸­çš„events_statements_currenté…ç½®é¡¹ï¼Œé»˜è®¤å€¼ä¸º<span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line">performance_schema_consumer_events_statements_history<span class="operator">=</span><span class="literal">TRUE</span></span><br><span class="line">ä¸performance_schema_consumer_events_statements_currenté€‰é¡¹ç±»ä¼¼ï¼Œä½†è¯¥é€‰é¡¹æ˜¯ç”¨äºé…ç½®æ˜¯å¦è®°å½•è¯­å¥äº‹ä»¶çŸ­å†å²ä¿¡æ¯ï¼Œé»˜è®¤ä¸º<span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line">performance_schema_consumer_events_stages_history_long<span class="operator">=</span><span class="literal">FALSE</span></span><br><span class="line">ä¸performance_schema_consumer_events_statements_currenté€‰é¡¹ç±»ä¼¼ï¼Œä½†è¯¥é€‰é¡¹æ˜¯ç”¨äºé…ç½®æ˜¯å¦è®°å½•è¯­å¥äº‹ä»¶é•¿å†å²ä¿¡æ¯ï¼Œé»˜è®¤ä¸º<span class="literal">FALSE</span></span><br><span class="line"></span><br><span class="line">é™¤äº†statement(è¯­å¥)äº‹ä»¶ä¹‹å¤–ï¼Œè¿˜æ”¯æŒï¼šwait(ç­‰å¾…)äº‹ä»¶ã€state(é˜¶æ®µ)äº‹ä»¶ã€transaction(äº‹åŠ¡)äº‹ä»¶ï¼Œä»–ä»¬ä¸statementäº‹ä»¶ä¸€æ ·éƒ½æœ‰ä¸‰ä¸ªå¯åŠ¨é¡¹åˆ†åˆ«è¿›è¡Œé…ç½®ï¼Œä½†è¿™äº›ç­‰å¾…äº‹ä»¶é»˜è®¤æœªå¯ç”¨ï¼Œå¦‚æœéœ€è¦åœ¨MySQL Serverå¯åŠ¨æ—¶ä¸€åŒå¯åŠ¨ï¼Œåˆ™é€šå¸¸éœ€è¦å†™è¿›my.cnfé…ç½®æ–‡ä»¶ä¸­</span><br><span class="line">performance_schema_consumer_global_instrumentation<span class="operator">=</span><span class="literal">TRUE</span></span><br><span class="line">æ˜¯å¦åœ¨MySQL Serverå¯åŠ¨æ—¶å°±å¼€å¯å…¨å±€è¡¨ï¼ˆå¦‚ï¼šmutex_instancesã€rwlock_instancesã€cond_instancesã€file_instancesã€usersã€hostsaccountsã€socket_summary_by_event_nameã€file_summary_by_instanceç­‰å¤§éƒ¨åˆ†çš„å…¨å±€å¯¹è±¡è®¡æ•°ç»Ÿè®¡å’Œäº‹ä»¶æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯è¡¨ ï¼‰çš„è®°å½•åŠŸèƒ½ï¼Œå¯åŠ¨ä¹‹åä¹Ÿå¯ä»¥åœ¨setup_consumersè¡¨ä¸­ä½¿ç”¨UPDATEè¯­å¥è¿›è¡ŒåŠ¨æ€æ›´æ–°å…¨å±€é…ç½®é¡¹</span><br><span class="line">é»˜è®¤å€¼ä¸º<span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line">performance_schema_consumer_statements_digest<span class="operator">=</span><span class="literal">TRUE</span></span><br><span class="line">æ˜¯å¦åœ¨MySQL Serverå¯åŠ¨æ—¶å°±å¼€å¯events_statements_summary_by_digest è¡¨çš„è®°å½•åŠŸèƒ½ï¼Œå¯åŠ¨ä¹‹åä¹Ÿå¯ä»¥åœ¨setup_consumersè¡¨ä¸­ä½¿ç”¨UPDATEè¯­å¥è¿›è¡ŒåŠ¨æ€æ›´æ–°digesté…ç½®é¡¹</span><br><span class="line">é»˜è®¤å€¼ä¸º<span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line">performance_schema_consumer_thread_instrumentation<span class="operator">=</span><span class="literal">TRUE</span></span><br><span class="line">æ˜¯å¦åœ¨MySQL Serverå¯åŠ¨æ—¶å°±å¼€å¯</span><br><span class="line"></span><br><span class="line">events_xxx_summary_by_yyy_by_event_nameè¡¨çš„è®°å½•åŠŸèƒ½ï¼Œå¯åŠ¨ä¹‹åä¹Ÿå¯ä»¥åœ¨setup_consumersè¡¨ä¸­ä½¿ç”¨UPDATEè¯­å¥è¿›è¡ŒåŠ¨æ€æ›´æ–°çº¿ç¨‹é…ç½®é¡¹</span><br><span class="line">é»˜è®¤å€¼ä¸º<span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line">performance_schema_instrument[<span class="operator">=</span>name]</span><br><span class="line">æ˜¯å¦åœ¨MySQL Serverå¯åŠ¨æ—¶å°±å¯ç”¨æŸäº›é‡‡é›†å™¨ï¼Œç”±äºinstrumentsé…ç½®é¡¹å¤šè¾¾æ•°åƒä¸ªï¼Œæ‰€ä»¥è¯¥é…ç½®é¡¹æ”¯æŒkey<span class="operator">-</span><span class="keyword">value</span>æ¨¡å¼ï¼Œè¿˜æ”¯æŒ<span class="operator">%</span>å·è¿›è¡Œé€šé…ç­‰ï¼Œå¦‚ä¸‹:</span><br><span class="line"></span><br><span class="line"># [<span class="operator">=</span>name]å¯ä»¥æŒ‡å®šä¸ºå…·ä½“çš„Instrumentsåç§°ï¼ˆä½†æ˜¯è¿™æ ·å¦‚æœæœ‰å¤šä¸ªéœ€è¦æŒ‡å®šçš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨è¯¥é€‰é¡¹å¤šæ¬¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œå¯ä»¥æŒ‡å®šinstrumentsç›¸åŒçš„å‰ç¼€<span class="operator">+</span>é€šé…ç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<span class="operator">%</span>ä»£è¡¨æ‰€æœ‰çš„instruments</span><br><span class="line"></span><br><span class="line">## æŒ‡å®šå¼€å¯å•ä¸ªinstruments</span><br><span class="line"></span><br><span class="line"><span class="comment">--performance-schema-instrument= &#x27;instrument_name=value&#x27;</span></span><br><span class="line"></span><br><span class="line">## ä½¿ç”¨é€šé…ç¬¦æŒ‡å®šå¼€å¯å¤šä¸ªinstruments</span><br><span class="line"></span><br><span class="line"><span class="comment">--performance-schema-instrument= &#x27;wait/synch/cond/%=COUNTED&#x27;</span></span><br><span class="line"></span><br><span class="line">## å¼€å…³æ‰€æœ‰çš„instruments</span><br><span class="line"></span><br><span class="line"><span class="comment">--performance-schema-instrument= &#x27;%=ON&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--performance-schema-instrument= &#x27;%=OFF&#x27;</span></span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼Œè¿™äº›å¯åŠ¨é€‰é¡¹è¦ç”Ÿæ•ˆçš„å‰ææ˜¯ï¼Œéœ€è¦è®¾ç½®performance_schema<span class="operator">=</span><span class="keyword">ON</span>ã€‚å¦å¤–ï¼Œè¿™äº›å¯åŠ¨é€‰é¡¹è™½ç„¶æ— æ³•ä½¿ç”¨<span class="keyword">show</span> variablesè¯­å¥æŸ¥çœ‹ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡setup_instrumentså’Œsetup_consumersè¡¨æŸ¥è¯¢è¿™äº›é€‰é¡¹æŒ‡å®šçš„å€¼ã€‚</span><br></pre></td></tr></table></figure>
<h6 id="ç³»ç»Ÿå˜é‡">ç³»ç»Ÿå˜é‡</h6>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%performance_schema%&#x27;</span>;</span><br><span class="line"><span class="comment">--é‡è¦çš„å±æ€§è§£é‡Š</span></span><br><span class="line">performance_schema<span class="operator">=</span><span class="keyword">ON</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ§åˆ¶performance_schemaåŠŸèƒ½çš„å¼€å…³ï¼Œè¦ä½¿ç”¨MySQLçš„performance_schemaï¼Œéœ€è¦åœ¨mysqldå¯åŠ¨æ—¶å¯ç”¨ï¼Œä»¥å¯ç”¨äº‹ä»¶æ”¶é›†åŠŸèƒ½</span></span><br><span class="line"><span class="comment">è¯¥å‚æ•°åœ¨5.7.xä¹‹å‰æ”¯æŒperformance_schemaçš„ç‰ˆæœ¬ä¸­é»˜è®¤å…³é—­ï¼Œ5.7.xç‰ˆæœ¬å¼€å§‹é»˜è®¤å¼€å¯</span></span><br><span class="line"><span class="comment">æ³¨æ„ï¼šå¦‚æœmysqldåœ¨åˆå§‹åŒ–performance_schemaæ—¶å‘ç°æ— æ³•åˆ†é…ä»»ä½•ç›¸å…³çš„å†…éƒ¨ç¼“å†²åŒºï¼Œåˆ™performance_schemaå°†è‡ªåŠ¨ç¦ç”¨ï¼Œå¹¶å°†performance_schemaè®¾ç½®ä¸ºOFF</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">performance_schema_digests_size<span class="operator">=</span><span class="number">10000</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ§åˆ¶events_statements_summary_by_digestè¡¨ä¸­çš„æœ€å¤§è¡Œæ•°ã€‚å¦‚æœäº§ç”Ÿçš„è¯­å¥æ‘˜è¦ä¿¡æ¯è¶…è¿‡æ­¤æœ€å¤§å€¼ï¼Œä¾¿æ— æ³•ç»§ç»­å­˜å…¥è¯¥è¡¨ï¼Œæ­¤æ—¶performance_schemaä¼šå¢åŠ çŠ¶æ€å˜é‡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">performance_schema_events_statements_history_long_size<span class="operator">=</span><span class="number">10000</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ§åˆ¶events_statements_history_longè¡¨ä¸­çš„æœ€å¤§è¡Œæ•°ï¼Œè¯¥å‚æ•°æ§åˆ¶æ‰€æœ‰ä¼šè¯åœ¨events_statements_history_longè¡¨ä¸­èƒ½å¤Ÿå­˜æ”¾çš„æ€»äº‹ä»¶è®°å½•æ•°ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶ä¹‹åï¼Œæœ€æ—©çš„è®°å½•å°†è¢«è¦†ç›–</span></span><br><span class="line"><span class="comment">å…¨å±€å˜é‡ï¼Œåªè¯»å˜é‡ï¼Œæ•´å‹å€¼ï¼Œ5.6.3ç‰ˆæœ¬å¼•å…¥ * 5.6.xç‰ˆæœ¬ä¸­ï¼Œ5.6.5åŠå…¶ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤ä¸º10000ï¼Œ5.6.6åŠå…¶ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤å€¼ä¸º-1ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨è®¡ç®—çš„å€¼éƒ½æ˜¯10000 * 5.7.xç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨è®¡ç®—çš„å€¼éƒ½æ˜¯10000</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">performance_schema_events_statements_history_size<span class="operator">=</span><span class="number">10</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ§åˆ¶events_statements_historyè¡¨ä¸­å•ä¸ªçº¿ç¨‹ï¼ˆä¼šè¯ï¼‰çš„æœ€å¤§è¡Œæ•°ï¼Œè¯¥å‚æ•°æ§åˆ¶å•ä¸ªä¼šè¯åœ¨events_statements_historyè¡¨ä¸­èƒ½å¤Ÿå­˜æ”¾çš„äº‹ä»¶è®°å½•æ•°ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶ä¹‹åï¼Œå•ä¸ªä¼šè¯æœ€æ—©çš„è®°å½•å°†è¢«è¦†ç›–</span></span><br><span class="line"><span class="comment">å…¨å±€å˜é‡ï¼Œåªè¯»å˜é‡ï¼Œæ•´å‹å€¼ï¼Œ5.6.3ç‰ˆæœ¬å¼•å…¥ * 5.6.xç‰ˆæœ¬ä¸­ï¼Œ5.6.5åŠå…¶ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤ä¸º10ï¼Œ5.6.6åŠå…¶ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤å€¼ä¸º-1ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨è®¡ç®—çš„å€¼éƒ½æ˜¯10 * 5.7.xç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨è®¡ç®—çš„å€¼éƒ½æ˜¯10</span></span><br><span class="line"><span class="comment">é™¤äº†statement(è¯­å¥)äº‹ä»¶ä¹‹å¤–ï¼Œwait(ç­‰å¾…)äº‹ä»¶ã€state(é˜¶æ®µ)äº‹ä»¶ã€transaction(äº‹åŠ¡)äº‹ä»¶ï¼Œä»–ä»¬ä¸statementäº‹ä»¶ä¸€æ ·éƒ½æœ‰ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¿›è¡Œå­˜å‚¨é™åˆ¶é…ç½®ï¼Œæœ‰å…´è¶£çš„åŒå­¦è‡ªè¡Œç ”ç©¶ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">performance_schema_max_digest_length<span class="operator">=</span><span class="number">1024</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”¨äºæ§åˆ¶æ ‡å‡†åŒ–å½¢å¼çš„SQLè¯­å¥æ–‡æœ¬åœ¨å­˜å…¥performance_schemaæ—¶çš„é™åˆ¶é•¿åº¦ï¼Œè¯¥å˜é‡ä¸max_digest_lengthå˜é‡ç›¸å…³(max_digest_lengthå˜é‡å«ä¹‰è¯·è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™)</span></span><br><span class="line"><span class="comment">å…¨å±€å˜é‡ï¼Œåªè¯»å˜é‡ï¼Œé»˜è®¤å€¼1024å­—èŠ‚ï¼Œæ•´å‹å€¼ï¼Œå–å€¼èŒƒå›´0~1048576</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">performance_schema_max_sql_text_length<span class="operator">=</span><span class="number">1024</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ§åˆ¶å­˜å…¥events_statements_currentï¼Œevents_statements_historyå’Œevents_statements_history_longè¯­å¥äº‹ä»¶è¡¨ä¸­çš„SQL_TEXTåˆ—çš„æœ€å¤§SQLé•¿åº¦å­—èŠ‚æ•°ã€‚ è¶…å‡ºç³»ç»Ÿå˜é‡performance_schema_max_sql_text_lengthçš„éƒ¨åˆ†å°†è¢«ä¸¢å¼ƒï¼Œä¸ä¼šè®°å½•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦è°ƒæ•´è¯¥å‚æ•°ï¼Œé™¤éè¢«æˆªæ–­çš„éƒ¨åˆ†ä¸å…¶ä»–SQLæ¯”èµ·æ¥æœ‰å¾ˆå¤§å·®å¼‚</span></span><br><span class="line"><span class="comment">å…¨å±€å˜é‡ï¼Œåªè¯»å˜é‡ï¼Œæ•´å‹å€¼ï¼Œé»˜è®¤å€¼ä¸º1024å­—èŠ‚ï¼Œå–å€¼èŒƒå›´ä¸º0~1048576ï¼Œ5.7.6ç‰ˆæœ¬å¼•å…¥</span></span><br><span class="line"><span class="comment">é™ä½ç³»ç»Ÿå˜é‡performance_schema_max_sql_text_lengthå€¼å¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œä½†å¦‚æœæ±‡æ€»çš„SQLä¸­ï¼Œè¢«æˆªæ–­éƒ¨åˆ†æœ‰è¾ƒå¤§å·®å¼‚ï¼Œä¼šå¯¼è‡´æ²¡æœ‰åŠæ³•å†å¯¹è¿™äº›æœ‰è¾ƒå¤§å·®å¼‚çš„SQLè¿›è¡ŒåŒºåˆ†ã€‚ å¢åŠ è¯¥ç³»ç»Ÿå˜é‡å€¼ä¼šå¢åŠ å†…å­˜ä½¿ç”¨ï¼Œä½†å¯¹äºæ±‡æ€»SQLæ¥è®²å¯ä»¥æ›´ç²¾å‡†åœ°åŒºåˆ†ä¸åŒçš„éƒ¨åˆ†ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h6 id="é‡è¦é…ç½®è¡¨çš„ç›¸å…³è¯´æ˜">é‡è¦é…ç½®è¡¨çš„ç›¸å…³è¯´æ˜</h6>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">performance_timersè¡¨ä¸­è®°å½•äº†serverä¸­æœ‰å“ªäº›å¯ç”¨çš„äº‹ä»¶è®¡æ—¶å™¨</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	timer_name:è¡¨ç¤ºå¯ç”¨è®¡æ—¶å™¨åç§°ï¼ŒCYCLEæ˜¯åŸºäºCPUå‘¨æœŸè®¡æ•°å™¨çš„å®šæ—¶å™¨</span></span><br><span class="line"><span class="comment">	timer_frequency:è¡¨ç¤ºæ¯ç§’é’Ÿå¯¹åº”çš„è®¡æ—¶å™¨å•ä½çš„æ•°é‡,CYCLEè®¡æ—¶å™¨çš„æ¢ç®—å€¼ä¸CPUçš„é¢‘ç‡ç›¸å…³ã€</span></span><br><span class="line"><span class="comment">	timer_resolution:è®¡æ—¶å™¨ç²¾åº¦å€¼ï¼Œè¡¨ç¤ºåœ¨æ¯ä¸ªè®¡æ—¶å™¨è¢«è°ƒç”¨æ—¶é¢å¤–å¢åŠ çš„å€¼</span></span><br><span class="line"><span class="comment">	timer_overhead:è¡¨ç¤ºåœ¨ä½¿ç”¨å®šæ—¶å™¨è·å–äº‹ä»¶æ—¶å¼€é”€çš„æœ€å°å‘¨æœŸå€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> performance_timers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">setup_timersè¡¨ä¸­è®°å½•å½“å‰ä½¿ç”¨çš„äº‹ä»¶è®¡æ—¶å™¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	name:è®¡æ—¶å™¨ç±»å‹ï¼Œå¯¹åº”æŸä¸ªäº‹ä»¶ç±»åˆ«</span></span><br><span class="line"><span class="comment">	timer_name:è®¡æ—¶å™¨ç±»å‹åç§°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> setup_timers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">setup_consumersè¡¨ä¸­åˆ—å‡ºäº†consumerså¯é…ç½®åˆ—è¡¨é¡¹</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	NAMEï¼šconsumersé…ç½®åç§°</span></span><br><span class="line"><span class="comment">	ENABLEDï¼šconsumersæ˜¯å¦å¯ç”¨ï¼Œæœ‰æ•ˆå€¼ä¸ºYESæˆ–NOï¼Œæ­¤åˆ—å¯ä»¥ä½¿ç”¨UPDATEè¯­å¥ä¿®æ”¹ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> setup_consumers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">setup_instruments è¡¨åˆ—å‡ºäº†instruments åˆ—è¡¨é…ç½®é¡¹ï¼Œå³ä»£è¡¨äº†å“ªäº›äº‹ä»¶æ”¯æŒè¢«æ”¶é›†ï¼š</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	NAMEï¼šinstrumentsåç§°ï¼Œinstrumentsåç§°å¯èƒ½å…·æœ‰å¤šä¸ªéƒ¨åˆ†å¹¶å½¢æˆå±‚æ¬¡ç»“æ„</span></span><br><span class="line"><span class="comment">	ENABLEDï¼šinstrumetnsæ˜¯å¦å¯ç”¨ï¼Œæœ‰æ•ˆå€¼ä¸ºYESæˆ–NOï¼Œæ­¤åˆ—å¯ä»¥ä½¿ç”¨UPDATEè¯­å¥ä¿®æ”¹ã€‚å¦‚æœè®¾ç½®ä¸ºNOï¼Œåˆ™è¿™ä¸ªinstrumentsä¸ä¼šè¢«æ‰§è¡Œï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•çš„äº‹ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="comment">	TIMEDï¼šinstrumentsæ˜¯å¦æ”¶é›†æ—¶é—´ä¿¡æ¯ï¼Œæœ‰æ•ˆå€¼ä¸ºYESæˆ–NOï¼Œæ­¤åˆ—å¯ä»¥ä½¿ç”¨UPDATEè¯­å¥ä¿®æ”¹ï¼Œå¦‚æœè®¾ç½®ä¸ºNOï¼Œåˆ™è¿™ä¸ªinstrumentsä¸ä¼šæ”¶é›†æ—¶é—´ä¿¡æ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> setup_instruments;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">setup_actorsè¡¨çš„åˆå§‹å†…å®¹æ˜¯åŒ¹é…ä»»ä½•ç”¨æˆ·å’Œä¸»æœºï¼Œå› æ­¤å¯¹äºæ‰€æœ‰å‰å°çº¿ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ç”¨ç›‘è§†å’Œå†å²äº‹ä»¶æ”¶é›†åŠŸèƒ½</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	HOSTï¼šä¸grantè¯­å¥ç±»ä¼¼çš„ä¸»æœºåï¼Œä¸€ä¸ªå…·ä½“çš„å­—ç¬¦ä¸²åå­—ï¼Œæˆ–ä½¿ç”¨â€œï¼…â€è¡¨ç¤ºâ€œä»»ä½•ä¸»æœºâ€</span></span><br><span class="line"><span class="comment">	USERï¼šä¸€ä¸ªå…·ä½“çš„å­—ç¬¦ä¸²åç§°ï¼Œæˆ–ä½¿ç”¨â€œï¼…â€è¡¨ç¤ºâ€œä»»ä½•ç”¨æˆ·â€</span></span><br><span class="line"><span class="comment">	ROLEï¼šå½“å‰æœªä½¿ç”¨ï¼ŒMySQL 8.0ä¸­æ‰å¯ç”¨è§’è‰²åŠŸèƒ½</span></span><br><span class="line"><span class="comment">	ENABLEDï¼šæ˜¯å¦å¯ç”¨ä¸HOSTï¼ŒUSERï¼ŒROLEåŒ¹é…çš„å‰å°çº¿ç¨‹çš„ç›‘æ§åŠŸèƒ½ï¼Œæœ‰æ•ˆå€¼ä¸ºï¼šYESæˆ–NO</span></span><br><span class="line"><span class="comment">	HISTORYï¼šæ˜¯å¦å¯ç”¨ä¸HOSTï¼Œ USERï¼ŒROLEåŒ¹é…çš„å‰å°çº¿ç¨‹çš„å†å²äº‹ä»¶è®°å½•åŠŸèƒ½ï¼Œæœ‰æ•ˆå€¼ä¸ºï¼šYESæˆ–NO</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> setup_actors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">setup_objectsè¡¨æ§åˆ¶performance_schemaæ˜¯å¦ç›‘è§†ç‰¹å®šå¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤è¡¨çš„æœ€å¤§è¡Œæ•°ä¸º100è¡Œã€‚</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	OBJECT_TYPEï¼šinstrumentsç±»å‹ï¼Œæœ‰æ•ˆå€¼ä¸ºï¼šâ€œEVENTâ€ï¼ˆäº‹ä»¶è°ƒåº¦å™¨äº‹ä»¶ï¼‰ã€â€œFUNCTIONâ€ï¼ˆå­˜å‚¨å‡½æ•°ï¼‰ã€â€œPROCEDUREâ€ï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰ã€â€œTABLEâ€ï¼ˆåŸºè¡¨ï¼‰ã€â€œTRIGGERâ€ï¼ˆè§¦å‘å™¨ï¼‰ï¼ŒTABLEå¯¹è±¡ç±»å‹çš„é…ç½®ä¼šå½±å“è¡¨I/Oäº‹ä»¶ï¼ˆwait/io/table/sql/handler instrumentï¼‰å’Œè¡¨é”äº‹ä»¶ï¼ˆwait/lock/table/sql/handler instrumentï¼‰çš„æ”¶é›†</span></span><br><span class="line"><span class="comment">	OBJECT_SCHEMAï¼šæŸä¸ªç›‘è§†ç±»å‹å¯¹è±¡æ¶µç›–çš„æ•°æ®åº“åç§°ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²åç§°ï¼Œæˆ–â€œï¼…â€(è¡¨ç¤ºâ€œä»»ä½•æ•°æ®åº“â€)</span></span><br><span class="line"><span class="comment">	OBJECT_NAMEï¼šæŸä¸ªç›‘è§†ç±»å‹å¯¹è±¡æ¶µç›–çš„è¡¨åï¼Œä¸€ä¸ªå­—ç¬¦ä¸²åç§°ï¼Œæˆ–â€œï¼…â€(è¡¨ç¤ºâ€œä»»ä½•æ•°æ®åº“å†…çš„å¯¹è±¡â€)</span></span><br><span class="line"><span class="comment">	ENABLEDï¼šæ˜¯å¦å¼€å¯å¯¹æŸä¸ªç±»å‹å¯¹è±¡çš„ç›‘è§†åŠŸèƒ½ï¼Œæœ‰æ•ˆå€¼ä¸ºï¼šYESæˆ–NOã€‚æ­¤åˆ—å¯ä»¥ä¿®æ”¹</span></span><br><span class="line"><span class="comment">	TIMEDï¼šæ˜¯å¦å¼€å¯å¯¹æŸä¸ªç±»å‹å¯¹è±¡çš„æ—¶é—´æ”¶é›†åŠŸèƒ½ï¼Œæœ‰æ•ˆå€¼ä¸ºï¼šYESæˆ–NOï¼Œæ­¤åˆ—å¯ä»¥ä¿®æ”¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> setup_objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">threadsè¡¨å¯¹äºæ¯ä¸ªserverçº¿ç¨‹ç”Ÿæˆä¸€è¡ŒåŒ…å«çº¿ç¨‹ç›¸å…³çš„ä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment">å­—æ®µè§£é‡Šï¼š</span></span><br><span class="line"><span class="comment">	THREAD_IDï¼šçº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆIDï¼‰</span></span><br><span class="line"><span class="comment">	NAMEï¼šä¸serverä¸­çš„çº¿ç¨‹æ£€æµ‹ä»£ç ç›¸å…³è”çš„åç§°(æ³¨æ„ï¼Œè¿™é‡Œä¸æ˜¯instrumentsåç§°)</span></span><br><span class="line"><span class="comment">	TYPEï¼šçº¿ç¨‹ç±»å‹ï¼Œæœ‰æ•ˆå€¼ä¸ºï¼šFOREGROUNDã€BACKGROUNDã€‚åˆ†åˆ«è¡¨ç¤ºå‰å°çº¿ç¨‹å’Œåå°çº¿ç¨‹</span></span><br><span class="line"><span class="comment">	PROCESSLIST_IDï¼šå¯¹åº”INFORMATION_SCHEMA.PROCESSLISTè¡¨ä¸­çš„IDåˆ—ã€‚</span></span><br><span class="line"><span class="comment">	PROCESSLIST_USERï¼šä¸å‰å°çº¿ç¨‹ç›¸å…³è”çš„ç”¨æˆ·åï¼Œå¯¹äºåå°çº¿ç¨‹ä¸ºNULLã€‚</span></span><br><span class="line"><span class="comment">	PROCESSLIST_HOSTï¼šä¸å‰å°çº¿ç¨‹å…³è”çš„å®¢æˆ·ç«¯çš„ä¸»æœºåï¼Œå¯¹äºåå°çº¿ç¨‹ä¸ºNULLã€‚</span></span><br><span class="line"><span class="comment">	PROCESSLIST_DBï¼šçº¿ç¨‹çš„é»˜è®¤æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºNULLã€‚</span></span><br><span class="line"><span class="comment">	PROCESSLIST_COMMANDï¼šå¯¹äºå‰å°çº¿ç¨‹ï¼Œè¯¥å€¼ä»£è¡¨ç€å½“å‰å®¢æˆ·ç«¯æ­£åœ¨æ‰§è¡Œçš„commandç±»å‹ï¼Œå¦‚æœæ˜¯sleepåˆ™è¡¨ç¤ºå½“å‰ä¼šè¯å¤„äºç©ºé—²çŠ¶æ€</span></span><br><span class="line"><span class="comment">	PROCESSLIST_TIMEï¼šå½“å‰çº¿ç¨‹å·²å¤„äºå½“å‰çº¿ç¨‹çŠ¶æ€çš„æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment">	PROCESSLIST_STATEï¼šè¡¨ç¤ºçº¿ç¨‹æ­£åœ¨åšä»€ä¹ˆäº‹æƒ…ã€‚</span></span><br><span class="line"><span class="comment">	PROCESSLIST_INFOï¼šçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯­å¥ï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œä»»ä½•è¯­å¥ï¼Œåˆ™ä¸ºNULLã€‚</span></span><br><span class="line"><span class="comment">	PARENT_THREAD_IDï¼šå¦‚æœè¿™ä¸ªçº¿ç¨‹æ˜¯ä¸€ä¸ªå­çº¿ç¨‹ï¼ˆç”±å¦ä¸€ä¸ªçº¿ç¨‹ç”Ÿæˆï¼‰ï¼Œé‚£ä¹ˆè¯¥å­—æ®µæ˜¾ç¤ºå…¶çˆ¶çº¿ç¨‹ID</span></span><br><span class="line"><span class="comment">	ROLEï¼šæš‚æœªä½¿ç”¨</span></span><br><span class="line"><span class="comment">	INSTRUMENTEDï¼šçº¿ç¨‹æ‰§è¡Œçš„äº‹ä»¶æ˜¯å¦è¢«æ£€æµ‹ã€‚æœ‰æ•ˆå€¼ï¼šYESã€NO </span></span><br><span class="line"><span class="comment">	HISTORYï¼šæ˜¯å¦è®°å½•çº¿ç¨‹çš„å†å²äº‹ä»¶ã€‚æœ‰æ•ˆå€¼ï¼šYESã€NO * </span></span><br><span class="line"><span class="comment">	THREAD_OS_IDï¼šç”±æ“ä½œç³»ç»Ÿå±‚å®šä¹‰çš„çº¿ç¨‹æˆ–ä»»åŠ¡æ ‡è¯†ç¬¦ï¼ˆIDï¼‰ï¼š</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> threads</span><br></pre></td></tr></table></figure>
<h5 id="performance-schemaå®è·µæ“ä½œ">performance_schemaå®è·µæ“ä½œ</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--1ã€å“ªç±»çš„SQLæ‰§è¡Œæœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> DIGEST_TEXT,COUNT_STAR,FIRST_SEEN,LAST_SEEN <span class="keyword">FROM</span> events_statements_summary_by_digest <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--2ã€å“ªç±»SQLçš„å¹³å‡å“åº”æ—¶é—´æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> DIGEST_TEXT,AVG_TIMER_WAIT <span class="keyword">FROM</span> events_statements_summary_by_digest <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--3ã€å“ªç±»SQLæ’åºè®°å½•æ•°æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> DIGEST_TEXT,SUM_SORT_ROWS <span class="keyword">FROM</span> events_statements_summary_by_digest <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--4ã€å“ªç±»SQLæ‰«æè®°å½•æ•°æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> DIGEST_TEXT,SUM_ROWS_EXAMINED <span class="keyword">FROM</span> events_statements_summary_by_digest <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--5ã€å“ªç±»SQLä½¿ç”¨ä¸´æ—¶è¡¨æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> DIGEST_TEXT,SUM_CREATED_TMP_TABLES,SUM_CREATED_TMP_DISK_TABLES <span class="keyword">FROM</span> events_statements_summary_by_digest <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--6ã€å“ªç±»SQLè¿”å›ç»“æœé›†æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> DIGEST_TEXT,SUM_ROWS_SENT <span class="keyword">FROM</span> events_statements_summary_by_digest <span class="keyword">ORDER</span> <span class="keyword">BY</span> COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--7ã€å“ªä¸ªè¡¨ç‰©ç†IOæœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> file_name,event_name,SUM_NUMBER_OF_BYTES_READ,SUM_NUMBER_OF_BYTES_WRITE <span class="keyword">FROM</span> file_summary_by_instance <span class="keyword">ORDER</span> <span class="keyword">BY</span> SUM_NUMBER_OF_BYTES_READ <span class="operator">+</span> SUM_NUMBER_OF_BYTES_WRITE <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--8ã€å“ªä¸ªè¡¨é€»è¾‘IOæœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> object_name,COUNT_READ,COUNT_WRITE,COUNT_FETCH,SUM_TIMER_WAIT <span class="keyword">FROM</span> table_io_waits_summary_by_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> sum_timer_wait <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--9ã€å“ªä¸ªç´¢å¼•è®¿é—®æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> OBJECT_NAME,INDEX_NAME,COUNT_FETCH,COUNT_INSERT,COUNT_UPDATE,COUNT_DELETE <span class="keyword">FROM</span> table_io_waits_summary_by_index_usage <span class="keyword">ORDER</span> <span class="keyword">BY</span> SUM_TIMER_WAIT <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--10ã€å“ªä¸ªç´¢å¼•ä»æ¥æ²¡æœ‰ç”¨è¿‡ï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> OBJECT_SCHEMA,OBJECT_NAME,INDEX_NAME <span class="keyword">FROM</span> table_io_waits_summary_by_index_usage <span class="keyword">WHERE</span> INDEX_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> COUNT_STAR <span class="operator">=</span> <span class="number">0</span> <span class="keyword">AND</span> OBJECT_SCHEMA <span class="operator">&lt;&gt;</span> <span class="string">&#x27;mysql&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> OBJECT_SCHEMA,OBJECT_NAME;</span><br><span class="line"><span class="comment">--11ã€å“ªä¸ªç­‰å¾…äº‹ä»¶æ¶ˆè€—æ—¶é—´æœ€å¤šï¼Ÿ</span></span><br><span class="line"><span class="keyword">SELECT</span> EVENT_NAME,COUNT_STAR,SUM_TIMER_WAIT,AVG_TIMER_WAIT <span class="keyword">FROM</span> events_waits_summary_global_by_event_name <span class="keyword">WHERE</span> event_name <span class="operator">!=</span> <span class="string">&#x27;idle&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> SUM_TIMER_WAIT <span class="keyword">DESC</span></span><br><span class="line"><span class="comment">--12-1ã€å‰–ææŸæ¡SQLçš„æ‰§è¡Œæƒ…å†µï¼ŒåŒ…æ‹¬statementä¿¡æ¯ï¼Œstegeä¿¡æ¯ï¼Œwaitä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SELECT</span> EVENT_ID,sql_text <span class="keyword">FROM</span> events_statements_history <span class="keyword">WHERE</span> sql_text <span class="keyword">LIKE</span> <span class="string">&#x27;%count(*)%&#x27;</span>;</span><br><span class="line"><span class="comment">--12-2ã€æŸ¥çœ‹æ¯ä¸ªé˜¶æ®µçš„æ—¶é—´æ¶ˆè€—</span></span><br><span class="line"><span class="keyword">SELECT</span> event_id,EVENT_NAME,SOURCE,TIMER_END <span class="operator">-</span> TIMER_START <span class="keyword">FROM</span> events_stages_history_long <span class="keyword">WHERE</span> NESTING_EVENT_ID <span class="operator">=</span> <span class="number">1553</span>;</span><br><span class="line"><span class="comment">--12-3ã€æŸ¥çœ‹æ¯ä¸ªé˜¶æ®µçš„é”ç­‰å¾…æƒ…å†µ</span></span><br><span class="line"><span class="keyword">SELECT</span> event_id,event_name,source,timer_wait,object_name,index_name,operation,nesting_event_id <span class="keyword">FROM</span> events_waits_history_longWHERE nesting_event_id <span class="operator">=</span> <span class="number">1553</span>;</span><br></pre></td></tr></table></figure>
<h4 id="explainæ‰§è¡Œè®¡åˆ’">explainæ‰§è¡Œè®¡åˆ’</h4>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">mysqlæ‰§è¡Œè®¡åˆ’</a></p>
<p>å¯ä»¥ä½¿ç”¨explain+SQLè¯­å¥æ¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“mysqlæ˜¯å¦‚ä½•å¤„ç†sqlè¯­å¥çš„ã€‚</p>
<h5 id="æ‰§è¡Œè®¡åˆ’ä¸­åŒ…å«çš„ä¿¡æ¯">æ‰§è¡Œè®¡åˆ’ä¸­åŒ…å«çš„ä¿¡æ¯</h5>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—å</th>
<th style="text-align:center">æ¶µä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">The <code>SELECT</code> identifier</td>
</tr>
<tr>
<td style="text-align:center">select_type</td>
<td style="text-align:center">The <code>SELECT</code> type</td>
</tr>
<tr>
<td style="text-align:center">table</td>
<td style="text-align:center">The table for the output row</td>
</tr>
<tr>
<td style="text-align:center">partitions</td>
<td style="text-align:center">The matching partitions</td>
</tr>
<tr>
<td style="text-align:center">type</td>
<td style="text-align:center">The join type</td>
</tr>
<tr>
<td style="text-align:center">possible_keys</td>
<td style="text-align:center">The possible indexes to choose</td>
</tr>
<tr>
<td style="text-align:center">key</td>
<td style="text-align:center">The index actually chosen</td>
</tr>
<tr>
<td style="text-align:center">key_len</td>
<td style="text-align:center">The length of the chosen key</td>
</tr>
<tr>
<td style="text-align:center">ref</td>
<td style="text-align:center">The columns compared to the index</td>
</tr>
<tr>
<td style="text-align:center">rows</td>
<td style="text-align:center">Estimate of rows to be examined</td>
</tr>
<tr>
<td style="text-align:center">filtered</td>
<td style="text-align:center">Percentage of rows filtered by table condition</td>
</tr>
<tr>
<td style="text-align:center">extra</td>
<td style="text-align:center">Additional information</td>
</tr>
</tbody>
</table>
<p><strong>æ‰§è¡Œè®¡åˆ’æ˜¯</strong>ï¼šå½“æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œé¦–å…ˆä¼šåˆ†æã€ä¼˜åŒ–ï¼Œå½¢æˆæ‰§è¡Œè®¡åˆ’ï¼Œåœ¨æŒ‰ç…§æ‰§è¡Œè®¡åˆ’æ‰§è¡Œã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„ä¸»ä»å¤åˆ¶</title>
    <url>/posts/9ee789ff/</url>
    <content><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶ï¼Ÿ</h2>
<ol>
<li>åœ¨ä¸šåŠ¡å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªæƒ…æ™¯ï¼Œæœ‰ä¸€å¥sqlè¯­å¥éœ€è¦é”è¡¨ï¼Œå¯¼è‡´æš‚æ—¶ä¸èƒ½ä½¿ç”¨è¯»çš„æœåŠ¡ï¼Œé‚£ä¹ˆå°±å¾ˆå½±å“è¿è¡Œä¸­çš„ä¸šåŠ¡ï¼Œä½¿ç”¨ä¸»ä»å¤åˆ¶ï¼Œè®©ä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ï¼Œè¿™æ ·ï¼Œå³ä½¿ä¸»åº“å‡ºç°äº†é”è¡¨çš„æƒ…æ™¯ï¼Œé€šè¿‡è¯»ä»åº“ä¹Ÿå¯ä»¥ä¿è¯ä¸šåŠ¡çš„æ­£å¸¸è¿ä½œã€‚</li>
<li>åšæ•°æ®çš„çƒ­å¤‡</li>
<li>æ¶æ„çš„æ‰©å±•ã€‚ä¸šåŠ¡é‡è¶Šæ¥è¶Šå¤§ï¼ŒI/Oè®¿é—®é¢‘ç‡è¿‡é«˜ï¼Œå•æœºæ— æ³•æ»¡è¶³ï¼Œæ­¤æ—¶åšå¤šåº“çš„å­˜å‚¨ï¼Œé™ä½ç£ç›˜I/Oè®¿é—®çš„é¢‘ç‡ï¼Œæé«˜å•ä¸ªæœºå™¨çš„I/Oæ€§èƒ½ã€‚</li>
</ol>
<h2 id="MySQL-ä¸»ä»å¤åˆ¶æ¦‚å¿µ">MySQL ä¸»ä»å¤åˆ¶æ¦‚å¿µ</h2>
<p>MySQL ä¸»ä»å¤åˆ¶æ˜¯æŒ‡æ•°æ®å¯ä»¥ä»ä¸€ä¸ªMySQLæ•°æ®åº“æœåŠ¡å™¨ä¸»èŠ‚ç‚¹å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ã€‚MySQL é»˜è®¤é‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œè¿™æ ·ä»èŠ‚ç‚¹ä¸ç”¨ä¸€ç›´è®¿é—®ä¸»æœåŠ¡å™¨æ¥æ›´æ–°è‡ªå·±çš„æ•°æ®ï¼Œæ•°æ®çš„æ›´æ–°å¯ä»¥åœ¨è¿œç¨‹è¿æ¥ä¸Šè¿›è¡Œï¼Œä»èŠ‚ç‚¹å¯ä»¥å¤åˆ¶ä¸»æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®åº“æˆ–è€…ç‰¹å®šçš„æ•°æ®åº“ï¼Œæˆ–è€…ç‰¹å®šçš„è¡¨ã€‚</p>
<h2 id="MySQL-ä¸»ä»å¤åˆ¶ä¸»è¦ç”¨é€”">MySQL ä¸»ä»å¤åˆ¶ä¸»è¦ç”¨é€”</h2>
<ul>
<li>
<p><strong>è¯»å†™åˆ†ç¦»</strong></p>
<p>åœ¨å¼€å‘å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡è§æŸä¸ªsql è¯­å¥éœ€è¦é”è¡¨ï¼Œå¯¼è‡´æš‚æ—¶ä¸èƒ½ä½¿ç”¨è¯»çš„æœåŠ¡ï¼Œè¿™æ ·å°±ä¼šå½±å“ç°æœ‰ä¸šåŠ¡ï¼Œä½¿ç”¨ä¸»ä»å¤åˆ¶ï¼Œè®©ä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ï¼Œè¿™æ ·ï¼Œ<strong>å³ä½¿ä¸»åº“å‡ºç°äº†é”è¡¨çš„æƒ…æ™¯ï¼Œé€šè¿‡è¯»ä»åº“ä¹Ÿå¯ä»¥ä¿è¯ä¸šåŠ¡çš„æ­£å¸¸è¿ä½œã€‚</strong></p>
</li>
<li>
<p><strong>æ•°æ®å®æ—¶å¤‡ä»½ï¼Œå½“ç³»ç»Ÿä¸­æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œæ–¹ä¾¿åˆ‡æ¢</strong></p>
</li>
<li>
<p><strong>é«˜å¯ç”¨HA</strong></p>
</li>
<li>
<p><strong>æ¶æ„æ‰©å±•</strong></p>
<p>éšç€ç³»ç»Ÿä¸­ä¸šåŠ¡è®¿é—®é‡çš„å¢å¤§ï¼Œå¦‚æœæ˜¯å•æœºéƒ¨ç½²æ•°æ®åº“ï¼Œå°±ä¼šå¯¼è‡´I/Oè®¿é—®é¢‘ç‡è¿‡é«˜ã€‚æœ‰äº†ä¸»ä»å¤åˆ¶ï¼Œå¢åŠ å¤šä¸ªæ•°æ®å­˜å‚¨èŠ‚ç‚¹ï¼Œå°†è´Ÿè½½åˆ†å¸ƒåœ¨å¤šä¸ªä»èŠ‚ç‚¹ä¸Šï¼Œé™ä½å•æœºç£ç›˜I/Oè®¿é—®çš„é¢‘ç‡ï¼Œæé«˜å•ä¸ªæœºå™¨çš„I/Oæ€§èƒ½ã€‚</p>
</li>
</ul>
<h2 id="MySQLä¸»ä»å½¢å¼">MySQLä¸»ä»å½¢å¼</h2>
<h3 id="ä¸€ä¸»ä¸€ä»">ä¸€ä¸»ä¸€ä»</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317105532.png" alt="image-20210317105532537"></p>
<h3 id="ä¸€ä¸»å¤šä»ï¼Œæé«˜ç³»ç»Ÿçš„è¯»æ€§èƒ½">ä¸€ä¸»å¤šä»ï¼Œæé«˜ç³»ç»Ÿçš„è¯»æ€§èƒ½</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317105558.png" alt="image-20210317105558859"></p>
<p>ä¸€ä¸»ä¸€ä»å’Œä¸€ä¸»å¤šä»æ˜¯æœ€å¸¸è§çš„ä¸»ä»æ¶æ„ï¼Œ<strong>å®æ–½èµ·æ¥ç®€å•å¹¶ä¸”æœ‰æ•ˆï¼Œä¸ä»…å¯ä»¥å®ç°HAï¼Œè€Œä¸”è¿˜èƒ½è¯»å†™åˆ†ç¦»ï¼Œè¿›è€Œæå‡é›†ç¾¤çš„å¹¶å‘èƒ½åŠ›ã€‚</strong></p>
<h3 id="å¤šä¸»ä¸€ä»-ï¼ˆä»5-7å¼€å§‹æ”¯æŒï¼‰">å¤šä¸»ä¸€ä» ï¼ˆä»5.7å¼€å§‹æ”¯æŒï¼‰</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317105629.png" alt="image-20210317105629817"></p>
<p>å¤šä¸»ä¸€ä»å¯ä»¥å°†å¤šä¸ªmysqlæ•°æ®åº“å¤‡ä»½åˆ°ä¸€å°å­˜å‚¨æ€§èƒ½æ¯”è¾ƒå¥½çš„æœåŠ¡å™¨ä¸Šã€‚</p>
<h3 id="åŒä¸»å¤åˆ¶">åŒä¸»å¤åˆ¶</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317105653.png" alt="image-20210317105653639"></p>
<p>åŒä¸»å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯äº’åšä¸»ä»å¤åˆ¶ï¼Œæ¯ä¸ªmasteræ—¢æ˜¯masterï¼Œåˆæ˜¯å¦å¤–ä¸€å°æœåŠ¡å™¨çš„slaveã€‚è¿™æ ·ä»»ä½•ä¸€æ–¹æ‰€åšçš„å˜æ›´ï¼Œéƒ½ä¼šé€šè¿‡å¤åˆ¶åº”ç”¨åˆ°å¦å¤–ä¸€æ–¹çš„æ•°æ®åº“ä¸­ã€‚</p>
<h3 id="çº§è”å¤åˆ¶">çº§è”å¤åˆ¶</h3>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317105716.png" alt="image-20210317105716117"></p>
<p>çº§è”å¤åˆ¶æ¨¡å¼ä¸‹ï¼Œéƒ¨åˆ†slaveçš„æ•°æ®åŒæ­¥ä¸è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè€Œæ˜¯è¿æ¥ä»èŠ‚ç‚¹ã€‚å› ä¸ºå¦‚æœä¸»èŠ‚ç‚¹æœ‰å¤ªå¤šçš„ä»èŠ‚ç‚¹ï¼Œå°±ä¼šæŸè€—ä¸€éƒ¨åˆ†æ€§èƒ½ç”¨äºreplicationï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©3~5ä¸ªä»èŠ‚ç‚¹è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œå…¶å®ƒä»èŠ‚ç‚¹ä½œä¸ºäºŒçº§æˆ–è€…ä¸‰çº§ä¸ä»èŠ‚ç‚¹è¿æ¥ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥ç¼“è§£ä¸»èŠ‚ç‚¹çš„å‹åŠ›ï¼Œå¹¶ä¸”å¯¹æ•°æ®ä¸€è‡´æ€§æ²¡æœ‰è´Ÿé¢å½±å“ã€‚</p>
<h2 id="MySQL-ä¸»ä»å¤åˆ¶åŸç†">MySQL ä¸»ä»å¤åˆ¶åŸç†</h2>
<p>MySQLä¸»ä»å¤åˆ¶æ¶‰åŠåˆ°ä¸‰ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿è¡Œåœ¨ä¸»èŠ‚ç‚¹ï¼ˆlog dump threadï¼‰ï¼Œå…¶ä½™ä¸¤ä¸ª(I/O thread, SQL thread)è¿è¡Œåœ¨ä»èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317105757.png" alt="image-20210317105757055"></p>
<ul>
<li><strong>ä¸»èŠ‚ç‚¹ binary log dump çº¿ç¨‹ä½œç”¨</strong></li>
</ul>
<p>å½“ä»èŠ‚ç‚¹è¿æ¥ä¸»èŠ‚ç‚¹æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªlog dump çº¿ç¨‹ï¼Œç”¨äºå‘é€bin-logçš„å†…å®¹ã€‚åœ¨è¯»å–bin-logä¸­çš„æ“ä½œæ—¶ï¼Œæ­¤çº¿ç¨‹ä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„bin-logåŠ é”ï¼Œå½“è¯»å–å®Œæˆï¼Œç”šè‡³åœ¨å‘åŠ¨ç»™ä»èŠ‚ç‚¹ä¹‹å‰ï¼Œé”ä¼šè¢«é‡Šæ”¾ã€‚</p>
<ul>
<li><strong>ä»èŠ‚ç‚¹I/Oçº¿ç¨‹ä½œç”¨</strong></li>
</ul>
<p>å½“ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ<code>start slave</code>å‘½ä»¤ä¹‹åï¼Œä»èŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªI/Oçº¿ç¨‹ç”¨æ¥è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯·æ±‚ä¸»åº“ä¸­æ›´æ–°çš„bin-logã€‚I/Oçº¿ç¨‹æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹binlog dump è¿›ç¨‹å‘æ¥çš„æ›´æ–°ä¹‹åï¼Œä¿å­˜åœ¨æœ¬åœ°relay-logä¸­ã€‚</p>
<ul>
<li><strong>ä»èŠ‚ç‚¹SQLçº¿ç¨‹ä½œç”¨</strong></li>
</ul>
<p>SQLçº¿ç¨‹è´Ÿè´£è¯»å–relay logä¸­çš„å†…å®¹ï¼Œè§£ææˆå…·ä½“çš„æ“ä½œå¹¶æ‰§è¡Œï¼Œæœ€ç»ˆä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>å¯¹äºæ¯ä¸€ä¸ªä¸»ä»è¿æ¥ï¼Œéƒ½éœ€è¦ä¸‰ä¸ªè¿›ç¨‹æ¥å®Œæˆã€‚å½“ä¸»èŠ‚ç‚¹æœ‰å¤šä¸ªä»èŠ‚ç‚¹æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šä¸ºæ¯ä¸€ä¸ªå½“å‰è¿æ¥çš„ä»èŠ‚ç‚¹å»ºä¸€ä¸ªbinary log dump è¿›ç¨‹ï¼Œè€Œæ¯ä¸ªä»èŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„I/Oè¿›ç¨‹ï¼ŒSQLè¿›ç¨‹ã€‚ä»èŠ‚ç‚¹ç”¨ä¸¤ä¸ªçº¿ç¨‹å°†ä»ä¸»åº“æ‹‰å–æ›´æ–°å’Œæ‰§è¡Œåˆ†æˆç‹¬ç«‹çš„ä»»åŠ¡ï¼Œè¿™æ ·åœ¨æ‰§è¡ŒåŒæ­¥æ•°æ®ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸ä¼šé™ä½è¯»æ“ä½œçš„æ€§èƒ½ã€‚æ¯”å¦‚ï¼Œå¦‚æœä»èŠ‚ç‚¹æ²¡æœ‰è¿è¡Œï¼Œæ­¤æ—¶I/Oè¿›ç¨‹å¯ä»¥å¾ˆå¿«ä»ä¸»èŠ‚ç‚¹è·å–æ›´æ–°ï¼Œå°½ç®¡SQLè¿›ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œã€‚å¦‚æœåœ¨SQLè¿›ç¨‹æ‰§è¡Œä¹‹å‰ä»èŠ‚ç‚¹æœåŠ¡åœæ­¢ï¼Œè‡³å°‘I/Oè¿›ç¨‹å·²ç»ä»ä¸»èŠ‚ç‚¹æ‹‰å–åˆ°äº†æœ€æ–°çš„å˜æ›´å¹¶ä¸”ä¿å­˜åœ¨æœ¬åœ°relayæ—¥å¿—ä¸­ï¼Œå½“æœåŠ¡å†æ¬¡èµ·æ¥ä¹‹åï¼Œå°±å¯ä»¥å®Œæˆæ•°æ®çš„åŒæ­¥ã€‚</p>
<h2 id="MySQLä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹">MySQLä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹</h2>
<p>è¦å®æ–½å¤åˆ¶ï¼Œé¦–å…ˆå¿…é¡»æ‰“å¼€Master ç«¯çš„binary logï¼ˆbin-logï¼‰åŠŸèƒ½ï¼Œå¦åˆ™æ— æ³•å®ç°ã€‚å› ä¸ºæ•´ä¸ªå¤åˆ¶è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯Slave ä»Master ç«¯è·å–è¯¥æ—¥å¿—ç„¶åå†åœ¨è‡ªå·±èº«ä¸Šå®Œå…¨é¡ºåºçš„æ‰§è¡Œæ—¥å¿—ä¸­æ‰€è®°å½•çš„å„ç§æ“ä½œ</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317111427.png" alt="image-20210317111427620"></p>
<ol>
<li>ä»åº“é€šè¿‡æ‰‹å·¥æ‰§è¡Œchange  master to è¯­å¥è¿æ¥ä¸»åº“ï¼Œæä¾›äº†è¿æ¥çš„ç”¨æˆ·ä¸€åˆ‡æ¡ä»¶ï¼ˆuser ã€passwordã€portã€ipï¼‰ï¼Œ<strong>ä»åº“å¹¶è¯·æ±‚ä»æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æŒ‡å®šä½ç½®ï¼ˆæˆ–è€…ä»æœ€å¼€å§‹çš„æ—¥å¿—ï¼‰ä¹‹åçš„æ—¥å¿—å†…å®¹ï¼›</strong></li>
<li>ä»åº“çš„IOçº¿ç¨‹å’Œä¸»åº“çš„dumpçº¿ç¨‹å»ºç«‹è¿æ¥ã€‚</li>
<li>ä»åº“æ ¹æ®change  master  to è¯­å¥æä¾›çš„fileåå’Œpositionå·ï¼ŒIOçº¿ç¨‹å‘ä¸»åº“å‘èµ·binlogçš„è¯·æ±‚ã€‚</li>
<li>ä¸»åº“dumpçº¿ç¨‹æ ¹æ®ä»åº“çš„è¯·æ±‚ï¼Œå°†æœ¬åœ°binlogä»¥eventsçš„æ–¹å¼å‘ç»™ä»åº“IOçº¿ç¨‹ã€‚è¿”å›ä¿¡æ¯ä¸­é™¤äº†æ—¥å¿—æ‰€åŒ…å«çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬æœ¬æ¬¡è¿”å›çš„ä¿¡æ¯çš„bin-log file çš„ä»¥åŠbin-log positionï¼›</li>
<li>ä»åº“IOçº¿ç¨‹æ¥æ”¶binlog  eventsï¼Œå¹¶å­˜æ”¾åˆ°æœ¬åœ°relay-logä¸­ï¼Œä¼ é€è¿‡æ¥çš„ä¿¡æ¯ï¼Œä¼šè®°å½•åˆ°master.infoä¸­ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è¯»å–çš„æ—¶å€™èƒ½å¤Ÿæ¸…æ¥šçš„å‘Šè¯‰Masterâ€œæˆ‘éœ€è¦ä»æŸä¸ªbin-log çš„å“ªä¸ªä½ç½®å¼€å§‹å¾€åçš„æ—¥å¿—å†…å®¹ï¼Œè¯·å‘ç»™æˆ‘â€ï¼›</li>
<li>ä»åº“SQLçº¿ç¨‹åº”ç”¨relay-logï¼Œå¹¶ä¸”æŠŠåº”ç”¨è¿‡çš„è®°å½•åˆ°relay-log.infoä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»åº”ç”¨è¿‡çš„relay ä¼šè‡ªåŠ¨è¢«æ¸…ç†purge</li>
</ol>
<h2 id="MySQL-ä¸»ä»å¤åˆ¶æ¨¡å¼">MySQL ä¸»ä»å¤åˆ¶æ¨¡å¼</h2>
<p>MySQL ä¸»ä»å¤åˆ¶<strong>é»˜è®¤æ˜¯å¼‚æ­¥çš„æ¨¡å¼</strong>ã€‚MySQLå¢åˆ æ”¹æ“ä½œä¼šå…¨éƒ¨è®°å½•åœ¨binary logä¸­ï¼Œå½“slaveèŠ‚ç‚¹è¿æ¥masteræ—¶ï¼Œä¼šä¸»åŠ¨ä»masterå¤„è·å–æœ€æ–°çš„bin logæ–‡ä»¶ã€‚å¹¶æŠŠbin logä¸­çš„sql relayã€‚</p>
<h3 id="å¼‚æ­¥æ¨¡å¼ï¼ˆmysql-async-modeï¼‰">å¼‚æ­¥æ¨¡å¼ï¼ˆmysql async-modeï¼‰</h3>
<p>å¼‚æ­¥æ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸»èŠ‚ç‚¹ä¸ä¼šä¸»åŠ¨push bin logåˆ°ä»èŠ‚ç‚¹ï¼Œè¿™æ ·æœ‰å¯èƒ½å¯¼è‡´failoverçš„æƒ…å†µä¸‹ï¼Œä¹Ÿè®¸ä»èŠ‚ç‚¹æ²¡æœ‰å³æ—¶åœ°å°†æœ€æ–°çš„bin logåŒæ­¥åˆ°æœ¬åœ°ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317114402.png" alt="image-20210317114402919"></p>
<h3 id="åŠåŒæ­¥æ¨¡å¼-mysql-semi-sync">åŠåŒæ­¥æ¨¡å¼(mysql semi-sync)</h3>
<p>è¿™ç§æ¨¡å¼ä¸‹<strong>ä¸»èŠ‚ç‚¹åªéœ€è¦æ¥æ”¶åˆ°å…¶ä¸­ä¸€å°ä»èŠ‚ç‚¹çš„è¿”å›ä¿¡æ¯ï¼Œå°±ä¼šcommitï¼›å¦åˆ™éœ€è¦ç­‰å¾…ç›´åˆ°è¶…æ—¶æ—¶é—´ç„¶ååˆ‡æ¢æˆå¼‚æ­¥æ¨¡å¼å†æäº¤</strong>ï¼›è¿™æ ·åšçš„ç›®çš„å¯ä»¥ä½¿ä¸»ä»æ•°æ®åº“çš„æ•°æ®å»¶è¿Ÿç¼©å°ï¼Œå¯ä»¥æé«˜æ•°æ®å®‰å…¨æ€§ï¼Œç¡®ä¿äº†äº‹åŠ¡æäº¤åï¼Œ<strong>binlogè‡³å°‘ä¼ è¾“åˆ°äº†ä¸€ä¸ªä»èŠ‚ç‚¹ä¸Šï¼Œä¸èƒ½ä¿è¯ä»èŠ‚ç‚¹å°†æ­¤äº‹åŠ¡æ›´æ–°åˆ°dbä¸­</strong>ã€‚æ€§èƒ½ä¸Šä¼šæœ‰ä¸€å®šçš„é™ä½ï¼Œå“åº”æ—¶é—´ä¼šå˜é•¿ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317114614.png" alt="image-20210317114614139"></p>
<h3 id="å…¨åŒæ­¥æ¨¡å¼">å…¨åŒæ­¥æ¨¡å¼</h3>
<p>å…¨åŒæ­¥æ¨¡å¼æ˜¯æŒ‡ä¸»èŠ‚ç‚¹å’Œ<strong>ä»èŠ‚ç‚¹å…¨éƒ¨æ‰§è¡Œäº†commitå¹¶ç¡®è®¤</strong>æ‰ä¼šå‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸã€‚</p>
<h2 id="MySQLçš„å¤åˆ¶æœºåˆ¶">MySQLçš„å¤åˆ¶æœºåˆ¶</h2>
<h3 id="binlogè®°å½•æ¨¡å¼">binlogè®°å½•æ¨¡å¼</h3>
<p>MySQL ä¸»ä»å¤åˆ¶æœ‰ä¸‰ç§æ–¹å¼ï¼šåŸºäºSQLè¯­å¥çš„å¤åˆ¶ï¼ˆstatement-based replicationï¼ŒSBRï¼‰ï¼ŒåŸºäºè¡Œçš„å¤åˆ¶ï¼ˆrow-based replicationï¼ŒRBR)ï¼Œæ··åˆæ¨¡å¼å¤åˆ¶ï¼ˆmixed-based replication,MBR)ã€‚å¯¹åº”çš„binlogæ–‡ä»¶çš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§ï¼šSTATEMENT,ROW,MIXEDã€‚</p>
<ol>
<li>Statement-base Replication (SBR)å°±æ˜¯è®°å½•sqlè¯­å¥åœ¨bin logä¸­ï¼ŒMysql 5.1.4 åŠä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§å¤åˆ¶æ ¼å¼ã€‚ä¼˜ç‚¹æ˜¯åªéœ€è¦è®°å½•ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥åˆ°binlogä¸­ï¼Œå‡å°‘äº†binlogæ—¥è´¨é‡ï¼ŒèŠ‚çº¦I/Oï¼Œæé«˜æ€§èƒ½ã€‚ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä¸»ä»èŠ‚ç‚¹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼ˆæ¯”å¦‚sleep(),now()ç­‰ï¼‰ã€‚</li>
<li>Row-based Relication(RBR)æ˜¯mysql masterå°†SQLè¯­å¥åˆ†è§£ä¸ºåŸºäºRowæ›´æ”¹çš„è¯­å¥å¹¶è®°å½•åœ¨bin logä¸­ï¼Œä¹Ÿå°±æ˜¯åªè®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·ã€‚ä¼˜ç‚¹æ˜¯ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–è€…å‡½æ•°ã€æˆ–è€…triggerçš„è°ƒç”¨æˆ–è€…è§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯ä¿®æ”¹tableçš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´å¢,åŒæ—¶å¢åŠ bin logåŒæ­¥æ—¶é—´ã€‚ä¹Ÿä¸èƒ½é€šè¿‡bin logè§£æè·å–æ‰§è¡Œè¿‡çš„sqlè¯­å¥ï¼Œåªèƒ½çœ‹åˆ°å‘ç”Ÿçš„dataå˜æ›´ã€‚</li>
<li>Mixed-format Replication(MBR)ï¼ŒMySQL NDB cluster 7.3 å’Œ7.4 ä½¿ç”¨çš„MBRã€‚æ˜¯ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆï¼Œå¯¹äºä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨STATEMENTæ¨¡å¼ä¿å­˜åˆ°binlogï¼Œå¯¹äºSTATEMENTæ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œåˆ™ä½¿ç”¨ROWæ¨¡å¼æ¥ä¿å­˜ï¼ŒMySQLä¼šæ ¹æ®æ‰§è¡Œçš„SQLè¯­å¥é€‰æ‹©æ—¥å¿—ä¿å­˜æ–¹å¼ã€‚</li>
</ol>
<h3 id="GTIDå¤åˆ¶æ¨¡å¼">GTIDå¤åˆ¶æ¨¡å¼</h3>
<p>åœ¨MySQL 5.6é‡Œé¢ï¼Œä¸ç”¨å†æ‰¾binlogå’Œposç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ä¸»èŠ‚ç‚¹çš„ipï¼Œç«¯å£ï¼Œä»¥åŠè´¦å·å¯†ç å°±è¡Œï¼Œå› ä¸ºå¤åˆ¶æ˜¯è‡ªåŠ¨çš„ï¼Œ<strong>MySQLä¼šé€šè¿‡å†…éƒ¨æœºåˆ¶GTIDè‡ªåŠ¨æ‰¾ç‚¹åŒæ­¥ã€‚</strong></p>
<h4 id="åŸºäºGTIDå¤åˆ¶å®ç°çš„å·¥ä½œåŸç†">åŸºäºGTIDå¤åˆ¶å®ç°çš„å·¥ä½œåŸç†</h4>
<ol>
<li>ä¸»èŠ‚ç‚¹æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šåœ¨äº‹åŠ¡å‰äº§ç”ŸGTIDï¼Œä¸€èµ·è®°å½•åˆ°binlogæ—¥å¿—ä¸­ã€‚</li>
<li>ä»èŠ‚ç‚¹çš„I/Oçº¿ç¨‹å°†å˜æ›´çš„bin logï¼Œå†™å…¥åˆ°æœ¬åœ°çš„relay logä¸­ã€‚</li>
<li>SQLçº¿ç¨‹ä»relay logä¸­è·å–GTIDï¼Œç„¶åå¯¹æ¯”æœ¬åœ°binlogæ˜¯å¦æœ‰è®°å½•ï¼ˆ<strong>æ‰€ä»¥MySQLä»èŠ‚ç‚¹å¿…é¡»è¦å¼€å¯binary log</strong>ï¼‰ã€‚</li>
<li>å¦‚æœæœ‰è®°å½•ï¼Œè¯´æ˜è¯¥GTIDçš„äº‹åŠ¡å·²ç»æ‰§è¡Œï¼Œä»èŠ‚ç‚¹ä¼šå¿½ç•¥ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è®°å½•ï¼Œä»èŠ‚ç‚¹å°±ä¼šä»relay logä¸­æ‰§è¡Œè¯¥GTIDçš„äº‹åŠ¡ï¼Œå¹¶è®°å½•åˆ°bin logã€‚</li>
<li>åœ¨è§£æè¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸»é”®ï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨äºŒçº§ç´¢å¼•ï¼Œå¦‚æœæœ‰å°±ç”¨å…¨éƒ¨æ‰«æã€‚</li>
</ol>
<h2 id="mysqlä¸»ä»åŒæ­¥å»¶æ—¶åˆ†æ">mysqlä¸»ä»åŒæ­¥å»¶æ—¶åˆ†æ</h2>
<p>mysqlçš„ä¸»ä»å¤åˆ¶éƒ½æ˜¯å•çº¿ç¨‹çš„æ“ä½œï¼Œä¸»åº“å¯¹æ‰€æœ‰DDLå’ŒDMLäº§ç”Ÿçš„æ—¥å¿—å†™è¿›binlogï¼Œç”±äºbinlogæ˜¯é¡ºåºå†™ï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆé«˜ï¼Œslaveçš„sql threadçº¿ç¨‹å°†ä¸»åº“çš„DDLå’ŒDMLæ“ä½œäº‹ä»¶åœ¨slaveä¸­é‡æ”¾ã€‚DMLå’ŒDDLçš„IOæ“ä½œæ˜¯éšæœºçš„ï¼Œä¸æ˜¯é¡ºåºï¼Œæ‰€ä»¥æˆæœ¬è¦é«˜å¾ˆå¤šï¼Œå¦ä¸€æ–¹é¢ï¼Œç”±äºsql threadä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œ<strong>å½“ä¸»åº“çš„å¹¶å‘è¾ƒé«˜æ—¶ï¼Œäº§ç”Ÿçš„DMLæ•°é‡è¶…è¿‡slaveçš„SQL threadæ‰€èƒ½å¤„ç†çš„é€Ÿåº¦ï¼Œæˆ–è€…å½“slaveä¸­æœ‰å¤§å‹queryè¯­å¥äº§ç”Ÿäº†é”ç­‰å¾…ï¼Œé‚£ä¹ˆå»¶æ—¶å°±äº§ç”Ÿäº†ã€‚</strong></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>ä¸šåŠ¡çš„æŒä¹…åŒ–å±‚çš„å®ç°é‡‡ç”¨åˆ†åº“æ¶æ„ï¼ŒmysqlæœåŠ¡å¯å¹³è¡Œæ‰©å±•ï¼Œåˆ†æ•£å‹åŠ›ã€‚</li>
<li>å•ä¸ªåº“è¯»å†™åˆ†ç¦»ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»å†™ä»è¯»ï¼Œåˆ†æ•£å‹åŠ›ã€‚è¿™æ ·ä»åº“å‹åŠ›æ¯”ä¸»åº“é«˜ï¼Œä¿æŠ¤ä¸»åº“</li>
<li>æœåŠ¡çš„åŸºç¡€æ¶æ„åœ¨ä¸šåŠ¡å’Œmysqlä¹‹é—´åŠ å…¥memcacheæˆ–è€…redisçš„cacheå±‚ã€‚é™ä½mysqlçš„è¯»å‹åŠ›ã€‚</li>
<li>ä¸åŒä¸šåŠ¡çš„mysqlç‰©ç†ä¸Šæ”¾åœ¨ä¸åŒæœºå™¨ï¼Œåˆ†æ•£å‹åŠ›ã€‚</li>
<li>ä½¿ç”¨æ¯”ä¸»åº“æ›´å¥½çš„ç¡¬ä»¶è®¾å¤‡ä½œä¸ºslaveï¼Œmysqlå‹åŠ›å°ï¼Œå»¶è¿Ÿè‡ªç„¶ä¼šå˜å°ã€‚</li>
<li>ä½¿ç”¨æ›´åŠ å¼ºåŠ²çš„ç¡¬ä»¶è®¾å¤‡</li>
</ol>
<p><strong>mysql5.7ä¹‹åä½¿ç”¨MTSå¹¶è¡Œå¤åˆ¶æŠ€æœ¯</strong></p>
<h3 id="å¤šçº¿ç¨‹å¤åˆ¶MTS">å¤šçº¿ç¨‹å¤åˆ¶MTS</h3>
<p>åœ¨MYSQL5.6ç‰ˆæœ¬ä¸­ï¼Œå¤šçº¿ç¨‹å¤åˆ¶åŸºäºschemaæ¥å®ç°ï¼Œå°†å¤šä¸ªæ•°æ®åº“ä¸‹çš„äº‹åŠ¡æŒ‰ç…§æ•°æ®åº“æ‹†åˆ†åˆ°å¤šä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œä¿è¯æ•°æ®åº“çº§åˆ«çš„äº‹åŠ¡ä¸€è‡´æ€§ã€‚</p>
<p>åœ¨MYSQL5.7ç‰ˆæœ¬åï¼Œå¤šçº¿ç¨‹å¤åˆ¶åŸºäºä¸»åº“ä¸Šå¹¶å‘ä¿¡æ¯æ¥å®ç°ï¼Œä¸»åº“ä¸Šå¹¶å‘æäº¤çš„äº‹åŠ¡ä¸å­˜åœ¨äº‹åŠ¡å†²çªï¼Œåœ¨ä»åº“ä¸Šæ‹†åˆ†åˆ°å¤šä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä¿è¯å®ä¾‹çº§åˆ«çš„äº‹åŠ¡ä¸€è‡´æ€§ã€‚</p>
<h4 id="MySQL5-6-åŸºäºschemaçš„å¹¶è¡Œå¤åˆ¶">MySQL5.6 åŸºäºschemaçš„å¹¶è¡Œå¤åˆ¶</h4>
<p>slave-parallel-type=DATABASE(ä¸åŒåº“çš„äº‹åŠ¡ï¼Œæ²¡æœ‰é”å†²çª),å¹¶è¡Œå¤åˆ¶çš„ç›®çš„å°±æ˜¯è¦è®©slaveå°½å¯èƒ½çš„å¤šçº¿ç¨‹è·‘èµ·æ¥ï¼Œå½“ç„¶åŸºäºåº“çº§åˆ«çš„å¤šçº¿ç¨‹ä¹Ÿæ˜¯ä¸€ç§æ–¹å¼(ä¸åŒåº“çš„äº‹åŠ¡ï¼Œæ²¡æœ‰é”å†²çª)ã€‚</p>
<p>**ä¼˜ç‚¹ï¼š**å®ç°ç›¸å¯¹æ¥è¯´ç®€å•ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä½¿ç”¨èµ·æ¥ä¹Ÿç®€å•</p>
<p><strong>ç¼ºç‚¹ï¼š</strong> ç”±äºæ˜¯åŸºäºåº“çš„ï¼Œé‚£ä¹ˆå¹¶è¡Œçš„ç²’åº¦éå¸¸ç²—ï¼Œç°åœ¨å¾ˆå¤šå…¬å¸çš„æ¶æ„æ˜¯ä¸€åº“ä¸€å®ä¾‹ï¼Œé’ˆå¯¹è¿™æ ·çš„æ¶æ„ï¼Œ5.6çš„å¹¶è¡Œå¤åˆ¶æ— èƒ½ä¸ºåŠ›ã€‚å½“ç„¶è¿˜æœ‰å°±æ˜¯ä¸»ä»äº‹åŠ¡çš„å…ˆåé¡ºåºï¼Œå¯¹äº5.6ä¹Ÿæ˜¯ä¸ªå¤§é—®é¢˜</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317143020.png" alt="image-20210317143020298"></p>
<p>MySQL 5.6ç‰ˆæœ¬å¼€å¯å¹¶è¡Œå¤åˆ¶åŠŸèƒ½ï¼Œé‚£ä¹ˆSQLçº¿ç¨‹å°±å˜ä¸ºäº†coordinatorçº¿ç¨‹ï¼Œcoordinatorçº¿ç¨‹ä¸»è¦è´Ÿè´£ä»¥å‰ä¸¤éƒ¨åˆ†çš„å†…å®¹ï¼š</p>
<ul>
<li>è‹¥åˆ¤æ–­å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆé€‰æ‹©workerçº¿ç¨‹æ‰§è¡Œäº‹åŠ¡çš„äºŒè¿›åˆ¶æ—¥å¿—</li>
<li>è‹¥åˆ¤æ–­ä¸å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå¦‚è¯¥æ“ä½œæ˜¯DDLï¼Œäº¦æˆ–è€…æ˜¯äº‹åŠ¡è·¨schemaæ“ä½œï¼Œåˆ™ç­‰å¾…æ‰€æœ‰çš„workerçº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†æ‰§è¡Œå½“å‰çš„æ—¥å¿—</li>
</ul>
<p>è¿™æ„å‘³ç€coordinatorçº¿ç¨‹å¹¶ä¸æ˜¯ä»…å°†æ—¥å¿—å‘é€ç»™workerçº¿ç¨‹ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥å›æ”¾æ—¥å¿—ï¼Œä½†æ˜¯æ‰€æœ‰å¯ä»¥å¹¶è¡Œçš„æ“ä½œäº¤ä»˜ç”±workerçº¿ç¨‹å®Œæˆã€‚coordinatorçº¿ç¨‹ä¸workeræ˜¯å…¸å‹çš„ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p>
<p>ä¸Šè¿°æœºåˆ¶å®ç°äº†åŸºäºschemaçš„å¹¶è¡Œå¤åˆ¶å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæ˜¯crash safeåŠŸèƒ½ä¸å¥½åšï¼Œå› ä¸ºå¯èƒ½ä¹‹åæ‰§è¡Œçš„äº‹åŠ¡ç”±äºå¹¶è¡Œå¤åˆ¶çš„å…³ç³»å…ˆå®Œæˆæ‰§è¡Œï¼Œé‚£ä¹ˆå½“å‘ç”Ÿcrashçš„æ—¶å€™ï¼Œè¿™éƒ¨åˆ†çš„å¤„ç†é€»è¾‘æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚ä»ä»£ç ä¸Šçœ‹ï¼Œ5.6è¿™é‡Œå¼•å…¥äº†Low-Water-Markæ ‡è®°æ¥è§£å†³è¯¥é—®é¢˜ï¼Œä»è®¾è®¡ä¸Šçœ‹ï¼ˆWL#5569ï¼‰ï¼Œå…¶æ˜¯å¸Œæœ›å€ŸåŠ©äºæ—¥å¿—çš„å¹‚ç­‰æ€§æ¥è§£å†³è¯¥é—®é¢˜ï¼Œä¸è¿‡5.6çš„äºŒè¿›åˆ¶æ—¥å¿—å›æ”¾è¿˜ä¸èƒ½å®ç°å¹‚ç­‰æ€§ã€‚å¦ä¸€ä¸ªæœ€ä¸ºå…³é”®çš„é—®é¢˜æ˜¯è¿™æ ·è®¾è®¡çš„å¹¶è¡Œå¤åˆ¶æ•ˆæœå¹¶ä¸é«˜ï¼Œå¦‚æœç”¨æˆ·å®ä¾‹ä»…æœ‰ä¸€ä¸ªåº“ï¼Œé‚£ä¹ˆå°±æ— æ³•å®ç°å¹¶è¡Œå›æ”¾ï¼Œç”šè‡³æ€§èƒ½ä¼šæ¯”åŸæ¥çš„å•çº¿ç¨‹æ›´å·®ã€‚è€Œå•åº“å¤šè¡¨æ˜¯æ¯”å¤šåº“å¤šè¡¨æ›´ä¸ºå¸¸è§çš„ä¸€ç§æƒ…å½¢ã€‚</p>
<h4 id="MySQL-5-7åŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶">MySQL 5.7åŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶</h4>
<p>MySQL 5.7æ‰å¯ç§°ä¸ºçœŸæ­£çš„å¹¶è¡Œå¤åˆ¶ï¼Œè¿™å…¶ä¸­æœ€ä¸ºä¸»è¦çš„åŸå› å°±æ˜¯slaveæœåŠ¡å™¨çš„å›æ”¾ä¸ä¸»æœºæ˜¯ä¸€è‡´çš„å³masteræœåŠ¡å™¨ä¸Šæ˜¯æ€ä¹ˆå¹¶è¡Œæ‰§è¡Œçš„slaveä¸Šå°±æ€æ ·è¿›è¡Œå¹¶è¡Œå›æ”¾ã€‚ä¸å†æœ‰åº“çš„å¹¶è¡Œå¤åˆ¶é™åˆ¶ï¼Œå¯¹äºäºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä¹Ÿæ— ç‰¹æ®Šçš„è¦æ±‚ï¼ˆåŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶ä¹Ÿæ²¡æœ‰è¦æ±‚ï¼‰ã€‚ä»MySQLå®˜æ–¹æ¥çœ‹ï¼Œå…¶å¹¶è¡Œå¤åˆ¶çš„åŸæœ¬è®¡åˆ’æ˜¯æ”¯æŒè¡¨çº§çš„å¹¶è¡Œå¤åˆ¶å’Œè¡Œçº§çš„å¹¶è¡Œå¤åˆ¶ï¼Œè¡Œçº§çš„å¹¶è¡Œå¤åˆ¶é€šè¿‡è§£æROWæ ¼å¼çš„äºŒè¿›åˆ¶æ—¥å¿—çš„æ–¹å¼æ¥å®Œæˆï¼ŒWL#4648ã€‚ä½†æ˜¯æœ€ç»ˆå‡ºç°ç»™å°ä¼™ä¼´çš„ç¡®æ˜¯åœ¨å¼€å‘è®¡åˆ’ä¸­ç§°ä¸ºï¼šMTS: Prepared transactions slave parallel applierï¼Œå¯è§ï¼šWL#6314ã€‚è¯¥å¹¶è¡Œå¤åˆ¶çš„æ€æƒ³æœ€æ—©æ˜¯ç”±MariaDBçš„Kristainæå‡ºï¼Œå¹¶å·²åœ¨MariaDB 10ä¸­å‡ºç°ï¼Œç›¸ä¿¡å¾ˆå¤šé€‰æ‹©MariaDBçš„å°ä¼™ä¼´æœ€ä¸ºçœ‹é‡çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¹¶è¡Œå¤åˆ¶ã€‚</p>
<blockquote>
<p>MySQL 5.7å¹¶è¡Œå¤åˆ¶çš„æ€æƒ³ç®€å•æ˜“æ‡‚ï¼Œä¸€è¨€ä»¥è”½ä¹‹ï¼š<font color=red>ä¸€ä¸ªç»„æäº¤çš„äº‹åŠ¡éƒ½æ˜¯å¯ä»¥å¹¶è¡Œå›æ”¾ï¼Œå› ä¸ºè¿™äº›äº‹åŠ¡éƒ½å·²è¿›å…¥åˆ°äº‹åŠ¡çš„prepareé˜¶æ®µï¼Œåˆ™è¯´æ˜äº‹åŠ¡ä¹‹é—´æ²¡æœ‰ä»»ä½•å†²çªï¼ˆå¦åˆ™å°±ä¸å¯èƒ½æäº¤ï¼‰ã€‚</font></p>
</blockquote>
<p>ä¸ºäº†å…¼å®¹MySQL 5.6åŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶ï¼Œ5.7å¼•å…¥äº†æ–°çš„å˜é‡slave-parallel-typeï¼Œå…¶å¯ä»¥é…ç½®çš„å€¼æœ‰ï¼š</p>
<ul>
<li>DATABASEï¼šé»˜è®¤å€¼ï¼ŒåŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶æ–¹å¼</li>
<li>LOGICAL_CLOCKï¼šåŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶æ–¹å¼</li>
</ul>
<h5 id="æ”¯æŒå¹¶è¡Œå¤åˆ¶çš„GTIDï¼ˆ5-7ä¹‹åæ”¯æŒï¼‰">æ”¯æŒå¹¶è¡Œå¤åˆ¶çš„GTIDï¼ˆ5.7ä¹‹åæ”¯æŒï¼‰</h5>
<p>åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­ï¼Œå…¶è®¾è®¡æ–¹å¼æ˜¯å°†ç»„æäº¤çš„ä¿¡æ¯å­˜æ”¾åœ¨GTIDä¸­ã€‚é‚£ä¹ˆå¦‚æœç”¨æˆ·æ²¡æœ‰å¼€å¯GTIDåŠŸèƒ½ï¼Œå³å°†å‚æ•°gtid_modeè®¾ç½®ä¸ºOFFï¼ŒMySQL 5.7åˆå¼•å…¥äº†ç§°ä¹‹ä¸ºAnonymous_Gtidçš„äºŒè¿›åˆ¶æ—¥å¿—eventç±»å‹ï¼Œæ„å‘³ç€åœ¨<strong>MySQL 5.7ç‰ˆæœ¬ä¸­å³ä½¿ä¸å¼€å¯GTIDï¼Œæ¯ä¸ªäº‹åŠ¡å¼€å§‹å‰ä¹Ÿæ˜¯ä¼šå­˜åœ¨ä¸€ä¸ªAnonymous_Gtidï¼Œè€Œè¿™GTIDä¸­å°±å­˜åœ¨ç€ç»„æäº¤çš„ä¿¡æ¯ã€‚</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317143937.png" alt="image-20210317143937183"></p>
<p>ç„¶è€Œï¼Œé€šè¿‡ä¸Šè¿°çš„SHOW BINLOG EVENTSï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç°æœ‰å…³ç»„æäº¤çš„ä»»ä½•ä¿¡æ¯ã€‚ä½†æ˜¯é€šè¿‡mysqlbinlogå·¥å…·ï¼Œç”¨æˆ·å°±èƒ½å‘ç°ç»„æäº¤çš„å†…éƒ¨ä¿¡æ¯ï¼š</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210317144000.png" alt="image-20210317143959999"></p>
<p>å¯ä»¥å‘ç°è¾ƒä¹‹åŸæ¥çš„äºŒè¿›åˆ¶æ—¥å¿—å†…å®¹å¤šäº†last_committedå’Œsequence_numberï¼Œlast_committedè¡¨ç¤ºäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¸Šæ¬¡äº‹åŠ¡æäº¤çš„ç¼–å·ï¼Œå¦‚æœ<strong>äº‹åŠ¡å…·æœ‰ç›¸åŒçš„last_committedï¼Œè¡¨ç¤ºè¿™äº›äº‹åŠ¡éƒ½åœ¨ä¸€ç»„å†…ï¼Œå¯ä»¥è¿›è¡Œå¹¶è¡Œçš„å›æ”¾ã€‚ä¾‹å¦‚ä¸Šè¿°last_committedä¸º0çš„äº‹åŠ¡æœ‰6ä¸ªï¼Œè¡¨ç¤ºç»„æäº¤æ—¶æäº¤äº†6ä¸ªäº‹åŠ¡ï¼Œè€Œè¿™6ä¸ªäº‹åŠ¡åœ¨ä»æœºæ˜¯å¯ä»¥è¿›è¡Œå¹¶è¡Œå›æ”¾çš„ã€‚</strong></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹å¸¸è§çš„åŒæ­¥æœºåˆ¶</title>
    <url>/posts/e8a097d2/</url>
    <content><![CDATA[<h3 id="ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰">ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰</h3>
<h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4>
<p>â€‹	ReentrantLocké‡å…¥é”ï¼Œæ˜¯å®ç°Lockæ¥å£çš„ä¸€ä¸ªç±»ï¼Œä¹Ÿæ˜¯åœ¨å®é™…ç¼–ç¨‹ä¸­ä½¿ç”¨é¢‘ç‡å¾ˆé«˜çš„ä¸€ä¸ªé”ï¼Œ<strong>æ”¯æŒé‡å…¥æ€§ï¼Œè¡¨ç¤ºèƒ½å¤Ÿå¯¹å…±äº«èµ„æºèƒ½å¤Ÿé‡å¤åŠ é”ï¼Œå³å½“å‰çº¿ç¨‹è·å–è¯¥é”å†æ¬¡è·å–ä¸ä¼šè¢«é˜»å¡</strong>ã€‚åœ¨javaå…³é”®å­—synchronizedéšå¼æ”¯æŒé‡å…¥æ€§ï¼Œsynchronizedé€šè¿‡è·å–è‡ªå¢ï¼Œé‡Šæ”¾è‡ªå‡çš„æ–¹å¼å®ç°é‡å…¥ã€‚ä¸æ­¤åŒæ—¶ï¼ŒReentrantLockè¿˜æ”¯æŒ<strong>å…¬å¹³é”å’Œéå…¬å¹³é”</strong>ä¸¤ç§æ–¹å¼ã€‚é‚£ä¹ˆï¼Œè¦æƒ³å®Œå®Œå…¨å…¨çš„å¼„æ‡‚ReentrantLockçš„è¯ï¼Œä¸»è¦ä¹Ÿå°±æ˜¯ReentrantLockåŒæ­¥è¯­ä¹‰çš„å­¦ä¹ ï¼š<strong>1. é‡å…¥æ€§çš„å®ç°åŸç†ï¼›2. å…¬å¹³é”å’Œéå…¬å¹³é”</strong></p>
<h4 id="ç®€ä»‹">ç®€ä»‹</h4>
<p>ReentrantLockå¸¸å¸¸å¯¹æ¯”ç€synchronizedæ¥åˆ†æ</p>
<p>ReentrantLockå¸¸å¸¸å¯¹æ¯”ç€synchronizedæ¥åˆ†æï¼Œæˆ‘ä»¬å…ˆå¯¹æ¯”ç€æ¥çœ‹ç„¶åå†ä¸€ç‚¹ä¸€ç‚¹åˆ†æã€‚</p>
<p>ï¼ˆ1ï¼‰synchronizedæ˜¯ç‹¬å é”ï¼ŒåŠ é”å’Œè§£é”çš„è¿‡ç¨‹è‡ªåŠ¨è¿›è¡Œï¼Œæ˜“äºæ“ä½œï¼Œä½†ä¸å¤Ÿçµæ´»ã€‚ReentrantLockä¹Ÿæ˜¯ç‹¬å é”ï¼ŒåŠ é”å’Œè§£é”çš„è¿‡ç¨‹éœ€è¦æ‰‹åŠ¨è¿›è¡Œï¼Œä¸æ˜“æ“ä½œï¼Œä½†éå¸¸çµæ´»ã€‚</p>
<p>ï¼ˆ2ï¼‰synchronizedå¯é‡å…¥ï¼Œå› ä¸ºåŠ é”å’Œè§£é”è‡ªåŠ¨è¿›è¡Œï¼Œä¸å¿…æ‹…å¿ƒæœ€åæ˜¯å¦é‡Šæ”¾é”ï¼›ReentrantLockä¹Ÿå¯é‡å…¥ï¼Œä½†åŠ é”å’Œè§£é”éœ€è¦æ‰‹åŠ¨è¿›è¡Œï¼Œä¸”æ¬¡æ•°éœ€ä¸€æ ·ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”ã€‚ï¼ˆ<strong>ReentrantLockç­‰lockæ–¹æ³•ä¸€å®šè¦åœ¨finallyè¿›è¡Œunlock</strong>ï¼‰</p>
<p>ï¼ˆ3ï¼‰synchronizedä¸å¯å“åº”ä¸­æ–­ï¼Œä¸€ä¸ªçº¿ç¨‹è·å–ä¸åˆ°é”å°±ä¸€ç›´ç­‰ç€ï¼›ReentrantLockå¯ä»¥ç›¸åº”ä¸­æ–­ã€‚</p>
<p>ï¼ˆ4 ï¼‰ReentrantLockå’Œsynchronizedæœ€ä¸»è¦çš„å°±<strong>åŒºåˆ«æ˜¯ReentrantLockè¿˜å¯ä»¥å®ç°å…¬å¹³é”æœºåˆ¶</strong>ã€‚ä¹Ÿå°±æ˜¯åœ¨é”ä¸Šç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å°†è·å¾—é”çš„ä½¿ç”¨æƒã€‚é€šä¿—çš„ç†è§£å°±æ˜¯è°æ’é˜Ÿæ—¶é—´æœ€é•¿è°å…ˆæ‰§è¡Œè·å–é”ï¼ˆä¸å…¬å¹³é”æ˜¯åªè¦é”è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹ä¸€èµ·äº‰æŠ¢é”ï¼‰</p>
<h4 id="å…¬å¹³é”å’Œéå…¬å¹³é”">å…¬å¹³é”å’Œéå…¬å¹³é”</h4>
<p>ä»ReentrantLockçš„æ„é€ ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒReentrantLockæä¾›ä¸¤ç§é”ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œå…¶å†…éƒ¨å®ç°äº†ä¸¤ç§åŒæ­¥å™¨<strong>NonfairSync</strong>ã€<strong>FairSync</strong>æ´¾ç”Ÿè‡ª<strong>AQS</strong>ï¼Œä¸»è¦æ‰é‡‡ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œä¸»è¦<strong>é‡å†™äº†AQSçš„tryAcquireã€lockæ–¹æ³•</strong></p>
<h4 id="ReentrantLockçš„å®ç°åŸç†">ReentrantLockçš„å®ç°åŸç†</h4>
<p>ReentrantLockåœ¨å†…éƒ¨ä½¿ç”¨äº†å†…éƒ¨ç±»Syncæ¥ç®¡ç†é”ï¼Œæ‰€ä»¥çœŸæ­£çš„è·å–é”æ˜¯ç”±Syncçš„å®ç°ç±»æ§åˆ¶çš„ã€‚Syncæœ‰ä¸¤ä¸ªå®ç°ï¼Œåˆ†åˆ«ä¸ºNonfairSyncï¼ˆéå…¬å¹³é”ï¼‰å’ŒFairSyncï¼ˆå…¬å¹³é”ï¼‰ã€‚Syncé€šè¿‡ç»§æ‰¿AQSå®ç°ï¼Œåœ¨AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ª<strong>private volatile int state</strong>æ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œé¿å…äº†é¢‘ç¹çš„æŒæœ‰é‡Šæ”¾æ“ä½œå¸¦æ¥æ•ˆç‡é—®é¢˜ã€‚æ‰€ä»¥è¯´æœ¬è´¨ä¸Šå¸¸è§çš„åŒæ­¥é”æ˜¯ä½¿ç”¨CAS+volatileæ¥å®ç°çš„</p>
<h4 id="ä»£ç ">ä»£ç </h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T02_ReentrantLock2</span> </span>&#123;</span><br><span class="line">    <span class="comment">//éå…¬å¹³é”</span></span><br><span class="line">	Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			lock.lock(); <span class="comment">//synchronized(this)</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">				TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">				System.out.println(i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			lock.lock();</span><br><span class="line">			System.out.println(<span class="string">&quot;m2 ...&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		T02_ReentrantLock2 rl = <span class="keyword">new</span> T02_ReentrantLock2();</span><br><span class="line">		<span class="keyword">new</span> Thread(rl::m1).start();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">new</span> Thread(rl::m2).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">è¾“å‡ºç»“æœ</span><br><span class="line">==========================================</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line">m2 ...     </span><br><span class="line">==========================================  </span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>å‘ç°è¯¥æ“ä½œå·²ç»åœ¨æ‰§è¡Œä¸­åˆ™ä¸å†æ‰§è¡Œ</li>
<li>å¦‚æœè¯¥æ“ä½œå·²ç»åœ¨æ‰§è¡Œï¼Œåˆ™ç­‰å¾…ä¸€ä¸ªä¸ªæ‰§è¡Œï¼ˆåŒæ­¥æ‰§è¡Œï¼Œä¸synchronizedç±»ä¼¼ï¼‰</li>
<li>å¦‚æœè¯¥æ“ä½œå·²ç»åœ¨æ‰§è¡Œï¼Œåˆ™å°è¯•ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¶…æ—¶åˆ™æ”¾å¼ƒæ‰§è¡Œ</li>
<li>å¦‚æœå‘ç°è¯¥æ“ä½œå·²ç»åœ¨æ‰§è¡Œï¼Œç­‰å¾…æ‰§è¡Œã€‚è¿™æ—¶å¯ä¸­æ–­æ­£åœ¨è¿›è¡Œçš„æ“ä½œç«‹åˆ»é‡Šæ”¾é”ç»§ç»­ä¸‹ä¸€æ“ä½œ</li>
</ul>
<h3 id="CountDownLatch">CountDownLatch</h3>
<h4 id="æ¦‚å¿µ-2">æ¦‚å¿µ</h4>
<ul>
<li>countDownLatchè¿™ä¸ªç±»ä½¿ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å„è‡ªæ‰§è¡Œå®Œæ¯•åå†æ‰§è¡Œã€‚</li>
<li>CountDownLatchæ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨ï¼Œä½†æ˜¯æœ‰äººå«å®ƒå‘ä»¤æªï¼Œä¹Ÿæœ‰äººå«å®ƒé—¨é—©ã€‚åˆå§‹åŒ–è®¾å®šçº¿ç¨‹çš„ä¸ªæ•°ï¼Œè°ƒç”¨countDownLatch.await()é˜»å¡æ‰€æœ‰çº¿ç¨‹ï¼Œç›´åˆ°countDownLatch.countDown()ä¸º0ï¼Œé‚£ä¹ˆå°†ç»§ç»­æ‰§è¡Œå‰©ä½™çš„æ“ä½œã€‚</li>
</ul>
<h4 id="ä¸»è¦æ–¹æ³•">ä¸»è¦æ–¹æ³•</h4>
<ul>
<li>
<p>countDownLatchç±»ä¸­åªæä¾›äº†ä¸€ä¸ªæ„é€ å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CountDownLatch</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç±»ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•æ˜¯æœ€é‡è¦çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå®ƒä¼šç­‰å¾…ç›´åˆ°countå€¼ä¸º0æ‰ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;;   </span><br><span class="line"><span class="comment">//å’Œawait()ç±»ä¼¼ï¼Œåªä¸è¿‡ç­‰å¾…ä¸€å®šçš„æ—¶é—´åcountå€¼è¿˜æ²¡å˜ä¸º0çš„è¯å°±ä¼šç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;;  </span><br><span class="line"><span class="comment">//å°†countå€¼å‡1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span> </span>&#123; &#125;;  </span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//new CountDownLatch(2);è¿™é‡Œè®¾ç½®æˆ2æ˜¯å› ä¸ºä¸‹é¢åªåˆ›å»ºäº†ä¸¤ä¸ªæ–°çº¿ç¨‹ï¼Œå¦‚æœå¤§äº2ï¼Œåˆ™ä¼šåˆ°countDownLatch.countDown()æ–¹æ³•ä¸­ä¸è‚¯èƒ½ä¸º0.å¯¼è‡´ä¸»çº¿ç¨‹ä¸€ç›´é˜»å¡</span></span><br><span class="line">       <span class="keyword">final</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªå­çº¿ç¨‹å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">        ExecutorService executorService = Executors.newSingleThreadExecutor();</span><br><span class="line">        executorService.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;å­çº¿ç¨‹&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// countDownLatch.countDown(); è¿™ä¸€å¥è¯è¦å†™åœ¨finallyä¸­ï¼Œä¸ç„¶çš„è¯å‡ºç°å¼‚å¸¸ä¼šå¯¼è‡´æ— æ³•å‡ä¸€ï¼Œç„¶åå‡ºç°æ­»é”çš„</span></span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">        <span class="comment">//ç¬¬äºŒä¸ªå­çº¿ç¨‹å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">        ExecutorService executorService2 = Executors.newSingleThreadExecutor();</span><br><span class="line">        executorService2.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;å­çº¿ç¨‹&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        executorService2.shutdown();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            countDownLatch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸¤ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œ</span><br><span class="line">ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span><br><span class="line">å­çº¿ç¨‹pool-<span class="number">2</span>-thread-<span class="number">1</span></span><br><span class="line">å­çº¿ç¨‹pool-<span class="number">1</span>-thread-<span class="number">1</span></span><br><span class="line">ä¸¤ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹</span><br><span class="line">ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span><br><span class="line">========================================</span><br><span class="line">ä½¿ç”¨CountDownLatchä½¿ä¸»çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹<span class="number">1</span>ï¼Œ<span class="number">2</span>æ‰§è¡Œå®Œä¸»çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œ</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>æ¸¸æˆå¤šçº¿ç¨‹åŠ è½½å›¾ç‰‡ï¼ŒéŸ³ä¹ç­‰ç›¸å…³èµ„æºï¼Œéœ€è¦å…¨éƒ¨åŠ è½½å®Œå¿…é¡»çš„èµ„æºæ‰èƒ½æ­£å¸¸çš„è¿›å…¥æ¸¸æˆ</li>
</ul>
<h3 id="CyclicBarrier">CyclicBarrier</h3>
<h4 id="æ¦‚å¿µ-3">æ¦‚å¿µ</h4>
<p>ä»å­—é¢ä¸Šçš„æ„æ€å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªç±»çš„ä¸­æ–‡æ„æ€æ˜¯â€œå¾ªç¯æ …æ â€ã€‚å¤§æ¦‚çš„æ„æ€å°±æ˜¯ä¸€ä¸ªå¯å¾ªç¯åˆ©ç”¨çš„å±éšœã€‚å®ƒçš„ä½œç”¨å°±æ˜¯ä¼šè®©æ‰€æœ‰çº¿ç¨‹éƒ½ç­‰å¾…å®Œæˆåæ‰ä¼šç»§ç»­ä¸‹ä¸€æ­¥è¡ŒåŠ¨</p>
<p>ä¾‹å­ï¼šå½“ä½ å’Œæœ‹å‹ä¸€èµ·åƒé¥­ï¼Œæœ‰äººå…ˆåˆ°ï¼Œæœ‰äººååˆ°ï¼Œæ­£å¸¸æƒ…å†µä¸‹å°±ä¼šç­‰åˆ°ä¸€èµ·æ‰ä¼šç‚¹èœåƒé¥­</p>
<h4 id="ä¸»è¦æ–¹æ³•-2">ä¸»è¦æ–¹æ³•</h4>
<ul>
<li>CyclicBarrieræä¾›äº†ä¸€ä¸ªæ„é€ å™¨</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¡¨ç¤ºéœ€è¦ç­‰åˆ°å‡ ä¸ªçº¿ç¨‹ä¸€èµ·æ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties)</span></span></span><br><span class="line"><span class="function"> <span class="comment">//parties æ˜¯å‚ä¸çº¿ç¨‹çš„ä¸ªæ•°ï¼Œ Runnable å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯æœ€åä¸€ä¸ªåˆ°è¾¾çº¿ç¨‹è¦åšçš„ä»»åŠ¡</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties, Runnable barrierActionè¿™ä¸ªçº¿ç¨‹åšä»€ä¹ˆå¤„ç†)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>ç±»ä¸­æœ‰ä¸¤ä¸ªé‡è¦æ–¹æ³•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹è°ƒç”¨ await() è¡¨ç¤ºè‡ªå·±å·²ç»åˆ°è¾¾æ …æ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException</span></span><br><span class="line"><span class="function"><span class="comment">//BrokenBarrierException è¡¨ç¤ºæ …æ å·²ç»è¢«ç ´åï¼Œç ´åçš„åŸå› å¯èƒ½æ˜¯å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ await() æ—¶è¢«ä¸­æ–­æˆ–è€…è¶…æ—¶</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException, TimeoutException</span></span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç ç¤ºä¾‹-2">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T07_TestCyclicBarrier</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        CyclicBarrier barrier = new CyclicBarrier(20);</span></span><br><span class="line">        CyclicBarrier barrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">20</span>, () -&gt; System.out.println(<span class="string">&quot;æ»¡20&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        barrier.await();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).start();</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">=====================================</span><br><span class="line">æ»¡<span class="number">20</span></span><br><span class="line">æ»¡<span class="number">20</span></span><br><span class="line">æ»¡<span class="number">20</span></span><br><span class="line">æ»¡<span class="number">20</span></span><br><span class="line">æ»¡<span class="number">20</span></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>å¯ä»¥ç”¨äºå¤šçº¿ç¨‹è®¡ç®—æ•°æ®ï¼Œæœ€ååˆå¹¶è®¡ç®—ç»“æœçš„åœºæ™¯ã€‚</li>
</ul>
<h3 id="phaser">phaser</h3>
<h4 id="æ¦‚å¿µ-4">æ¦‚å¿µ</h4>
<p>â€‹	phaserä¸CountDownLatchéå¸¸ç›¸ä¼¼ï¼Œå…è®¸æˆ‘ä»¬åè°ƒçº¿ç¨‹çš„æ‰§è¡Œã€‚ä¸CountDownLatchç›¸æ¯”ï¼Œå®ƒå…·æœ‰ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚Phaseræ˜¯åœ¨çº¿ç¨‹åŠ¨æ€æ•°éœ€è¦ç»§ç»­æ‰§è¡Œä¹‹å‰ç­‰å¾…çš„å±éšœã€‚åœ¨CountDownLatchä¸­ï¼Œè¯¥æ•°å­—æ— æ³•åŠ¨æ€é…ç½®ï¼Œéœ€è¦åœ¨åˆ›å»ºå®ä¾‹æ—¶æä¾›</p>
<h4 id="ä¸»è¦æ–¹æ³•-3">ä¸»è¦æ–¹æ³•</h4>
<ul>
<li>æ„é€ æ–¹æ³•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ— å‚æ„é€ é»˜è®¤é˜¶æ®µæ•°ä¸º0ï¼Œåˆ›å»ºä¸€ä¸ªæ²¡æœ‰åˆå§‹æ³¨å†Œæ–¹ï¼Œæ²¡æœ‰çˆ¶çº§ä¸”åˆå§‹é˜¶æ®µå·ä¸º0çš„æ–°ç›¸ä½å™¨ã€‚ä½¿ç”¨æ­¤ç›¸ä½å™¨çš„ä»»ä½•çº¿ç¨‹éƒ½éœ€è¦é¦–å…ˆä¸ºå…¶æ³¨å†Œ  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Phaser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºæŒ‡å®šæ•°é‡ä¸ºpartiesçš„ç›¸ä½å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phaser</span><span class="params">(<span class="keyword">int</span> parties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>, parties);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ ¸å¿ƒæ–¹æ³•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//ä½¿çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…æŒ‡å®šçº¿ç¨‹æ•°ç›®ä¹‹åå†ç»§ç»­è¿è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">arriveAndAwaitAdvance</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">//æ³¨é”€åˆ°è¾¾çš„ç›¸å…³çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">arriveAndDeregister</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">//æ³¨å†Œä¸€ä¸ªæ–°çº¿ç¨‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> doRegister(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç ç¤ºä¾‹-3">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Phaser;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T09_TestPhaser2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Random r = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">static</span> MarriagePhaser phaser = <span class="keyword">new</span> MarriagePhaser();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        phaser.bulkRegister(<span class="number">7</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Person(<span class="string">&quot;p&quot;</span> + i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Person(<span class="string">&quot;æ–°éƒ&quot;</span>)).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Person(<span class="string">&quot;æ–°å¨˜&quot;</span>)).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MarriagePhaser</span> <span class="keyword">extends</span> <span class="title">Phaser</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="comment">//è¯¥æ–¹æ³•ä¼šåœ¨phaser.arriveAndAwaitAdvance();è¿›è¡Œç›¸å…³åˆ¤æ–­ï¼Œphaseé˜¶æ®µä¸€å®šæ˜¯ä»0å¼€å§‹è¿›è¡Œç³»åˆ—æ“ä½œï¼Œåªæœ‰å½“å‰Phaserä¸­æœ‰æŒ‡å®šæ•°é‡çš„çº¿ç¨‹æ—¶æ‰ä¼šè¿›è¡Œè¿è¡Œ</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onAdvance</span><span class="params">(<span class="keyword">int</span> phase, <span class="keyword">int</span> registeredParties)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (phase) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ‰€æœ‰äººåˆ°é½äº†ï¼&quot;</span> + registeredParties);</span><br><span class="line">                    System.out.println();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ‰€æœ‰äººåƒå®Œäº†ï¼&quot;</span> + registeredParties);</span><br><span class="line">                    System.out.println();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ‰€æœ‰äººç¦»å¼€äº†ï¼&quot;</span> + registeredParties);</span><br><span class="line">                    System.out.println();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;å©šç¤¼ç»“æŸï¼æ–°éƒæ–°å¨˜æŠ±æŠ±ï¼&quot;</span> + registeredParties);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">milliSleep</span><span class="params">(<span class="keyword">int</span> milli)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(milli);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">arrive</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            milliSleep(r.nextInt(<span class="number">1000</span>));</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s åˆ°è¾¾ç°åœºï¼\n&quot;</span>, name);</span><br><span class="line">            phaser.arriveAndAwaitAdvance();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            milliSleep(r.nextInt(<span class="number">1000</span>));</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s åƒå®Œ!\n&quot;</span>, name);</span><br><span class="line">            phaser.arriveAndAwaitAdvance();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            milliSleep(r.nextInt(<span class="number">1000</span>));</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s ç¦»å¼€ï¼\n&quot;</span>, name);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            phaser.arriveAndAwaitAdvance();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hug</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(name.equals(<span class="string">&quot;æ–°éƒ&quot;</span>) || name.equals(<span class="string">&quot;æ–°å¨˜&quot;</span>)) &#123;</span><br><span class="line">                milliSleep(r.nextInt(<span class="number">1000</span>));</span><br><span class="line">                System.out.printf(<span class="string">&quot;%s æ´æˆ¿ï¼\n&quot;</span>, name);</span><br><span class="line">                phaser.arriveAndAwaitAdvance();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                phaser.arriveAndDeregister();</span><br><span class="line">          <span class="comment">/*      phaser.register();</span></span><br><span class="line"><span class="comment">                System.out.println(phaser.getPhase());*/</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            arrive();</span><br><span class="line">            eat();</span><br><span class="line">            leave();</span><br><span class="line">            hug();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">======================================</span><br><span class="line">p3 åˆ°è¾¾ç°åœºï¼</span><br><span class="line">æ–°éƒ åˆ°è¾¾ç°åœºï¼</span><br><span class="line">p2 åˆ°è¾¾ç°åœºï¼</span><br><span class="line">p1 åˆ°è¾¾ç°åœºï¼</span><br><span class="line">p0 åˆ°è¾¾ç°åœºï¼</span><br><span class="line">p4 åˆ°è¾¾ç°åœºï¼</span><br><span class="line">æ–°å¨˜ åˆ°è¾¾ç°åœºï¼</span><br><span class="line">æ‰€æœ‰äººåˆ°é½äº†ï¼<span class="number">7</span></span><br><span class="line"></span><br><span class="line">æ–°å¨˜ åƒå®Œ!</span><br><span class="line">p0 åƒå®Œ!</span><br><span class="line">p1 åƒå®Œ!</span><br><span class="line">p4 åƒå®Œ!</span><br><span class="line">æ–°éƒ åƒå®Œ!</span><br><span class="line">p2 åƒå®Œ!</span><br><span class="line">p3 åƒå®Œ!</span><br><span class="line">æ‰€æœ‰äººåƒå®Œäº†ï¼<span class="number">7</span></span><br><span class="line"></span><br><span class="line">p0 ç¦»å¼€ï¼</span><br><span class="line">p3 ç¦»å¼€ï¼</span><br><span class="line">æ–°éƒ ç¦»å¼€ï¼</span><br><span class="line">æ–°å¨˜ ç¦»å¼€ï¼</span><br><span class="line">p2 ç¦»å¼€ï¼</span><br><span class="line">p4 ç¦»å¼€ï¼</span><br><span class="line">p1 ç¦»å¼€ï¼</span><br><span class="line">æ‰€æœ‰äººç¦»å¼€äº†ï¼<span class="number">7</span></span><br><span class="line"></span><br><span class="line">æ–°å¨˜ æ´æˆ¿ï¼</span><br><span class="line">æ–°éƒ æ´æˆ¿ï¼</span><br><span class="line">å©šç¤¼ç»“æŸï¼æ–°éƒæ–°å¨˜æŠ±æŠ±ï¼<span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨åœºæ™¯-4">ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>åœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ‹¦æˆªçš„æ—¶å€™</li>
</ul>
<h3 id="ReadWriteLock">ReadWriteLock</h3>
<h4 id="æ¦‚å¿µ-5">æ¦‚å¿µ</h4>
<p>ReadWriteLockæ˜¯JDK5ä¸­æä¾›çš„è¯»å†™åˆ†ç¦»é”ã€‚è¯»å†™åˆ†ç¦»é”å¯ä»¥æœ‰æ•ˆåœ°å¸®åŠ©å‡å°‘é”ç«äº‰ï¼Œä»¥æé«˜ç³»ç»Ÿæ€§èƒ½</p>
<p>è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½¿å¾—B1,B2,B3ä¹‹é—´çœŸæ­£å¹¶è¡Œã€‚ä½†æ˜¯ï¼Œè€ƒè™‘éƒ½æ•°æ®å®Œæ•´æ€§ï¼Œ<strong>å†™å†™æ“ä½œå’Œè¯»å†™æ“ä½œé—´ä¾ç„¶æ—¶éœ€è¦ç›¸äº’ç­‰å¾…å’ŒæŒæœ‰é”çš„</strong></p>
<h4 id="ä¸»è¦æ–¹æ³•-4">ä¸»è¦æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯»é”</span></span><br><span class="line"><span class="function">Lock <span class="title">readLock</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//å†™é”</span></span><br><span class="line"><span class="function">Lock <span class="title">writeLock</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç ç¤ºä¾‹-4">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T10_TestReadWriteLock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="keyword">static</span> ReadWriteLock readWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line">    <span class="keyword">static</span> Lock readLock = readWriteLock.readLock();</span><br><span class="line">    <span class="keyword">static</span> Lock writeLock = readWriteLock.writeLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(Lock lock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;read over!&quot;</span>);</span><br><span class="line">            <span class="comment">//æ¨¡æ‹Ÿè¯»å–æ“ä½œ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Lock lock, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            value = v;</span><br><span class="line">            System.out.println(<span class="string">&quot;write over!&quot;</span>);</span><br><span class="line">            <span class="comment">//æ¨¡æ‹Ÿå†™æ“ä½œ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Runnable readR = ()-&gt; read(readLock);</span><br><span class="line">        Runnable writeR = ()-&gt;write(writeLock, <span class="keyword">new</span> Random().nextInt());</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) <span class="keyword">new</span> Thread(readR).start();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++) <span class="keyword">new</span> Thread(writeR).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">==========</span><br><span class="line">read over!</span><br><span class="line">read over!</span><br><span class="line">read over!</span><br><span class="line">read over!</span><br><span class="line">read over!</span><br><span class="line">write over!</span><br><span class="line">write over!</span><br></pre></td></tr></table></figure>
<h3 id="Semaphore">Semaphore</h3>
<h4 id="æ¦‚å¿µ-6">æ¦‚å¿µ</h4>
<p>semaphore æ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œå¿…é¡»ç”±è·å–å®ƒçš„çº¿ç¨‹é‡Šæ”¾ã€‚</p>
<p>å¸¸ç”¨äºé™åˆ¶å¯ä»¥è®¿é—®æŸäº›èµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œä¾‹å¦‚é€šè¿‡ Semaphore é™æµã€‚</p>
<p>Semaphore åªæœ‰3ä¸ªæ“ä½œï¼š</p>
<ol>
<li>åˆå§‹åŒ–</li>
<li>å¢åŠ </li>
<li>å‡å°‘</li>
</ol>
<h4 id="ä»£ç ç¤ºä¾‹-5">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T11_TestSemaphore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Semaphore s = new Semaphore(2);</span></span><br><span class="line">        Semaphore s = <span class="keyword">new</span> Semaphore(<span class="number">2</span>, <span class="keyword">true</span>);<span class="comment">//è®¾ç½®æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”</span></span><br><span class="line">        <span class="comment">//å…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ</span></span><br><span class="line">        <span class="comment">//Semaphore s = new Semaphore(1);</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è¿›è¡Œè¯·æ±‚</span></span><br><span class="line">                s.acquire();</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;T1 running...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;T1 running...&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                s.release();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                s.acquire();</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;T2 running...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;T2 running...&quot;</span>);</span><br><span class="line"></span><br><span class="line">                s.release();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">==========================</span><br><span class="line">T1 running...</span><br><span class="line">T2 running...</span><br><span class="line">T1 running...</span><br><span class="line">T2 running...</span><br></pre></td></tr></table></figure>
<h3 id="Exchanger">Exchanger</h3>
<h4 id="æ¦‚å¿µ-7">æ¦‚å¿µ</h4>
<p>ä¸€ä¸ªç”¨äºä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®çš„å°è£…å·¥å…·ç±»ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹åœ¨å®Œæˆä¸€å®šçš„äº‹åŠ¡åæƒ³ä¸å¦ä¸€ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®ï¼Œåˆ™ç¬¬ä¸€ä¸ªå…ˆæ‹¿å‡ºæ•°æ®çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œç›´åˆ°ç¬¬äºŒä¸ªçº¿ç¨‹æ‹¿ç€æ•°æ®åˆ°æ¥æ—¶æ‰èƒ½å½¼æ­¤äº¤æ¢å¯¹åº”æ•°æ®</p>
<h4 id="ä¸»è¦æ–¹æ³•-5">ä¸»è¦æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exchanger()ï¼šæ— å‚æ„é€ æ–¹æ³•ã€‚</span><br><span class="line"><span class="function">V <span class="title">exchange</span><span class="params">(V v)</span>ï¼šç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾æ­¤äº¤æ¢ç‚¹ï¼ˆé™¤éå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼‰ï¼Œç„¶åå°†ç»™å®šçš„å¯¹è±¡ä¼ é€ç»™è¯¥çº¿ç¨‹ï¼Œå¹¶æ¥æ”¶è¯¥çº¿ç¨‹çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">V <span class="title">exchange</span><span class="params">(V v, <span class="keyword">long</span> timeout, TimeUnit unit)</span>ï¼šç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾æ­¤äº¤æ¢ç‚¹ï¼ˆé™¤éå½“å‰çº¿ç¨‹è¢«ä¸­æ–­æˆ–è¶…å‡ºäº†æŒ‡å®šçš„ç­‰å¾…æ—¶é—´ï¼‰ï¼Œç„¶åå°†ç»™å®šçš„å¯¹è±¡ä¼ é€ç»™è¯¥çº¿ç¨‹ï¼Œå¹¶æ¥æ”¶è¯¥çº¿ç¨‹çš„å¯¹è±¡ã€‚</span></span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç ç¤ºä¾‹-6">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Exchanger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T12_TestExchanger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Exchanger&lt;String&gt; exchanger = <span class="keyword">new</span> Exchanger&lt;&gt;();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * exchangeråªèƒ½æ˜¯ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œå¤šä¸ªçº¿ç¨‹éœ€è¦è¿›è¡Œçº¿ç¨‹åŒæ­¥</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            String s = <span class="string">&quot;T1&quot;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//åœ¨æ­¤ä¼šé˜»å¡ç­‰å¾…T2çº¿ç¨‹è¿›è¡Œæ•°æ®äº¤æ¢</span></span><br><span class="line">                s = exchanger.exchange(s);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + s);</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            String s = <span class="string">&quot;T2&quot;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                s = exchanger.exchange(s);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + s);</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">=============================</span><br><span class="line">t2 T1</span><br><span class="line">t1 T2</span><br></pre></td></tr></table></figure>
<h3 id="LockSupport">LockSupport</h3>
<h4 id="æ¦‚å¿µ-8">æ¦‚å¿µ</h4>
<p>LockSupportæ˜¯ä¸€ä¸ªçº¿ç¨‹å·¥å…·ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜»å¡ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»æ„ä½ç½®å”¤é†’ã€‚å®ƒçš„å†…éƒ¨å…¶å®ä¸¤ç±»ä¸»è¦çš„æ–¹æ³•ï¼š<strong>park</strong>ï¼ˆåœè½¦é˜»å¡çº¿ç¨‹ï¼‰å’Œ<strong>unpark</strong>ï¼ˆå¯åŠ¨å”¤é†’çº¿ç¨‹ï¼‰ã€‚</p>
<h4 id="ä¸»è¦æ–¹æ³•-6">ä¸»è¦æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">park</span><span class="params">(Object blocker)</span></span>; <span class="comment">// æš‚åœå½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkNanos</span><span class="params">(Object blocker, <span class="keyword">long</span> nanos)</span></span>; <span class="comment">// æš‚åœå½“å‰çº¿ç¨‹ï¼Œä¸è¿‡æœ‰è¶…æ—¶æ—¶é—´çš„é™åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkUntil</span><span class="params">(Object blocker, <span class="keyword">long</span> deadline)</span></span>; <span class="comment">// æš‚åœå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æŸä¸ªæ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">park</span><span class="params">()</span></span>; <span class="comment">// æ— æœŸé™æš‚åœå½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkNanos</span><span class="params">(<span class="keyword">long</span> nanos)</span></span>; <span class="comment">// æš‚åœå½“å‰çº¿ç¨‹ï¼Œä¸è¿‡æœ‰è¶…æ—¶æ—¶é—´çš„é™åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkUntil</span><span class="params">(<span class="keyword">long</span> deadline)</span></span>; <span class="comment">// æš‚åœå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æŸä¸ªæ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unpark</span><span class="params">(Thread thread)</span></span>; <span class="comment">// æ¢å¤å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBlocker</span><span class="params">(Thread t)</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç ç¤ºä¾‹-7">ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T13_TestLockSupport</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(i);</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">5</span>) &#123;</span><br><span class="line"><span class="comment">//                    å½“å‰çº¿ç¨‹åœæ­¢ï¼Œè¿›å…¥åˆ°é˜»å¡çŠ¶æ€</span></span><br><span class="line">                    LockSupport.park();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">//LockSupport.park()ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨unparkæ–¹æ³•ä½¿è¿›ç¨‹ç»§ç»­è¿è¡Œ</span></span><br><span class="line">        <span class="comment">//ä¸è¿›è¡Œ LockSupport.unpark(t)åˆ™ä¼šå¯¼è‡´çº¿ç¨‹ä¸€ç›´éƒ½ä¼šé˜»å¡</span></span><br><span class="line">       LockSupport.unpark(t);     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="parkå’Œunparkçš„ä¼˜ç‚¹">parkå’Œunparkçš„ä¼˜ç‚¹</h4>
<p><strong>ä¸€ä¸ªçº¿ç¨‹å®ƒæœ‰å¯èƒ½åœ¨åˆ«çš„çº¿ç¨‹unParkä¹‹å‰ï¼Œæˆ–è€…ä¹‹åï¼Œæˆ–è€…åŒæ—¶è°ƒç”¨äº†parkï¼Œé‚£ä¹ˆå› ä¸ºparkçš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ä¸ç”¨æ‹…å¿ƒè‡ªå·±çš„parkçš„æ—¶åºé—®é¢˜ï¼Œå¦åˆ™ï¼Œå¦‚æœparkå¿…é¡»è¦åœ¨unparkä¹‹å‰ï¼Œé‚£ä¹ˆç»™ç¼–ç¨‹å¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ï¼ï¼</strong></p>
<p>è€ƒè™‘ä¸€ä¸‹ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ­¥ï¼Œè¦å¦‚ä½•å¤„ç†ï¼Ÿ</p>
<p>åœ¨Java5é‡Œæ˜¯ç”¨wait/notify/notifyAllæ¥åŒæ­¥çš„ã€‚wait/notifyæœºåˆ¶æœ‰ä¸ªå¾ˆè›‹ç–¼çš„åœ°æ–¹æ˜¯ï¼Œæ¯”å¦‚**çº¿ç¨‹Bè¦ç”¨notifyé€šçŸ¥çº¿ç¨‹Aï¼Œé‚£ä¹ˆçº¿ç¨‹Bè¦ç¡®ä¿çº¿ç¨‹Aå·²ç»åœ¨waitè°ƒç”¨ä¸Šç­‰å¾…äº†ï¼Œå¦åˆ™çº¿ç¨‹Aå¯èƒ½æ°¸è¿œéƒ½åœ¨ç­‰å¾…ã€‚**å¦å¤–ï¼Œ<strong>æ˜¯è°ƒç”¨notifyï¼Œè¿˜æ˜¯notifyAllï¼Ÿ</strong></p>
<p>notifyåªä¼šå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœé”™è¯¯åœ°æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šwaitç­‰å¾…ï¼Œé‚£ä¹ˆåˆæ‚²å‰§äº†ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè²Œä¼¼åªèƒ½è°ƒç”¨notifyAlläº†ã€‚</p>
<p><strong>park/unparkæ¨¡å‹çœŸæ­£è§£è€¦äº†çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼Œçº¿ç¨‹ä¹‹é—´ä¸å†éœ€è¦ä¸€ä¸ªObjectæˆ–è€…å…¶å®ƒå˜é‡æ¥å­˜å‚¨çŠ¶æ€ï¼Œä¸å†éœ€è¦å…³å¿ƒå¯¹æ–¹çš„çŠ¶æ€ã€‚</strong></p>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹çš„AQS</title>
    <url>/posts/1008f972/</url>
    <content><![CDATA[<h3 id="æ¦‚è¿°">æ¦‚è¿°</h3>
<p>AbstractQueuedSynchronizeræŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ç®€ç§°AQSï¼Œå®ƒæ˜¯å®ç°åŒæ­¥å™¨çš„åŸºç¡€ç»„ä»¶ï¼Œjucä¸‹é¢Lockçš„å®ç°ä»¥åŠä¸€äº›å¹¶å‘å·¥å…·ç±»å°±æ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡AQSçš„ç±»å›¾å…ˆçœ‹ä¸€ä¸‹å¤§æ¦‚ï¼Œä¸‹é¢æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹AQSçš„å®ç°åŸç†ã€‚å…ˆçœ‹çœ‹AQSçš„ç±»å›¾ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114112.png" alt="img"></p>
<p><strong>(1)<strong>AQSæ˜¯ä¸€ä¸ªé€šè¿‡å†…ç½®çš„</strong>FIFO</strong>åŒå‘é˜Ÿåˆ—æ¥å®Œæˆçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œ(å†…éƒ¨é€šè¿‡ç»“ç‚¹headå’Œtailè®°å½•é˜Ÿé¦–å’Œé˜Ÿå°¾å…ƒç´ ï¼Œå…ƒç´ çš„ç»“ç‚¹ç±»å‹ä¸ºNodeç±»å‹ï¼Œåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°Nodeçš„å…·ä½“æ„é€ )ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿé¦–ç»“ç‚¹(æ‡’åŠ è½½ï¼Œè¿™é‡Œä½“ç°ä¸ºç«äº‰å¤±è´¥çš„æƒ…å†µä¸‹ï¼ŒåŠ å…¥åŒæ­¥é˜Ÿåˆ—çš„çº¿ç¨‹æ‰§è¡Œåˆ°enqæ–¹æ³•çš„æ—¶å€™ä¼šåˆ›</span></span><br><span class="line"><span class="comment">å»ºä¸€ä¸ªHeadç»“ç‚¹)ã€‚è¯¥ç»“ç‚¹åªèƒ½è¢«setHeadæ–¹æ³•ä¿®æ”¹ã€‚å¹¶ä¸”ç»“ç‚¹çš„waitStatusä¸èƒ½ä¸ºCANCELLED*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line"><span class="comment">/**ç­‰å¾…é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯æ‡’åŠ è½½çš„ã€‚ï¼ˆenqæ–¹æ³•ï¼‰ã€‚åªåœ¨åŠ å…¥æ–°çš„é˜»å¡ç»“ç‚¹çš„æƒ…å†µä¸‹ä¿®æ”¹*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br></pre></td></tr></table></figure>
<p><strong>(2)<strong>å…¶ä¸­</strong>Node</strong>ä¸­çš„threadç”¨æ¥å­˜æ”¾è¿›å…¥AQSé˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¼•ç”¨ï¼ŒNodeç»“ç‚¹å†…éƒ¨çš„SHAREDè¡¨ç¤ºæ ‡è®°çº¿ç¨‹æ˜¯å› ä¸ºè·å–å…±äº«èµ„æºå¤±è´¥è¢«é˜»å¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„ï¼›Nodeä¸­çš„EXCLUSIVEè¡¨ç¤ºçº¿ç¨‹å› ä¸ºè·å–ç‹¬å èµ„æºå¤±è´¥è¢«é˜»å¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„ã€‚waitStatusè¡¨ç¤ºå½“å‰çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€</p>
<p>â‘ CANCELLED=1ï¼šè¡¨ç¤ºçº¿ç¨‹å› ä¸ºä¸­æ–­æˆ–è€…ç­‰å¾…è¶…æ—¶ï¼Œéœ€è¦ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å–æ¶ˆç­‰å¾…ï¼›</p>
<p>â‘¡SIGNAL=-1ï¼šå½“å‰çº¿ç¨‹thread1å æœ‰é”ï¼Œé˜Ÿåˆ—ä¸­çš„head(ä»…ä»…ä»£è¡¨å¤´ç»“ç‚¹ï¼Œé‡Œé¢æ²¡æœ‰å­˜æ”¾çº¿ç¨‹å¼•ç”¨)çš„åç»§ç»“ç‚¹node1å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœå·²å æœ‰é”çš„çº¿ç¨‹thread1é‡Šæ”¾é”æˆ–è¢«CANCELä¹‹åå°±ä¼šé€šçŸ¥è¿™ä¸ªç»“ç‚¹node1å»è·å–é”æ‰§è¡Œã€‚</p>
<p>â‘¢CONDITION=-2ï¼šè¡¨ç¤ºç»“ç‚¹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­(è¿™é‡ŒæŒ‡çš„æ˜¯ç­‰å¾…åœ¨æŸä¸ªlockçš„conditionä¸Šï¼Œå…³äºConditionçš„åŸç†ä¸‹é¢ä¼šå†™åˆ°)ï¼Œå½“æŒæœ‰é”çš„çº¿ç¨‹è°ƒç”¨äº†Conditionçš„signal()æ–¹æ³•ä¹‹åï¼Œç»“ç‚¹ä¼šä»è¯¥conditionçš„ç­‰å¾…é˜Ÿåˆ—è½¬ç§»åˆ°è¯¥lockçš„åŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œå»ç«äº‰lockã€‚(æ³¨æ„ï¼šè¿™é‡Œçš„åŒæ­¥é˜Ÿåˆ—å°±æ˜¯æˆ‘ä»¬è¯´çš„AQSç»´æŠ¤çš„FIFOé˜Ÿåˆ—ï¼Œç­‰å¾…é˜Ÿåˆ—åˆ™æ˜¯æ¯ä¸ªconditionå…³è”çš„é˜Ÿåˆ—)</p>
<p>â‘£PROPAGTE=-3ï¼šè¡¨ç¤ºä¸‹ä¸€æ¬¡å…±äº«çŠ¶æ€è·å–å°†ä¼šä¼ é€’ç»™åç»§ç»“ç‚¹è·å–è¿™ä¸ªå…±äº«åŒæ­¥çŠ¶æ€ã€‚</p>
<p>**(3)**AQSä¸­ç»´æŒäº†ä¸€ä¸ªå•ä¸€çš„volatileä¿®é¥°çš„çŠ¶æ€ä¿¡æ¯state(AQSé€šè¿‡Unsafeçš„ç›¸å…³æ–¹æ³•ï¼Œä»¥åŸå­æ€§çš„æ–¹å¼ç”±çº¿ç¨‹å»è·å–è¿™ä¸ªstate)ã€‚AQSæä¾›äº†getState()ã€setState()ã€compareAndSetState()å‡½æ•°ä¿®æ”¹å€¼(å®é™…ä¸Šè°ƒç”¨çš„æ˜¯unsafeçš„compareAndSwapIntæ–¹æ³•)ã€‚ä¸‹é¢æ˜¯AQSä¸­çš„éƒ¨åˆ†æˆå‘˜å˜é‡ä»¥åŠæ›´æ–°stateçš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™å°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯´åˆ°çš„headç»“ç‚¹ï¼Œæ‡’åŠ è½½çš„ï¼ˆåªæœ‰ç«äº‰å¤±è´¥éœ€è¦æ„å»ºåŒæ­¥é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ›å»ºè¿™ä¸ªheadï¼‰ï¼Œå¦‚æœå¤´èŠ‚ç‚¹å­˜åœ¨ï¼Œå®ƒçš„waitStatusä¸èƒ½ä¸ºCANCELLED</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line"><span class="comment">//å½“å‰åŒæ­¥é˜Ÿåˆ—å°¾èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œä¹Ÿæ˜¯æ‡’åŠ è½½çš„ï¼Œåªæœ‰è°ƒç”¨enqæ–¹æ³•çš„æ—¶å€™ä¼šæ·»åŠ ä¸€ä¸ªæ–°çš„wait node</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br><span class="line"><span class="comment">//AQSæ ¸å¿ƒï¼šåŒæ­¥çŠ¶æ€</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> newState)</span> </span>&#123;</span><br><span class="line">    state = newState;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSetState</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, expect, update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>(4)<strong>AQSçš„è®¾è®¡å¸ˆåŸºäº</strong>æ¨¡æ¿æ–¹æ³•</strong>æ¨¡å¼çš„ã€‚ä½¿ç”¨æ—¶å€™éœ€è¦ç»§æ‰¿åŒæ­¥å™¨å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ï¼Œå¹¶ä¸”é€šå¸¸å°†å­ç±»æ¨èä¸ºå®šä¹‰åŒæ­¥ç»„ä»¶çš„é™æ€å†…éƒ¨ç±»ï¼Œå­ç±»é‡å†™è¿™äº›æ–¹æ³•ä¹‹åï¼ŒAQSå·¥ä½œæ—¶ä½¿ç”¨çš„æ˜¯æä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼Œåœ¨è¿™äº›æ¨¡æ¿æ–¹æ³•ä¸­è°ƒç”¨å­ç±»é‡å†™çš„æ–¹æ³•ã€‚å…¶ä¸­å­ç±»å¯ä»¥é‡å†™çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç‹¬å å¼çš„è·å–åŒæ­¥çŠ¶æ€ï¼Œå®ç°è¯¥æ–¹æ³•éœ€è¦æŸ¥è¯¢å½“å‰çŠ¶æ€å¹¶åˆ¤æ–­åŒæ­¥çŠ¶æ€æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œç„¶åå†è¿›è¡ŒCASè®¾ç½®åŒæ­¥çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;	<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();&#125;</span><br><span class="line"><span class="comment">//ç‹¬å å¼çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œç­‰å¾…è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹å¯ä»¥æœ‰æœºä¼šè·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;	<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();&#125;</span><br><span class="line"><span class="comment">//å…±äº«å¼çš„è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();&#125;</span><br><span class="line"><span class="comment">//å°è¯•å°†çŠ¶æ€è®¾ç½®ä¸ºä»¥å…±äº«æ¨¡å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€‚ è¯¥æ–¹æ³•æ€»æ˜¯ç”±æ‰§è¡Œé‡Šæ”¾çš„çº¿ç¨‹è°ƒç”¨ã€‚ </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(); &#125;</span><br><span class="line"><span class="comment">//å½“å‰åŒæ­¥å™¨æ˜¯å¦åœ¨ç‹¬å æ¨¡å¼ä¸‹è¢«çº¿ç¨‹å ç”¨ï¼Œä¸€èˆ¬è¯¥æ–¹æ³•è¡¨ç¤ºæ˜¯å¦è¢«å½“å‰çº¿ç¨‹æ‰€ç‹¬å </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">isHeldExclusively</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;	<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();&#125;</span><br></pre></td></tr></table></figure>
<p><strong>(5)<strong>AQSçš„å†…éƒ¨ç±»</strong>ConditionObject</strong>æ˜¯é€šè¿‡ç»“åˆé”å®ç°çº¿ç¨‹åŒæ­¥ï¼ŒConditionObjectå¯ä»¥ç›´æ¥è®¿é—®AQSçš„å˜é‡(stateã€queue)ï¼ŒConditionObjectæ˜¯ä¸ªæ¡ä»¶å˜é‡ ï¼Œæ¯ä¸ªConditionObjectå¯¹åº”ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥å­˜æ”¾çº¿ç¨‹è°ƒç”¨conditionæ¡ä»¶å˜é‡çš„awaitæ–¹æ³•ä¹‹åè¢«é˜»å¡çš„çº¿ç¨‹ã€‚</p>
<h3 id="éå…¬å¹³é”çš„åŠ é”æµç¨‹">éå…¬å¹³é”çš„åŠ é”æµç¨‹</h3>
<p>AQSä¼šæŠŠæ‰€æœ‰çš„è¯·æ±‚çº¿ç¨‹æ„æˆä¸€ä¸ª<strong>CLHé˜Ÿåˆ—</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ˆlock.unlock()ï¼‰æ—¶ä¼šæ¿€æ´»è‡ªå·±çš„åç»§èŠ‚ç‚¹ï¼Œä½†æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¹¶ä¸åœ¨é˜Ÿåˆ—ä¸­ï¼Œè€Œé‚£äº›ç­‰å¾…æ‰§è¡Œçš„çº¿ç¨‹å…¨éƒ¨å¤„äºé˜»å¡çŠ¶æ€(park())ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114118.png" alt="img"></p>
<p>**(1)**å‡è®¾è¿™ä¸ªæ—¶å€™åœ¨åˆå§‹æƒ…å†µä¸‹ï¼Œè¿˜æ²¡æœ‰å¤šä»»åŠ¡æ¥è¯·æ±‚ç«äº‰è¿™ä¸ªstateï¼Œè¿™æ—¶å€™å¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹thread1è°ƒç”¨äº†lockæ–¹æ³•è¯·æ±‚è·å¾—é”ï¼Œé¦–å…ˆä¼šé€šè¿‡CASçš„æ–¹å¼å°†stateæ›´æ–°ä¸º1ï¼Œè¡¨ç¤ºè‡ªå·±thread1è·å¾—äº†é”ï¼Œå¹¶å°†ç‹¬å é”çš„çº¿ç¨‹æŒæœ‰è€…è®¾ç½®ä¸ºthread1ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">        <span class="comment">//setExclusiveOwnerThreadæ˜¯AbstractOwnableSynchronizerçš„æ–¹æ³•ï¼ŒAQSç»§æ‰¿äº†AbstractOwnableSynchronizer</span></span><br><span class="line">        setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        acquire(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**(2)**è¿™ä¸ªæ—¶å€™æœ‰å¦ä¸€ä¸ªçº¿ç¨‹thread2æ¥å°è¯•æˆ–è€…é”ï¼ŒåŒæ ·ä¹Ÿè°ƒç”¨lockæ–¹æ³•ï¼Œå°è¯•é€šè¿‡CASçš„æ–¹å¼å°†stateæ›´æ–°ä¸º1ï¼Œä½†æ˜¯ç”±äºä¹‹å‰å·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†stateï¼Œæ‰€ä»¥thread2è¿™ä¸€æ­¥CASå¤±è´¥ï¼ˆå‰é¢çš„thread1å·²ç»è·å–stateå¹¶ä¸”æ²¡æœ‰é‡Šæ”¾ï¼‰ï¼Œå°±ä¼šè°ƒç”¨acquire(1)æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•æ˜¯AQSæä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨å­ç±»çš„tryAcquireæ–¹æ³•ï¼‰ã€‚éå…¬å¹³é”çš„å®ç°ä¸­ï¼ŒAQSçš„æ¨¡æ¿æ–¹æ³•acquire(1)å°±ä¼šè°ƒç”¨NofairSyncçš„tryAcquireæ–¹æ³•ï¼Œè€ŒtryAcquireæ–¹æ³•åˆè°ƒç”¨çš„Syncçš„nonfairTryAcquireæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹nonfairTryAcquireçš„æµç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//NofairSync</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nonfairTryAcquire(acquires);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ï¼ˆ1ï¼‰è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">    <span class="comment">//ï¼ˆ2ï¼‰è·å¾—å½“å‰åŒæ­¥çŠ¶æ€state</span></span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="comment">//ï¼ˆ3ï¼‰å¦‚æœstate==0ï¼Œè¡¨ç¤ºæ²¡æœ‰çº¿ç¨‹è·å–</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//ï¼ˆ3-1ï¼‰é‚£ä¹ˆå°±å°è¯•ä»¥CASçš„æ–¹å¼æ›´æ–°stateçš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123;</span><br><span class="line">            <span class="comment">//ï¼ˆ3-2ï¼‰å¦‚æœæ›´æ–°æˆåŠŸï¼Œå°±è®¾ç½®å½“å‰ç‹¬å æ¨¡å¼ä¸‹åŒæ­¥çŠ¶æ€çš„æŒæœ‰è€…ä¸ºå½“å‰çº¿ç¨‹</span></span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            <span class="comment">//ï¼ˆ3-3ï¼‰è·å¾—æˆåŠŸä¹‹åï¼Œè¿”å›true</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ï¼ˆ4ï¼‰è¿™é‡Œæ˜¯é‡å…¥é”çš„é€»è¾‘</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">        <span class="comment">//ï¼ˆ4-1ï¼‰åˆ¤æ–­å½“å‰å æœ‰stateçš„çº¿ç¨‹å°±æ˜¯å½“å‰æ¥å†æ¬¡è·å–stateçš„çº¿ç¨‹ä¹‹åï¼Œå°±è®¡ç®—é‡å…¥åçš„state</span></span><br><span class="line">        <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="comment">//ï¼ˆ4-2ï¼‰è¿™é‡Œæ˜¯é£é™©å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">        <span class="comment">//ï¼ˆ4-3ï¼‰é€šè¿‡setStateæ— æ¡ä»¶çš„è®¾ç½®stateçš„å€¼ï¼Œï¼ˆå› ä¸ºè¿™é‡Œä¹Ÿåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œstateçš„å€¼ï¼Œå³</span></span><br><span class="line">        <span class="comment">//å·²ç»è·å–åˆ°çš„çº¿ç¨‹ï¼Œæ‰€ä»¥æ²¡æœ‰è¿›è¡ŒCASæ“ä½œï¼‰</span></span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ï¼ˆ5ï¼‰æ²¡æœ‰è·å¾—stateï¼Œä¹Ÿä¸æ˜¯é‡å…¥ï¼Œå°±è¿”å›false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š</p>
<p>1ã€è·å–å½“å‰å°†è¦å»è·å–é”çš„çº¿ç¨‹thread2ã€‚</p>
<p>2ã€è·å–å½“å‰AQSçš„stateçš„å€¼ã€‚å¦‚æœæ­¤æ—¶stateçš„å€¼æ˜¯0ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±é€šè¿‡CASæ“ä½œè·å–é”ï¼Œç„¶åè®¾ç½®AQSçš„çº¿ç¨‹å æœ‰è€…ä¸ºthread2ã€‚å¾ˆæ˜æ˜¾ï¼Œåœ¨å½“å‰çš„è¿™ä¸ªæ‰§è¡Œæƒ…å†µä¸‹ï¼Œstateçš„å€¼æ˜¯1ä¸æ˜¯0ï¼Œå› ä¸ºæˆ‘ä»¬çš„thread1è¿˜æ²¡æœ‰é‡Šæ”¾é”ã€‚æ‰€ä»¥CASå¤±è´¥ï¼Œåé¢ç¬¬3æ­¥çš„é‡å…¥é€»è¾‘ä¹Ÿä¸ä¼šè¿›è¡Œ</p>
<p>3ã€å¦‚æœå½“å‰å°†è¦å»è·å–é”çš„çº¿ç¨‹ç­‰äºæ­¤æ—¶AQSçš„exclusiveOwnerThreadçš„çº¿ç¨‹ï¼Œåˆ™æ­¤æ—¶å°†stateçš„å€¼åŠ 1ï¼Œè¿™æ˜¯é‡å…¥é”çš„å®ç°æ–¹å¼ã€‚</p>
<p>4ã€æœ€ç»ˆthread2æ‰§è¡Œåˆ°è¿™é‡Œä¼šè¿”å›falseã€‚</p>
<p>**(3)**ä¸Šé¢çš„thread2åŠ é”å¤±è´¥ï¼Œè¿”å›falseã€‚é‚£ä¹ˆæ ¹æ®å¼€å§‹æˆ‘ä»¬è®²åˆ°çš„AQSæ¦‚è¿°å°±åº”è¯¥å°†thread2æ„é€ ä¸ºä¸€ä¸ªNodeç»“ç‚¹åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚å› ä¸ºNofairSyncçš„tryAcquireæ–¹æ³•æ˜¯ç”±AQSçš„æ¨¡æ¿æ–¹æ³•acquire()æ¥è°ƒç”¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹è¯¥æ–¹æ³•çš„æºç ä»¥åŠæ‰§è¡Œæµç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//(1)tryAcquireï¼Œè¿™é‡Œthread2æ‰§è¡Œè¿”å›äº†falseï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡ŒaddWaiterå°†å½“å‰çº¿ç¨‹æ„é€ ä¸ºä¸€ä¸ªç»“ç‚¹åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹addWaiteræ–¹æ³•çš„æ‰§è¡Œæµç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//(1)å°†å½“å‰çº¿ç¨‹ä»¥åŠé˜»å¡åŸå› (æ˜¯å› ä¸ºSHAREDæ¨¡å¼è·å–stateå¤±è´¥è¿˜æ˜¯EXCLUSIVEè·å–å¤±è´¥)æ„é€ ä¸ºNodeç»“ç‚¹</span></span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">//(2)è¿™ä¸€æ­¥æ˜¯å¿«é€Ÿå°†å½“å‰çº¿ç¨‹æ’å…¥é˜Ÿåˆ—å°¾éƒ¨</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//(2-1)å°†æ„é€ åçš„nodeç»“ç‚¹çš„å‰é©±ç»“ç‚¹è®¾ç½®ä¸ºtail</span></span><br><span class="line">        node.prev = pred;</span><br><span class="line">        <span class="comment">//(2-2)ä»¥CASçš„æ–¹å¼è®¾ç½®å½“å‰çš„nodeç»“ç‚¹ä¸ºtailç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">            <span class="comment">//(2-3)CASè®¾ç½®æˆåŠŸï¼Œå°±å°†åŸæ¥çš„tailçš„nextç»“ç‚¹è®¾ç½®ä¸ºå½“å‰çš„nodeç»“ç‚¹ã€‚è¿™æ ·è¿™ä¸ªåŒå‘é˜Ÿ</span></span><br><span class="line">            <span class="comment">//åˆ—å°±æ›´æ–°å®Œæˆäº†</span></span><br><span class="line">            pred.next = node;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//(3)æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜è¦ä¹ˆå½“å‰é˜Ÿåˆ—ä¸ºnullï¼Œè¦ä¹ˆå­˜åœ¨å¤šä¸ªçº¿ç¨‹ç«äº‰å¤±è´¥éƒ½å»å°†è‡ªå·±è®¾ç½®ä¸ºtailç»“ç‚¹ï¼Œ</span></span><br><span class="line">    <span class="comment">//é‚£ä¹ˆå°±ä¼šæœ‰çº¿ç¨‹åœ¨ä¸Šé¢ï¼ˆ2-2ï¼‰çš„CASè®¾ç½®ä¸­å¤±è´¥ï¼Œå°±ä¼šåˆ°è¿™é‡Œè°ƒç”¨enqæ–¹æ³•</span></span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ€»ç»“ä¸€ä¸‹add Waiteræ–¹æ³•</p>
<p>1ã€å°†å½“å‰å°†è¦å»è·å–é”çš„çº¿ç¨‹ä¹Ÿå°±æ˜¯thread2å’Œç‹¬å æ¨¡å¼å°è£…ä¸ºä¸€ä¸ªnodeå¯¹è±¡ã€‚</p>
<p>2ã€å°è¯•å¿«é€Ÿçš„å°†å½“å‰çº¿ç¨‹æ„é€ çš„nodeç»“ç‚¹æ·»åŠ ä½œä¸ºtailç»“ç‚¹(è¿™é‡Œå°±æ˜¯ç›´æ¥è·å–å½“å‰tailï¼Œç„¶åå°†nodeçš„å‰é©±ç»“ç‚¹è®¾ç½®ä¸ºtail)ï¼Œå¹¶ä¸”ä»¥CASçš„æ–¹å¼å°†nodeè®¾ç½®ä¸ºtailç»“ç‚¹(CASæˆåŠŸåå°†åŸtailçš„nextè®¾ç½®ä¸ºnodeï¼Œç„¶åè¿™ä¸ªé˜Ÿåˆ—æ›´æ–°æˆåŠŸ)ã€‚</p>
<p>3ã€å¦‚æœ2è®¾ç½®å¤±è´¥ï¼Œå°±è¿›å…¥enqæ–¹æ³•ã€‚</p>
<p>åœ¨åˆšåˆšçš„thread1å’Œthread2çš„ç¯å¢ƒä¸‹ï¼Œå¼€å§‹æ—¶å€™çº¿ç¨‹é˜»å¡é˜Ÿåˆ—æ˜¯ç©ºçš„(å› ä¸ºthread1è·å–äº†é”ï¼Œthread2ä¹Ÿæ˜¯åˆšåˆšæ¥è¯·æ±‚é”ï¼Œæ‰€ä»¥çº¿ç¨‹é˜»å¡é˜Ÿåˆ—é‡Œé¢æ˜¯ç©ºçš„)ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ—¶å€™é˜Ÿåˆ—çš„å°¾éƒ¨tailèŠ‚ç‚¹ä¹Ÿæ˜¯nullï¼Œé‚£ä¹ˆå°†ç›´æ¥è¿›å…¥åˆ°enqæ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹enqæ–¹æ³•çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">//(4)è¿˜æ˜¯å…ˆè·å–å½“å‰é˜Ÿåˆ—çš„tailç»“ç‚¹</span></span><br><span class="line">        Node t = tail;</span><br><span class="line">        <span class="comment">//(5)å¦‚æœtailä¸ºnullï¼Œè¡¨ç¤ºå½“å‰åŒæ­¥é˜Ÿåˆ—ä¸ºnullï¼Œå°±å¿…é¡»åˆå§‹åŒ–è¿™ä¸ªåŒæ­¥é˜Ÿåˆ—çš„headå’Œtailï¼ˆå»º</span></span><br><span class="line">        <span class="comment">//ç«‹ä¸€ä¸ªå“¨å…µç»“ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="comment">//ï¼ˆ5-1ï¼‰åˆå§‹æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ç«äº‰å¤±è´¥ï¼Œåœ¨æ£€æŸ¥çš„æ—¶å€™éƒ½å‘ç°æ²¡æœ‰å“¨å…µç»“ç‚¹ï¼Œæ‰€ä»¥éœ€è¦CASçš„</span></span><br><span class="line">            <span class="comment">//è®¾ç½®å“¨å…µç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                tail = head;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">//(6)tailä¸ä¸ºnull</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//(6-1)ç›´æ¥å°†å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹è®¾ç½®ä¸ºtailç»“ç‚¹</span></span><br><span class="line">            node.prev = t;</span><br><span class="line">            <span class="comment">//(6-2)å‰é©±ç»“ç‚¹è®¾ç½®å®Œæ¯•ä¹‹åï¼Œè¿˜éœ€è¦ä»¥CASçš„æ–¹å¼å°†è‡ªå·±è®¾ç½®ä¸ºtailç»“ç‚¹ï¼Œå¦‚æœè®¾ç½®å¤±è´¥ï¼Œ</span></span><br><span class="line">            <span class="comment">//å°±ä¼šé‡æ–°è¿›å…¥å¾ªç¯åˆ¤æ–­ä¸€é</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class="line">                t.next = node;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>enqæ–¹æ³•å†…éƒ¨æ˜¯ä¸€ä¸ªè‡ªæ—‹å¾ªç¯ï¼Œç¬¬ä¸€æ¬¡å¾ªç¯é»˜è®¤æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p>1ã€é¦–å…ˆä»£ç å—ï¼ˆ4ï¼‰å¤„å°†tæŒ‡å‘äº†tailï¼Œåˆ¤æ–­å¾—åˆ°t==nullï¼Œå¦‚å›¾(1)æ‰€ç¤ºï¼›</p>
<p>2ã€äºæ˜¯éœ€è¦æ–°å»ºä¸€ä¸ªå“¨å…µç»“ç‚¹ä½œä¸ºæ•´ä¸ªåŒæ­¥é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹(ä»£ç å—5-1å¤„æ‰§è¡Œ)</p>
<p>3ã€å®Œäº†ä¹‹åå¦‚å›¾(2)æ‰€ç¤ºã€‚è¿™æ ·ç¬¬ä¸€æ¬¡å¾ªç¯æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114125.png" alt="img"></p>
<p>ç¬¬äºŒæ¬¡å¾ªç¯æ•´ä½“æ‰§è¡Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p>1ã€è¿˜æ˜¯å…ˆè·å–å½“å‰tailç»“ç‚¹ç„¶åå°†tæŒ‡å‘tailç»“ç‚¹ã€‚å¦‚ä¸‹å›¾çš„(3)</p>
<p>2ã€ç„¶ååˆ¤æ–­å¾—åˆ°å½“å‰t!=nullï¼Œæ‰€ä»¥enqæ–¹æ³•ä¸­è¿›å…¥ä»£ç å—(6).</p>
<p>3ã€åœ¨(6-1)ä»£ç å—ä¸­å°†nodeçš„å‰é©±ç»“ç‚¹è®¾ç½®ä¸ºåŸæ¥é˜Ÿåˆ—çš„tailç»“ç‚¹ï¼Œå¦‚ä¸‹å›¾çš„(4)æ‰€ç¤ºã€‚</p>
<p>4ã€è®¾ç½®å®Œå‰é©±ç»“ç‚¹ä¹‹åï¼Œä»£ç å—(6-2)ä¼šä»¥CASçš„æ–¹å¼å°†å½“å‰çš„nodeç»“ç‚¹è®¾ç½®ä¸ºtailç»“ç‚¹,å¦‚æœè®¾ç½®æˆåŠŸï¼Œå°±ä¼šæ˜¯ä¸‹å›¾(5)æ‰€ç¤ºã€‚æ›´æ–°å®Œtailç»“ç‚¹ä¹‹åï¼Œéœ€è¦ä¿è¯åŒå‘é˜Ÿåˆ—çš„ï¼Œæ‰€ä»¥å°†åŸæ¥çš„æŒ‡å‘å“¨å…µç»“ç‚¹çš„tçš„nextç»“ç‚¹æŒ‡å‘nodeç»“ç‚¹ï¼Œå¦‚ä¸‹å›¾(6)æ‰€ç¤ºã€‚æœ€åè¿”å›</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114131.png" alt="img"></p>
<p>æ€»ç»“æ¥è¯´ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œenqæ–¹æ³•è¿˜æ˜¯èƒ½å¤Ÿä¿è¯æ¯ä¸ªçº¿ç¨‹ç»“ç‚¹ä¼šè¢«å®‰å…¨çš„æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºenqé€šè¿‡CASæ–¹å¼å°†ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¹‹åæ‰ä¼šè¿”å›ï¼Œå¦åˆ™å°±ä¼šä¸æ–­å°è¯•æ·»åŠ (è¿™æ ·å®é™…ä¸Šå°±æ˜¯åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼ŒæŠŠå‘åŒæ­¥é˜Ÿåˆ—æ·»åŠ Nodeå˜å¾—ä¸²è¡ŒåŒ–äº†)</p>
<p>**(4)**åœ¨ä¸Šé¢AQSçš„æ¨¡æ¿æ–¹æ³•ä¸­ï¼Œacquire()æ–¹æ³•è¿˜æœ‰ä¸€æ­¥acquireQueuedï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­å—…æ¢åˆ°è‡ªå·±çš„å‰é©±ç»“ç‚¹ï¼Œå¦‚æœå‰é©±ç»“ç‚¹æ˜¯å¤´èŠ‚ç‚¹çš„è¯å°±ä¼šå°è¯•å–è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦åˆ™ä¼šå…ˆè®¾ç½®è‡ªå·±çš„waitStatusä¸º-1ï¼Œç„¶åè°ƒç”¨LockSupportçš„æ–¹æ³•parkè‡ªå·±ã€‚å…·ä½“çš„å®ç°å¦‚ä¸‹é¢ä»£ç æ‰€ç¤º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//åœ¨è¿™æ ·ä¸€ä¸ªå¾ªç¯ä¸­å°è¯•tryAcquireåŒæ­¥çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">//è·å–å‰é©±ç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="comment">//(1)å¦‚æœå‰é©±ç»“ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼Œå°±å°è¯•å–è·å–åŒæ­¥çŠ¶æ€ï¼Œè¿™é‡Œçš„tryAcquireæ–¹æ³•ç›¸å½“äºè¿˜æ˜¯è°ƒ</span></span><br><span class="line">            <span class="comment">//ç”¨NofairSyncçš„tryAcquireæ–¹æ³•ï¼Œåœ¨ä¸Šé¢å·²ç»è¯´è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                <span class="comment">//å¦‚æœå‰é©±ç»“ç‚¹æ˜¯å¤´èŠ‚ç‚¹å¹¶ä¸”tryAcquireè¿”å›trueï¼Œé‚£ä¹ˆå°±é‡æ–°è®¾ç½®å¤´èŠ‚ç‚¹ä¸ºnode</span></span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">//å°†åŸæ¥çš„å¤´èŠ‚ç‚¹çš„nextè®¾ç½®ä¸ºnullï¼Œäº¤ç”±GCå»å›æ”¶å®ƒ</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//(2)å¦‚æœä¸æ˜¯å¤´èŠ‚ç‚¹,æˆ–è€…è™½ç„¶å‰é©±ç»“ç‚¹æ˜¯å¤´èŠ‚ç‚¹ä½†æ˜¯å°è¯•è·å–åŒæ­¥çŠ¶æ€å¤±è´¥å°±ä¼šå°†nodeç»“ç‚¹</span></span><br><span class="line">            <span class="comment">//çš„waitStatusè®¾ç½®ä¸º-1(SIGNAL),å¹¶ä¸”parkè‡ªå·±ï¼Œç­‰å¾…å‰é©±ç»“ç‚¹çš„å”¤é†’ã€‚è‡³äºå”¤é†’çš„ç»†èŠ‚</span></span><br><span class="line">            <span class="comment">//ä¸‹é¢ä¼šè¯´åˆ°</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªè‡ªæ—‹å¾ªç¯ï¼Œç»§ç»­æŒ‰ç…§åˆšåˆšçš„thread1å’Œthread2è¿™ä¸ªæƒ…å†µåˆ†æã€‚åœ¨enqæ–¹æ³•æ‰§è¡Œå®Œä¹‹åï¼ŒåŒæ­¥é˜Ÿåˆ—çš„æƒ…å†µå¤§æ¦‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114138.png" alt="img"></p>
<p>å½“å‰çš„nodeç»“ç‚¹çš„å‰é©±ç»“ç‚¹ä¸ºheadï¼Œæ‰€ä»¥ä¼šè°ƒç”¨tryAcquire()æ–¹æ³•å»è·å¾—åŒæ­¥çŠ¶æ€ã€‚ä½†æ˜¯ç”±äºstateè¢«thread1å æœ‰ï¼Œæ‰€ä»¥tryAcquireå¤±è´¥ã€‚è¿™é‡Œå°±æ˜¯æ‰§è¡ŒacquireQueuedæ–¹æ³•çš„ä»£ç å—(2)äº†ã€‚ä»£ç å—(2)ä¸­é¦–å…ˆè°ƒç”¨äº†shouldParkAfterFailedAcquireæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†åŒæ­¥é˜Ÿåˆ—ä¸­nodeç»“ç‚¹çš„å‰é©±ç»“ç‚¹çš„waitStatusä¸ºCANCELLEDçš„çº¿ç¨‹ç§»é™¤ï¼Œå¹¶å°†å½“å‰è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹æ‰€å±ç»“ç‚¹è‡ªå·±å’Œä»–çš„å‰é©±ç»“ç‚¹çš„waitStatusè®¾ç½®ä¸º-1(SIGNAL)ï¼Œç„¶åè¿”å›ã€‚å…·ä½“æ–¹æ³•å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ï¼ˆ1ï¼‰è·å–å‰é©±ç»“ç‚¹çš„waitStatus</span></span><br><span class="line">    <span class="keyword">int</span> ws = pred.waitStatus;</span><br><span class="line">    <span class="comment">//ï¼ˆ2ï¼‰å¦‚æœå‰é©±ç»“ç‚¹çš„waitStatusä¸ºSINGNALï¼Œå°±ç›´æ¥è¿”å›true</span></span><br><span class="line">    <span class="keyword">if</span> (ws == Node.SIGNAL)</span><br><span class="line">        <span class="comment">//å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALï¼Œé‚£ä¹ˆè¯¥ç»“ç‚¹å°±èƒ½å¤Ÿå®‰å…¨çš„è°ƒç”¨parkæ–¹æ³•é˜»å¡è‡ªå·±äº†ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (ws &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//ï¼ˆ3ï¼‰è¿™é‡Œå°±æ˜¯å°†æ‰€æœ‰çš„å‰é©±ç»“ç‚¹çŠ¶æ€ä¸ºCANCELLEDçš„éƒ½ç§»é™¤</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            node.prev = pred = pred.prev;</span><br><span class="line">        &#125; <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>);</span><br><span class="line">        pred.next = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//CASæ“ä½œå°†è¿™ä¸ªå‰é©±èŠ‚ç‚¹è®¾ç½®æˆSIGHNALã€‚</span></span><br><span class="line">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥shouldParkAfterFailedAcquireæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç°åœ¨çš„åŒæ­¥é˜Ÿåˆ—æƒ…å†µå¤§æ¦‚å°±æ˜¯è¿™æ ·å­ï¼Œå³å“¨å…µç»“ç‚¹çš„waitStatuså€¼å˜ä¸º-1ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114141.png" alt="img"></p>
<p>ä¸Šé¢çš„æ‰§è¡Œå®Œæ¯•è¿”å›åˆ°acquireQueuedæ–¹æ³•çš„æ—¶å€™ï¼Œåœ¨acquireQueuedæ–¹æ³•ä¸­å°±ä¼šè¿›è¡Œç¬¬äºŒæ¬¡å¾ªç¯äº†ï¼Œä½†æ˜¯è¿˜æ˜¯è·å–stateå¤±è´¥ï¼Œè€Œå½“å†æ¬¡è¿›å…¥shouldParkAfterFailedAcquireæ–¹æ³•çš„æ—¶å€™ï¼Œå½“å‰ç»“ç‚¹nodeçš„å‰é©±ç»“ç‚¹headçš„waitStatuså·²ç»ä¸º-1(SIGNAL)äº†ï¼Œå°±ä¼šè¿”å›trueï¼Œç„¶åacquireQueuedæ–¹æ³•ä¸­å°±ä¼šæ¥ç€æ‰§è¡ŒparkAndCheckInterruptå°†è‡ªå·±parké˜»å¡æŒ‚èµ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**(5)**æˆ‘ä»¬æ¢³ç†ä¸€ä¸‹æ•´ä¸ªæ–¹æ³•è°ƒç”¨çš„æµç¨‹ï¼Œå‡è®¾ç°åœ¨åˆæœ‰ä¸€ä¸ªthread3çº¿ç¨‹ç«äº‰è¿™ä¸ªstateï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ã€‚</p>
<p>â‘ é¦–å…ˆè‚¯å®šæ˜¯è°ƒç”¨**ReentrantLock.lock()**æ–¹æ³•å»å°è¯•åŠ é”;</p>
<p>â‘¡å› ä¸ºæ˜¯éå…¬å¹³é”ï¼Œæ‰€ä»¥å°±ä¼šè½¬åˆ°è°ƒç”¨**NoFairSync.lock()**æ–¹æ³•;</p>
<p>â‘¢åœ¨NoFairSync.lock()æ–¹æ³•ä¸­ï¼Œä¼šé¦–å…ˆå°è¯•è®¾ç½®stateçš„å€¼ï¼Œå› ä¸ºå·²ç»è¢«å æœ‰é‚£ä¹ˆè‚¯å®šå°±æ˜¯å¤±è´¥çš„ã€‚è¿™æ—¶å€™å°±ä¼šè°ƒç”¨AQSçš„æ¨¡æ¿æ–¹æ³•<strong>AQS.acquire(1)</strong>ã€‚</p>
<p>â‘£åœ¨AQSçš„æ¨¡æ¿æ–¹æ³•acquire(1)ä¸­ï¼Œå®é™…é¦–å…ˆä¼šè°ƒç”¨çš„æ˜¯å­ç±»çš„tryAcquire()æ–¹æ³•ï¼Œè€Œåœ¨éå…¬å¹³é”çš„å®ç°ä¸­å³**Sync.nofairTryAcquire()**æ–¹æ³•ã€‚</p>
<p>â‘¤æ˜¾ç„¶tryAcquire()ä¼šè¿”å›falseï¼Œæ‰€ä»¥acquire()ç»§ç»­æ‰§è¡Œï¼Œå³è°ƒç”¨<strong>AQS.addWaiter()</strong>ï¼Œå°±ä¼šå°†å½“å‰çº¿ç¨‹æ„é€ ç§°ä¸ºä¸€ä¸ªNodeç»“ç‚¹,åˆå§‹çŠ¶å†µä¸‹waitStatusä¸º0ã€‚</p>
<p>â‘¥åœ¨addWaiteræ–¹æ³•ä¸­ï¼Œä¼šé¦–å…ˆå°è¯•ç›´æ¥å°†æ„å»ºçš„nodeç»“ç‚¹ä»¥CASçš„æ–¹å¼(å­˜åœ¨å¤šä¸ªçº¿ç¨‹å°è¯•å°†è‡ªå·±è®¾ç½®ä¸ºtail)è®¾ç½®ä¸ºtailç»“ç‚¹ï¼Œå¦‚æœè®¾ç½®æˆåŠŸå°±ç›´æ¥è¿”å›ï¼Œå¤±è´¥çš„è¯å°±ä¼šè¿›å…¥ä¸€ä¸ªè‡ªæ—‹å¾ªç¯çš„è¿‡ç¨‹ã€‚å³è°ƒç”¨**enq()**æ–¹æ³•ã€‚æœ€ç»ˆä¿è¯è‡ªå·±æˆåŠŸè¢«æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚</p>
<p>â‘¦åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä¹‹åï¼Œå°±éœ€è¦å°†è‡ªå·±æŒ‚èµ·æˆ–è€…å—…æ¢è‡ªå·±çš„å‰é©±ç»“ç‚¹æ˜¯å¦ä¸ºå¤´ç»“ç‚¹ä»¥ä¾¿å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚å³è°ƒç”¨**acquireQueued()**æ–¹æ³•ã€‚</p>
<p>â‘§åœ¨è¿™é‡Œthread3çš„å‰é©±ç»“ç‚¹ä¸æ˜¯headç»“ç‚¹ï¼Œæ‰€ä»¥å°±ç›´æ¥è°ƒç”¨**shouldParkAfterFailedAcquire()**æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä¼šå°†åˆšåˆšçš„thread2çº¿ç¨‹ç»“ç‚¹ä¸­çš„waitStatueçš„å€¼æ”¹å˜ä¸º-1(åˆå§‹çš„æ—¶å€™æ˜¯æ²¡æœ‰æ”¹å˜è¿™ä¸ªwaitStatusçš„ï¼Œæ¯ä¸ªæ–°èŠ‚ç‚¹çš„æ·»åŠ å°±ä¼šæ”¹å˜å‰é©±ç»“ç‚¹çš„waitStatuså€¼)ã€‚</p>
<p>â‘¨thread2æ‰€åœ¨ç»“ç‚¹çš„waitStatusæ”¹å˜åï¼ŒshouldParkAfterFailedAcquireæ–¹æ³•ä¼šè¿”å›falseã€‚æ‰€ä»¥ä¹‹åè¿˜ä¼šåœ¨acquireQueuedä¸­è¿›è¡Œç¬¬äºŒæ¬¡å¾ªç¯ã€‚å¹¶å†æ¬¡è°ƒç”¨shouldParkAfterFailedAcquireæ–¹æ³•ï¼Œç„¶åè¿”å›trueã€‚æœ€ç»ˆè°ƒç”¨**parkAndCheckInterrupt()**å°†è‡ªå·±æŒ‚èµ·ã€‚</p>
<p>æ¯ä¸ªçº¿ç¨‹å»ç«äº‰è¿™ä¸ªåŒæ­¥çŠ¶æ€å¤±è´¥çš„è¯å¤§æ¦‚å°±ä¼šç»å†ä¸Šé¢çš„è¿™äº›è¿‡ç¨‹ã€‚å‡è®¾ç°åœ¨thread3ç»å†ä¸Šé¢è¿™äº›è¿‡ç¨‹ä¹‹åä¹Ÿè¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ•´ä¸ªåŒæ­¥é˜Ÿåˆ—å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·äº†.</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114215.png" alt="image-20210223114214953"></p>
<p>å°†ä¸Šé¢çš„æµç¨‹æ•´ç†ä¸€ä¸‹å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™ä¸ªå›¾</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114151.png" alt="img"></p>
<h3 id="éå…¬å¹³é”çš„é‡Šæ”¾æµç¨‹">éå…¬å¹³é”çš„é‡Šæ”¾æµç¨‹</h3>
<p>ä¸Šé¢è¯´ä¸€ReentrantLockä¸ºä¾‹åˆ°äº†æ€æ ·å»è·å¾—éå…¬å¹³é”ï¼Œé‚£ä¹ˆthread1è·å–é”ï¼Œæ‰§è¡Œå®Œé‡Šæ”¾é”çš„æµç¨‹æ˜¯æ€æ ·çš„å‘¢ã€‚é¦–å…ˆè‚¯å®šæ˜¯åœ¨finallyä¸­è°ƒç”¨ReentrantLock.unlock()æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»è¿™ä¸ªæ–¹æ³•å¼€å§‹çœ‹èµ·ã€‚</p>
<p>**(1)**ä»ä¸‹é¢çš„unlockæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨AQSçš„release()æ–¹æ³•ï¼Œå…¶ä¸­ä¼ é€’çš„å‚æ•°ä¸º1ï¼Œè¡¨ç¤ºæ¯ä¸€æ¬¡è°ƒç”¨unlockæ–¹æ³•éƒ½æ˜¯é‡Šæ”¾æ‰€è·å¾—çš„ä¸€æ¬¡stateã€‚é‡å…¥çš„æƒ…å†µä¸‹ä¼šå¤šæ¬¡è°ƒç”¨unlockæ–¹æ³•ï¼Œä¹Ÿä¿è¯äº†lockå’Œunlockæ˜¯æˆå¯¹çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sync.release(<span class="number">1</span>); <span class="comment">//è¿™é‡ŒReentrantLockçš„unlockæ–¹æ³•è°ƒç”¨äº†AQSçš„releaseæ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//è¿™é‡Œè°ƒç”¨äº†å­ç±»çš„tryReleaseæ–¹æ³•ï¼Œå³ReentrantLockçš„å†…éƒ¨ç±»Syncçš„tryReleaseæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**(2)**ä¸Šé¢çœ‹åˆ°releaseæ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨ReentrantLockçš„å†…éƒ¨ç±»Syncçš„tryReleaseæ–¹æ³•ã€‚è€Œé€šè¿‡ä¸‹é¢ä»£ç çš„åˆ†æï¼Œå¤§æ¦‚çŸ¥é“tryReleaseåšäº†è¿™äº›äº‹æƒ…ã€‚</p>
<p>â‘ è·å–å½“å‰AQSçš„stateï¼Œå¹¶å‡å»1ï¼›</p>
<p>â‘¡åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ç­‰äºAQSçš„exclusiveOwnerThreadï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±æŠ›IllegalMonitorStateExceptionå¼‚å¸¸ï¼Œè¿™å°±ä¿è¯äº†åŠ é”å’Œé‡Šæ”¾é”å¿…é¡»æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼›</p>
<p>â‘¢å¦‚æœ(state-1)çš„ç»“æœä¸ä¸º0ï¼Œè¯´æ˜é”è¢«é‡å…¥äº†ï¼Œéœ€è¦å¤šæ¬¡unlockï¼Œè¿™ä¹Ÿæ˜¯lockå’Œunlockæˆå¯¹çš„åŸå› ï¼›</p>
<p>â‘£å¦‚æœ(state-1)ç­‰äº0ï¼Œæˆ‘ä»¬å°±å°†AQSçš„ExclusiveOwnerThreadè®¾ç½®ä¸ºnullï¼›</p>
<p>â‘¤å¦‚æœä¸Šè¿°æ“ä½œæˆåŠŸäº†ï¼Œä¹Ÿå°±æ˜¯tryRelaseæ–¹æ³•è¿”å›äº†trueï¼›è¿”å›falseè¡¨ç¤ºéœ€è¦å¤šæ¬¡unlockã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ï¼ˆ1ï¼‰è·å–å½“å‰çš„stateï¼Œç„¶åå‡1ï¼Œå¾—åˆ°è¦æ›´æ–°çš„state</span></span><br><span class="line">    <span class="keyword">int</span> c = getState() - releases;</span><br><span class="line">    <span class="comment">//ï¼ˆ2ï¼‰åˆ¤æ–­å½“å‰è°ƒç”¨çš„çº¿ç¨‹æ˜¯ä¸æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯æŠ›å‡ºIllegalMonitorStateException</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">    <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//ï¼ˆ3ï¼‰åˆ¤æ–­æ›´æ–°åçš„stateæ˜¯ä¸æ˜¯0</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">        free = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">//ï¼ˆ3-1ï¼‰å°†å½“å‰é”æŒè€…è®¾ä¸ºnull</span></span><br><span class="line">        setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ï¼ˆ4ï¼‰è®¾ç½®å½“å‰state=c=getState()-releases</span></span><br><span class="line">    setState(c);</span><br><span class="line">    <span class="comment">//ï¼ˆ5ï¼‰åªæœ‰state==0ï¼Œæ‰ä¼šè¿”å›true</span></span><br><span class="line">    <span class="keyword">return</span> free;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**(3)**é‚£ä¹ˆå½“tryReleaseè¿”å›trueä¹‹åï¼Œå°±ä¼šæ‰§è¡Œreleaseæ–¹æ³•ä¸­ifè¯­å¥å—ä¸­çš„å†…å®¹ã€‚ä»ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">    <span class="comment">//ï¼ˆ1ï¼‰è·å–å½“å‰é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹head</span></span><br><span class="line">    Node h = head;</span><br><span class="line">    <span class="comment">//ï¼ˆ2ï¼‰åˆ¤æ–­å¤´èŠ‚ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´ç»“ç‚¹çš„waitStatusä¸ä¸º0(CACCELLED)</span></span><br><span class="line">    <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//ï¼ˆ3-1ï¼‰è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•å”¤é†’åŒæ­¥é˜Ÿåˆ—headç»“ç‚¹çš„åç»§ç»“ç‚¹ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">        unparkSuccessor(h);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**(4)**åœ¨è·å–é”çš„æµç¨‹åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å½“å‰åŒæ­¥é˜Ÿåˆ—å¦‚ä¸‹æ‰€ç¤ºï¼Œæ‰€ä»¥åˆ¤æ–­å¾—åˆ°head!=nullå¹¶ä¸”headçš„waitStatus=-1ã€‚æ‰€ä»¥ä¼šæ‰§è¡ŒunparkSuccessoræ–¹æ³•ï¼Œä¼ é€’çš„å‚æ•°ä¸ºæŒ‡å‘headçš„ä¸€ä¸ªå¼•ç”¨h.é‚£ä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹unparkSuccessoræ–¹æ³•ä¸­å¤„ç†äº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114221.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ï¼ˆ1ï¼‰è·å¾—nodeçš„waitStatus</span></span><br><span class="line">    <span class="keyword">int</span> ws = node.waitStatus;</span><br><span class="line">    <span class="comment">//ï¼ˆ2ï¼‰åˆ¤æ–­waitStatusæ˜¯å¦å°äº0</span></span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//ï¼ˆ2-1ï¼‰å¦‚æœwaitStatuså°äº0éœ€è¦å°†å…¶ä»¥CASçš„æ–¹å¼è®¾ç½®ä¸º0</span></span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ï¼ˆ2ï¼‰è·å¾—sçš„åç»§ç»“ç‚¹ï¼Œè¿™é‡Œå³headçš„åç»§ç»“ç‚¹</span></span><br><span class="line">    Node s = node.next;</span><br><span class="line">    <span class="comment">//ï¼ˆ3ï¼‰åˆ¤æ–­åç»§ç»“ç‚¹æ˜¯å¦å·²ç»è¢«ç§»é™¤ï¼Œæˆ–è€…å…¶waitStatus==CANCELLED</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//ï¼ˆ3-1ï¼‰å¦‚æœsï¼=nullï¼Œä½†æ˜¯å…¶waitStatus=CANCELLEDéœ€è¦å°†å…¶è®¾ç½®ä¸ºnull</span></span><br><span class="line">        s = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//ï¼ˆ3-2ï¼‰ä¼šä»å°¾éƒ¨ç»“ç‚¹å¼€å§‹å¯»æ‰¾ï¼Œæ‰¾åˆ°ç¦»headæœ€è¿‘çš„ä¸ä¸ºnullå¹¶ä¸”node.waitStatusçš„ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ï¼ˆ4ï¼‰node.next!=nullæˆ–è€…æ‰¾åˆ°çš„ä¸€ä¸ªç¦»headæœ€è¿‘çš„ç»“ç‚¹ä¸ä¸ºnull</span></span><br><span class="line">    <span class="keyword">if</span> (s != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">//ï¼ˆ4-1ï¼‰å”¤é†’è¿™ä¸ªç»“ç‚¹ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç å®ç°ä¸­å¯ä»¥æ€»ç»“ï¼ŒunparkSuccessorä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…:</p>
<p>â‘ è·å–headèŠ‚ç‚¹çš„waitStatusï¼Œå¦‚æœå°äº0ï¼Œå°±é€šè¿‡CASæ“ä½œå°†headèŠ‚ç‚¹çš„waitStatusä¿®æ”¹ä¸º0</p>
<p>â‘¡å¯»æ‰¾headèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹çš„waitStatuså°äº0ï¼Œå°±å”¤é†’è¿™ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™éå†ä¸‹å»ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªwaitStatus&lt;=0çš„èŠ‚ç‚¹ï¼Œå¹¶å”¤é†’ã€‚</p>
<p>**(5)**ä¸‹é¢æˆ‘ä»¬åº”è¯¥åˆ†æçš„æ˜¯é‡Šæ”¾æ‰stateä¹‹åï¼Œå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç»“ç‚¹ä¹‹åç¨‹åºåˆæ˜¯æ˜¯æ€æ ·æ‰§è¡Œçš„ã€‚æŒ‰ç…§ä¸Šé¢çš„åŒæ­¥é˜Ÿåˆ—ç¤ºæ„å›¾ï¼Œé‚£ä¹ˆä¸‹é¢ä¼šæ‰§è¡Œè¿™äº›</p>
<p><strong>â‘ </strong>thread1(è·å–åˆ°é”çš„çº¿ç¨‹)è°ƒç”¨unlockæ–¹æ³•ä¹‹åï¼Œæœ€ç»ˆæ‰§è¡Œåˆ°unparkSuccessoræ–¹æ³•ä¼šå”¤é†’thread2ç»“ç‚¹ã€‚<strong>æ‰€ä»¥thread2è¢«unpark</strong>ã€‚</p>
<p><strong>â‘¡</strong>å†å›æƒ³ä¸€ä¸‹ï¼Œå½“æ—¶thread2æ˜¯åœ¨è°ƒç”¨acquireQueuedæ–¹æ³•ä¹‹åçš„parkAndCheckInterrupté‡Œé¢è¢«parké˜»å¡æŒ‚èµ·äº†ï¼Œæ‰€ä»¥thread2è¢«å”¤é†’ä¹‹å<strong>ç»§ç»­æ‰§è¡ŒacquireQueuedæ–¹æ³•ä¸­çš„forå¾ªç¯</strong>ï¼ˆåˆ°è¿™é‡Œå¯ä»¥å¾€å‰å›å¿†çœ‹ä¸€ä¸‹acquireQueuedæ–¹æ³•ä¸­çš„forå¾ªç¯åšäº†å“ªäº›äº‹æƒ…ï¼‰ï¼›</p>
<p><strong>â‘¢</strong>forå¾ªç¯ä¸­åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯<strong>æŸ¥çœ‹è‡ªå·±çš„å‰é©±ç»“ç‚¹æ˜¯ä¸æ˜¯å¤´ç»“ç‚¹</strong>ï¼ˆæŒ‰ç…§ä¸Šé¢çš„åŒæ­¥é˜Ÿåˆ—æƒ…å†µæ˜¯æ»¡è¶³çš„ï¼‰ï¼›</p>
<p><strong>â‘£</strong>å‰é©±ç»“ç‚¹æ˜¯headç»“ç‚¹ï¼Œå°±ä¼š<strong>è°ƒç”¨tryAcquireæ–¹æ³•å°è¯•è·å–state</strong>ï¼Œå› ä¸ºthread1å·²ç»é‡Šæ”¾äº†stateï¼Œå³state=0ï¼Œæ‰€ä»¥thread2è°ƒç”¨tryAcquireæ–¹æ³•æ—¶å€™ï¼Œä»¥<strong>CASçš„æ–¹å¼å»å°†stateä»0æ›´æ–°ä¸º1æ˜¯æˆåŠŸçš„</strong>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™<strong>thread2å°±è·å–åˆ°äº†é”</strong></p>
<p><strong>â‘¤</strong>thread2è·å–stateæˆåŠŸï¼Œå°±ä¼šä»acquireQueuedæ–¹æ³•ä¸­é€€å‡ºã€‚æ³¨æ„è¿™æ—¶å€™çš„acquireQueuedè¿”å›å€¼ä¸ºfalseï¼Œæ‰€ä»¥åœ¨AQSçš„æ¨¡æ¿æ–¹æ³•çš„acquireä¸­ä¼šç›´æ¥ä»ifæ¡ä»¶é€€å‡ºï¼Œæœ€åæ‰§è¡Œè‡ªå·±é”ä½çš„ä»£ç å—ä¸­çš„ç¨‹åºã€‚</p>
<h3 id="varhandle">varhandle</h3>
<p>jdk1.9æ–°å¢çš„ï¼Œå¯ä»¥å®ç°åŸå­æ€§æ“ä½œ</p>
<p>åŸæ–‡åœ°å€ï¼š<a href="https://www.cnblogs.com/fsmly/p/11274572.html#_labelTop">https://www.cnblogs.com/fsmly/p/11274572.html#_labelTop</a></p>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®â€”â€”Zabç®—æ³•</title>
    <url>/posts/b369a3b6/</url>
    <content><![CDATA[<h1>Zabç®—æ³•æè¿°</h1>
<p>Zabåè®® çš„å…¨ç§°æ˜¯ <strong>Zookeeper Atomic Broadcast</strong> ï¼ˆZookeeperåŸå­å¹¿æ’­ï¼‰ã€‚</p>
<p><strong>Zookeeper æ˜¯é€šè¿‡ Zab åè®®æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p>
<ol>
<li>Zabåè®®æ˜¯ä¸ºåˆ†å¸ƒå¼åè°ƒæœåŠ¡Zookeeperä¸“é—¨è®¾è®¡çš„ä¸€ç§ <strong>æ”¯æŒå´©æºƒæ¢å¤</strong> çš„ <strong>åŸå­å¹¿æ’­åè®®</strong> ï¼Œæ˜¯Zookeeperä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒç®—æ³•ã€‚Zabå€Ÿé‰´äº†Paxosç®—æ³•ï¼Œä½†åˆä¸åƒPaxosé‚£æ ·ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‚<strong>å®ƒæ˜¯ç‰¹åˆ«ä¸ºZookeeperè®¾è®¡çš„æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®</strong>ã€‚</li>
<li>åœ¨Zookeeperä¸­ä¸»è¦ä¾èµ–Zabåè®®æ¥å®ç°æ•°æ®ä¸€è‡´æ€§ï¼ŒåŸºäºè¯¥åè®®ï¼Œzkå®ç°äº†ä¸€ç§ä¸»å¤‡æ¨¡å‹ï¼ˆå³Leaderå’ŒFolloweræ¨¡å‹ï¼‰çš„ç³»ç»Ÿæ¶æ„æ¥ä¿è¯é›†ç¾¤ä¸­å„ä¸ªå‰¯æœ¬ä¹‹é—´æ•°æ®çš„ä¸€è‡´æ€§ã€‚<br>
è¿™é‡Œçš„ä¸»å¤‡ç³»ç»Ÿæ¶æ„æ¨¡å‹ï¼Œå°±æ˜¯æŒ‡åªæœ‰ä¸€å°å®¢æˆ·ç«¯ï¼ˆLeaderï¼‰è´Ÿè´£å¤„ç†å¤–éƒ¨çš„å†™äº‹åŠ¡è¯·æ±‚ï¼Œç„¶åLeaderå®¢æˆ·ç«¯å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–FollowerèŠ‚ç‚¹ã€‚</li>
</ol>
<p>Zookeeper å®¢æˆ·ç«¯ä¼šéšæœºçš„é“¾æ¥åˆ° zookeeper é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯<font color=red>è¯»è¯·æ±‚ï¼Œå°±ç›´æ¥ä»å½“å‰èŠ‚ç‚¹ä¸­è¯»å–æ•°æ®ï¼›å¦‚æœæ˜¯å†™è¯·æ±‚ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°±ä¼šå‘ Leader æäº¤äº‹åŠ¡ï¼ŒLeader æ¥æ”¶åˆ°äº‹åŠ¡æäº¤ï¼Œä¼šå¹¿æ’­è¯¥äº‹åŠ¡ï¼Œåªè¦è¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œè¯¥äº‹åŠ¡å°±ä¼šè¢«æäº¤</font>ã€‚</p>
<h1><strong>Zab åè®®çš„ç‰¹æ€§</strong>ï¼š</h1>
<p>1ï¼‰Zab åè®®éœ€è¦ç¡®ä¿é‚£äº›<strong>å·²ç»åœ¨ Leader æœåŠ¡å™¨ä¸Šæäº¤ï¼ˆCommitï¼‰çš„äº‹åŠ¡æœ€ç»ˆè¢«æ‰€æœ‰çš„æœåŠ¡å™¨æäº¤</strong>ã€‚</p>
<p>2ï¼‰Zab åè®®éœ€è¦ç¡®ä¿<strong>ä¸¢å¼ƒé‚£äº›åªåœ¨ Leader ä¸Šè¢«æå‡ºè€Œæ²¡æœ‰è¢«æäº¤çš„äº‹åŠ¡</strong>ã€‚</p>
<h1>Zab åè®®çš„ä½œç”¨</h1>
<ol>
<li>
<p><strong>ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„ä¸»è¿›ç¨‹ï¼ˆLeaderï¼‰æ¥æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚</strong>ï¼ˆä¹Ÿå°±æ˜¯å†™è¯·æ±‚ï¼‰ï¼Œå¹¶é‡‡ç”¨äº†Zabçš„åŸå­å¹¿æ’­åè®®ï¼Œå°†æœåŠ¡å™¨æ•°æ®çš„çŠ¶æ€å˜æ›´ä»¥ <strong>äº‹åŠ¡proposal</strong> ï¼ˆäº‹åŠ¡æè®®ï¼‰çš„å½¢å¼å¹¿æ’­åˆ°æ‰€æœ‰çš„å‰¯æœ¬ï¼ˆFollowerï¼‰è¿›ç¨‹ä¸Šå»ã€‚</p>
</li>
<li>
<p><strong>ä¿è¯ä¸€ä¸ªå…¨å±€çš„å˜æ›´åºåˆ—è¢«é¡ºåºå¼•ç”¨</strong>ã€‚<br>
Zookeeperæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œå¾ˆå¤šæ“ä½œéƒ½è¦å…ˆæ£€æŸ¥æ‰èƒ½ç¡®å®šæ˜¯å¦å¯ä»¥æ‰§è¡Œï¼Œæ¯”å¦‚P1çš„äº‹åŠ¡t1å¯èƒ½æ˜¯åˆ›å»ºèŠ‚ç‚¹&quot;/a&quot;ï¼Œt2å¯èƒ½æ˜¯åˆ›å»ºèŠ‚ç‚¹&quot;/a/bb&quot;ï¼Œåªæœ‰å…ˆåˆ›å»ºäº†çˆ¶èŠ‚ç‚¹&quot;/a&quot;ï¼Œæ‰èƒ½åˆ›å»ºå­èŠ‚ç‚¹&quot;/a/b&quot;ã€‚</p>
<p>ä¸ºäº†ä¿è¯è¿™ä¸€ç‚¹ï¼ŒZabè¦ä¿è¯åŒä¸€ä¸ªLeaderå‘èµ·çš„äº‹åŠ¡è¦æŒ‰é¡ºåºè¢«applyï¼ŒåŒæ—¶è¿˜è¦ä¿è¯åªæœ‰å…ˆå‰Leaderçš„äº‹åŠ¡è¢«applyä¹‹åï¼Œæ–°é€‰ä¸¾å‡ºæ¥çš„Leaderæ‰èƒ½å†æ¬¡å‘èµ·äº‹åŠ¡ã€‚</p>
</li>
<li>
<p><strong>å½“ä¸»è¿›ç¨‹å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œæ•´ä¸ªzké›†ç¾¤ä¾æ—§èƒ½æ­£å¸¸å·¥ä½œ</strong>ã€‚</p>
</li>
</ol>
<h2 id="Zabåè®®åŸç†">Zabåè®®åŸç†</h2>
<p>Zabåè®®è¦æ±‚æ¯ä¸ª Leader éƒ½è¦ç»å†ä¸‰ä¸ªé˜¶æ®µï¼š<strong>å‘ç°ï¼ŒåŒæ­¥ï¼Œå¹¿æ’­</strong>ã€‚</p>
<ul>
<li><strong>å‘ç°</strong>ï¼šè¦æ±‚zookeeperé›†ç¾¤å¿…é¡»é€‰ä¸¾å‡ºä¸€ä¸ª Leader è¿›ç¨‹ï¼ŒåŒæ—¶ Leader ä¼šç»´æŠ¤ä¸€ä¸ª Follower å¯ç”¨å®¢æˆ·ç«¯åˆ—è¡¨ã€‚å°†æ¥å®¢æˆ·ç«¯å¯ä»¥å’Œè¿™äº› FollowerèŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚</li>
<li><strong>åŒæ­¥</strong>ï¼šLeader è¦è´Ÿè´£å°†æœ¬èº«çš„æ•°æ®ä¸ Follower å®ŒæˆåŒæ­¥ï¼Œåšåˆ°å¤šå‰¯æœ¬å­˜å‚¨ã€‚è¿™æ ·ä¹Ÿæ˜¯æç°äº†CAPä¸­çš„é«˜å¯ç”¨å’Œåˆ†åŒºå®¹é”™ã€‚Followerå°†é˜Ÿåˆ—ä¸­æœªå¤„ç†å®Œçš„è¯·æ±‚æ¶ˆè´¹å®Œæˆåï¼Œå†™å…¥æœ¬åœ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚</li>
<li><strong>å¹¿æ’­</strong>ï¼šLeader å¯ä»¥æ¥å—å®¢æˆ·ç«¯æ–°çš„äº‹åŠ¡Proposalè¯·æ±‚ï¼Œå°†æ–°çš„Proposalè¯·æ±‚å¹¿æ’­ç»™æ‰€æœ‰çš„ Followerã€‚</li>
</ul>
<h2 id="Zabåè®®æ ¸å¿ƒ">Zabåè®®æ ¸å¿ƒ</h2>
<p>Zabåè®®çš„æ ¸å¿ƒï¼š<strong>å®šä¹‰äº†äº‹åŠ¡è¯·æ±‚çš„å¤„ç†æ–¹å¼</strong></p>
<p>1ï¼‰æ‰€æœ‰çš„äº‹åŠ¡è¯·æ±‚å¿…é¡»ç”±ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æœåŠ¡å™¨æ¥åè°ƒå¤„ç†ï¼Œè¿™æ ·çš„æœåŠ¡å™¨è¢«å«åš <strong>LeaderæœåŠ¡å™¨</strong>ã€‚å…¶ä»–å‰©ä½™çš„æœåŠ¡å™¨åˆ™æ˜¯ <strong>FolloweræœåŠ¡å™¨</strong>ã€‚</p>
<p>2ï¼‰LeaderæœåŠ¡å™¨ è´Ÿè´£å°†ä¸€ä¸ªå®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚ï¼Œè½¬æ¢æˆä¸€ä¸ª <strong>äº‹åŠ¡Proposal</strong>ï¼Œå¹¶å°†è¯¥ Proposal åˆ†å‘ç»™é›†ç¾¤ä¸­æ‰€æœ‰çš„ Follower æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯å‘æ‰€æœ‰ Follower èŠ‚ç‚¹å‘é€æ•°æ®å¹¿æ’­è¯·æ±‚ï¼ˆæˆ–æ•°æ®å¤åˆ¶ï¼‰</p>
<p>3ï¼‰åˆ†å‘ä¹‹åLeaderæœåŠ¡å™¨éœ€è¦ç­‰å¾…æ‰€æœ‰FolloweræœåŠ¡å™¨çš„åé¦ˆï¼ˆAckè¯·æ±‚ï¼‰ï¼Œ<strong>åœ¨Zabåè®®ä¸­ï¼Œåªè¦è¶…è¿‡åŠæ•°çš„FolloweræœåŠ¡å™¨è¿›è¡Œäº†æ­£ç¡®çš„åé¦ˆ</strong>åï¼ˆä¹Ÿå°±æ˜¯æ”¶åˆ°åŠæ•°ä»¥ä¸Šçš„Followerçš„Ackè¯·æ±‚ï¼‰ï¼Œé‚£ä¹ˆ Leader å°±ä¼šå†æ¬¡å‘æ‰€æœ‰çš„ FolloweræœåŠ¡å™¨å‘é€ Commit æ¶ˆæ¯ï¼Œè¦æ±‚å…¶å°†ä¸Šä¸€ä¸ª äº‹åŠ¡proposal è¿›è¡Œæäº¤ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302165537.png" alt="image-20210302165537904"></p>
<h2 id="Zabåè®®å†…å®¹">Zabåè®®å†…å®¹</h2>
<p>Zab åè®®åŒ…æ‹¬ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼š<strong>å´©æºƒæ¢å¤</strong> å’Œ <strong>æ¶ˆæ¯å¹¿æ’­</strong></p>
<h3 id="Zabåè®®å†…å®¹-2">Zabåè®®å†…å®¹</h3>
<h4 id="åè®®è¿‡ç¨‹">åè®®è¿‡ç¨‹</h4>
<p>å½“æ•´ä¸ªé›†ç¾¤å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ–è€…å½“ Leader æœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­å¼„æ–­ã€å´©æºƒé€€å‡ºæˆ–é‡å¯ç­‰å¼‚å¸¸æ—¶ï¼ŒZabåè®®å°±ä¼š <strong>è¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼</strong>ï¼Œé€‰ä¸¾äº§ç”Ÿæ–°çš„Leaderã€‚</p>
<p>å½“é€‰ä¸¾äº§ç”Ÿäº†æ–°çš„ Leaderï¼ŒåŒæ—¶é›†ç¾¤ä¸­æœ‰è¿‡åŠçš„æœºå™¨ä¸è¯¥ Leader æœåŠ¡å™¨å®Œæˆäº†çŠ¶æ€åŒæ­¥ï¼ˆå³æ•°æ®åŒæ­¥ï¼‰ä¹‹åï¼ŒZabåè®®å°±ä¼šé€€å‡ºå´©æºƒæ¢å¤æ¨¡å¼ï¼Œ<strong>è¿›å…¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼</strong>ã€‚</p>
<p>è¿™æ—¶ï¼Œå¦‚æœæœ‰ä¸€å°éµå®ˆZabåè®®çš„æœåŠ¡å™¨åŠ å…¥é›†ç¾¤ï¼Œå› ä¸ºæ­¤æ—¶é›†ç¾¤ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªLeaderæœåŠ¡å™¨åœ¨å¹¿æ’­æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¯¥æ–°åŠ å…¥çš„æœåŠ¡å™¨è‡ªåŠ¨è¿›å…¥æ¢å¤æ¨¡å¼ï¼šæ‰¾åˆ°LeaderæœåŠ¡å™¨ï¼Œå¹¶ä¸”å®Œæˆæ•°æ®åŒæ­¥ã€‚åŒæ­¥å®Œæˆåï¼Œä½œä¸ºæ–°çš„Followerä¸€èµ·å‚ä¸åˆ°æ¶ˆæ¯å¹¿æ’­æµç¨‹ä¸­ã€‚</p>
<h4 id="åè®®çŠ¶æ€åˆ‡æ¢">åè®®çŠ¶æ€åˆ‡æ¢</h4>
<p>å½“Leaderå‡ºç°å´©æºƒé€€å‡ºæˆ–è€…æœºå™¨é‡å¯ï¼Œäº¦æˆ–æ˜¯é›†ç¾¤ä¸­ä¸å­˜åœ¨è¶…è¿‡åŠæ•°çš„æœåŠ¡å™¨ä¸Leaderä¿å­˜æ­£å¸¸é€šä¿¡ï¼ŒZabå°±ä¼šå†ä¸€æ¬¡è¿›å…¥å´©æºƒæ¢å¤ï¼Œå‘èµ·æ–°ä¸€è½®Leaderé€‰ä¸¾å¹¶å®ç°æ•°æ®åŒæ­¥ã€‚åŒæ­¥å®Œæˆååˆä¼šè¿›å…¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ï¼Œæ¥æ”¶äº‹åŠ¡è¯·æ±‚ã€‚</p>
<h4 id="ä¿è¯æ¶ˆæ¯æœ‰åº">ä¿è¯æ¶ˆæ¯æœ‰åº</h4>
<p>åœ¨æ•´ä¸ªæ¶ˆæ¯å¹¿æ’­ä¸­ï¼ŒLeaderä¼šå°†æ¯ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚è½¬æ¢æˆå¯¹åº”çš„ proposal æ¥è¿›è¡Œå¹¿æ’­ï¼Œå¹¶ä¸”åœ¨å¹¿æ’­ äº‹åŠ¡Proposal ä¹‹å‰ï¼ŒLeaderæœåŠ¡å™¨ä¼šé¦–å…ˆä¸ºè¿™ä¸ªäº‹åŠ¡Proposalåˆ†é…ä¸€ä¸ªå…¨å±€å•é€’å¢çš„å”¯ä¸€IDï¼Œç§°ä¹‹ä¸ºäº‹åŠ¡IDï¼ˆå³zxidï¼‰ï¼Œç”±äºZabåè®®éœ€è¦ä¿è¯æ¯ä¸€ä¸ªæ¶ˆæ¯çš„ä¸¥æ ¼çš„é¡ºåºå…³ç³»ï¼Œå› æ­¤å¿…é¡»å°†æ¯ä¸€ä¸ªproposalæŒ‰ç…§å…¶zxidçš„å…ˆåé¡ºåºè¿›è¡Œæ’åºå’Œå¤„ç†ã€‚</p>
<h3 id="æ¶ˆæ¯å¹¿æ’­">æ¶ˆæ¯å¹¿æ’­</h3>
<ol>
<li>
<p>åœ¨zookeeperé›†ç¾¤ä¸­ï¼Œæ•°æ®å‰¯æœ¬çš„ä¼ é€’ç­–ç•¥å°±æ˜¯é‡‡ç”¨æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ã€‚zookeeperä¸­å†œæ•°æ®å‰¯æœ¬çš„åŒæ­¥æ–¹å¼ä¸äºŒæ®µæäº¤ç›¸ä¼¼ï¼Œä½†æ˜¯å´åˆä¸åŒã€‚äºŒæ®µæäº¤è¦æ±‚åè°ƒè€…å¿…é¡»ç­‰åˆ°æ‰€æœ‰çš„å‚ä¸è€…å…¨éƒ¨åé¦ˆACKç¡®è®¤æ¶ˆæ¯åï¼Œå†å‘é€commitæ¶ˆæ¯ã€‚è¦æ±‚æ‰€æœ‰çš„å‚ä¸è€…è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚äºŒæ®µæäº¤ä¼šäº§ç”Ÿä¸¥é‡çš„é˜»å¡é—®é¢˜ã€‚</p>
</li>
<li>
<p>Zabåè®®ä¸­ Leader ç­‰å¾… Follower çš„ACKåé¦ˆæ¶ˆæ¯æ˜¯æŒ‡â€œåªè¦åŠæ•°ä»¥ä¸Šçš„FolloweræˆåŠŸåé¦ˆå³å¯ï¼Œä¸éœ€è¦æ”¶åˆ°å…¨éƒ¨Followeråé¦ˆâ€</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302170013.png" alt="æ¶ˆæ¯å¹¿æ’­æµç¨‹å›¾"></p>
</li>
</ol>
<h4 id="æ¶ˆæ¯å¹¿æ’­å…·ä½“æ­¥éª¤">æ¶ˆæ¯å¹¿æ’­å…·ä½“æ­¥éª¤</h4>
<ol>
<li>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªå†™æ“ä½œè¯·æ±‚ã€‚</li>
<li>Leader æœåŠ¡å™¨å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬åŒ–ä¸ºäº‹åŠ¡ Proposal ææ¡ˆï¼ŒåŒæ—¶ä¸ºæ¯ä¸ª Proposal åˆ†é…ä¸€ä¸ªå…¨å±€çš„IDï¼Œå³zxidã€‚</li>
<li>Leader æœåŠ¡å™¨ä¸ºæ¯ä¸ª Follower æœåŠ¡å™¨åˆ†é…ä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œç„¶åå°†éœ€è¦å¹¿æ’­çš„ Proposal ä¾æ¬¡æ”¾åˆ°é˜Ÿåˆ—ä¸­å–ï¼Œå¹¶ä¸”æ ¹æ® FIFO ç­–ç•¥è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚</li>
<li>Follower æ¥æ”¶åˆ° Proposal åï¼Œä¼šé¦–å…ˆå°†å…¶ä»¥äº‹åŠ¡æ—¥å¿—çš„æ–¹å¼å†™å…¥æœ¬åœ°ç£ç›˜ä¸­ï¼Œå†™å…¥æˆåŠŸåå‘ Leader åé¦ˆä¸€ä¸ª Ack å“åº”æ¶ˆæ¯ã€‚</li>
<li>Leader æ¥æ”¶åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Š Follower çš„ Ack å“åº”æ¶ˆæ¯åï¼Œå³è®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸï¼Œå¯ä»¥å‘é€ commit æ¶ˆæ¯ã€‚</li>
<li>Leader å‘æ‰€æœ‰ Follower å¹¿æ’­ commit æ¶ˆæ¯ï¼ŒåŒæ—¶è‡ªèº«ä¹Ÿä¼šå®Œæˆäº‹åŠ¡æäº¤ã€‚Follower æ¥æ”¶åˆ° commit æ¶ˆæ¯åï¼Œä¼šå°†ä¸Šä¸€æ¡äº‹åŠ¡æäº¤ã€‚</li>
</ol>
<p><strong>zookeeper é‡‡ç”¨ Zab åè®®çš„æ ¸å¿ƒï¼Œå°±æ˜¯åªè¦æœ‰ä¸€å°æœåŠ¡å™¨æäº¤äº† Proposalï¼Œå°±è¦ç¡®ä¿æ‰€æœ‰çš„æœåŠ¡å™¨æœ€ç»ˆéƒ½èƒ½æ­£ç¡®æäº¤ Proposalã€‚è¿™ä¹Ÿæ˜¯ CAP/BASE å®ç°æœ€ç»ˆä¸€è‡´æ€§çš„ä¸€ä¸ªä½“ç°ã€‚</strong></p>
<p><strong>Leader æœåŠ¡å™¨ä¸æ¯ä¸€ä¸ª Follower æœåŠ¡å™¨ä¹‹é—´éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå•ç‹¬çš„ FIFO æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œæ”¶å‘æ¶ˆæ¯ï¼Œä½¿ç”¨é˜Ÿåˆ—æ¶ˆæ¯å¯ä»¥åšåˆ°å¼‚æ­¥è§£è€¦ã€‚ Leader å’Œ Follower ä¹‹é—´åªéœ€è¦å¾€é˜Ÿåˆ—ä¸­å‘æ¶ˆæ¯å³å¯ã€‚å¦‚æœä½¿ç”¨åŒæ­¥çš„æ–¹å¼ä¼šå¼•èµ·é˜»å¡ï¼Œæ€§èƒ½è¦ä¸‹é™å¾ˆå¤šã€‚</strong></p>
<h3 id="å´©æºƒæ¢å¤">å´©æºƒæ¢å¤</h3>
<p><strong>ä¸€æ—¦ Leader æœåŠ¡å™¨å‡ºç°å´©æºƒæˆ–è€…ç”±äºç½‘ç»œåŸå› å¯¼è‡´ Leader æœåŠ¡å™¨å¤±å»äº†ä¸è¿‡åŠ Follower çš„è”ç³»ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼ã€‚</strong></p>
<p>åœ¨ Zab åè®®ä¸­ï¼Œä¸ºäº†ä¿è¯ç¨‹åºçš„æ­£ç¡®è¿è¡Œï¼Œæ•´ä¸ªæ¢å¤è¿‡ç¨‹ç»“æŸåéœ€è¦é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„ Leader æœåŠ¡å™¨ã€‚å› æ­¤ Zab åè®®éœ€è¦ä¸€ä¸ªé«˜æ•ˆä¸”å¯é çš„ Leader é€‰ä¸¾ç®—æ³•ï¼Œä»è€Œç¡®ä¿èƒ½å¤Ÿå¿«é€Ÿé€‰ä¸¾å‡ºæ–°çš„ Leader ã€‚</p>
<p>Leader é€‰ä¸¾ç®—æ³•ä¸ä»…ä»…éœ€è¦è®© Leader è‡ªå·±çŸ¥é“è‡ªå·±å·²ç»è¢«é€‰ä¸¾ä¸º Leader ï¼ŒåŒæ—¶è¿˜éœ€è¦è®©é›†ç¾¤ä¸­çš„æ‰€æœ‰å…¶ä»–æœºå™¨ä¹Ÿèƒ½å¤Ÿå¿«é€Ÿæ„ŸçŸ¥åˆ°é€‰ä¸¾äº§ç”Ÿçš„æ–° Leader æœåŠ¡å™¨ã€‚</p>
<p>å´©æºƒæ¢å¤ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š<strong>Leaderé€‰ä¸¾</strong> å’Œ <strong>æ•°æ®æ¢å¤</strong></p>
<h4 id="Zab-åè®®ä¿è¯æ•°æ®ä¸€è‡´æ€§">Zab åè®®ä¿è¯æ•°æ®ä¸€è‡´æ€§</h4>
<p><strong>Zab åè®®å´©æºƒæ¢å¤è¦æ±‚æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè¦æ±‚</strong>ï¼š</p>
<ol>
<li>
<p><strong>ç¡®ä¿å·²ç»è¢« Leader æäº¤çš„ Proposal å¿…é¡»æœ€ç»ˆè¢«æ‰€æœ‰çš„ Follower æœåŠ¡å™¨æäº¤</strong>ã€‚</p>
</li>
<li>
<p><strong>ç¡®ä¿ä¸¢å¼ƒå·²ç»è¢« Leader æå‡ºçš„ä½†æ˜¯æ²¡æœ‰è¢«æäº¤çš„ Proposal</strong>ã€‚</p>
</li>
</ol>
<p>æ ¹æ®ä¸Šè¿°è¦æ±‚</p>
<p>Zabåè®®éœ€è¦ä¿è¯é€‰ä¸¾å‡ºæ¥çš„Leaderéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ol>
<li>
<p><strong>æ–°é€‰ä¸¾å‡ºæ¥çš„ Leader ä¸èƒ½åŒ…å«æœªæäº¤çš„ Proposal</strong> ã€‚</p>
<p>å³æ–°é€‰ä¸¾çš„ Leader å¿…é¡»éƒ½æ˜¯å·²ç»æäº¤äº† Proposal çš„ Follower æœåŠ¡å™¨èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p><strong>æ–°é€‰ä¸¾çš„ Leader èŠ‚ç‚¹ä¸­å«æœ‰æœ€å¤§çš„ zxid</strong> ã€‚<br>
è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥é¿å… Leader æœåŠ¡å™¨æ£€æŸ¥ Proposal çš„æäº¤å’Œä¸¢å¼ƒå·¥ä½œã€‚</p>
</li>
</ol>
<h4 id="Zab-æ•°æ®åŒæ­¥">Zab æ•°æ®åŒæ­¥</h4>
<ol>
<li>å®Œæˆ Leader é€‰ä¸¾åï¼ˆæ–°çš„ Leader å…·æœ‰æœ€é«˜çš„zxidï¼‰ï¼Œåœ¨æ­£å¼å¼€å§‹å·¥ä½œä¹‹å‰ï¼ˆæ¥æ”¶äº‹åŠ¡è¯·æ±‚ï¼Œç„¶åæå‡ºæ–°çš„ Proposalï¼‰ï¼ŒLeader æœåŠ¡å™¨ä¼šé¦–å…ˆç¡®è®¤äº‹åŠ¡æ—¥å¿—ä¸­çš„æ‰€æœ‰çš„ Proposal æ˜¯å¦å·²ç»è¢«é›†ç¾¤ä¸­è¿‡åŠçš„æœåŠ¡å™¨ Commitã€‚</li>
<li>Leader æœåŠ¡å™¨éœ€è¦ç¡®ä¿æ‰€æœ‰çš„ Follower æœåŠ¡å™¨èƒ½å¤Ÿæ¥æ”¶åˆ°æ¯ä¸€æ¡äº‹åŠ¡çš„ Proposal ï¼Œå¹¶ä¸”èƒ½å°†æ‰€æœ‰å·²ç»æäº¤çš„äº‹åŠ¡ Proposal åº”ç”¨åˆ°å†…å­˜æ•°æ®ä¸­ã€‚ç­‰åˆ° Follower å°†æ‰€æœ‰å°šæœªåŒæ­¥çš„äº‹åŠ¡ Proposal éƒ½ä» Leader æœåŠ¡å™¨ä¸ŠåŒæ­¥è¿‡å•¦å¹¶ä¸”åº”ç”¨åˆ°å†…å­˜æ•°æ®ä¸­ä»¥åï¼ŒLeader æ‰ä¼šæŠŠè¯¥ Follower åŠ å…¥åˆ°çœŸæ­£å¯ç”¨çš„ Follower åˆ—è¡¨ä¸­ã€‚</li>
</ol>
<h4 id="Zab-æ•°æ®åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å¤„ç†éœ€è¦ä¸¢å¼ƒçš„-Proposal">Zab æ•°æ®åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å¤„ç†éœ€è¦ä¸¢å¼ƒçš„ Proposal</h4>
<p>åœ¨ Zab çš„äº‹åŠ¡ç¼–å· zxid è®¾è®¡ä¸­ï¼Œzxidæ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ã€‚</p>
<p>å…¶ä¸­ä½32ä½å¯ä»¥çœ‹æˆä¸€ä¸ªç®€å•çš„å•å¢è®¡æ•°å™¨ï¼Œé’ˆå¯¹å®¢æˆ·ç«¯æ¯ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚ï¼ŒLeader åœ¨äº§ç”Ÿæ–°çš„ Proposal äº‹åŠ¡æ—¶ï¼Œéƒ½ä¼šå¯¹è¯¥è®¡æ•°å™¨åŠ 1ã€‚è€Œ<font color=red>é«˜32ä½åˆ™ä»£è¡¨äº† Leader å‘¨æœŸçš„ epoch ç¼–å·</font>ã€‚</p>
<blockquote>
<p>epoch ç¼–å·å¯ä»¥ç†è§£ä¸ºå½“å‰é›†ç¾¤æ‰€å¤„çš„å¹´ä»£ï¼Œæˆ–è€…å‘¨æœŸã€‚æ¯æ¬¡Leaderå˜æ›´ä¹‹åéƒ½ä¼šåœ¨ epoch çš„åŸºç¡€ä¸ŠåŠ 1ï¼Œè¿™æ ·æ—§çš„ Leader å´©æºƒæ¢å¤ä¹‹åï¼Œå…¶ä»–Follower ä¹Ÿä¸ä¼šå¬å®ƒçš„äº†ï¼Œå› ä¸º Follower åªæœä»epochæœ€é«˜çš„ Leader å‘½ä»¤ã€‚</p>
</blockquote>
<p>æ¯å½“é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªæ–°çš„ Leader ï¼Œå°±ä¼šä»è¿™ä¸ª <font color=red>Leader æœåŠ¡å™¨ä¸Šå–å‡ºæœ¬åœ°äº‹åŠ¡æ—¥å¿—å……æœ€å¤§ç¼–å· Proposal çš„ zxidï¼Œå¹¶ä» zxid ä¸­è§£æå¾—åˆ°å¯¹åº”çš„ epoch ç¼–å·ï¼Œç„¶åå†å¯¹å…¶åŠ 1ï¼Œä¹‹åè¯¥ç¼–å·å°±ä½œä¸ºæ–°çš„ epoch å€¼ï¼Œå¹¶å°†ä½32ä½æ•°å­—å½’é›¶ï¼Œç”±0å¼€å§‹é‡æ–°ç”Ÿæˆzxid</font>ã€‚</p>
<p><strong>Zab åè®®é€šè¿‡ epoch ç¼–å·æ¥åŒºåˆ† Leader å˜åŒ–å‘¨æœŸ</strong>ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…ä¸åŒçš„ Leader é”™è¯¯çš„ä½¿ç”¨äº†ç›¸åŒçš„ zxid ç¼–å·æå‡ºäº†ä¸ä¸€æ ·çš„ Proposal çš„å¼‚å¸¸æƒ…å†µã€‚</p>
<h1>Zabå®ç°åŸç†</h1>
<p><strong>Zab èŠ‚ç‚¹æœ‰ä¸‰ç§çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>Followingï¼šå½“å‰èŠ‚ç‚¹æ˜¯è·Ÿéšè€…ï¼Œæœä» Leader èŠ‚ç‚¹çš„å‘½ä»¤ã€‚</li>
<li>Leadingï¼šå½“å‰èŠ‚ç‚¹æ˜¯ Leaderï¼Œè´Ÿè´£åè°ƒäº‹åŠ¡ã€‚</li>
<li>Election/Lookingï¼šèŠ‚ç‚¹å¤„äºé€‰ä¸¾çŠ¶æ€ï¼Œæ­£åœ¨å¯»æ‰¾ Leaderã€‚</li>
</ul>
<p>ä»£ç å®ç°ä¸­ï¼Œå¤šäº†ä¸€ç§çŠ¶æ€ï¼šObserving çŠ¶æ€<br>
è¿™æ˜¯ Zookeeper å¼•å…¥ Observer ä¹‹ååŠ å…¥çš„ï¼ŒObserver ä¸å‚ä¸é€‰ä¸¾ï¼Œæ˜¯åªè¯»èŠ‚ç‚¹ï¼Œè·Ÿ Zab åè®®æ²¡æœ‰å…³ç³»ã€‚</p>
<p><strong>èŠ‚ç‚¹çš„æŒä¹…çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>historyï¼šå½“å‰èŠ‚ç‚¹æ¥æ”¶åˆ°äº‹åŠ¡ Proposal çš„Log</li>
<li>acceptedEpochï¼šFollower å·²ç»æ¥å—çš„ Leader æ›´æ”¹ epoch çš„ newEpoch æè®®ã€‚</li>
<li>currentEpochï¼šå½“å‰æ‰€å¤„çš„ Leader å¹´ä»£</li>
<li>lastZxidï¼šhistory ä¸­æœ€è¿‘æ¥æ”¶åˆ°çš„Proposal çš„ zxidï¼ˆæœ€å¤§zxidï¼‰</li>
</ul>
<h2 id="Zab-çš„å››ä¸ªé˜¶æ®µ">Zab çš„å››ä¸ªé˜¶æ®µ</h2>
<h3 id="é€‰ä¸¾é˜¶æ®µï¼ˆLeader-Election">é€‰ä¸¾é˜¶æ®µï¼ˆLeader Election</h3>
<p>èŠ‚ç‚¹åœ¨ä¸€å¼€å§‹éƒ½å¤„äºé€‰ä¸¾èŠ‚ç‚¹ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹å¾—åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„ç¥¨æ•°ï¼Œå®ƒå°±å¯ä»¥å½“é€‰å‡† Leaderï¼Œåªæœ‰åˆ°è¾¾ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼ˆä¹Ÿå°±æ˜¯åŒæ­¥é˜¶æ®µï¼‰ï¼Œè¿™ä¸ªå‡† Leader æ‰ä¼šæˆä¸ºçœŸæ­£çš„ Leaderã€‚<strong>Zookeeper è§„å®šæ‰€æœ‰æœ‰æ•ˆçš„æŠ•ç¥¨éƒ½å¿…é¡»åœ¨åŒä¸€ä¸ª è½®æ¬¡ ä¸­ï¼Œæ¯ä¸ªæœåŠ¡å™¨åœ¨å¼€å§‹æ–°ä¸€è½®æŠ•ç¥¨æ—¶ï¼Œéƒ½ä¼šå¯¹è‡ªå·±ç»´æŠ¤çš„ logicalClock è¿›è¡Œè‡ªå¢æ“ä½œ</strong>ã€‚</p>
<p>æ¯ä¸ªæœåŠ¡å™¨åœ¨å¹¿æ’­è‡ªå·±çš„é€‰ç¥¨å‰ï¼Œä¼šå°†è‡ªå·±çš„æŠ•ç¥¨ç®±ï¼ˆrecvsetï¼‰æ¸…ç©ºã€‚è¯¥æŠ•ç¥¨ç®±è®°å½•äº†æ‰€å—åˆ°çš„é€‰ç¥¨ã€‚</p>
<p>ä¾‹å¦‚ï¼šServer_2 æŠ•ç¥¨ç»™ Server_3ï¼ŒServer_3 æŠ•ç¥¨ç»™ Server_1ï¼Œåˆ™Server_1çš„æŠ•ç¥¨ç®±ä¸º(2,3)ã€(3,1)ã€(1,1)ã€‚ï¼ˆæ¯ä¸ªæœåŠ¡å™¨éƒ½ä¼šé»˜è®¤ç»™è‡ªå·±æŠ•ç¥¨ï¼‰</p>
<p>å‰ä¸€ä¸ªæ•°å­—è¡¨ç¤ºæŠ•ç¥¨è€…ï¼Œåä¸€ä¸ªæ•°å­—è¡¨ç¤ºè¢«é€‰ä¸¾è€…ã€‚ç¥¨ç®±ä¸­åªä¼šè®°å½•æ¯ä¸€ä¸ªæŠ•ç¥¨è€…çš„æœ€åä¸€æ¬¡æŠ•ç¥¨è®°å½•ï¼Œå¦‚æœæŠ•ç¥¨è€…æ›´æ–°è‡ªå·±çš„é€‰ç¥¨ï¼Œåˆ™å…¶ä»–æœåŠ¡å™¨æ”¶åˆ°è¯¥æ–°é€‰ç¥¨åä¼šåœ¨è‡ªå·±çš„ç¥¨ç®±ä¸­æ›´æ–°è¯¥æœåŠ¡å™¨çš„é€‰ç¥¨ã€‚</p>
<p><strong>è¿™ä¸€é˜¶æ®µçš„ç›®çš„å°±æ˜¯ä¸ºäº†é€‰å‡ºä¸€ä¸ªå‡† Leader ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</strong></p>
<p>åè®®å¹¶æ²¡æœ‰è§„å®šè¯¦ç»†çš„é€‰ä¸¾ç®—æ³•ï¼Œåé¢ä¼šæåˆ°å®ç°ä¸­ä½¿ç”¨çš„ Fast Leader Electionã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302171418.png" alt="é€‰ä¸¾æµç¨‹"></p>
<h3 id="å‘ç°é˜¶æ®µï¼ˆDescoveryï¼‰">å‘ç°é˜¶æ®µï¼ˆDescoveryï¼‰</h3>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒFollowers å’Œä¸Šä¸€è½®é€‰ä¸¾å‡ºçš„å‡† Leader è¿›è¡Œé€šä¿¡ï¼ŒåŒæ­¥ Followers æœ€è¿‘æ¥æ”¶çš„äº‹åŠ¡ Proposal ã€‚</p>
<p>ä¸€ä¸ª Follower åªä¼šè¿æ¥ä¸€ä¸ª Leaderï¼Œå¦‚æœä¸€ä¸ª Follower èŠ‚ç‚¹è¿æ¥å¦ä¸€ä¸ª Follower èŠ‚ç‚¹ï¼Œåˆ™ä¼šåœ¨å°è¯•è¿æ¥æ—¶è¢«æ‹’ç»ã€‚è¢«æ‹’ç»ä¹‹åï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šè¿›å…¥ Leader Electioné˜¶æ®µã€‚</p>
<p><strong>è¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯å‘ç°å½“å‰å¤§å¤šæ•°èŠ‚ç‚¹æ¥æ”¶çš„æœ€æ–° Proposalï¼Œå¹¶ä¸”å‡† Leader ç”Ÿæˆæ–°çš„ epoch ï¼Œè®© Followers æ¥æ”¶ï¼Œæ›´æ–°å®ƒä»¬çš„ acceptedEpoch</strong>ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302171535.png" alt="å‘ç°æµç¨‹"></p>
<h3 id="åŒæ­¥é˜¶æ®µï¼ˆSynchronizationï¼‰">åŒæ­¥é˜¶æ®µï¼ˆSynchronizationï¼‰</h3>
<p><strong>åŒæ­¥é˜¶æ®µä¸»è¦æ˜¯åˆ©ç”¨ Leader å‰ä¸€é˜¶æ®µè·å¾—çš„æœ€æ–° Proposal å†å²ï¼ŒåŒæ­¥é›†ç¾¤ä¸­æ‰€æœ‰çš„å‰¯æœ¬</strong>ã€‚<br>
åªæœ‰å½“ quorumï¼ˆè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ï¼‰ éƒ½åŒæ­¥å®Œæˆï¼Œå‡† Leader æ‰ä¼šæˆä¸ºçœŸæ­£çš„ Leaderã€‚Follower åªä¼šæ¥æ”¶ zxid æ¯”è‡ªå·± lastZxid å¤§çš„ Proposalã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302171702.png" alt="åŒæ­¥æµç¨‹"></p>
<h3 id="å¹¿æ’­é˜¶æ®µï¼ˆBroadcastï¼‰">å¹¿æ’­é˜¶æ®µï¼ˆBroadcastï¼‰</h3>
<p>åˆ°äº†è¿™ä¸ªé˜¶æ®µï¼ŒZookeeper é›†ç¾¤æ‰èƒ½æ­£å¼å¯¹å¤–æä¾›äº‹åŠ¡æœåŠ¡ï¼Œå¹¶ä¸” Leader å¯ä»¥è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ã€‚åŒæ—¶ï¼Œå¦‚æœæœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œè¿˜éœ€è¦å¯¹æ–°èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒZab æäº¤äº‹åŠ¡å¹¶ä¸åƒ 2PC ä¸€æ ·éœ€è¦å…¨éƒ¨ Follower éƒ½ Ackï¼Œåªéœ€è¦å¾—åˆ° quorumï¼ˆè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ï¼‰çš„Ack å°±å¯ä»¥ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302171740.png" alt="å¹¿æ’­æµç¨‹"></p>
<h1>Zabåè®®å®ç°</h1>
<p>é€‰ä¸¾é˜¶æ®µä½¿ç”¨ javaç‰ˆæœ¬å®ç°çš„æ˜¯Fast Leader Electionç®—æ³•ï¼Œå®é™…çš„å®ç°å°†<strong>å‘ç°å’ŒåŒæ­¥é˜¶æ®µåˆå¹¶ä¸º Recovery Phaseï¼ˆæ¢å¤é˜¶æ®µï¼‰</strong>ï¼Œæ‰€ä»¥ï¼ŒZab çš„å®ç°å®é™…ä¸Šæœ‰ä¸‰ä¸ªé˜¶æ®µã€‚</p>
<p>Zabåè®®ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>é€‰ä¸¾ï¼ˆFast Leader Electionï¼‰</strong></li>
<li><strong>æ¢å¤ï¼ˆRecovery Phaseï¼‰</strong></li>
<li><strong>å¹¿æ’­ï¼ˆBroadcast Phaseï¼‰</strong></li>
</ol>
<h2 id="Fast-Leader-Electionï¼ˆå¿«é€Ÿé€‰ä¸¾ï¼‰">Fast Leader Electionï¼ˆå¿«é€Ÿé€‰ä¸¾ï¼‰</h2>
<p>FLE ä¼šé€‰ä¸¾æ‹¥æœ‰æœ€æ–°Proposal history ï¼ˆlastZxidæœ€å¤§ï¼‰çš„èŠ‚ç‚¹ä½œä¸º Leaderï¼Œè¿™æ ·å°±çœå»äº†å‘ç°æœ€æ–°æè®®çš„æ­¥éª¤ã€‚<strong>è¿™æ˜¯åŸºäºæ‹¥æœ‰æœ€æ–°æè®®çš„èŠ‚ç‚¹ä¹Ÿæ‹¥æœ‰æœ€æ–°çš„æäº¤è®°å½•</strong></p>
<h3 id="æˆä¸º-Leader-çš„æ¡ä»¶ï¼š">æˆä¸º Leader çš„æ¡ä»¶ï¼š</h3>
<ol>
<li>é€‰ epoch æœ€å¤§çš„</li>
<li>è‹¥ epoch ç›¸ç­‰ï¼Œé€‰ zxid æœ€å¤§çš„</li>
<li>è‹¥ epoch å’Œ zxid ç›¸ç­‰ï¼Œé€‰æ‹© server_id æœ€å¤§çš„ï¼ˆ<strong>zoo.cfgä¸­çš„myid</strong>ï¼‰</li>
</ol>
<p>èŠ‚ç‚¹åœ¨é€‰ä¸¾å¼€å§‹æ—¶ï¼Œéƒ½é»˜è®¤æŠ•ç¥¨ç»™è‡ªå·±ï¼Œå½“æ¥æ”¶å…¶ä»–èŠ‚ç‚¹çš„é€‰ç¥¨æ—¶ï¼Œä¼šæ ¹æ®ä¸Šé¢çš„ <strong>Leaderæ¡ä»¶</strong> åˆ¤æ–­å¹¶ä¸”æ›´æ”¹è‡ªå·±çš„é€‰ç¥¨ï¼Œç„¶åé‡æ–°å‘é€é€‰ç¥¨ç»™å…¶ä»–èŠ‚ç‚¹ã€‚<strong>å½“æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„å¾—ç¥¨è¶…è¿‡åŠæ•°ï¼Œè¯¥èŠ‚ç‚¹ä¼šè®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸º Leading ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šè®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸º Following</strong>ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302172451.png" alt="é€‰ä¸¾è¿‡ç¨‹"></p>
<h2 id="Recovery-Phaseï¼ˆæ¢å¤é˜¶æ®µï¼‰">Recovery Phaseï¼ˆæ¢å¤é˜¶æ®µï¼‰</h2>
<p>è¿™ä¸€é˜¶æ®µ Follower å‘é€ä»–ä»¬çš„ <strong>lastZxid</strong> ç»™ Leaderï¼ŒLeader æ ¹æ® lastZxid å†³å®šå¦‚ä½•åŒæ­¥æ•°æ®ã€‚è¿™é‡Œçš„å®ç°è·Ÿå‰é¢çš„ Phase 2 æœ‰æ‰€ä¸åŒï¼šFollower æ”¶åˆ° TRUNC æŒ‡ä»¤ä¼šç»ˆæ­¢L.lastCommitedZxid ä¹‹åçš„ Proposal ï¼Œæ”¶åˆ° DIFF æŒ‡ä»¤ä¼šæ¥æ”¶æ–°çš„ Proposalã€‚</p>
<blockquote>
<p>history.lastCommitedZxidï¼šæœ€è¿‘è¢«æäº¤çš„ Proposal zxid</p>
<p>history.oldThresholdï¼šè¢«è®¤ä¸ºå·²ç»å¤ªæ—§çš„å·²ç»æäº¤çš„ Proposal zxid</p>
</blockquote>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302172728.png" alt="æ¢å¤é˜¶æ®µ"></p>
<h1>Zabç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦è§£å†³çš„ä¸¤ä¸ªé—®é¢˜ï¼š</h1>
<h2 id="å·²ç»è¢«å¤„ç†çš„äº‹åŠ¡è¯·æ±‚ï¼ˆproposalï¼‰ä¸èƒ½ä¸¢ï¼ˆcommitçš„ï¼‰">å·²ç»è¢«å¤„ç†çš„äº‹åŠ¡è¯·æ±‚ï¼ˆproposalï¼‰ä¸èƒ½ä¸¢ï¼ˆcommitçš„ï¼‰</h2>
<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>å½“ leader æ”¶åˆ°åˆæ³•æ•°é‡ follower çš„ ACKs åï¼Œå°±å‘å„ä¸ª follower å¹¿æ’­ COMMIT å‘½ä»¤ï¼ŒåŒæ—¶ä¹Ÿä¼šåœ¨æœ¬åœ°æ‰§è¡Œ COMMIT å¹¶å‘è¿æ¥çš„å®¢æˆ·ç«¯è¿”å›ã€ŒæˆåŠŸã€ã€‚ä½†æ˜¯å¦‚æœåœ¨å„ä¸ª follower åœ¨æ”¶åˆ°COMMIT å‘½ä»¤å‰ leader å°±æŒ‚äº†ï¼Œå¯¼è‡´å‰©ä¸‹çš„æœåŠ¡å™¨å¹¶æ²¡æœ‰æ‰§è¡Œéƒ½è¿™æ¡æ¶ˆæ¯ã€‚</p>
<h3 id="è§£å†³æ–¹å¼">è§£å†³æ–¹å¼</h3>
<ol>
<li>
<p>é€‰ä¸¾æ‹¥æœ‰ proposal æœ€å¤§å€¼ï¼ˆå³ zxid æœ€å¤§ï¼‰ çš„èŠ‚ç‚¹ä½œä¸ºæ–°çš„ leaderã€‚</p>
<blockquote>
<p>ç”±äºæ‰€æœ‰ææ¡ˆè¢« COMMIT ä¹‹å‰å¿…é¡»æœ‰<font color=red>åˆæ³•æ•°é‡çš„ follower ACKï¼Œå³å¿…é¡»æœ‰åˆæ³•æ•°é‡çš„æœåŠ¡å™¨çš„äº‹åŠ¡æ—¥å¿—ä¸Šæœ‰è¯¥ææ¡ˆçš„ proposal</font>ï¼Œå› æ­¤ï¼Œzxidæœ€å¤§ä¹Ÿå°±æ˜¯æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹ä¿å­˜äº†æ‰€æœ‰è¢« COMMIT æ¶ˆæ¯çš„ proposal çŠ¶æ€ã€‚</p>
</blockquote>
</li>
<li>
<p>æ–°çš„ leader å°†è‡ªå·±äº‹åŠ¡æ—¥å¿—ä¸­ proposal ä½†æœª COMMIT çš„æ¶ˆæ¯å¤„ç†ã€‚</p>
</li>
<li>
<p>æ–°çš„ leader ä¸ follower å»ºç«‹å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œ å…ˆå°†è‡ªèº«æœ‰è€Œ follower æ²¡æœ‰çš„ proposal</p>
<p>å‘é€ç»™ followerï¼Œå†å°†è¿™äº› proposal çš„ COMMIT å‘½ä»¤å‘é€ç»™ followerï¼Œä»¥ä¿è¯æ‰€æœ‰çš„</p>
<p>follower éƒ½ä¿å­˜äº†æ‰€æœ‰çš„ proposalã€æ‰€æœ‰çš„ follower éƒ½å¤„ç†äº†æ‰€æœ‰çš„æ¶ˆæ¯</p>
</li>
</ol>
<h2 id="æ²¡è¢«å¤„ç†çš„äº‹åŠ¡è¯·æ±‚ï¼ˆproposalï¼‰ä¸èƒ½å†æ¬¡å‡ºç°ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°äº‹åŠ¡è¯·æ±‚è¢«ä¸¢å¤±å‘¢ï¼Ÿ">æ²¡è¢«å¤„ç†çš„äº‹åŠ¡è¯·æ±‚ï¼ˆproposalï¼‰ä¸èƒ½å†æ¬¡å‡ºç°ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°äº‹åŠ¡è¯·æ±‚è¢«ä¸¢å¤±å‘¢ï¼Ÿ</h2>
<h3 id="é—®é¢˜æè¿°-2">é—®é¢˜æè¿°</h3>
<p>å½“ leader æ¥æ”¶åˆ°æ¶ˆæ¯è¯·æ±‚ç”Ÿæˆ proposal åå°±æŒ‚äº†ï¼Œå…¶ä»– follower å¹¶æ²¡æœ‰æ”¶åˆ°æ­¤ proposalï¼Œå› æ­¤ç»è¿‡æ¢å¤æ¨¡å¼é‡æ–°é€‰äº† leader åï¼Œè¿™æ¡æ¶ˆæ¯æ˜¯è¢«è·³è¿‡çš„ã€‚ æ­¤æ—¶ï¼Œä¹‹å‰æŒ‚äº†çš„ leader é‡æ–°å¯åŠ¨å¹¶æ³¨å†Œæˆäº† followerï¼Œä»–ä¿ç•™äº†è¢«è·³è¿‡æ¶ˆæ¯çš„ proposal çŠ¶æ€ï¼Œä¸æ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€æ˜¯ä¸ä¸€è‡´çš„ï¼Œéœ€è¦å°†å…¶åˆ é™¤ã€‚</p>
<h3 id="è§£å†³æ–¹å¼-2">è§£å†³æ–¹å¼</h3>
<p><strong>Zab é€šè¿‡å·§å¦™çš„è®¾è®¡ zxid æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚</strong></p>
<p>ä¸€ä¸ª zxid æ˜¯64ä½ï¼Œé«˜ 32 æ˜¯çºªå…ƒï¼ˆepochï¼‰ç¼–å·ï¼Œæ¯ç»è¿‡ä¸€æ¬¡ leader é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªæ–°çš„ leaderï¼Œæ–° leader ä¼šå°† epoch å· +1ã€‚ä½ 32 ä½æ˜¯æ¶ˆæ¯è®¡æ•°å™¨ï¼Œæ¯æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯è¿™ä¸ªå€¼ +1ï¼Œæ–° leader é€‰ä¸¾åè¿™ä¸ªå€¼é‡ç½®ä¸º 0ã€‚</p>
<p>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯æ—§çš„ leader æŒ‚äº†åé‡å¯ï¼Œå®ƒä¸ä¼šè¢«é€‰ä¸¾ä¸º leaderï¼Œå› ä¸ºæ­¤æ—¶å®ƒçš„ zxid è‚¯å®šå°äºå½“å‰çš„æ–° leaderã€‚å½“æ—§çš„ leader ä½œä¸º follower æ¥å…¥æ–°çš„ leader åï¼Œæ–°çš„ leader ä¼šè®©å®ƒå°†æ‰€æœ‰çš„æ‹¥æœ‰æ—§çš„ epoch å·çš„æœªè¢« COMMIT çš„ proposal æ¸…é™¤ã€‚</p>
]]></content>
      <categories>
        <category>ZooKeeper</category>
        <category>åˆ†å¸ƒå¼</category>
        <category>Zab</category>
      </categories>
      <tags>
        <tag>ZooKeeper</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>ZAB</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeperé›†ç¾¤ç®€å•ä»‹ç»</title>
    <url>/posts/5af4d7fe/</url>
    <content><![CDATA[<p><a href="https://zookeeper.apache.org/doc/r3.6.2/zookeeperOver.html">å®˜æ–¹æ–‡æ¡£åœ°å€</a></p>
<h1>Zookeeperä»‹ç»</h1>
<p>ZooKeeperæ˜¯ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F/19276232">åˆ†å¸ƒå¼</a>çš„ï¼Œå¼€æ”¾æºç çš„<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/9854429">åˆ†å¸ƒå¼åº”ç”¨ç¨‹åº</a>åè°ƒæœåŠ¡ï¼Œæ˜¯Googleçš„Chubbyä¸€ä¸ªå¼€æºçš„å®ç°ï¼Œæ˜¯Hadoopå’ŒHbaseçš„é‡è¦ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚</p>
<p>ZooKeeperå…·æœ‰<strong>é«˜æ€§èƒ½</strong>ï¼Œ<strong>é«˜å¯ç”¨æ€§</strong>ï¼Œ<strong>ä¸¥æ ¼æ’åºçš„è®¿é—®</strong>çš„ç‰¹æ€§ã€‚ZooKeeperçš„<strong>é«˜æ€§èƒ½</strong>æ„å‘³ç€å®ƒ<strong>å¯ä»¥åœ¨å¤§å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨</strong>ã€‚<strong>å¯é æ€§</strong>æ–¹é¢ä½¿å®ƒ<strong>ä¸ä¼šäº§ç”Ÿå•ç‚¹æ•…éšœ</strong>ã€‚<strong>ä¸¥æ ¼çš„æ’åº</strong>æ„å‘³ç€å¯ä»¥<strong>åœ¨å®¢æˆ·ç«¯ä¸Šå®ç°å¤æ‚çš„åŒæ­¥åŸè¯­</strong>ã€‚</p>
<blockquote>
<p>è¯¦ç»†æµ‹è¯•å¯¹æ¯”å¯çœ‹å®˜æ–¹æ–‡æ¡£   ï¼š   <a href="https://zookeeper.apache.org/doc/r3.6.2/zookeeperOver.html">å®˜æ–¹æ–‡æ¡£åœ°å€</a></p>
</blockquote>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210228144326.png" alt="image-20210228144326215"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210228143924.png" alt="image-20210228143924298"></p>
<blockquote>
<p><a href="https://juejin.cn/post/6844903919026438158">Zookeeperé¡ºåºä¸€è‡´æ€§çš„ç†è§£</a></p>
</blockquote>
<h1>Zookeeperçš„è¯»å†™æœºåˆ¶</h1>
<ul>
<li>Zookeeperæ˜¯ä¸€ä¸ªç”±å¤šä¸ªserverç»„æˆçš„é›†ç¾¤</li>
<li>ä¸€ä¸ªleaderï¼Œå¤šä¸ªfollower</li>
<li>æ¯ä¸ªserverä¿å­˜ä¸€ä»½æ•°æ®å‰¯æœ¬</li>
<li>å…¨å±€æ•°æ®ä¸€è‡´</li>
<li>åˆ†å¸ƒå¼è¯»å†™</li>
<li>æ›´æ–°è¯·æ±‚è½¬å‘ï¼Œç”±<strong>leaderå®æ–½</strong></li>
</ul>
<h1><strong>Zookeeper çš„ä¿è¯</strong></h1>
<ul>
<li><font color=red>æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªclientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œ</font></li>
<li>æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥</li>
<li>å…¨å±€<strong>å”¯ä¸€æ•°æ®è§†å›¾</strong>ï¼Œclientæ— è®ºè¿æ¥åˆ°å“ªä¸ªserverï¼Œ<strong>æ•°æ®è§†å›¾éƒ½æ˜¯ä¸€è‡´çš„</strong></li>
<li>å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šäº‹ä»¶èŒƒå›´å†…ï¼Œclientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®</li>
</ul>
<h1>é›†ç¾¤ä¸­çš„è§’è‰²</h1>
<ul>
<li>é¢†å¯¼è€…ï¼ˆleaderï¼‰ï¼Œè´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€</li>
<li>å­¦ä¹ è€…ï¼ˆlearnerï¼‰ï¼ŒåŒ…æ‹¬è·Ÿéšè€…ï¼ˆfollowerï¼‰å’Œè§‚å¯Ÿè€…ï¼ˆobserverï¼‰ï¼Œfollowerç”¨äºæ¥å—å®¢æˆ·ç«¯è¯·æ±‚å¹¶æƒ³å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸»è¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨</li>
<li>Observerå¯ä»¥æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œå°†å†™è¯·æ±‚è½¬å‘ç»™leaderï¼Œä½†<strong>observerä¸å‚åŠ æŠ•ç¥¨è¿‡ç¨‹</strong>ï¼ŒåªåŒæ­¥leaderçš„çŠ¶æ€ï¼Œ<font color=red>observerçš„ç›®çš„æ˜¯ä¸ºäº†æ‰©å±•ç³»ç»Ÿï¼Œæé«˜è¯»å–é€Ÿåº¦,æ”¾å¤§æŸ¥è¯¢èƒ½åŠ›</font></li>
<li>å®¢æˆ·ç«¯ï¼ˆclientï¼‰ï¼Œè¯·æ±‚å‘èµ·æ–¹</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302102953.png" alt="183233-20160316222444771-1363762533"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302103007.jpg" alt=""></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303103255.png" alt="èŠ‚ç‚¹é—´è¿æ¥æ¨¡å¼"></p>
<ul>
<li>
<p>Zookeeperçš„æ ¸å¿ƒ**æ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ªServerä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åšZabåè®®ã€‚Zabåè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ã€‚**å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼ŒZabå°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•°Serverå®Œæˆäº†å’Œleaderçš„çŠ¶æ€åŒæ­¥ä»¥åï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº†leaderå’ŒServerå…·æœ‰ç›¸åŒçš„ç³»ç»ŸçŠ¶æ€ã€‚</p>
</li>
<li>
<p>ä¸ºäº†ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§**ï¼Œzookeeperé‡‡ç”¨äº†é€’å¢çš„äº‹åŠ¡idå·ï¼ˆzxidï¼‰æ¥æ ‡è¯†äº‹åŠ¡ã€‚æ‰€æœ‰çš„æè®®ï¼ˆproposalï¼‰éƒ½åœ¨è¢«æå‡ºçš„æ—¶å€™åŠ ä¸Šäº†zxid**ã€‚<strong>å®ç°ä¸­zxidæ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œå®ƒé«˜32ä½æ˜¯epochç”¨æ¥æ ‡è¯†leaderå…³ç³»æ˜¯å¦æ”¹å˜ï¼Œæ¯æ¬¡ä¸€ä¸ªleaderè¢«é€‰å‡ºæ¥ï¼Œå®ƒéƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„epochï¼Œæ ‡è¯†å½“å‰å±äºé‚£ä¸ªleaderçš„ç»Ÿæ²»æ—¶æœŸã€‚ä½32ä½ç”¨äºé€’å¢è®¡æ•°ã€‚</strong></p>
</li>
</ul>
<p><strong>æ¯ä¸ªServeråœ¨å·¥ä½œè¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼š</strong></p>
<ul>
<li>LOOKINGï¼šå½“å‰Serverä¸çŸ¥é“leaderæ˜¯è°ï¼Œæ­£åœ¨æœå¯»</li>
<li>LEADINGï¼šå½“å‰Serverå³ä¸ºé€‰ä¸¾å‡ºæ¥çš„leader</li>
<li>FOLLOWINGï¼šleaderå·²ç»é€‰ä¸¾å‡ºæ¥ï¼Œå½“å‰Serverä¸ä¹‹åŒæ­¥</li>
</ul>
<p><strong>Followerä¸»è¦æœ‰å››ä¸ªåŠŸèƒ½</strong></p>
<ol>
<li>å‘Leaderå‘é€è¯·æ±‚ï¼ˆPINGæ¶ˆæ¯ã€REQUESTæ¶ˆæ¯ã€ACKæ¶ˆæ¯ã€REVALIDATEæ¶ˆæ¯ï¼‰ï¼›</li>
<li>æ¥æ”¶Leaderæ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ï¼›</li>
<li>æ¥æ”¶Clientçš„è¯·æ±‚ï¼Œå¦‚æœä¸ºå†™è¯·æ±‚ï¼Œå‘é€ç»™Leaderè¿›è¡ŒæŠ•ç¥¨ï¼›</li>
<li>è¿”å›Clientç»“æœã€‚</li>
</ol>
<p><strong>Followerçš„æ¶ˆæ¯å¾ªç¯å¤„ç†å¦‚ä¸‹å‡ ç§æ¥è‡ªLeaderçš„æ¶ˆæ¯ï¼š</strong></p>
<ol>
<li>PINGæ¶ˆæ¯ï¼š å¿ƒè·³æ¶ˆæ¯ï¼›</li>
<li>PROPOSALæ¶ˆæ¯ï¼šLeaderå‘èµ·çš„ææ¡ˆï¼Œè¦æ±‚FolloweræŠ•ç¥¨ï¼›</li>
<li>COMMITæ¶ˆæ¯ï¼šæœåŠ¡å™¨ç«¯æœ€æ–°ä¸€æ¬¡ææ¡ˆçš„ä¿¡æ¯ï¼›</li>
<li>UPTODATEæ¶ˆæ¯ï¼šè¡¨æ˜åŒæ­¥å®Œæˆï¼›</li>
<li>.REVALIDATEæ¶ˆæ¯ï¼šæ ¹æ®Leaderçš„REVALIDATEç»“æœï¼Œå…³é—­å¾…revalidateçš„sessionè¿˜æ˜¯å…è®¸å…¶æ¥å—æ¶ˆæ¯ï¼›</li>
<li>SYNCæ¶ˆæ¯ï¼šè¿”å›SYNCç»“æœåˆ°å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æœ€åˆç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œç”¨æ¥å¼ºåˆ¶å¾—åˆ°æœ€æ–°çš„æ›´æ–°ã€‚</li>
</ol>
<p>å…¶ä»–æ–‡æ¡£ï¼š<a href="http://www.cnblogs.com/lpshou/archive/2013/06/14/3136738.html">http://www.cnblogs.com/lpshou/archive/2013/06/14/3136738.html</a></p>
<h1>Zookeeperä¸­èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯å„å­—æ®µå«ä¹‰</h1>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302100241.png" alt="image-20210302100241394"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@InterfaceAudience</span>.Public</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stat</span> <span class="keyword">implements</span> <span class="title">Record</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> czxid; <span class="comment">// è¯¥æ•°æ®èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> mzxid; <span class="comment">// è¯¥æ•°æ®èŠ‚ç‚¹è¢«ä¿®æ”¹æ—¶æœ€æ–°çš„äº‹åŠ¡idï¼ˆé›†ç¾¤ä¸­ä¼šä¸ä¸€æ ·ï¼‰</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> ctime; <span class="comment">// è¯¥æ•°æ®èŠ‚ç‚¹åˆ›å»ºæ—¶é—´</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> mtime; <span class="comment">// è¯¥æ•°æ®èŠ‚ç‚¹æœ€åä¿®æ”¹æ—¶é—´</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> version; <span class="comment">// å½“å‰èŠ‚ç‚¹ç‰ˆæœ¬å·ï¼ˆå¯ä»¥ç†è§£ä¸ºä¿®æ”¹æ¬¡æ•°ï¼Œæ¯ä¿®æ”¹ä¸€æ¬¡å€¼+1ï¼‰</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> cversion;<span class="comment">// å­èŠ‚ç‚¹ç‰ˆæœ¬å·ï¼ˆå­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°ï¼Œæ¯ä¿®æ”¹ä¸€æ¬¡å€¼+1ï¼‰</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> aversion; <span class="comment">// å½“å‰èŠ‚ç‚¹aclç‰ˆæœ¬å·ï¼ˆaclèŠ‚ç‚¹è¢«ä¿®æ”¹æ¬¡æ•°ï¼Œæ¯ä¿®æ”¹ä¸€æ¬¡å€¼+1ï¼‰</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> ephemeralOwner; <span class="comment">// ä¸´æ—¶èŠ‚ç‚¹æ ‡ç¤ºï¼Œå½“å‰èŠ‚ç‚¹å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ™å­˜å‚¨çš„åˆ›å»ºè€…çš„ä¼šè¯idï¼ˆsessionIdï¼‰ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå€¼=0</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> dataLength;<span class="comment">// å½“å‰èŠ‚ç‚¹æ•°æ®é•¿åº¦</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> numChildren; <span class="comment">// å½“å‰èŠ‚ç‚¹å­èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> pzxid; <span class="comment">// å½“å‰èŠ‚ç‚¹çš„çˆ¶çº§èŠ‚ç‚¹äº‹åŠ¡ID</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Stat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><font color=red>å…¶ä¸­zxidè¡¨ç¤ºçš„æ˜¯zookeeperçš„äº‹åŠ¡IDï¼Œç”±64ä½æ•°å­—ç»„æˆï¼Œåˆ†ä¸ºé«˜32ä½å’Œä½32ä½</font></strong></p>
<p><strong>é«˜32ä½</strong>ï¼šEpochå‘¨æœŸæ•°ï¼Œå€¼ä¸ºæœ€æ–°çš„é¢†å¯¼çš„å¯¹åº”çš„idï¼Œå…¶å®å°±æ˜¯å°±æ˜¯ä¸€ä¸ªé€’å¢çš„æ•°å­—</p>
<p><strong>ä½32ä½</strong>ï¼šè®¡æ•°å™¨ï¼Œä¸€ä¸ªé€’å¢çš„è®¡æ•°å™¨ï¼Œå½“å¤„ç†äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå€¼+1</p>
<p>zxidç”Ÿæˆçš„è§„åˆ™ï¼šZxidUtils.makeZxid</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZxidUtils</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getEpochFromZxid</span><span class="params">(<span class="keyword">long</span> zxid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zxid &gt;&gt; <span class="number">32L</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getCounterFromZxid</span><span class="params">(<span class="keyword">long</span> zxid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zxid &amp; <span class="number">0xffffffffL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">makeZxid</span><span class="params">(<span class="keyword">long</span> epoch, <span class="keyword">long</span> counter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (epoch &lt;&lt; <span class="number">32L</span>) | (counter &amp; <span class="number">0xffffffffL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">zxidToString</span><span class="params">(<span class="keyword">long</span> zxid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Long.toHexString(zxid);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>ZookeeperèŠ‚ç‚¹æ•°æ®æ“ä½œæµç¨‹</h1>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302103739.png" alt="183233-20160316223234865-1124736424"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303103735.png" alt=""></p>
<p><strong>è¯¦ç»†è¯´æ˜</strong></p>
<ol>
<li>åœ¨Clientå‘Follwerå‘å‡ºä¸€ä¸ªå†™çš„è¯·æ±‚</li>
<li>FollweræŠŠè¯·æ±‚å‘é€ç»™Leader</li>
<li>Leaderæ¥æ”¶åˆ°ä»¥åå¼€å§‹å‘èµ·æŠ•ç¥¨å¹¶é€šçŸ¥Follwerè¿›è¡ŒæŠ•ç¥¨</li>
<li>FollweræŠŠæŠ•ç¥¨ç»“æœå‘é€ç»™Leader</li>
<li>Leaderå°†ç»“æœæ±‡æ€»åå¦‚æœéœ€è¦å†™å…¥ï¼Œåˆ™å¼€å§‹å†™å…¥åŒæ—¶æŠŠå†™å…¥æ“ä½œé€šçŸ¥ç»™Leaderç„¶åcommit;</li>
<li>FollweræŠŠè¯·æ±‚ç»“æœè¿”å›ç»™Client</li>
</ol>
<h1>Zookeeperé›†ç¾¤çš„ä¸¤ç§è¿è¡ŒçŠ¶æ€</h1>
<h2 id="leaderå¯ç”¨çŠ¶æ€">leaderå¯ç”¨çŠ¶æ€</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210228144112.png" alt="image-20210228144111968"></p>
<h2 id="leaderä¸å¯ç”¨çŠ¶æ€">leaderä¸å¯ç”¨çŠ¶æ€</h2>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210228144131.png" alt="image-20210228144131837"></p>
<p>ä¸å¯ç”¨çŠ¶æ€æ¢å¤åˆ°å¯ç”¨çŠ¶æ€æ ¹æ®å®˜æ–¹æµ‹è¯•<font color=red>å°äº200ms</font></p>
<h1>Zookeeperçš„é›†ç¾¤é€‰ä¸¾</h1>
<p>Leaderé€‰ä¸¾æ˜¯ZooKeeperä¸­æœ€é‡è¦çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ä¿è¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„å…³é”®æ‰€åœ¨ã€‚</p>
<p><a href="https://blog.csdn.net/qq_39554452/article/details/109988266">zookeeperé›†ç¾¤æ­å»ºåŠé€‰ä¸¾æ¨¡å¼</a></p>
<h2 id="æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„é€‰ä¸¾">æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„é€‰ä¸¾</h2>
<h3 id="æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„Leaderé€‰ä¸¾">æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„Leaderé€‰ä¸¾</h3>
<p>Leaderé€‰ä¸¾çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>éšå¼æ¡ä»¶ä¾¿æ˜¯ZooKeeperçš„é›†ç¾¤è§„æ¨¡è‡³å°‘æ˜¯2å°æœºå™¨</strong>ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥3å°æœºå™¨ç»„æˆçš„æœåŠ¡å™¨é›†ç¾¤ä¸ºä¾‹ã€‚åœ¨æœåŠ¡å™¨é›†ç¾¤åˆå§‹åŒ–é˜¶æ®µï¼Œå½“æœ‰ä¸€å°æœåŠ¡å™¨(æˆ‘ä»¬å‡è®¾è¿™å°æœºå™¨çš„myidä¸º1ï¼Œå› æ­¤ç§°å…¶ä¸ºServer1)å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒæ˜¯æ— æ³•å®ŒæˆLeaderé€‰ä¸¾çš„ã€‚å½“ç¬¬äºŒèƒæœºå™¨(åŒæ ·ï¼Œæˆ‘ä»¬å‡è®¾è¿™å°æœåŠ¡å™¨çš„myidæ˜¯2ï¼Œç§°å…¶ä¸ºServer2)ä¹Ÿå¯åŠ¨åï¼Œæ­¤æ—¶è¿™ä¸¤å°æœºå™¨å·²ç»èƒ½å¤Ÿè¿›è¡Œäº’ç›¸é€šä¿¡ï¼Œæ¯å°æœºå™¨éƒ½è¯•å›¾æ‰¾åˆ°ä¸€ä¸ªLeaderï¼Œäºæ˜¯ä¾¿è¿›å…¥äº†Leaderé€‰ä¸¾æµç¨‹ã€‚</p>
<ol>
<li>
<p>æ¯ä¸ªServerä¼šå‘å‡ºä¸€ä¸ªæŠ•ç¥¨ï¼Œç”±äºæ˜¯åˆå§‹æƒ…å†µï¼Œå› æ­¤å¯¹äºServer1å’ŒServer2æ¥è¯´ï¼Œéƒ½ä¼šå°†è‡ªå·±ä½œä¸ºLeaderæœåŠ¡å™¨æ¥è¿›è¡ŒæŠ•ç¥¨ï¼Œæ¯æ¬¡æŠ•ç¥¨åŒ…å«æœ€åŸºæœ¬çš„å…ƒç´ æœ‰ï¼šæ‰€æ¨ä¸¾çš„æœåŠ¡å™¨çš„myidå’ŒZXIDï¼Œæˆ‘ä»¬ä»¥(myid,ZXID)çš„å½¢å¼æ¥è¡¨ç¤ºã€‚å› ä¸ºæ˜¯åˆå§‹åŒ–é˜¶æ®µï¼Œå› æ­¤æ— è®ºæ˜¯Server1è¿˜æ˜¯Server2,éƒ½ä¼šæŠ•ç»™è‡ªå·±ï¼Œå³Server1çš„æŠ•ç¥¨ä¸º(1,0),Server2çš„æŠ•ç¥¨ä¸º(2,0),ç„¶åå„è‡ªå°†è¿™ä¸ªæŠ•ç¥¨å‘ç»™é›†ç¾¤ä¸­å…¶ä»–æ‰€æœ‰æœºå™¨ã€‚</p>
</li>
<li>
<p>æ¥æ”¶æ¥è‡ªå„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½ä¼šæ¥æ”¶æ¥è‡ªå…¶ä»–æœåŠ¡å™¨çš„æŠ•ç¥¨ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°æŠ•ç¥¨åï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¯¥æŠ•ç¥¨çš„æœ‰æ•ˆæ€§ï¼ŒåŒ…æ‹¬æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬è½®æŠ•ç¥¨ï¼Œæ˜¯å¦æ¥è‡ªLOOKINGçŠ¶æ€çš„æœåŠ¡å™¨ã€‚</p>
</li>
<li>
<p>å¤„ç†æŠ•ç¥¨ï¼Œåœ¨æ¥æ”¶åˆ°æ¥è‡ªå…¶ä»–æœåŠ¡å™¨çš„æŠ•ç¥¨åï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªæŠ•ç¥¨ï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦å°†åˆ«äººçš„æŠ•ç¥¨å’Œè‡ªå·±çš„æŠ•ç¥¨è¿›è¡ŒPKï¼ŒPKçš„<strong>æ­¥éª¤åŠå¤„ç†æµç¨‹</strong>å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>==ç»Ÿè®¡æŠ•ç¥¨==ï¼Œæ¯æ¬¡æŠ•ç¥¨åï¼ŒæœåŠ¡å™¨éƒ½ä¼šç»Ÿè®¡æ‰€æœ‰æŠ•ç¥¨ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰è¿‡åŠçš„åŠå…¶æ¥æ”¶åˆ°ç›¸åŒçš„æŠ•ç¥¨ä¿¡æ¯ã€‚å¯¹äºServer1å’ŒServer2æœåŠ¡å™¨æ¥è¯´ï¼Œéƒ½ç»Ÿè®¡å‡ºé›†ç¾¤ä¸­å·²ç»æœ‰ä¸¤å°æœºå™¨æ¥å—äº†(2,0)è¿™ä¸ªæŠ•ç¥¨ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å¯¹â€œè¿‡åŠâ€çš„æ¦‚å¿µåšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚æ‰€æœ‰â€œè¿‡åŠâ€å°±æ˜¯æŒ‡å¤§äºé›†ç¾¤æœºå™¨æ•°é‡çš„ä¸€åŠï¼Œå³å¤§äºæˆ–ç­‰äº(n/2+1)ã€‚å¯¹äºè¿™é‡Œç”±3å°æœºå™¨æ„æˆçš„é›†ç¾¤ï¼Œå¤§äºç­‰äº2å°å³ä¸ºè¾¾åˆ°â€œè¿‡åŠâ€è¦æ±‚ã€‚ï¼Œå½“<strong>é€‰ä¸¾ç¥¨æ•°æœºå™¨ç›¸åŒ</strong></p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¼˜å…ˆæ£€æŸ¥ZXIDï¼ŒZXIDæ¯”è¾ƒå¤§çš„æœåŠ¡å™¨ä¼˜å…ˆä½œä¸ºLeader</span><br><span class="line"></span><br><span class="line">å¦‚æœZXIDç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒmyidã€‚myidæ¯”è¾ƒå¤§çš„æœåŠ¡å™¨ä½œä¸ºLeaderæœåŠ¡å™¨</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>==æ”¹å˜æœåŠ¡å™¨çŠ¶æ€==ï¼Œä¸€æ—¦ç¡®å®šLeaderï¼Œæ¯ä¸ªæœåŠ¡å™¨å°±ä¼šæ›´æ–°è‡ªå·±çš„çŠ¶æ€ã€‚å¦‚æœæ˜¯Followerï¼Œé‚£ä¹ˆå°±å˜æ›´ä¸ºFOLLOWINGï¼Œå¦‚æœæ˜¯Leaderï¼Œé‚£ä¹ˆå°±å˜æ›´ä¸ºLEADINGã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303103925.png" alt=""></p>
</li>
</ol>
</li>
</ol>
<h3 id="æœåŠ¡å™¨è¿è¡Œæ—¶æœŸçš„Leaderé€‰ä¸¾">æœåŠ¡å™¨è¿è¡Œæ—¶æœŸçš„Leaderé€‰ä¸¾</h3>
<p>åœ¨Zookeeperé›†ç¾¤æ­£å¸¸è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ<strong>ä¸€æ—¦é€‰å‡ºä¸€ä¸ªLeaderï¼Œé‚£ä¹ˆæ‰€æœ‰æœåŠ¡å™¨çš„é›†ç¾¤è§’è‰²ä¸€èˆ¬ä¸ä¼šå†å‘ç”Ÿå˜åŒ–</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒLeaderæœåŠ¡å™¨å°†ä¸€ç›´ä½œä¸ºé›†ç¾¤çš„Leaderï¼Œ<strong>å³ä½¿é›†ç¾¤ä¸­æœ‰éLeaderæŒ‚äº†æˆ–æœ‰æ–°æœºå™¨åŠ å…¥é›†ç¾¤ä¹Ÿä¸ä¼šå½±å“Leader</strong>ã€‚ä½†æ˜¯<strong>ä¸€æ—¦Leaderæ‰€åœ¨æœºå™¨æŒ‚äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°†æš‚æ—¶æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ï¼Œè€Œæ˜¯è¿›å…¥æ–°ä¸€è½®çš„Leaderé€‰ä¸¾</strong>ã€‚æœåŠ¡å™¨è¿è¡ŒæœŸé—´çš„Leaderé€‰ä¸¾å’Œå¯åŠ¨æ—¶æœŸçš„Leaderé€‰ä¸¾åŸºæœ¬è¿‡ç¨‹ä¸€è‡´çš„ã€‚</p>
<h1>ZooKeeperçš„Watch</h1>
<p>Zookeeperæä¾›äº†æ•°æ®çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ï¼Œå¤šä¸ªè®¢é˜…è€…å¯åŒæ—¶ç›‘å¬æŸä¸€ç‰¹å®šä¸»é¢˜å¯¹è±¡ï¼Œå½“è¯¥ä¸»é¢˜å¯¹è±¡çš„è‡ªèº«çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶(ä¾‹å¦‚èŠ‚ç‚¹å†…å®¹æ”¹å˜ã€èŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨æ”¹å˜ç­‰)ï¼Œä¼šå®æ—¶ã€ä¸»åŠ¨é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚</p>
<p>Zookeeperé‡‡ç”¨äº†Watcheræœºåˆ¶å®ç°æ•°æ®çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚è¯¥æœºåˆ¶åœ¨è¢«è®¢é˜…å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ä¼šå¼‚æ­¥é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸å¿…åœ¨Watcheræ³¨å†Œåè½®è¯¢é˜»å¡ï¼Œä»è€Œå‡è½»äº†å®¢æˆ·ç«¯å‹åŠ›ã€‚</p>
<blockquote>
<p>Watcheræœºåˆ¶å®é™…ä¸Š<strong>ä¸è§‚å¯Ÿè€…æ¨¡å¼ç±»ä¼¼</strong>ï¼Œä¹Ÿå¯çœ‹ä½œæ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„å®ç°æ–¹å¼ã€‚</p>
</blockquote>
<h2 id="watcheræ¶æ„">watcheræ¶æ„</h2>
<p>Watcherå®ç°ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ZookeeperæœåŠ¡ç«¯ï¼›</li>
<li>Zookeeperå®¢æˆ·ç«¯ï¼›</li>
<li>å®¢æˆ·ç«¯çš„ZKWatchManagerå¯¹è±¡ï¼›</li>
</ul>
<p>å®¢æˆ·ç«¯é¦–å…ˆå°†Watcheræ³¨å†Œåˆ°æœåŠ¡ç«¯ï¼ŒåŒæ—¶å°†Watcherå¯¹è±¡ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„Watchç®¡ç†å™¨ä¸­ã€‚å½“ZooKeeperæœåŠ¡ç«¯ç›‘å¬çš„æ•°æ®çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯ï¼Œæ¥ç€å®¢æˆ·ç«¯çš„Watchç®¡ç†å™¨ä¼šè§¦å‘ç›¸å…³Watcheræ¥å›è°ƒç›¸åº”å¤„ç†é€»è¾‘ï¼Œä»è€Œå®Œæˆæ•´ä½“çš„æ•°æ®å‘å¸ƒ/è®¢é˜…æµç¨‹ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303104435.png" alt="image-20210303104435501"></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210303104900.webp" alt="img"></p>
<p>æ­¤æ—¶å°çº¢æ——æ˜¯ä¸€ä¸ªwatcherï¼Œå½“å°çº¢æ——è¢«åˆ›å»ºå¹¶æ³¨å†Œåˆ°node1èŠ‚ç‚¹(ä¼šæœ‰ç›¸åº”çš„APIå®ç°)åï¼Œå°±ä¼šç›‘å¬node1+node_a+node_bæˆ–node_a+node_bã€‚è¿™é‡Œä¸¤ç§æƒ…å†µæ˜¯å› ä¸ºåœ¨åˆ›å»ºwatcheræ³¨å†Œæ—¶ä¼šæœ‰å¤šç§é€”å¾„ã€‚å¹¶ä¸”watcherä¸èƒ½ç›‘å¬åˆ°å­™èŠ‚ç‚¹ã€‚æ³¨æ„æ³¨æ„æ³¨æ„ï¼Œwatcherè®¾ç½®åï¼Œä¸€æ—¦è§¦å‘ä¸€æ¬¡åå°±ä¼šå¤±æ•ˆï¼Œå¦‚æœè¦æƒ³ä¸€ç›´ç›‘å¬ï¼Œéœ€è¦åœ¨processå›è°ƒå‡½æ•°é‡Œé‡æ–°æ³¨å†Œç›¸åŒçš„ <strong>watcher</strong>ã€‚</p>
<h2 id="Watcherç‰¹æ€§">Watcherç‰¹æ€§</h2>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸€æ¬¡æ€§</td>
<td>Watcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šç§»é™¤ï¼Œå†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œ</td>
</tr>
<tr>
<td>å®¢æˆ·ç«¯é¡ºåºå›è°ƒ</td>
<td>Watcherå›è°ƒæ˜¯é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œçš„ï¼Œåªæœ‰å›è°ƒåå®¢æˆ·ç«¯æ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ä¸€ä¸ªWatcherå›è°ƒé€»è¾‘ä¸åº”è¯¥å¤ªå¤šï¼Œä»¥å…å½±å“åˆ«çš„watcheræ‰§è¡Œ</td>
</tr>
<tr>
<td>è½»é‡çº§</td>
<td>WatchEventæ˜¯æœ€å°çš„é€šä¿¡å•å…ƒï¼Œç»“æ„ä¸ŠåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œå¹¶ä¸ä¼šå‘Šè¯‰æ•°æ®èŠ‚ç‚¹å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ï¼›</td>
</tr>
<tr>
<td>æ—¶æ•ˆæ€§</td>
<td>Watcheråªæœ‰åœ¨å½“å‰sessionå½»åº•å¤±æ•ˆæ—¶æ‰ä¼šæ— æ•ˆï¼Œè‹¥åœ¨sessionæœ‰æ•ˆæœŸå†…å¿«é€Ÿé‡è¿æˆåŠŸï¼Œåˆ™watcherä¾ç„¶å­˜åœ¨ï¼Œä»å¯æ¥æ”¶åˆ°é€šçŸ¥ï¼›</td>
</tr>
</tbody>
</table>
<h1>Zookeeperé¡ºåºä¸€è‡´æ€§ç®€å•éªŒè¯</h1>
<ol>
<li>
<p>å¯åŠ¨ä¸‰ä¸ª1ï¼Œ2ï¼Œ3ä¸‰ä¸ªèŠ‚ç‚¹(å…±å››ä¸ªèŠ‚ç‚¹)ï¼Œä¸‰ä¸ªèŠ‚ç‚¹å·²ç»å¯ä»¥é€‰ä¸¾å‡ºleader</p>
<p><code>./bin/zkServer.sh start-foreground</code></p>
<p><strong>èŠ‚ç‚¹1æ—¥å¿—</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302121105.png" alt="image-20210302121105538"></p>
<p><strong>èŠ‚ç‚¹2æ—¥å¿—</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302121316.png" alt="image-20210302121316291"></p>
<p><strong>èŠ‚ç‚¹3æ—¥å¿—</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302123647.png" alt="image-20210302123647739"></p>
</li>
<li>
<p>å¯åŠ¨èŠ‚ç‚¹4</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302124033.png" alt=""></p>
</li>
<li>
<p>è¿æ¥3ï¼Œ4èŠ‚ç‚¹å¹¶æ–°å¢æ•°æ®ï¼Œä¼šå‘ç°cZxidä¼šè‡ªå¢</p>
<p><code>./bin/zkCli.sh -server 127.0.0.1:12183</code></p>
<p><code>./bin/zkCli.sh -server 127.0.0.1:12184</code></p>
<p><code>create -s /ooxx/xxx</code></p>
<p><code>get -s /ooxx/xxx</code></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302124819.png" alt="image-20210302124819564"></p>
<p>å½“è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨mzxidï¼ˆè¯¥æ•°æ®èŠ‚ç‚¹è¢«ä¿®æ”¹æ—¶æœ€æ–°çš„äº‹åŠ¡idï¼‰å­—æ®µåŠ 1</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302125027.png" alt="image-20210302125027621"></p>
<p>4.åœ¨æ­¤æ—¶ä¸­æ–­leaderè¿›ç¨‹ï¼Œå¹¶åœ¨4èŠ‚ç‚¹ç»§ç»­æ–°å¢ç›¸å…³æ•°æ®</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302130145.png" alt=""></p>
<p><strong>mZxidå‰ä¸¤æ¬¡ï¼ˆå‰©ä½™2ä¸ªfollowingèŠ‚ç‚¹ï¼‰äº‹åŠ¡æ˜¯è¿›è¡Œäº†æ•°æ®åŒæ­¥ï¼Œç¬¬ä¸‰æ¬¡äº‹åŠ¡æ‰æ˜¯ä¿®æ”¹/ooxxèŠ‚ç‚¹æ•°æ®</strong></p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302130252.png" alt="image-20210302130252033"></p>
<p>5.ä¸åŒå®¢æˆ·ç«¯åˆ›å»ºåŒä¸€ä¸ªèŠ‚ç‚¹</p>
<p><strong>leaderä¼šåœ¨æ­¤èŠ‚ç‚¹è¿›è¡Œé€’å¢ï¼Œä¸ä¼šè¦†ç›–åˆ›å»º</strong>ï¼Œè§„é¿æ•°æ®è¢«è¦†ç›–</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302130554.png" alt="image-20210302130554281"></p>
</li>
</ol>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302130614.png" alt="image-20210302130614931"></p>
<p>å½“åˆ é™¤èŠ‚ç‚¹é‡æ–°åˆ›å»ºï¼Œä½†æ˜¯æ•°æ®åä¼šç»§ç»­é€’å¢ï¼ˆleadeå†…éƒ¨ç»´æŠ¤ï¼‰</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210302130920.png" alt="image-20210302130920351"></p>
<h1>Zookeeperçš„åº”ç”¨åœºæ™¯</h1>
<ol>
<li>ç»Ÿä¸€çš„é…ç½®ç®¡ç†  ------------èŠ‚ç‚¹ä¸‹å¯ä»¥å­˜å‚¨1Mçš„æ•°æ®</li>
<li>åˆ†ç»„ç®¡ç†              --------------Zookeeperçš„æ ‘ç»“æ„ï¼Œå¯ä»¥æœ‰å¤šä¸ªèŠ‚ç‚¹</li>
<li>ç»Ÿä¸€å‘½å              -------------é¡ºåºä¸€è‡´æ€§çš„èƒ½åŠ›ï¼ˆä¸ä¼šè¦†ç›–æ•°æ®ï¼‰</li>
<li>åˆ†å¸ƒå¼åŒæ­¥          -------------ä¸´æ—¶èŠ‚ç‚¹
<ul>
<li>åˆ†å¸ƒå¼é”   ---------ä¸´æ—¶èŠ‚ç‚¹ä¸‹æ”¾ç½®åˆ†å¸ƒå¼é”ï¼ˆsessionæŒ‚æ‰è‡ªåŠ¨æ¶ˆå¤±ï¼Œå°±ä¼šé‡Šæ”¾é”ï¼‰</li>
<li>å¸¦äº‹åŠ¡(é˜Ÿåˆ—å½¢å¼)çš„å…¬å¹³é”   --------------åœ¨æŒä¹…çš„çˆ¶èŠ‚ç‚¹ä¸‹ï¼Œå»ºç«‹å¤šä¸ªåŒçº§åŒå(create -s  ä¼šè‡ªåŠ¨çš„æ·»åŠ åºåˆ—)çš„ä¸´æ—¶èŠ‚ç‚¹ï¼ˆå¯ä»¥æŒæœ‰å¤šæŠŠé”ï¼‰ï¼Œåé¢çš„é”ç›¯ä½å‰é¢çš„é”ï¼ˆ01-02-03ï¼‰</li>
<li>HA,é€‰ä¸»ï¼ˆhadoopï¼‰</li>
</ul>
</li>
<li>å‘å¸ƒè®¢é˜…</li>
</ol>
]]></content>
      <categories>
        <category>ZooKeeper</category>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>ZooKeeper</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­çš„å®¹å™¨</title>
    <url>/posts/5c0b6c7e/</url>
    <content><![CDATA[<h1>å®¹å™¨çš„åˆ†ç±»</h1>
<p>Collection</p>
<ul>
<li>
<p>List</p>
<ul>
<li>Vector</li>
<li>ArrayList</li>
<li>LinkList</li>
<li>CopyOnWriteList</li>
</ul>
</li>
<li>
<p>Set</p>
<ul>
<li>
<p>HashSet</p>
<ul>
<li>LinkedHashSet</li>
</ul>
</li>
<li>
<p>SortedSet</p>
<ul>
<li>TreeSet</li>
</ul>
</li>
<li>
<p>EnumSet</p>
</li>
<li>
<p>CopyOnwriteArraySet</p>
</li>
<li>
<p>ConcurrentSkipListSet</p>
</li>
</ul>
</li>
<li>
<p>Queueï¼ˆJDK1.5æ–°å¢ï¼Œå¯¹å¤šçº¿ç¨‹å‹å¥½ï¼Œå¤šçº¿ç¨‹ä¼˜å…ˆä½¿ç”¨ï¼‰</p>
<ul>
<li>
<p>é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰</p>
<ul>
<li>
<p>TransferQueue</p>
</li>
<li>
<p>PriorityBlockingQueue</p>
</li>
<li>
<p>ArrayBlockingQueue</p>
</li>
<li>
<p>LinkedBlockingQueue</p>
</li>
<li>
<p>SynchonousQueue</p>
</li>
<li>
<p>DelayQueue</p>
</li>
</ul>
</li>
<li>
<p>éé˜»å¡é˜Ÿåˆ—</p>
<ul>
<li>Dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼Œä¸¤è¾¹éƒ½å¯ä»¥è¿›å‡ºï¼‰</li>
<li>ConcurrentLinkedQueue</li>
<li>priorityQueue</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Map</p>
<ul>
<li>HashTable</li>
<li>HashMap
<ul>
<li>LinkHashMap</li>
<li>ConcurrentHashMap</li>
<li>TreeMap</li>
<li>ConcurrentSkipListMap</li>
<li>WeakHashMap</li>
<li>IdentityHashMap</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114233.gif" alt="img"></p>
<h1>Listæ¥å£</h1>
<p>â€‹	Listæ˜¯ç”¨äºå­˜æ”¾å¤šä¸ªå…ƒç´ ï¼Œèƒ½å¤Ÿç»´æŠ¤å…ƒç´ çš„æ¬¡åºï¼Œå¹¶ä¸”å…è®¸å…ƒç´ çš„é‡å¤</p>
<h2 id="ArrayList">ArrayList</h2>
<h3 id="æ¦‚å¿µ">æ¦‚å¿µ</h3>
<p>ArrayListæ˜¯æœ€å¸¸ç”¨çš„Listå®ç°ç±»ï¼Œå†…éƒ¨æ˜¯é€šè¿‡<strong>æ•°ç»„</strong>å®ç°çš„ï¼Œå®ƒå…è®¸å¯¹å…ƒç´ è¿›è¡Œ<strong>å¿«é€Ÿéšæœºè®¿é—®</strong>ã€‚æ•°ç»„çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªå…ƒç´ ä¹‹é—´ä¸èƒ½æœ‰é—´éš”ï¼Œå½“æ•°ç»„å¤§å°ä¸æ»¡è¶³æ—¶éœ€è¦å¢åŠ å­˜å‚¨èƒ½åŠ›ï¼Œå°±è¦è®²å·²ç»æœ‰<strong>æ•°ç»„çš„æ•°æ®å¤åˆ¶åˆ°æ–°çš„å­˜å‚¨ç©ºé—´</strong>ä¸­ã€‚å½“ä»ArrayListçš„ä¸­é—´ä½ç½®æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ç§»åŠ¨ã€ä»£ä»·æ¯”è¾ƒé«˜ã€‚å› æ­¤ï¼Œå®ƒ<strong>é€‚åˆéšæœºæŸ¥æ‰¾å’Œéå†</strong>ï¼Œ<strong>ä¸é€‚åˆæ’å…¥å’Œåˆ é™¤</strong></p>
<ul>
<li>ç»§æ‰¿äº†AbstractList,æ­¤ç±»æä¾› List æ¥å£çš„éª¨å¹²å®ç°ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å®ç°â€éšæœºè®¿é—®â€æ•°æ®å­˜å‚¨ï¼ˆå¦‚æ•°ç»„ï¼‰æ”¯æŒçš„è¯¥æ¥å£æ‰€éœ€çš„å·¥ä½œ.å¯¹äºè¿ç»­çš„è®¿é—®æ•°æ®ï¼ˆå¦‚é“¾è¡¨ï¼‰ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ AbstractSequentialListï¼Œè€Œä¸æ˜¯æ­¤ç±»ã€‚</li>
<li>å®ç°äº†Listæ¥å£,æ„å‘³ç€ArrayListå…ƒç´ æ˜¯æœ‰åºçš„,å¯ä»¥é‡å¤çš„,<strong>å¯ä»¥æœ‰nullå…ƒç´ </strong>çš„é›†åˆ.</li>
<li>å®ç°äº†RandomAccessæ¥å£æ ‡è¯†ç€å…¶æ”¯æŒéšæœºå¿«é€Ÿè®¿é—®,å®é™…ä¸Š,æˆ‘ä»¬æŸ¥çœ‹RandomAccessæºç å¯ä»¥çœ‹åˆ°,å…¶å®é‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰å®šä¹‰.å› ä¸ºArrayListåº•å±‚æ˜¯æ•°ç»„,é‚£ä¹ˆéšæœºå¿«é€Ÿè®¿é—®æ˜¯ç†æ‰€å½“ç„¶çš„,è®¿é—®é€Ÿåº¦O(1)ã€‚</li>
<li>å®ç°äº†Cloneableæ¥å£,æ ‡è¯†ç€å¯ä»¥å®ƒå¯ä»¥è¢«å¤åˆ¶.æ³¨æ„,ArrayListé‡Œé¢çš„clone()å¤åˆ¶å…¶å®æ˜¯æµ…å¤åˆ¶ã€‚</li>
<li>å®ç°äº†Serializable æ ‡è¯†ç€é›†åˆå¯è¢«åºåˆ—åŒ–</li>
</ul>
<h3 id="ArrayListçš„å±æ€§">ArrayListçš„å±æ€§</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//JDK1.8ç‰ˆæœ¬</span></span><br><span class="line">    <span class="comment">//åºåˆ—åŒ–ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8683452581122892189L</span>;</span><br><span class="line">    <span class="comment">//é»˜è®¤çš„æ•°ç»„å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//åˆ›å»ºç©ºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">    <span class="comment">// ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºï¼Œåˆ™é»˜è®¤å¯¹è±¡å†…å®¹é»˜è®¤æ˜¯è¯¥å€¼ </span></span><br><span class="line">    <span class="comment">//å¦‚æœä½¿ç”¨çš„æ˜¯é»˜è®¤çš„æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ™è¿”å›DEFAULTCAPACITY_EMPTY_ELEMENTDATAï¼›å¦‚æœæ˜¯ç”¨æˆ·åœ¨æŒ‡å®šå®¹é‡çš„å¤§å°ä¸º0çš„æ—¶å€™è¿”å›çš„ï¼Œåˆ™è¿”å›çš„æ˜¯EMPTY_ELEMENTDATA</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">    <span class="comment">// å½“å‰æ•°æ®å¯¹è±¡å­˜æ”¾åœ°æ–¹ï¼Œå½“å‰å¯¹è±¡ä¸å‚ä¸åºåˆ—åŒ–(ä¸»è¦æ˜¯å…³é”®å­—transientèµ·ä½œç”¨çš„)  </span></span><br><span class="line">    <span class="keyword">transient</span> Object[] elementData; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line">    <span class="comment">//å½“å‰æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="comment">//æ•°ç»„æœ€å¤§ç¨‹åº¦ä¸º2^32-8ä¸º2147483639</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ArrayListçš„ç›¸å…³æ–¹æ³•">ArrayListçš„ç›¸å…³æ–¹æ³•</h3>
<h4 id="ArrayListçš„æ„é€ æ–¹æ³•">ArrayListçš„æ„é€ æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ— å‚æ„é€  </span></span><br><span class="line"><span class="comment">//åˆ›å»ºçš„æ—¶å€™elementDataé•¿åº¦ä¸º0.å½“è¿›è¡Œç¬¬ä¸€æ¬¡addä¹‹åï¼Œä¼šå˜æˆé»˜è®¤çš„é•¿åº¦10</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//æœ‰å‚æ„é€ </span></span><br><span class="line"><span class="comment">//ä¼ å…¥å‚æ•°ï¼Œåˆ™ä»£è¡¨æŒ‡å®šArrayListçš„åˆå§‹æ•°ç»„é•¿åº¦ï¼Œä¼ å…¥å‚æ•°å¦‚æœæ˜¯å¤§äºç­‰äº0ï¼Œåˆ™ä½¿ç”¨ç”¨æˆ·çš„å‚æ•°åˆå§‹åŒ–ï¼Œå¦‚æœç”¨æˆ·ä¼ å…¥çš„å‚æ•°å°äº0ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">//å½“</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];  </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal Capacity: &quot;</span>+  </span><br><span class="line">                                           initialCapacity);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//å°†Collection&lt;T&gt; c ä¸­ä¿å­˜çš„æ•°æ®ï¼Œé¦–å…ˆè½¬æ¢æˆæ•°ç»„å½¢å¼ï¼ˆtoArrayï¼ˆï¼‰æ–¹æ³•ï¼‰ï¼Œç„¶ååˆ¤æ–­å½“å‰æ•°ç»„é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸º 0 åˆ™åªæƒ³é»˜è®¤æ•°ç»„ï¼ˆEMPTY_ELEMENTDATAï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        elementData = c.toArray();</span><br><span class="line">        <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">            <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">                elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// replace with empty array.</span></span><br><span class="line">            <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤æ—¶æˆ‘ä»¬åˆ›å»ºçš„ArrayListå¯¹è±¡ä¸­çš„elementDataä¸­çš„é•¿åº¦æ˜¯0ï¼Œsizeæ˜¯0,<strong>å½“è¿›è¡Œç¬¬ä¸€æ¬¡addçš„æ—¶å€™ï¼ŒelementDataå°†ä¼šå˜æˆé»˜è®¤çš„é•¿åº¦ï¼š10.</strong></p>
<ul>
<li>ArrayListï¼ˆï¼‰ï¼šæŒ‡å‘ <strong>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</strong>ï¼Œå½“åˆ—è¡¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šé€šè¿‡åˆ¤æ–­æ˜¯ä¸æ˜¯ DEFAULTCAPACITY_EMPTY_ELEMENTDATA è¿™ä¸ªå¯¹è±¡è€Œè®¾ç½®æ•°ç»„é»˜è®¤å¤§å°ã€‚</li>
<li>ArrayList(int initialCapacity)ï¼šå½“ initialCapacity &gt;0 çš„æ—¶å€™ï¼Œè®¾ç½®è¯¥é•¿åº¦ã€‚å¦‚æœ initialCapacity =0ï¼Œåˆ™æŒ‡å‘ <strong>EMPTY_ELEMENTDATA</strong> åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šè®¾ç½®é»˜è®¤æ•°ç»„é•¿åº¦ ã€‚</li>
<li>DEFAULTCAPACITY_EMPTY_ELEMENTDATA ä¸ EMPTY_ELEMENTDATA çš„æœ¬è´¨åŒºåˆ«å°±åœ¨äºï¼Œä¼šä¸ä¼šè®¾ç½®é»˜è®¤çš„æ•°ç»„é•¿åº¦</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//ArrayListçš„sizeæ–¹æ³•è·å–çš„æ˜¯listä¸­çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"> <span class="comment">//é€šè¿‡åå°„è·å–listçš„é•¿åº¦</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListCapacity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getArrayListCapacity</span><span class="params">(ArrayList&lt;?&gt; arrayList)</span> </span>&#123;</span><br><span class="line">        Class&lt;ArrayList&gt; arrayListClass = ArrayList.class;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å– elementData å­—æ®µ</span></span><br><span class="line">            Field field = arrayListClass.getDeclaredField(<span class="string">&quot;elementData&quot;</span>);</span><br><span class="line">            <span class="comment">//å¼€å§‹è®¿é—®æƒé™</span></span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//æŠŠç¤ºä¾‹ä¼ å…¥getï¼Œè·å–å®ä¾‹å­—æ®µelementDataçš„å€¼</span></span><br><span class="line">            Object[] objects = (Object[])field.get(arrayList);</span><br><span class="line">            <span class="comment">//è¿”å›å½“å‰ArrayListå®ä¾‹çš„å®¹é‡å€¼</span></span><br><span class="line">            <span class="keyword">return</span> objects.length;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-2-ArrayListçš„æ–¹æ³•">2.1.3.2 ArrayListçš„æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–°å¢å…ƒç´ </span></span><br><span class="line">add(E element)</span><br><span class="line">add(<span class="keyword">int</span> i , E element)</span><br><span class="line">addAll(Collection)</span><br><span class="line">addAll(<span class="keyword">int</span> indexï¼ŒCollection)</span><br><span class="line"><span class="comment">//ç§»é™¤å…ƒç´ </span></span><br><span class="line">removeï¼ˆ<span class="keyword">int</span> iï¼‰<span class="comment">//ç§»é™¤æŒ‡å®šä½ç½®å…ƒç´ </span></span><br><span class="line">removeï¼ˆE elementï¼‰<span class="comment">//ç§»é™¤æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªä¸elementç›¸åŒçš„å…ƒç´ </span></span><br><span class="line">removeRangeï¼ˆ<span class="keyword">int</span> start,<span class="keyword">int</span> endï¼‰<span class="comment">//ç§»é™¤æŒ‡å®šèŒƒå›´çš„å…ƒç´ </span></span><br><span class="line">clear()<span class="comment">//æ¸…é™¤æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">removeAll(Collection c)<span class="comment">//ç§»é™¤æ•°ç»„ä¸­æ‰€æœ‰å’Œcä¸­æœ‰äº¤é›†çš„å…ƒç´ </span></span><br><span class="line">size() ;<span class="comment">//è·å–æ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼ˆéæ•°ç»„é•¿åº¦ï¼‰</span></span><br><span class="line">set();<span class="comment">//è®¾ç½®æ•°ç»„ä¸­æŒ‡å®šä½ç½®å…ƒç´ å€¼</span></span><br><span class="line">get(<span class="keyword">int</span> index);  <span class="comment">//index -- è¯¥å…ƒç´ è¿”å›çš„ç´¢å¼•å€¼</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-4-ArrayListçš„æ‰©å®¹æœºåˆ¶">2.1.4 ArrayListçš„æ‰©å®¹æœºåˆ¶</h3>
<h5 id="æ‰©å®¹æ­¥éª¤">æ‰©å®¹æ­¥éª¤</h5>
<p>â€‹     æ€»çš„æ¥è¯´å°±æ˜¯åˆ†ä¸¤æ­¥ï¼š</p>
<p>1ã€æ‰©å®¹</p>
<p>â€‹      æŠŠåŸæ¥çš„æ•°ç»„å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜ç©ºé—´æ›´å¤§çš„æ•°ç»„ä¸­</p>
<p>2ã€æ·»åŠ å…ƒç´ </p>
<p>â€‹        æŠŠæ–°å…ƒç´ æ·»åŠ åˆ°æ‰©å®¹ä»¥åçš„æ•°ç»„ä¸­ï¼Œæ‰©å®¹é•¿åº¦æœªåŸæ•°ç»„çš„1.5å€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// overflow-conscious code</span></span><br><span class="line">      <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="comment">//å³ç§»è¿ç®—ç¬¦(æé«˜æ•ˆç‡)   åŸæ¥é•¿åº¦çš„ä¸€åŠ å†åŠ ä¸ŠåŸé•¿åº¦ä¹Ÿå°±æ˜¯æ¯æ¬¡æ‰©å®¹æ˜¯åŸæ¥çš„1.5å€</span></span><br><span class="line">      <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">          newCapacity = minCapacity;</span><br><span class="line">      <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">          newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">      <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">      elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-1-5-å®ç°ArrayListçº¿ç¨‹å®‰å…¨æ–¹å¼">2.1.5 å®ç°ArrayListçº¿ç¨‹å®‰å…¨æ–¹å¼</h3>
<ol>
<li>æ·»åŠ Synchronizeå…³é”®å­—ï¼ˆVectorå®¹å™¨ï¼‰</li>
<li>ä½¿ç”¨Collectionsçš„Collections.<strong>synchronizedList</strong>(new ArrayList&lt;&gt;());æ–¹æ³•</li>
<li><strong>CopyOnWriteArrayListï¼ˆè¯¦æƒ…è§ä¸‹ï¼‰</strong></li>
</ol>
<h2 id="Vector">Vector</h2>
<p>Vectorä¸ArrayListä¸€æ ·ï¼Œä¹Ÿæ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œä¸åŒçš„æ˜¯å®ƒ<strong>æ”¯æŒçº¿ç¨‹çš„åŒæ­¥</strong>ï¼Œå³æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿå†™Vectorï¼Œé¿å…å¤šçº¿ç¨‹åŒæ—¶å†™è€Œå¼•èµ·çš„ä¸ä¸€è‡´æ€§ï¼Œä½†å®ç°åŒæ­¥éœ€è¦å¾ˆé«˜çš„èŠ±è´¹ï¼Œå› æ­¤ï¼Œè®¿é—®å®ƒæ¯”è®¿é—®ArrayListæ…¢ã€‚<strong>Vectoræ¯æ¬¡è¯·æ±‚å…¶å¤§å°çš„åŒå€ç©ºé—´</strong></p>
<h2 id="LinkList">LinkList</h2>
<p>LinkedListæ˜¯ä¸€ä¸ª<strong>åŒå‘å¾ªç¯é“¾è¡¨</strong>çš„ï¼Œåœ¨<strong>æ·»åŠ å’Œåˆ é™¤å…ƒç´ æ—¶å…·æœ‰æ¯”ArrayListæ›´å¥½çš„æ€§èƒ½</strong>ã€‚ä½†åœ¨getä¸setæ–¹é¢å¼±äºArrayListã€‚<strong>çº¿ç¨‹éå®‰å…¨</strong>ï¼Œå¯ä»¥ç”¨<strong>Collectionsçš„synchronizedList</strong>ä¸­ç›¸å…³æ–¹æ³•å®ç°çº¿ç¨‹å®‰å…¨</p>
<h2 id="CopyOnWriteList">CopyOnWriteList</h2>
<p>CopyOnWriteArrayListè¿™æ˜¯ä¸€ä¸ªArrayListçš„<strong>çº¿ç¨‹å®‰å…¨çš„å˜ä½“</strong>ï¼Œå…¶åŸç†å¤§æ¦‚å¯ä»¥é€šä¿—çš„ç†è§£ä¸º:åˆå§‹åŒ–çš„æ—¶å€™åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œå¾ˆå¸¸ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¸ªå®¹å™¨æ•°æ®ã€æ•°é‡ç­‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¤§å®¶(å¤šä¸ªçº¿ç¨‹)ï¼Œéƒ½æ˜¯è¯»å–(å‡è®¾è¿™æ®µæ—¶é—´é‡Œåªå‘ç”Ÿè¯»å–çš„æ“ä½œ)åŒä¸€ä¸ªå®¹å™¨ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™æ ·å¤§å®¶è¯»åˆ°çš„æ•°æ®éƒ½æ˜¯å”¯ä¸€ã€ä¸€è‡´ã€å®‰å…¨çš„ï¼Œä½†æ˜¯åæ¥æœ‰äººå¾€é‡Œé¢å¢åŠ äº†ä¸€ä¸ªæ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™<strong>CopyOnWriteArrayList åº•å±‚å®ç°æ·»åŠ çš„åŸç†æ˜¯å…ˆcopyå‡ºä¸€ä¸ªå®¹å™¨</strong>(å¯ä»¥ç®€ç§°å‰¯æœ¬)ï¼Œ<strong>å†å¾€æ–°çš„å®¹å™¨é‡Œæ·»åŠ è¿™ä¸ªæ–°çš„æ•°æ®ï¼Œæœ€åæŠŠæ–°çš„å®¹å™¨çš„å¼•ç”¨åœ°å€èµ‹å€¼ç»™äº†ä¹‹å‰é‚£ä¸ªæ—§çš„çš„å®¹å™¨åœ°å€ï¼Œä½†æ˜¯åœ¨æ·»åŠ è¿™ä¸ªæ•°æ®çš„æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœè¦å»è¯»å–æ•°æ®ï¼Œä»ç„¶æ˜¯è¯»å–åˆ°æ—§çš„å®¹å™¨é‡Œçš„æ•°æ®ï¼Œè¿™æ ·åªèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶æ€§ï¼Œå¹¶ä¸”å†…å­˜å ç”¨å¤š</strong></p>
<h1>Setæ¥å£</h1>
<p>Setæ¥å£çš„ç‰¹ç‚¹æ˜¯<strong>æ— åº(æ²¡æœ‰ä¸‹æ ‡) é›†åˆä¸­çš„å…ƒç´ ä¸é‡å¤</strong>ï¼ŒSetåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ç›¸åŒä¸æ˜¯ä½¿ç”¨==è¿ç®—ç¬¦ï¼Œè€Œæ˜¯æ ¹æ®<strong>equals</strong>æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ç”¨equalsæ–¹æ³•æ¯”è¾ƒè¿”å›trueï¼ŒSetå°±ä¸ä¼šæ¥å—è¿™ä¸¤ä¸ªå¯¹è±¡ã€‚</p>
<h3 id="HashSet">HashSet</h3>
<ul>
<li>å®ƒå­˜å‚¨å”¯ä¸€å…ƒç´ å¹¶å…è®¸ç©ºå€¼ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªNULLå€¼ï¼‰</li>
<li>å®ƒç”±HashMapæ”¯æŒ</li>
<li>å®ƒä¸ä¿æŒæ’å…¥é¡ºåº</li>
<li>å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
</ul>
<p><strong>HashSetåº•å±‚å£°æ˜äº†ä¸€ä¸ªHashMapï¼ŒHashSetåšäº†ä¸€å±‚åŒ…è£…ï¼Œæ“ä½œHashSeté‡Œçš„å…ƒç´ æ—¶å…¶å®æ˜¯åœ¨æ“ä½œHashMapé‡Œçš„å…ƒç´ </strong></p>
<h4 id="LinkedHashSet">LinkedHashSet</h4>
<p>LinkedHashSeté›†åˆåŒæ ·æ˜¯æ ¹æ®å…ƒç´ çš„hashCodeå€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œä½†æ˜¯å®ƒåŒæ—¶ä½¿ç”¨<strong>é“¾è¡¨</strong>ç»´æŠ¤å…ƒç´ çš„æ¬¡åºã€‚è¿™æ ·ä½¿å¾—å…ƒç´ çœ‹èµ· æ¥åƒæ˜¯ä»¥æ’å…¥é¡º åºä¿å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éå†è¯¥é›†åˆæ—¶å€™ï¼ŒLinkedHashSetå°†ä¼šä»¥å…ƒç´ çš„æ·»åŠ é¡ºåºè®¿é—®é›†åˆçš„å…ƒç´ ã€‚<br>
LinkedHashSetåœ¨è¿­ä»£è®¿é—®Setä¸­çš„å…¨éƒ¨å…ƒç´ æ—¶ï¼Œæ€§èƒ½æ¯”HashSetå¥½ï¼Œä½†æ˜¯æ’å…¥æ—¶æ€§èƒ½ç¨å¾®é€Šè‰²äºHashSetã€‚</p>
<h3 id="SortedSetï¼ˆæ¥å£ï¼‰">SortedSetï¼ˆæ¥å£ï¼‰</h3>
<p>SortedSet æ˜¯ä¸€ä¸ªæœ‰åºçš„æ¥å£,é›†åˆå†…å…ƒç´ æœ‰2ç§æ’åºè§„åˆ™,ä¸€ç§æ˜¯Comparable(è‡ªç„¶æ’åº) å¦ä¸€åˆ™æ˜¯Comparator(æ¯”è¾ƒå™¨æ’åº),</p>
<h4 id="TreeSet">TreeSet</h4>
<p><strong>TreeSetåº•å±‚ä¹Ÿæ˜¯å£°æ˜äº†ä¸€ä¸ªTreeMapï¼Œæ“ä½œTreeSeté‡Œçš„å…ƒç´ å…¶å®æ˜¯æ“ä½œTreeMapé‡Œçš„å…ƒç´ </strong></p>
<p>TreeSetæ˜¯SortedSetæ¥å£çš„<strong>å”¯ä¸€å®ç°ç±»</strong>ï¼ŒTreeSetå¯ä»¥ç¡®ä¿é›†åˆå…ƒç´ å¤„äºæ’åºçŠ¶æ€ã€‚TreeSetæ”¯æŒä¸¤ç§æ’åºæ–¹å¼ï¼Œ<strong>è‡ªç„¶æ’åº</strong> å’Œ<strong>å®šåˆ¶æ’åº</strong>ï¼Œå…¶ä¸­è‡ªç„¶æ’åºä¸ºé»˜è®¤çš„æ’åºæ–¹å¼ã€‚å‘ TreeSetä¸­åŠ å…¥çš„åº”è¯¥æ˜¯åŒä¸€ä¸ªç±»çš„å¯¹è±¡ã€‚</p>
<p>TreeSetåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰çš„æ–¹å¼æ˜¯ä¸¤ä¸ªå¯¹è±¡é€šè¿‡equalsæ–¹æ³•è¿”å›falseï¼Œæˆ–è€…é€šè¿‡CompareToæ–¹æ³•æ¯”è¾ƒæ²¡æœ‰è¿”å›0</p>
<h3 id="EnumSet">EnumSet</h3>
<p><strong>EnumSet æ˜¯ä¸€ä¸ªä¸“ä¸ºæšä¸¾è®¾è®¡çš„é›†åˆç±»ï¼ŒEnumSetä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»æ˜¯æŒ‡å®šæšä¸¾ç±»å‹çš„æšä¸¾å€¼ï¼Œè¯¥æšä¸¾ç±»å‹åœ¨åˆ›å»ºEnumSetæ—¶æ˜¾å¼æˆ–éšå¼åœ°æŒ‡å®š</strong></p>
<ol>
<li>EnumSetçš„é›†åˆå…ƒç´ ä¹Ÿæ˜¯<strong>æœ‰åº</strong>çš„ï¼ŒEnumSetä»¥æšä¸¾å€¼åœ¨Enumç±»å†…çš„å®šä¹‰é¡ºåºæ¥å†³å®šé›†åˆå…ƒç´ çš„é¡ºåºã€‚</li>
<li>EnumSetåœ¨å†…éƒ¨ä»¥ä½å‘é‡çš„å½¢å¼å­˜å‚¨ï¼Œè¿™ç§å­˜å‚¨å½¢å¼éå¸¸ç´§å‡‘ã€é«˜æ•ˆ,å› æ­¤EnumSetå¯¹è±¡å ç”¨å†…å­˜å¾ˆå°ï¼Œè€Œä¸”è¿è¡Œæ•ˆç‡å¾ˆå¥½ã€‚å°¤å…¶æ˜¯è¿›è¡Œæ‰¹é‡æ“ä½œï¼ˆå¦‚è°ƒç”¨containsAll()å’ŒretainAll()æ–¹æ³•ï¼‰æ—¶ï¼Œå¦‚æœå…¶å‚æ•°ä¹Ÿæ˜¯EnumSeté›†åˆï¼Œåˆ™è¯¥æ‰¹é‡æ“ä½œçš„æ‰§è¡Œé€Ÿåº¦ä¹Ÿéå¸¸å¿«ã€‚</li>
<li>EnumSeté›†åˆä¸å…è®¸åŠ å…¥nullå…ƒç´ ï¼Œå¦‚æœè¯•å›¾æ’å…¥nullå…ƒç´ ï¼ŒEnumSetå°†æŠ›å‡ºNullPointerExceptionå¼‚å¸¸ã€‚</li>
<li>EnumSetç±»æ²¡æœ‰æš´éœ²ä»»ä½•æ„é€ å™¨æ¥åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ï¼Œç¨‹åºåº”è¯¥é€šè¿‡å®ƒæä¾›çš„ç±»æ–¹æ³•æ¥åˆ›å»ºEnumSetå¯¹è±¡ã€‚</li>
<li>å¦‚æœåªæ˜¯æƒ³åˆ¤æ–­EnumSetæ˜¯å¦åŒ…å«nullå…ƒç´ æˆ–è¯•å›¾åˆ é™¤nullå…ƒç´ éƒ½ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œåªæ˜¯åˆ é™¤æ“ä½œå°†è¿”å›falseï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•nullå…ƒç´ è¢«åˆ é™¤ã€‚</li>
</ol>
<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<ul>
<li><strong>EnumSet allOf(Class elementType)</strong>: åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šæšä¸¾ç±»é‡Œæ‰€æœ‰æšä¸¾å€¼çš„EnumSeté›†åˆã€‚</li>
<li><strong>EnumSet complementOf(EnumSet e)</strong>: åˆ›å»ºä¸€ä¸ªå…¶å…ƒç´ ç±»å‹ä¸æŒ‡å®šEnumSeté‡Œå…ƒç´ ç±»å‹ç›¸åŒçš„EnumSeté›†åˆï¼Œæ–°EnumSeté›†åˆåŒ…å«åŸEnumSeté›†åˆæ‰€ä¸åŒ…å«çš„ã€æ­¤ç±»æšä¸¾ç±»å‰©ä¸‹çš„æšä¸¾å€¼ï¼ˆå³æ–°EnumSeté›†åˆå’ŒåŸEnumSeté›†åˆçš„é›†åˆå…ƒç´ åŠ èµ·æ¥æ˜¯è¯¥æšä¸¾ç±»çš„æ‰€æœ‰æšä¸¾å€¼ï¼‰ã€‚</li>
<li><strong>EnumSet copyOf(Collection c)</strong>: ä½¿ç”¨ä¸€ä¸ªæ™®é€šé›†åˆæ¥åˆ›å»ºEnumSeté›†åˆã€‚</li>
<li><strong>EnumSet copyOf(EnumSet e)</strong>: åˆ›å»ºä¸€ä¸ªæŒ‡å®šEnumSetå…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹ã€ç›¸åŒé›†åˆå…ƒç´ çš„EnumSeté›†åˆã€‚</li>
<li><strong>EnumSet noneOf(Class elementType)</strong>: åˆ›å»ºä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºæŒ‡å®šæšä¸¾ç±»å‹çš„ç©ºEnumSetã€‚</li>
<li><strong>EnumSet of(E first,Eâ€¦rest)</strong>: åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæšä¸¾å€¼çš„EnumSeté›†åˆï¼Œä¼ å…¥çš„å¤šä¸ªæšä¸¾å€¼å¿…é¡»å±äºåŒä¸€ä¸ªæšä¸¾ç±»ã€‚</li>
<li><strong>EnumSet range(E from,E to)</strong>: åˆ›å»ºä¸€ä¸ªåŒ…å«ä»fromæšä¸¾å€¼åˆ°toæšä¸¾å€¼èŒƒå›´å†…æ‰€æœ‰æšä¸¾å€¼çš„EnumSeté›†åˆã€‚</li>
</ul>
<h3 id="CopyOnwriteArraySet">CopyOnwriteArraySet</h3>
<p>ç±»ä¼¼äº<strong>CopyOnWriteArrayList</strong>ï¼Œåªæ˜¯å¤åˆ¶çš„å®¹å™¨æœ‰æ‰€ä¸åŒ</p>
<h3 id="ConcurrentSkipListSet">ConcurrentSkipListSet</h3>
<p>ConcurrentSkipListSetæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„é›†åˆï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„åœºæ™¯ã€‚<br>
ConcurrentSkipListSetå’ŒTreeSetï¼Œå®ƒä»¬è™½ç„¶éƒ½æ˜¯æœ‰åºçš„é›†åˆã€‚ä½†æ˜¯ï¼Œç¬¬ä¸€ï¼Œå®ƒä»¬çš„çº¿ç¨‹å®‰å…¨æœºåˆ¶ä¸åŒï¼ŒTreeSetæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒConcurrentSkipListSetæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ç¬¬äºŒï¼ŒConcurrentSkipListSetæ˜¯é€šè¿‡ConcurrentSkipListMapå®ç°çš„ï¼Œè€ŒTreeSetæ˜¯é€šè¿‡TreeMapå®ç°çš„ã€‚</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114252.jpg" alt="ConcurrentSkipListSetçš„æ•°æ®ç»“æ„"></p>
<p><strong>è¯´æ˜</strong>ï¼š<br>
(01) ConcurrentSkipListSetç»§æ‰¿äºAbstractSetã€‚å› æ­¤ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé›†åˆã€‚<br>
(02) ConcurrentSkipListSetå®ç°äº†NavigableSetæ¥å£ã€‚å› æ­¤ï¼ŒConcurrentSkipListSetæ˜¯ä¸€ä¸ªæœ‰åºçš„é›†åˆã€‚<br>
(03) ConcurrentSkipListSetæ˜¯é€šè¿‡<strong>ConcurrentSkipListMap</strong>å®ç°çš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªConcurrentNavigableMapå¯¹è±¡mï¼Œè€Œmå¯¹è±¡å®é™…ä¸Šæ˜¯ConcurrentNavigableMapçš„å®ç°ç±»ConcurrentSkipListMapçš„å®ä¾‹ã€‚ConcurrentSkipListMapä¸­çš„å…ƒç´ æ˜¯key-valueé”®å€¼å¯¹ï¼›è€ŒConcurrentSkipListSetæ˜¯é›†åˆï¼Œå®ƒåªç”¨åˆ°äº†ConcurrentSkipListMapä¸­çš„key</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªæ–°çš„ç©º setï¼Œè¯¥ set æŒ‰ç…§å…ƒç´ çš„è‡ªç„¶é¡ºåºå¯¹å…¶è¿›è¡Œæ’åºã€‚</span></span><br><span class="line">ConcurrentSkipListSet()</span><br><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®š collection ä¸­å…ƒç´ çš„æ–° setï¼Œè¿™ä¸ªæ–° set æŒ‰ç…§å…ƒç´ çš„è‡ªç„¶é¡ºåºå¯¹å…¶è¿›è¡Œæ’åºã€‚</span></span><br><span class="line">ConcurrentSkipListSet(Collection&lt;? extends E&gt; c)</span><br><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªæ–°çš„ç©º setï¼Œè¯¥ set æŒ‰ç…§æŒ‡å®šçš„æ¯”è¾ƒå™¨å¯¹å…¶å…ƒç´ è¿›è¡Œæ’åºã€‚</span></span><br><span class="line">ConcurrentSkipListSet(Comparator&lt;? <span class="keyword">super</span> E&gt; comparator)</span><br><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªæ–° setï¼Œè¯¥ set æ‰€åŒ…å«çš„å…ƒç´ ä¸æŒ‡å®šçš„æœ‰åº set åŒ…å«çš„å…ƒç´ ç›¸åŒï¼Œä½¿ç”¨çš„é¡ºåºä¹Ÿç›¸åŒã€‚</span></span><br><span class="line">ConcurrentSkipListSet(SortedSet&lt;E&gt; s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ­¤ set ä¸­ä¸åŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™æ·»åŠ æŒ‡å®šå…ƒç´ ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­å¤§äºç­‰äºç»™å®šå…ƒç´ çš„æœ€å°å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">ceiling</span><span class="params">(E e)</span></span></span><br><span class="line"><span class="function"><span class="comment">// ä»æ­¤ set ä¸­ç§»é™¤æ‰€æœ‰å…ƒç´ ã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ ConcurrentSkipListSet å®ä¾‹çš„æµ…è¡¨å‰¯æœ¬ã€‚</span></span></span><br><span class="line"><span class="function">ConcurrentSkipListSet&lt;E&gt; <span class="title">clone</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›å¯¹æ­¤ set ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºçš„æ¯”è¾ƒå™¨ï¼›å¦‚æœæ­¤ set ä½¿ç”¨å…¶å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">Comparator&lt;? <span class="keyword">super</span> E&gt; <span class="title">comparator</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// å¦‚æœæ­¤ set åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å› trueã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›åœ¨æ­¤ set çš„å…ƒç´ ä¸Šä»¥é™åºè¿›è¡Œè¿­ä»£çš„è¿­ä»£å™¨ã€‚</span></span></span><br><span class="line"><span class="function">Iterator&lt;E&gt; <span class="title">descendingIterator</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­æ‰€åŒ…å«å…ƒç´ çš„é€†åºè§†å›¾ã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">descendingSet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// æ¯”è¾ƒæŒ‡å®šå¯¹è±¡ä¸æ­¤ set çš„ç›¸ç­‰æ€§ã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­å½“å‰ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰å…ƒç´ ã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">first</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­å°äºç­‰äºç»™å®šå…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">floor</span><span class="params">(E e)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ ä¸¥æ ¼å°äº toElementã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">headSet</span><span class="params">(E toElement)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ å°äºï¼ˆæˆ–ç­‰äºï¼Œå¦‚æœ inclusive ä¸º trueï¼‰toElementã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">headSet</span><span class="params">(E toElement, <span class="keyword">boolean</span> inclusive)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­ä¸¥æ ¼å¤§äºç»™å®šå…ƒç´ çš„æœ€å°å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">higher</span><span class="params">(E e)</span></span></span><br><span class="line"><span class="function"><span class="comment">// å¦‚æœæ­¤ set ä¸åŒ…å«ä»»ä½•å…ƒç´ ï¼Œåˆ™è¿”å› trueã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›åœ¨æ­¤ set çš„å…ƒç´ ä¸Šä»¥å‡åºè¿›è¡Œè¿­ä»£çš„è¿­ä»£å™¨ã€‚</span></span></span><br><span class="line"><span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­å½“å‰æœ€åä¸€ä¸ªï¼ˆæœ€é«˜ï¼‰å…ƒç´ ã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">last</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­ä¸¥æ ¼å°äºç»™å®šå…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">lower</span><span class="params">(E e)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è·å–å¹¶ç§»é™¤ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰å…ƒç´ ï¼›å¦‚æœæ­¤ set ä¸ºç©ºï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">pollFirst</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è·å–å¹¶ç§»é™¤æœ€åä¸€ä¸ªï¼ˆæœ€é«˜ï¼‰å…ƒç´ ï¼›å¦‚æœæ­¤ set ä¸ºç©ºï¼Œåˆ™è¿”å› nullã€‚</span></span></span><br><span class="line"><span class="function">E <span class="title">pollLast</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// å¦‚æœæ­¤ set ä¸­å­˜åœ¨æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™å°†å…¶ç§»é™¤ã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span></span><br><span class="line"><span class="function"><span class="comment">// ä»æ­¤ set ä¸­ç§»é™¤åŒ…å«åœ¨æŒ‡å®š collection ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set ä¸­çš„å…ƒç´ æ•°ç›®ã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ èŒƒå›´ä» fromElement åˆ° toElementã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">subSet</span><span class="params">(E fromElement, <span class="keyword">boolean</span> fromInclusive, E toElement, <span class="keyword">boolean</span> toInclusive)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ ä» fromElementï¼ˆåŒ…æ‹¬ï¼‰åˆ° toElementï¼ˆä¸åŒ…æ‹¬ï¼‰ã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">subSet</span><span class="params">(E fromElement, E toElement)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ å¤§äºç­‰äº fromElementã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">tailSet</span><span class="params">(E fromElement)</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ å¤§äºï¼ˆæˆ–ç­‰äºï¼Œå¦‚æœ inclusive ä¸º trueï¼‰fromElementã€‚</span></span></span><br><span class="line"><span class="function">NavigableSet&lt;E&gt; <span class="title">tailSet</span><span class="params">(E fromElement, <span class="keyword">boolean</span> inclusive)</span></span></span><br></pre></td></tr></table></figure>
<h1>Queue</h1>
<p><strong>Queueï¼ˆJDK1.5æ–°å¢ï¼Œå¯¹å¤šçº¿ç¨‹å‹å¥½ï¼Œå¤šçº¿ç¨‹ä¼˜å…ˆä½¿ç”¨ï¼Œçº¿ç¨‹å®‰å…¨ï¼ˆåº•å±‚æœ‰CASæ“ä½œç­‰ç­‰è¿›è¡ŒåŒæ­¥ï¼‰ï¼‰</strong></p>
<p>é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œæ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ•°æ®ç»“æ„ã€‚å®ƒåªå…è®¸åœ¨è¡¨çš„å‰ç«¯ï¼ˆfrontï¼‰è¿›è¡Œåˆ é™¤æ“ä½œï¼Œè€Œåœ¨è¡¨çš„åç«¯ï¼ˆrearï¼‰è¿›è¡Œæ’å…¥æ“ä½œã€‚è¿›è¡Œæ’å…¥æ“ä½œçš„ç«¯ç§°ä¸ºé˜Ÿå°¾ï¼Œè¿›è¡Œåˆ é™¤æ“ä½œçš„ç«¯ç§°ä¸ºé˜Ÿå¤´ã€‚é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œç§°ä¸ºç©ºé˜Ÿåˆ—</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114258.png" alt="é˜Ÿåˆ—çš„ç»§æ‰¿å…³ç³»"></p>
<h2 id="é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰">é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰</h2>
<p>BlockingQueueå³é˜»å¡é˜Ÿåˆ—ï¼Œå®ƒæ˜¯åŸºäº<strong>ReentrantLock</strong>å®ç°ç›¸å…³è¿‡ç¨‹ï¼Œä¾æ®å®ƒçš„åŸºæœ¬åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°Webä¸­çš„é•¿è¿æ¥èŠå¤©åŠŸèƒ½ï¼Œå½“ç„¶å…¶æœ€å¸¸ç”¨çš„è¿˜æ˜¯ç”¨äºå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114301.png" alt="img"></p>
<blockquote>
<p>åœ¨Javaä¸­ï¼ŒBlockingQueueæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„å®ç°ç±»æœ‰<strong>ArrayBlockingQueue</strong>ã€<strong>DelayQueue</strong>ã€ <strong>LinkedBlockingDeque</strong>ã€<strong>PriorityBlockingQueue</strong>ã€<strong>SynchronousQueue</strong>ã€<strong>TransferQueue</strong>ç­‰ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å­˜å‚¨ç»“æ„ä¸Šæˆ–å¯¹å…ƒç´ æ“ä½œä¸Šçš„ä¸åŒï¼Œä½†æ˜¯å¯¹äºtakeä¸putæ“ä½œçš„åŸç†ï¼Œå´æ˜¯ç±»ä¼¼çš„ã€‚</p>
</blockquote>
<p><code>BlockingQueue</code> æ–¹æ³•ä»¥å››ç§å½¢å¼å‡ºç°ï¼Œå¯¹äºä¸èƒ½ç«‹å³æ»¡è¶³ä½†å¯èƒ½åœ¨å°†æ¥æŸä¸€æ—¶åˆ»å¯ä»¥æ»¡è¶³çš„æ“ä½œï¼Œè¿™å››ç§å½¢å¼çš„å¤„ç†æ–¹å¼ä¸åŒï¼šç¬¬ä¸€ç§æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç¬¬äºŒç§æ˜¯è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆ<code>null</code> æˆ– <code>false</code>ï¼Œå…·ä½“å–å†³äºæ“ä½œï¼‰ï¼Œç¬¬ä¸‰ç§æ˜¯åœ¨æ“ä½œå¯ä»¥æˆåŠŸå‰ï¼Œæ— é™æœŸåœ°é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç¬¬å››ç§æ˜¯åœ¨æ”¾å¼ƒå‰åªåœ¨ç»™å®šçš„æœ€å¤§æ—¶é—´é™åˆ¶å†…é˜»å¡ã€‚ä¸‹è¡¨ä¸­æ€»ç»“äº†è¿™äº›æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>ç‰¹æ®Šå€¼</th>
<th>é˜»å¡</th>
<th>è¶…æ—¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ’å…¥</td>
<td><code>add(e)</code></td>
<td><code>offer(e)</code></td>
<td><code>put(e)</code></td>
<td><code>offer(e, time, unit)</code></td>
</tr>
<tr>
<td>ç§»é™¤</td>
<td><code>remove()</code></td>
<td><code>poll()</code></td>
<td><code>take()</code></td>
<td><code>poll(time, unit)</code></td>
</tr>
<tr>
<td>æ£€æŸ¥</td>
<td><code>element()</code></td>
<td><code>peek()</code></td>
<td>ä¸å¯ç”¨</td>
<td>ä¸å¯ç”¨</td>
</tr>
</tbody>
</table>
<h3 id="LinkedBlockingQueue">LinkedBlockingQueue</h3>
<p>LinkedBlockingQueueå’ŒLinkedListä¸€æ ·ï¼Œå†…éƒ¨åŸºäº<strong>é“¾è¡¨</strong>æ¥å­˜æ”¾å…ƒç´ ã€‚LinkedBlockingQueueå¦‚æœä¸æŒ‡å®šå®¹é‡ï¼Œé»˜è®¤ä¸º<code>Integer.MAX_VALUE</code>ï¼Œä¹Ÿå°±æ˜¯<strong>æ— ç•Œé˜Ÿåˆ—</strong>ã€‚æ‰€ä»¥ä¸ºäº†<strong>é¿å…é˜Ÿåˆ—è¿‡å¤§é€ æˆæœºå™¨è´Ÿè½½æˆ–è€…å†…å­˜çˆ†æ»¡</strong>çš„æƒ…å†µå‡ºç°ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å»ºè®®æ‰‹åŠ¨ä¼ ä¸€ä¸ªé˜Ÿåˆ—çš„å¤§å°ã€‚</p>
<p>LinkedBlockingQueueå†…éƒ¨ç”±<strong>å•é“¾è¡¨å®ç°</strong>ï¼Œåªèƒ½ä»headå–å…ƒç´ ï¼Œä»tailæ·»åŠ å…ƒç´ ã€‚æ·»åŠ å…ƒç´ å’Œè·å–å…ƒç´ éƒ½æœ‰ç‹¬ç«‹çš„é”ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>LinkedBlockingQueueæ˜¯è¯»å†™åˆ†ç¦»çš„</strong>ï¼Œè¯»å†™æ“ä½œå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚LinkedBlockingQueueé‡‡ç”¨å¯é‡å…¥é”(**ReentrantLock)**æ¥ä¿è¯åœ¨å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<h4 id="æºç åˆ†æ">æºç åˆ†æ</h4>
<h5 id="å±æ€§">å±æ€§</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èŠ‚ç‚¹ç±»ï¼Œç”¨äºå­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">    Node(E x) &#123; item = x; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** é˜»å¡é˜Ÿåˆ—çš„å¤§å°ï¼Œé»˜è®¤ä¸ºInteger.MAX_VALUE */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> capacity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å½“å‰é˜»å¡é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ªæ•° */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜»å¡é˜Ÿåˆ—çš„å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; head;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜»å¡é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Node&lt;E&gt; last;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è·å–å¹¶ç§»é™¤å…ƒç´ æ—¶ä½¿ç”¨çš„é”ï¼Œå¦‚take, poll, etc */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock takeLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** notEmptyæ¡ä»¶å¯¹è±¡ï¼Œå½“é˜Ÿåˆ—æ²¡æœ‰æ•°æ®æ—¶ç”¨äºæŒ‚èµ·æ‰§è¡Œåˆ é™¤çš„çº¿ç¨‹ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Condition notEmpty = takeLock.newCondition();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æ·»åŠ å…ƒç´ æ—¶ä½¿ç”¨çš„é”å¦‚ put, offer, etc */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock putLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** notFullæ¡ä»¶å¯¹è±¡ï¼Œå½“é˜Ÿåˆ—æ•°æ®å·²æ»¡æ—¶ç”¨äºæŒ‚èµ·æ‰§è¡Œæ·»åŠ çš„çº¿ç¨‹ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Condition notFull = putLock.newCondition();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>LinkedBlockingQueueé˜Ÿåˆ—ä¸­çš„æ•°æ®éƒ½å°†è¢«å°è£…æˆNodeèŠ‚ç‚¹ï¼Œæ·»åŠ çš„é“¾è¡¨é˜Ÿåˆ—ä¸­ï¼Œå…¶ä¸­headå’Œlaståˆ†åˆ«æŒ‡å‘é˜Ÿåˆ—çš„å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹</li>
<li>LinkedBlockingQueueå†…éƒ¨åˆ†åˆ«ä½¿ç”¨äº†takeLock å’Œ putLock å¯¹å¹¶å‘è¿›è¡Œæ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ·»åŠ å’Œåˆ é™¤æ“ä½œå¹¶ä¸æ˜¯äº’æ–¥æ“ä½œï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œï¼Œè¿™æ ·ä¹Ÿå°±å¯ä»¥å¤§å¤§æé«˜ååé‡ã€‚</li>
<li>LinkedBlockingQueueå¯¹æ¯ä¸€ä¸ªlocké”éƒ½æä¾›äº†ä¸€ä¸ªConditionç”¨æ¥æŒ‚èµ·å’Œå”¤é†’å…¶ä»–çº¿ç¨‹ã€‚</li>
</ol>
</blockquote>
<p>LinkedBlockingQueueå¸¸ç”¨æ“ä½œ</p>
<h5 id="å–æ•°æ®">å–æ•°æ®</h5>
<p><strong>take()ï¼šé¦–é€‰ã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶é˜»å¡</strong></p>
<p>poll()ï¼šå¼¹å‡ºé˜Ÿé¡¶å…ƒç´ ï¼Œé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè¿”å›ç©º</p>
<p>peek()ï¼šå’Œpollçƒˆæ€§ï¼Œè¿”å›é˜Ÿé˜Ÿé¡¶å…ƒç´ ï¼Œä½†é¡¶å…ƒç´ ä¸å¼¹å‡ºã€‚é˜Ÿåˆ—ä¸ºç©ºæ—¶è¿”å›null</p>
<p>remove(Object o)ï¼šç§»é™¤æŸä¸ªå…ƒç´ ï¼Œé˜Ÿåˆ—ä¸ºç©ºæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚æˆåŠŸç§»é™¤è¿”å›true</p>
<h5 id="æ·»åŠ æ•°æ®">æ·»åŠ æ•°æ®</h5>
<p><strong>put()ï¼šé¦–é€‰ã€‚é˜Ÿæ»¡æ˜¯é˜»å¡</strong></p>
<p>offer()ï¼šé˜Ÿæ»¡æ—¶è¿”å›false</p>
<h5 id="åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º">åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</h5>
<p><strong>size()æ–¹æ³•ä¼šéå†æ•´ä¸ªé˜Ÿåˆ—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n),æ‰€ä»¥æœ€å¥½é€‰ç”¨isEmtpy</strong></p>
<h5 id="putå…ƒç´ åŸç†">putå…ƒç´ åŸç†</h5>
<p>åŸºæœ¬è¿‡ç¨‹ï¼š</p>
<p>1.åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºnullï¼Œä¸ºnullæŠ›å‡ºå¼‚å¸¸</p>
<p>2.åŠ é”(å¯ä¸­æ–­é”<strong>ReentrantLock</strong>å®ç°)</p>
<p>3.åˆ¤æ–­é˜Ÿåˆ—é•¿åº¦æ˜¯å¦åˆ°è¾¾å®¹é‡ï¼Œå¦‚æœåˆ°è¾¾ä¸€ç›´ç­‰å¾…</p>
<p>4.å¦‚æœæ²¡æœ‰é˜Ÿæ»¡ï¼Œenqueue()åœ¨é˜Ÿå°¾åŠ å…¥å…ƒç´ </p>
<p>5.é˜Ÿåˆ—é•¿åº¦åŠ 1ï¼Œæ­¤æ—¶å¦‚æœé˜Ÿåˆ—è¿˜æ²¡æœ‰æ»¡ï¼Œè°ƒç”¨signalå”¤é†’å…¶ä»–å µå¡é˜Ÿåˆ—</p>
<h3 id="ArrayBlockingQueue">ArrayBlockingQueue</h3>
<p>ArrayBlockingQueueæ˜¯ä¸€ä¸ª<strong>é˜»å¡å¼çš„é˜Ÿåˆ—</strong>ï¼Œç»§æ‰¿è‡ªAbstractBlockingQueue,é—´æ¥çš„å®ç°äº†Queueæ¥å£å’ŒCollectionæ¥å£ã€‚åº•å±‚ä»¥æ•°ç»„çš„å½¢å¼ä¿å­˜æ•°æ®(å®é™…ä¸Šå¯çœ‹ä½œä¸€ä¸ªå¾ªç¯æ•°ç»„)ã€‚å¸¸ç”¨çš„æ“ä½œåŒ…æ‹¬ addï¼Œofferï¼Œputï¼Œremoveï¼Œpollï¼Œtakeï¼Œpeekã€‚</p>
<p>ArrayBlockingQueue è¿›é˜Ÿæ“ä½œé‡‡ç”¨äº†åŠ é”çš„æ–¹å¼ä¿è¯å¹¶å‘å®‰å…¨ã€‚æºä»£ç é‡Œé¢æœ‰ä¸€ä¸ª <strong>while</strong>() åˆ¤æ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Â Â Â  checkNotNull(e); <span class="comment">// éç©ºåˆ¤æ–­</span></span><br><span class="line">Â Â Â  <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">Â Â Â  lock.lockInterruptibly(); <span class="comment">// è·å–é”</span></span><br><span class="line">Â Â Â  <span class="keyword">try</span> &#123;</span><br><span class="line">Â Â Â  Â  Â  <span class="keyword">while</span> (count == items.length) &#123;</span><br><span class="line">Â Â Â  Â  Â  Â  Â  <span class="comment">// ä¸€ç›´é˜»å¡ï¼ŒçŸ¥é“é˜Ÿåˆ—éæ»¡æ—¶ï¼Œè¢«å”¤é†’</span></span><br><span class="line">Â Â Â  Â  Â  Â  Â  notFull.await();</span><br><span class="line">Â Â Â  Â  Â  &#125;</span><br><span class="line">Â Â Â  Â  Â  enqueue(e); <span class="comment">// è¿›é˜Ÿ</span></span><br><span class="line">Â Â Â  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">Â Â Â  Â  Â  lock.unlock();</span><br><span class="line">Â Â Â  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e, <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">Â Â Â  <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Â Â Â  checkNotNull(e);</span><br><span class="line">Â Â Â  <span class="keyword">long</span> nanos = unit.toNanos(timeout);</span><br><span class="line">Â Â Â  <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">Â Â Â  lock.lockInterruptibly();</span><br><span class="line">Â Â Â  <span class="keyword">try</span> &#123;</span><br><span class="line">Â Â Â  Â  Â  <span class="keyword">while</span> (count == items.length) &#123;</span><br><span class="line">Â Â Â  Â  Â  <span class="comment">// é˜»å¡ï¼ŒçŸ¥é“é˜Ÿåˆ—ä¸æ»¡</span></span><br><span class="line">Â Â Â  Â  Â  <span class="comment">// æˆ–è€…è¶…æ—¶æ—¶é—´å·²è¿‡ï¼Œè¿”å›false</span></span><br><span class="line">Â Â Â  Â  Â  Â  Â  <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>)</span><br><span class="line">Â Â Â  Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">Â Â Â  Â  Â  Â  Â  nanos = notFull.awaitNanos(nanos);</span><br><span class="line">Â Â Â  Â  Â  &#125;</span><br><span class="line">Â Â Â  Â  Â  enqueue(e);</span><br><span class="line">Â Â Â  Â  Â  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">Â Â Â  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">Â Â Â  Â  Â  lock.unlock();</span><br><span class="line">Â Â Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸‹é¢çš„è§„å¾‹ï¼š</p>
<ul>
<li>é˜»å¡è°ƒç”¨æ–¹å¼ put(e)æˆ– offer(e, timeout, unit)</li>
<li>é˜»å¡è°ƒç”¨æ—¶ï¼Œå”¤é†’æ¡ä»¶ä¸ºè¶…æ—¶æˆ–è€…é˜Ÿåˆ—éæ»¡ï¼ˆå› æ­¤ï¼Œè¦æ±‚åœ¨å‡ºé˜Ÿæ—¶ï¼Œè¦å‘èµ·ä¸€ä¸ªå”¤é†’æ“ä½œï¼‰</li>
<li>è¿›é˜ŸæˆåŠŸä¹‹åï¼Œæ‰§è¡ŒnotEmpty.signal()å”¤èµ·è¢«é˜»å¡çš„å‡ºé˜Ÿçº¿ç¨‹</li>
</ul>
<p>å‡ºé˜Ÿçš„æºç ç±»ä¼¼ã€‚ArrayBlockingQueue é˜Ÿåˆ—æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºçº¿ç¨‹æ± æ—¶è¿›è¡Œä½¿ç”¨ã€‚</p>
<blockquote>
<p>åœ¨è¿›è¡ŒæŸé¡¹ä¸šåŠ¡å­˜å‚¨æ“ä½œæ—¶ï¼Œå»ºè®®é‡‡ç”¨<strong>offer</strong>è¿›è¡Œæ·»åŠ ï¼Œå¯åŠæ—¶è·å–booleanè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚ç”¨putè¦è€ƒè™‘é˜»å¡æƒ…å†µï¼ˆé˜Ÿåˆ—çš„å‡ºé˜Ÿæ“ä½œæ…¢äºè¿›é˜Ÿæ“ä½œï¼‰ï¼Œèµ„æºå ç”¨</p>
</blockquote>
<h3 id="SynchonousQueue">SynchonousQueue</h3>
<p>SynchronousQueue æ˜¯ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é˜Ÿåˆ—ï¼Œæ„Ÿè§‰éƒ½ä¸èƒ½å«é˜Ÿåˆ—ï¼Œå› ä¸ºå†…éƒ¨æ²¡æœ‰æ•°æ®çš„å­˜å‚¨ç©ºé—´ï¼Œé˜Ÿåˆ—ä¸èƒ½peekï¼Œå› ä¸ºä¸å­˜åœ¨å…ƒç´ ï¼Œä»»ä½•å…¥é˜Ÿçš„çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰çº¿ç¨‹æ¥å‡ºé˜Ÿï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ç»„æ“ä½œï¼Œå…¥é˜Ÿå’Œå‡ºé˜Ÿè¦ä¸€èµ·ç¦»å¼€ï¼Œå‡ºé˜Ÿä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¿…é¡»ç­‰å…¥é˜Ÿï¼Œå¿…é¡»ç»“ä¼´è€Œè¡Œï¼›é˜Ÿåˆ—æ”¯æŒå…¬å¹³å’Œéå…¬å¹³çš„æ¨¡å¼(æŒ‡çš„æ˜¯é˜Ÿåˆ—åŒ¹é…çº¿ç¨‹çš„é¡ºåº)ï¼Œ<strong>å…¬å¹³æ¨¡å¼çš„æ•°æ®ç»“æ„æ˜¯é˜Ÿåˆ—</strong>ï¼ˆFIFOï¼‰ï¼Œ<strong>éå…¬å¹³æ¨¡å¼ä½¿ç”¨çš„æ˜¯æ ˆ</strong>ï¼ˆLIFOï¼‰ã€‚</p>
<h4 id="UMLå›¾">UMLå›¾</h4>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114309.png" alt="image-20200831164258224"></p>
<h4 id="åŸºæœ¬æ–¹æ³•">åŸºæœ¬æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Transferer</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å‡ºé˜Ÿå…¥é˜Ÿéƒ½æ˜¯è¿™ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> E <span class="title">transfer</span><span class="params">(E e, <span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// npuæ•°</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NCPUS = Runtime.getRuntime().availableProcessors();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¸¦è¶…æ—¶æ—¶é—´çš„è‡ªæ—‹æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> maxTimedSpins = (NCPUS &lt; <span class="number">2</span>) ? <span class="number">0</span> : <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ²¡æœ‰è¶…æ—¶çš„è‡ªæ—‹æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> maxUntimedSpins = maxTimedSpins * <span class="number">16</span>;</span><br></pre></td></tr></table></figure>
<h5 id="TransferStack-éå…¬å¹³çš„å®ç°ï¼Œä¸»è¦æ–¹æ³•">TransferStack éå…¬å¹³çš„å®ç°ï¼Œä¸»è¦æ–¹æ³•</h5>
<p>TransferStack ç»§æ‰¿ Transferer</p>
<p>æ³¨æ„ï¼š<strong>è¿™å‡ ä¸ªçŠ¶æ€å¾ˆé‡è¦ï¼Œå› ä¸ºç»§æ‰¿äº†Transfererï¼Œæ‰€ä»¥å‡ºé˜Ÿå’Œå…¥é˜Ÿéƒ½æ˜¯ä½¿ç”¨çš„transferæ–¹æ³•ï¼ŒçŠ¶æ€æ˜¯ç”¨æ¥åŒºåˆ†çš„</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/** 0è¡¨ç¤ºæ¶ˆè´¹è€… */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST    = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/** 1è¡¨ç¤ºæ•°æ®çš„ç”Ÿäº§è€… */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DATA       = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/** 2 è¡¨ç¤ºæ•°æ®æ­£åœ¨åŒ¹é… */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FULFILLING = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">volatile</span> SNode next;        <span class="comment">// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">volatile</span> SNode match;       <span class="comment">// åŒ¹é…çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">volatile</span> Thread waiter;     <span class="comment">// ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">        Object item;                <span class="comment">// æ•°æ®</span></span><br><span class="line">        <span class="keyword">int</span> mode;                   <span class="comment">// æ¨¡å¼ 0 ï¼Œ 1 ï¼Œ 2</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/** å¤´ç»“ç‚¹ */</span></span><br><span class="line"><span class="keyword">volatile</span> SNode head;</span><br></pre></td></tr></table></figure>
<h5 id="TransferQueue-å…¬å¹³å®ç°ï¼Œä¸»è¦æˆå‘˜">TransferQueue å…¬å¹³å®ç°ï¼Œä¸»è¦æˆå‘˜</h5>
<p>TransferQueue ç»§æ‰¿ Transferer</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">QNode</span> </span>&#123;</span><br><span class="line">          <span class="keyword">volatile</span> QNode next;          <span class="comment">// next èŠ‚ç‚¹</span></span><br><span class="line">          <span class="keyword">volatile</span> Object item;         <span class="comment">// æ•°æ®é¡¹</span></span><br><span class="line">          <span class="keyword">volatile</span> Thread waiter;       <span class="comment">// ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">boolean</span> isData;         <span class="comment">// åŒºåˆ†ç”Ÿäº§å’Œæ¶ˆè´¹</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/** å¤´ç»“ç‚¹ */</span></span><br><span class="line">      <span class="keyword">transient</span> <span class="keyword">volatile</span> QNode head;</span><br><span class="line">      <span class="comment">/** å°¾èŠ‚ç‚¹ */</span></span><br><span class="line">      <span class="keyword">transient</span> <span class="keyword">volatile</span> QNode tail;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SynchronousQueue çš„å®ç°è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è™½ç„¶æ˜¯ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå¯æ˜¯æ²¡æœ‰ä½¿ç”¨é”ï¼›è¿™ä¸ªé˜Ÿåˆ—é€‚åˆä¼ é€’çš„åœºæ™¯ï¼Œé˜Ÿåˆ—æ²¡æœ‰å­˜å‚¨å…ƒç´ çš„é˜Ÿåˆ—ï¼Œå‡ºé˜Ÿå’Œå…¥é˜Ÿå¿…é¡»ç»“ä¼´è€Œè¡Œã€‚</p>
<p>è¯¦ç»†çš„æºç è§£æå¯çœ‹  <a href="https://blog.51cto.com/14220760/2416470">https://blog.51cto.com/14220760/2416470</a></p>
</blockquote>
<h3 id="PriorityBlockingQueue">PriorityBlockingQueue</h3>
<p>PriorityBlockingQueueæ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— <strong>ç•Œé˜»å¡é˜Ÿåˆ—</strong>ï¼Œç›´åˆ°ç³»ç»Ÿèµ„æºè€—å°½ã€‚<strong>é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡ç”¨è‡ªç„¶é¡ºåºå‡åºæ’åˆ—</strong>ã€‚ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç±»å®ç°compareTo()æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ æ’åºè§„åˆ™ï¼Œæˆ–è€…åˆå§‹åŒ–PriorityBlockingQueueæ—¶ï¼ŒæŒ‡å®šæ„é€ å‚æ•°Comparatoræ¥å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ä¿è¯åŒä¼˜å…ˆçº§å…ƒç´ çš„é¡ºåºã€‚PriorityBlockingQueueä¹Ÿæ˜¯åŸºäºæœ€å°äºŒå‰å †å®ç°ï¼Œä½¿ç”¨åŸºäº<strong>CASå®ç°çš„è‡ªæ—‹é”</strong>æ¥æ§åˆ¶é˜Ÿåˆ—çš„<strong>åŠ¨æ€æ‰©å®¹</strong>ï¼Œä¿è¯äº†æ‰©å®¹æ“ä½œä¸ä¼šé˜»å¡takeæ“ä½œçš„æ‰§è¡Œ<strong>PriorityBlockingQueueæœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨this(DEFAULT_INITIAL_CAPACITY, null)ï¼Œå³é»˜è®¤çš„å®¹é‡æ˜¯11</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityBlockingQueue</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// æ ¹æ®initialCapacityæ¥è®¾ç½®é˜Ÿåˆ—çš„åˆå§‹å®¹é‡</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityBlockingQueue</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span></span></span><br><span class="line"><span class="function"><span class="comment">// æ ¹æ®initialCapacityæ¥è®¾ç½®é˜Ÿåˆ—çš„åˆå§‹å®¹é‡ï¼Œå¹¶æ ¹æ®comparatorå¯¹è±¡æ¥å¯¹æ•°æ®è¿›è¡Œæ’åº</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityBlockingQueue</span><span class="params">(<span class="keyword">int</span> initialCapacity, Comparator&lt;? <span class="keyword">super</span> E&gt; comparator)</span></span></span><br><span class="line"><span class="function"><span class="comment">// æ ¹æ®é›†åˆæ¥åˆ›å»ºé˜Ÿåˆ—</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityBlockingQueue</span><span class="params">(Collection&lt;? extends E&gt; c)</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æºç è§£æå¯çœ‹https://zhuanlan.zhihu.com/p/63801130</p>
</blockquote>
<h3 id="DelayQueue">DelayQueue</h3>
<p>DelayQueueæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒDelayQueueçš„ç‰¹ç‚¹å°±æ˜¯æ’å…¥Queueä¸­çš„æ•°æ®å¯ä»¥æŒ‰ç…§è‡ªå®šä¹‰çš„delayæ—¶é—´è¿›è¡Œæ’åºã€‚åªæœ‰delayæ—¶é—´å°äº0çš„å…ƒç´ æ‰èƒ½å¤Ÿè¢«å–å‡º</p>
<p>DelayQueueçš„åº•å±‚å­˜å‚¨æ˜¯ä¸€ä¸ªPriorityQueueï¼ŒPriorityQueueæ˜¯ä¸€ä¸ªå¯æ’åºçš„Queueï¼Œå…¶ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Comparableæ–¹æ³•ã€‚è€ŒgetDelayæ–¹æ³•åˆ™ç”¨æ¥åˆ¤æ–­æ’åºåçš„å…ƒç´ æ˜¯å¦å¯ä»¥ä»Queueä¸­å–å‡º</p>
<blockquote>
<p>æºç è§£æå¯çœ‹ <a href="https://zhuanlan.zhihu.com/p/138368078">https://zhuanlan.zhihu.com/p/138368078</a></p>
</blockquote>
<h3 id="TransferQueue">TransferQueue</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransferQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">BlockingQueue</span>&lt;<span class="title">E</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»ç±»çš„æºç å¯ä»¥çœ‹åˆ°TransferQueueåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå®ƒå…·å¤‡<strong>é˜»å¡é˜Ÿåˆ—çš„æ‰€æœ‰ç‰¹æ€§</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransferQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">BlockingQueue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå¯èƒ½ï¼Œç«‹å³å°†å…ƒç´ è½¬ç§»ç»™ç­‰å¾…çš„æ¶ˆè´¹è€…ã€‚ </span></span><br><span class="line">    <span class="comment">// æ›´ç¡®åˆ‡åœ°è¯´ï¼Œå¦‚æœå­˜åœ¨æ¶ˆè´¹è€…å·²ç»ç­‰å¾…æ¥æ”¶å®ƒï¼ˆåœ¨ take æˆ– timed pollï¼ˆlongï¼ŒTimeUnitï¼‰pollï¼‰ä¸­ï¼Œåˆ™ç«‹å³ä¼ é€æŒ‡å®šçš„å…ƒç´ ï¼Œå¦åˆ™è¿”å› falseã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tryTransfer</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å…ƒç´ è½¬ç§»ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœéœ€è¦çš„è¯ç­‰å¾…ã€‚ </span></span><br><span class="line">    <span class="comment">// æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªæ¶ˆè´¹è€…å·²ç»ç­‰å¾…æ¥æ”¶å®ƒï¼ˆåœ¨ take æˆ–timed pollï¼ˆlongï¼ŒTimeUnitï¼‰pollï¼‰ä¸­ï¼Œåˆ™ç«‹å³ä¼ é€æŒ‡å®šçš„å…ƒç´ ï¼Œå¦åˆ™ç­‰å¾…ç›´åˆ°å…ƒç´ ç”±æ¶ˆè´¹è€…æ¥æ”¶ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šé¢æ–¹æ³•çš„åŸºç¡€ä¸Šè®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tryTransfer</span><span class="params">(E e, <span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœè‡³å°‘æœ‰ä¸€ä½æ¶ˆè´¹è€…åœ¨ç­‰å¾…ï¼Œåˆ™è¿”å› true</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasWaitingConsumer</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç­‰å¾…æ¶ˆè´¹è€…äººæ•°çš„ä¼°è®¡å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getWaitingConsumerCount</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>transfer</strong> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xfer(e, <span class="keyword">true</span>, SYNC, <span class="number">0</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Thread.interrupted(); <span class="comment">// failure possible only due to interrupt</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>tryTransfer</strong>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryTransfer</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> xfer(e, <span class="keyword">true</span>, NOW, <span class="number">0</span>) == <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-6-1-xfer-æ–¹æ³•åˆ†æ">1.6.1 xfer æ–¹æ³•åˆ†æ</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">xfer</span><span class="params">(E e, <span class="keyword">boolean</span> haveData, <span class="keyword">int</span> how, <span class="keyword">long</span> nanos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (haveData &amp;&amp; (e == <span class="keyword">null</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Node s = <span class="keyword">null</span>;                        <span class="comment">// the node to append, if needed</span></span><br><span class="line"></span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;                            <span class="comment">// restart on append race</span></span><br><span class="line">        <span class="comment">// ä»  head å¼€å§‹</span></span><br><span class="line">        <span class="keyword">for</span> (Node h = head, p = h; p != <span class="keyword">null</span>;) &#123; <span class="comment">// find &amp; match first node</span></span><br><span class="line">            <span class="comment">// head çš„ç±»å‹ã€‚</span></span><br><span class="line">            <span class="keyword">boolean</span> isData = p.isData;</span><br><span class="line">            <span class="comment">// head çš„æ•°æ®</span></span><br><span class="line">            Object item = p.item;</span><br><span class="line">            <span class="comment">// item != null æœ‰ 2 ç§æƒ…å†µ,ä¸€æ˜¯ put æ“ä½œ, äºŒæ˜¯ take çš„ itme è¢«ä¿®æ”¹äº†(åŒ¹é…æˆåŠŸ)</span></span><br><span class="line">            <span class="comment">// (itme != null) == isData è¦ä¹ˆè¡¨ç¤º p æ˜¯ä¸€ä¸ª put æ“ä½œ, è¦ä¹ˆè¡¨ç¤º p æ˜¯ä¸€ä¸ªè¿˜æ²¡åŒ¹é…æˆåŠŸçš„ take æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (item != p &amp;&amp; (item != <span class="keyword">null</span>) == isData) &#123; </span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰æ“ä½œå’Œ head æ“ä½œç›¸åŒï¼Œå°±æ²¡æœ‰åŒ¹é…ä¸Šï¼Œç»“æŸå¾ªç¯ï¼Œè¿›å…¥ä¸‹é¢çš„ if å—ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (isData == haveData)   <span class="comment">// can&#x27;t match</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// å¦‚æœæ“ä½œä¸åŒ,åŒ¹é…æˆåŠŸ, å°è¯•æ›¿æ¢ item æˆåŠŸ,</span></span><br><span class="line">                <span class="keyword">if</span> (p.casItem(item, e)) &#123; <span class="comment">// match</span></span><br><span class="line">                    <span class="comment">// æ›´æ–° head</span></span><br><span class="line">                    <span class="keyword">for</span> (Node q = p; q != h;) &#123;</span><br><span class="line">                        Node n = q.next;  <span class="comment">// update by 2 unless singleton</span></span><br><span class="line">                        <span class="keyword">if</span> (head == h &amp;&amp; casHead(h, n == <span class="keyword">null</span> ? q : n)) &#123;</span><br><span class="line">                            h.forgetNext();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;                 <span class="comment">// advance and retry</span></span><br><span class="line">                        <span class="keyword">if</span> ((h = head)   == <span class="keyword">null</span> ||</span><br><span class="line">                            (q = h.next) == <span class="keyword">null</span> || !q.isMatched())</span><br><span class="line">                            <span class="keyword">break</span>;        <span class="comment">// unless slack &lt; 2</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å”¤é†’åŸ head çº¿ç¨‹.</span></span><br><span class="line">                    LockSupport.unpark(p.waiter);</span><br><span class="line">                    <span class="keyword">return</span> LinkedTransferQueue.&lt;E&gt;cast(item);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰¾ä¸‹ä¸€ä¸ª</span></span><br><span class="line">            Node n = p.next;</span><br><span class="line">            p = (p != n) ? n : (h = head); <span class="comment">// Use head if p offlist</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœè¿™ä¸ªæ“ä½œä¸æ˜¯ç«‹åˆ»å°±è¿”å›çš„ç±»å‹    </span></span><br><span class="line">        <span class="keyword">if</span> (how != NOW) &#123;                 <span class="comment">// No matches available</span></span><br><span class="line">            <span class="comment">// ä¸”æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥è¿™é‡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (s == <span class="keyword">null</span>)</span><br><span class="line">                <span class="comment">// åˆ›å»ºä¸€ä¸ª node</span></span><br><span class="line">                s = <span class="keyword">new</span> Node(e, haveData);</span><br><span class="line">            <span class="comment">// å°è¯•å°† node è¿½åŠ å¯¹é˜Ÿåˆ—å°¾éƒ¨ï¼Œå¹¶è¿”å›ä»–çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class="line">            Node pred = tryAppend(s, haveData);</span><br><span class="line">            <span class="comment">// å¦‚æœè¿”å›çš„æ˜¯ null, è¡¨ç¤ºä¸èƒ½è¿½åŠ åˆ° tail èŠ‚ç‚¹,å› ä¸º tail èŠ‚ç‚¹çš„æ¨¡å¼å’Œå½“å‰æ¨¡å¼ç›¸å.</span></span><br><span class="line">            <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">                <span class="comment">// é‡æ¥</span></span><br><span class="line">                <span class="keyword">continue</span> retry;           <span class="comment">// lost race vs opposite mode</span></span><br><span class="line">            <span class="comment">// å¦‚æœä¸æ˜¯å¼‚æ­¥æ“ä½œ(å³ç«‹åˆ»è¿”å›ç»“æœ)</span></span><br><span class="line">            <span class="keyword">if</span> (how != ASYNC)</span><br><span class="line">                <span class="comment">// é˜»å¡ç­‰å¾…åŒ¹é…å€¼</span></span><br><span class="line">                <span class="keyword">return</span> awaitMatch(s, pred, e, (how == TIMED), nanos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e; <span class="comment">// not waiting</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€»è¾‘å¦‚ä¸‹:<br>
æ‰¾åˆ° <code>head</code> èŠ‚ç‚¹,å¦‚æœ <code>head</code> èŠ‚ç‚¹æ˜¯åŒ¹é…çš„æ“ä½œ,å°±ç›´æ¥èµ‹å€¼,å¦‚æœä¸æ˜¯,æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<p>â€‹				æ³¨æ„ï¼šé˜Ÿåˆ—ä¸­æ°¸è¿œåªæœ‰ä¸€ç§ç±»å‹çš„æ“ä½œ,è¦ä¹ˆæ˜¯ <code>put</code> ç±»å‹, è¦ä¹ˆæ˜¯ <code>take</code> ç±»å‹.</p>
<p><img src="https://gitee.com/CNRF/image/raw/master/img/20210223114320.png" alt="img"></p>
<p>ç›¸æ¯”è¾ƒ <code>SynchronousQueue</code> å¤šäº†ä¸€ä¸ªå¯ä»¥å­˜å‚¨çš„é˜Ÿåˆ—ï¼Œç›¸æ¯”è¾ƒ <code>LinkedBlockingQueue</code> å¤šäº†ç›´æ¥ä¼ é€’å…ƒç´ ï¼Œå°‘äº†ç”¨é”æ¥åŒæ­¥ã€‚</p>
<p>æ€§èƒ½æ›´é«˜ï¼Œç”¨å¤„æ›´å¤§</p>
<h4 id="1-6-2-æ€»ç»“">1.6.2  æ€»ç»“</h4>
<p><code>LinkedTransferQueue</code>æ˜¯ <code>SynchronousQueue</code> å’Œ <code>LinkedBlockingQueue</code> çš„åˆä½“ï¼Œæ€§èƒ½æ¯” <code>LinkedBlockingQueue</code> æ›´é«˜ï¼ˆæ²¡æœ‰é”æ“ä½œï¼‰ï¼Œæ¯” <code>SynchronousQueue</code>èƒ½å­˜å‚¨æ›´å¤šçš„å…ƒç´ ã€‚</p>
<p>å½“ <code>put</code> æ—¶ï¼Œå¦‚æœæœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå°±ç›´æ¥å°†å…ƒç´  â€œäº¤ç»™â€ ç­‰å¾…è€…ï¼Œ å¦åˆ™ç›´æ¥è¿›å…¥é˜Ÿåˆ—ã€‚</p>
<p><code>put</code>å’Œ <code>transfer</code> æ–¹æ³•çš„åŒºåˆ«æ˜¯ï¼Œput æ˜¯ç«‹å³è¿”å›çš„ï¼Œ transfer æ˜¯é˜»å¡ç­‰å¾…æ¶ˆè´¹è€…æ‹¿åˆ°æ•°æ®æ‰è¿”å›ã€‚<code>transfer</code>æ–¹æ³•å’Œ <code>SynchronousQueue</code>çš„ put æ–¹æ³•ç±»ä¼¼ã€‚</p>
<h2 id="éé˜»å¡é˜Ÿåˆ—">éé˜»å¡é˜Ÿåˆ—</h2>
<h3 id="Dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼Œä¸¤è¾¹éƒ½å¯ä»¥è¿›å‡ºï¼‰">Dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼Œä¸¤è¾¹éƒ½å¯ä»¥è¿›å‡ºï¼‰</h3>
<p>dequeå®¹å™¨ä¸ºä¸€ä¸ªç»™å®š<strong>ç±»å‹</strong>çš„å…ƒç´ è¿›è¡Œ<strong>çº¿æ€§å¤„ç†</strong>ï¼Œåƒå‘é‡ä¸€æ ·ï¼Œ<strong>èƒ½å¤Ÿå¿«é€Ÿåœ°éšæœºè®¿é—®ä»»ä¸€ä¸ªå…ƒç´ </strong>ï¼Œå¹¶ä¸”èƒ½å¤Ÿ<strong>é«˜æ•ˆåœ°æ’å…¥å’Œåˆ é™¤å®¹å™¨çš„å°¾éƒ¨å…ƒç´ </strong>ã€‚ä½†å®ƒåˆä¸vectorä¸åŒï¼Œ<strong>dequeæ”¯æŒé«˜æ•ˆæ’å…¥å’Œåˆ é™¤å®¹å™¨çš„å¤´éƒ¨å…ƒç´ </strong>ï¼Œå› æ­¤ä¹Ÿå«åš<strong>åŒç«¯é˜Ÿåˆ—</strong>ã€‚dequeç±»å¸¸ç”¨çš„å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">deque():åˆ›å»ºä¸€ä¸ªç©ºdeque</span><br><span class="line"></span><br><span class="line">deque(<span class="keyword">int</span> nSize):åˆ›å»ºä¸€ä¸ªdeque,å…ƒç´ ä¸ªæ•°ä¸ºnSize</span><br><span class="line"></span><br><span class="line">deque(<span class="keyword">int</span> nSize,<span class="keyword">const</span> T&amp; t):åˆ›å»ºä¸€ä¸ªdeque,å…ƒç´ ä¸ªæ•°ä¸ºnSize,ä¸”å€¼å‡ä¸ºt</span><br><span class="line"></span><br><span class="line">deque(<span class="keyword">const</span> deque &amp;):å¤åˆ¶æ„é€ å‡½æ•°</span><br><span class="line"></span><br><span class="line"><span class="comment">//  å¢åŠ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_front</span><span class="params">(<span class="keyword">const</span> T&amp; x)</span>:åŒç«¯é˜Ÿåˆ—å¤´éƒ¨å¢åŠ ä¸€ä¸ªå…ƒç´ X</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">const</span> T&amp; x)</span>:åŒç«¯é˜Ÿåˆ—å°¾éƒ¨å¢åŠ ä¸€ä¸ªå…ƒç´ x</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">iterator <span class="title">insert</span><span class="params">(iterator it,<span class="keyword">const</span> T&amp; x)</span>:åŒç«¯é˜Ÿåˆ—ä¸­æŸä¸€å…ƒç´ å‰å¢åŠ ä¸€ä¸ªå…ƒç´ x</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(iterator it,<span class="keyword">int</span> n,<span class="keyword">const</span> T&amp; x)</span>:åŒç«¯é˜Ÿåˆ—ä¸­æŸä¸€å…ƒç´ å‰å¢åŠ nä¸ªç›¸åŒçš„å…ƒç´ x</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(iterator it,const_iterator first,const_iteratorlast)</span>:åŒç«¯é˜Ÿåˆ—ä¸­æŸä¸€å…ƒç´ å‰æ’å…¥å¦ä¸€ä¸ªç›¸åŒç±»å‹å‘é‡çš„[forst,last)é—´çš„æ•°æ®</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// åˆ é™¤å‡½æ•°</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Iterator <span class="title">erase</span><span class="params">(iterator it)</span>:åˆ é™¤åŒç«¯é˜Ÿåˆ—ä¸­çš„æŸä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Iterator <span class="title">erase</span><span class="params">(iterator first,iterator last)</span>:åˆ é™¤åŒç«¯é˜Ÿåˆ—ä¸­[first,lastï¼‰ä¸­çš„å…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop_front</span><span class="params">()</span>:åˆ é™¤åŒç«¯é˜Ÿåˆ—ä¸­æœ€å‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop_back</span><span class="params">()</span>:åˆ é™¤åŒç«¯é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span>:åˆ é™¤æ‰€æœ‰çš„å…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// éå†å‡½æ•°</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">reference <span class="title">at</span><span class="params">(<span class="keyword">int</span> pos)</span>:è¿”å›posä½ç½®å…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">reference <span class="title">front</span><span class="params">()</span>:è¿”å›é¦–å…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">reference <span class="title">back</span><span class="params">()</span>:è¿”å›å°¾å…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">iterator <span class="title">begin</span><span class="params">()</span>:è¿”å›å‘é‡å¤´æŒ‡é’ˆï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">iterator <span class="title">end</span><span class="params">()</span>:è¿”å›æŒ‡å‘å‘é‡ä¸­æœ€åä¸€ä¸ªå…ƒç´ ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼ˆä¸åŒ…å«åœ¨å‘é‡ä¸­ï¼‰</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">reverse_iterator <span class="title">rbegin</span><span class="params">()</span>:åå‘è¿­ä»£å™¨ï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">reverse_iterator <span class="title">rend</span><span class="params">()</span>:åå‘è¿­ä»£å™¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// åˆ¤æ–­å‡½æ•°</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">bool <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span>:å‘é‡æ˜¯å¦ä¸ºç©ºï¼Œè‹¥<span class="keyword">true</span>,åˆ™å‘é‡ä¸­æ— å…ƒç´ </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// å¤§å°å‡½æ•°</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Int <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span>:è¿”å›å‘é‡ä¸­å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max_size</span><span class="params">()</span> <span class="keyword">const</span>:è¿”å›æœ€å¤§å¯å…è®¸çš„åŒç«¯å¯¹äº†å…ƒç´ æ•°é‡å€¼</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// å…¶ä»–å‡½æ•°</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(deque&amp;)</span>:äº¤æ¢ä¸¤ä¸ªåŒç±»å‹å‘é‡çš„æ•°æ®</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">assign</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">const</span> T&amp; x)</span>:å‘é‡ä¸­ç¬¬nä¸ªå…ƒç´ çš„å€¼è®¾ç½®ä¸ºx</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯¦ç»†åˆ†æ  <a href="https://blog.csdn.net/u011630575/article/details/79923132">https://blog.csdn.net/u011630575/article/details/79923132</a></p>
</blockquote>
<h3 id="ConcurrentLinkedQueue">ConcurrentLinkedQueue</h3>
<p>ConcurrentLinkedQueueæ˜¯ä¸€ä¸ªåŸºäº<strong>é“¾æ¥èŠ‚ç‚¹çš„æ— ç•Œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—</strong>ï¼Œå®ƒé‡‡ç”¨<strong>å…ˆè¿›å…ˆå‡ºçš„è§„åˆ™å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åº</strong>ï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå®ƒä¼šæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå½“æˆ‘ä»¬è·å–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ã€‚å®ƒé‡‡ç”¨äº†â€œwaitï¼freeâ€ç®—æ³•æ¥å®ç°</p>
<p>ConcurrentLinkedQueueç”±headèŠ‚ç‚¹å’ŒtailèŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ç”±èŠ‚ç‚¹å…ƒç´ ï¼ˆitemï¼‰å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨(next)ç»„æˆï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´å°±æ˜¯é€šè¿‡è¿™ä¸ªnextå…³è”èµ·æ¥ï¼Œä»è€Œç»„æˆä¸€å¼ é“¾è¡¨ç»“æ„çš„é˜Ÿåˆ—</p>
<p><strong>æ€»ç»“</strong></p>
<p>ConcurrentLinkedQueue çš„éé˜»å¡ç®—æ³•å®ç°å¯æ¦‚æ‹¬ä¸ºä¸‹é¢ 5 ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ CAS åŸå­æŒ‡ä»¤æ¥å¤„ç†å¯¹æ•°æ®çš„å¹¶å‘è®¿é—®ï¼Œè¿™æ˜¯éé˜»å¡ç®—æ³•å¾—ä»¥å®ç°çš„åŸºç¡€ã€‚</li>
<li>head/tail å¹¶éæ€»æ˜¯æŒ‡å‘é˜Ÿåˆ—çš„å¤´ / å°¾èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´å…è®¸é˜Ÿåˆ—å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚ è¿™ä¸ªç‰¹æ€§æŠŠå…¥é˜Ÿ / å‡ºé˜Ÿæ—¶ï¼ŒåŸæœ¬éœ€è¦ä¸€èµ·åŸå­åŒ–æ‰§è¡Œçš„ä¸¤ä¸ªæ­¥éª¤åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œç¼©å°äº†å…¥é˜Ÿ / å‡ºé˜Ÿæ—¶éœ€è¦åŸå­åŒ–æ›´æ–°å€¼çš„èŒƒå›´åˆ°å”¯ä¸€å˜é‡ã€‚è¿™æ˜¯éé˜»å¡ç®—æ³•å¾—ä»¥å®ç°çš„å…³é”®ã€‚</li>
<li>ç”±äºé˜Ÿåˆ—æœ‰æ—¶ä¼šå¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚ä¸ºæ­¤ï¼ŒConcurrentLinkedQueue ä½¿ç”¨<a href="https://www.ibm.com/developerworks/cn/java/j-lo-concurrent/index.html">ä¸‰ä¸ªä¸å˜å¼</a>æ¥ç»´æŠ¤éé˜»å¡ç®—æ³•çš„æ­£ç¡®æ€§ã€‚</li>
<li>ä»¥æ‰¹å¤„ç†æ–¹å¼æ¥æ›´æ–° head/tailï¼Œä»æ•´ä½“ä¸Šå‡å°‘å…¥é˜Ÿ / å‡ºé˜Ÿæ“ä½œçš„å¼€é”€ã€‚</li>
<li>ä¸ºäº†æœ‰åˆ©äºåƒåœ¾æ”¶é›†ï¼Œé˜Ÿåˆ—ä½¿ç”¨ç‰¹æœ‰çš„ head æ›´æ–°æœºåˆ¶ï¼›ä¸ºäº†ç¡®ä¿ä»å·²åˆ é™¤èŠ‚ç‚¹å‘åéå†ï¼Œå¯åˆ°è¾¾æ‰€æœ‰çš„éåˆ é™¤èŠ‚ç‚¹ï¼Œé˜Ÿåˆ—ä½¿ç”¨äº†ç‰¹æœ‰çš„å‘åæ¨è¿›ç­–ç•¥ã€‚</li>
</ul>
<blockquote>
<p>è¯¦ç»†åˆ†æ   <a href="https://blog.csdn.net/qq_38293564/article/details/80798310">https://blog.csdn.net/qq_38293564/article/details/80798310</a></p>
</blockquote>
<h3 id="priorityQueue">priorityQueue</h3>
<p>PriorityQueue ä¸€ä¸ªåŸºäºä¼˜å…ˆçº§çš„<strong>æ— ç•Œä¼˜å…ˆçº§é˜Ÿåˆ—</strong>ã€‚ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å…ƒç´ æŒ‰ç…§å…¶è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–è€…æ ¹æ®æ„é€ é˜Ÿåˆ—æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚è¯¥é˜Ÿåˆ—ä¸å…è®¸ä½¿ç”¨ null å…ƒç´ ä¹Ÿä¸å…è®¸æ’å…¥ä¸å¯æ¯”è¾ƒçš„å¯¹è±¡(æ²¡æœ‰å®ç°Comparableæ¥å£çš„å¯¹è±¡)ã€‚<br>
PriorityQueue é˜Ÿåˆ—çš„å¤´æŒ‡æ’åºè§„åˆ™æœ€å°é‚£å“¥å…ƒç´ ã€‚å¦‚æœå¤šä¸ªå…ƒç´ éƒ½æ˜¯æœ€å°å€¼åˆ™éšæœºé€‰ä¸€ä¸ªã€‚<br>
PriorityQueue æ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œä½†æ˜¯åˆå§‹çš„å®¹é‡(å®é™…æ˜¯ä¸€ä¸ªObject[])ï¼Œéšç€ä¸æ–­å‘ä¼˜å…ˆçº§é˜Ÿåˆ—æ·»åŠ å…ƒç´ ï¼Œå…¶å®¹é‡ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæ— éœ€æŒ‡å®šå®¹é‡å¢åŠ ç­–ç•¥çš„ç»†èŠ‚</p>
<ol>
<li>PriorityQueueæ˜¯ä¸€ç§æ— ç•Œçš„ï¼Œçº¿ç¨‹ä¸å®‰å…¨çš„é˜Ÿåˆ—</li>
<li>PriorityQueueæ˜¯ä¸€ç§é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œå¹¶æ‹¥æœ‰ä¼˜å…ˆçº§çš„é˜Ÿåˆ—</li>
<li>PriorityQueueå­˜å‚¨çš„å…ƒç´ è¦æ±‚å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„å¯¹è±¡ï¼Œ å¦‚æœä¸æ˜¯å°±å¿…é¡»æ˜ç¡®æŒ‡å®šæ¯”è¾ƒå™¨</li>
</ol>
<blockquote>
<p>è¯¦ç»†åˆ†æ    <a href="https://www.jianshu.com/p/f1fd9b82cb72">https://www.jianshu.com/p/f1fd9b82cb72</a></p>
</blockquote>
<h1>Map</h1>
<p>Mapç”¨äºä¿å­˜å…·æœ‰æ˜ å°„å…³ç³»çš„æ•°æ®ï¼ŒMapé›†åˆé‡Œä¿å­˜ç€ä¸¤ç»„å€¼ï¼Œä¸€ç»„ç”¨äºä¿å­˜Mapçš„leyï¼Œå¦ä¸€ç»„ä¿å­˜ç€Mapçš„value</p>
<p><strong>Mapä¸­çš„å¸¸ç”¨æ–¹æ³•</strong>ï¼š</p>
<ul>
<li><code>void clear()</code>:åˆ é™¤è¯¥Mapå¯¹è±¡ä¸­æ‰€æœ‰é”®å€¼å¯¹ï¼›</li>
<li><code>boolean containsKey(Object key)</code>:æŸ¥è¯¢Mapä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„keyå€¼ï¼›</li>
<li><code>boolean containsValue(Object value)</code>:æŸ¥è¯¢Mapä¸­æ˜¯å¦åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªvalue;</li>
<li><code>Set entrySet()</code>:è¿”å›mapä¸­åŒ…å«çš„é”®å€¼å¯¹æ‰€ç»„æˆçš„Seté›†åˆï¼Œæ¯ä¸ªé›†åˆéƒ½æ˜¯Map.Entryå¯¹è±¡ã€‚</li>
<li><code>Object get()</code>ï¼šè¿”å›æŒ‡å®škeyå¯¹åº”çš„valueï¼Œå¦‚æœä¸åŒ…å«keyåˆ™è¿”å›nullï¼›</li>
<li><code>boolean isEmpty()</code>:æŸ¥è¯¢è¯¥Mapæ˜¯å¦ä¸ºç©ºï¼›</li>
<li><code>Set keySet()</code>:è¿”å›Mapä¸­æ‰€æœ‰keyç»„æˆçš„é›†åˆï¼›</li>
<li><code>Collection values()</code>:è¿”å›è¯¥Mapé‡Œæ‰€æœ‰valueç»„æˆçš„Collectionã€‚</li>
<li><code>Object put(Object key,Object value)</code>:æ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœé›†åˆä¸­çš„keyé‡å¤ï¼Œåˆ™è¦†ç›–åŸæ¥çš„é”®å€¼å¯¹ï¼›</li>
<li><code>void putAll(Map m)</code>:å°†Mapä¸­çš„é”®å€¼å¯¹å¤åˆ¶åˆ°æœ¬Mapä¸­ï¼›</li>
<li><code>Object remove(Object key)</code>:åˆ é™¤æŒ‡å®šçš„keyå¯¹åº”çš„é”®å€¼å¯¹ï¼Œå¹¶è¿”å›è¢«åˆ é™¤é”®å€¼å¯¹çš„valueï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›nullï¼›</li>
<li><code>boolean remove(Object key,Object value)</code>:åˆ é™¤æŒ‡å®šé”®å€¼å¯¹ï¼Œåˆ é™¤æˆåŠŸè¿”å›trueï¼›</li>
<li><code>int size()</code>:è¿”å›è¯¥Mapé‡Œçš„é”®å€¼å¯¹ä¸ªæ•°</li>
</ul>
<p><strong>å†…éƒ¨ç±»Entry</strong></p>
<p>Mapä¸­åŒ…æ‹¬ä¸€ä¸ªå†…éƒ¨ç±»Entry,è¯¥ç±»å°è£…ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>Object getKey()</code>:è¿”å›è¯¥Entryé‡ŒåŒ…å«çš„keyå€¼ï¼›</li>
<li><code>Object getvalue()</code>:è¿”å›è¯¥Entryé‡ŒåŒ…å«çš„valueå€¼ï¼›</li>
<li><code>Object setValue(V value)</code>:è®¾ç½®è¯¥Entryé‡ŒåŒ…å«çš„valueå€¼ï¼Œå¹¶è®¾ç½®æ–°çš„valueå€¼ã€‚</li>
</ul>
<p><strong>Mapçš„éå†å››ç§æ–¹æ³•</strong></p>
<p>åœ¨javaä¸­æ‰€æœ‰çš„mapéƒ½å®ç°äº†Mapæ¥å£ï¼Œå› æ­¤æ‰€æœ‰çš„Mapï¼ˆå¦‚HashMap, TreeMap, LinkedHashMap, Hashtableç­‰ï¼‰éƒ½å¯ä»¥ç”¨ä»¥ä¸‹çš„æ–¹å¼å»éå†ã€‚</p>
<p>æ–¹æ³•ä¸€ï¼šåœ¨forå¾ªç¯ä¸­ä½¿ç”¨entrieså®ç°Mapçš„éå†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æœ€å¸¸è§ä¹Ÿæ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨çš„æœ€å¤šçš„ï¼Œä¸€èˆ¬åœ¨é”®å€¼å¯¹éƒ½éœ€è¦ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Map &lt;String,String&gt;map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">map.put(<span class="string">&quot;ç†Šå¤§&quot;</span>, <span class="string">&quot;æ£•è‰²&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;ç†ŠäºŒ&quot;</span>, <span class="string">&quot;é»„è‰²&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(Map.Entry&lt;String, String&gt; entry : map.entrySet())&#123;</span><br><span class="line">    String mapKey = entry.getKey();</span><br><span class="line">    String mapValue = entry.getValue();</span><br><span class="line">    System.out.println(mapKey+<span class="string">&quot;:&quot;</span>+mapValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•äºŒï¼šåœ¨forå¾ªç¯ä¸­éå†keyæˆ–è€…valuesï¼Œä¸€èˆ¬é€‚ç”¨äºåªéœ€è¦mapä¸­çš„keyæˆ–è€…valueæ—¶ä½¿ç”¨ï¼Œåœ¨æ€§èƒ½ä¸Šæ¯”ä½¿ç”¨entrySetè¾ƒå¥½ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map &lt;String,String&gt;map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">map.put(<span class="string">&quot;ç†Šå¤§&quot;</span>, <span class="string">&quot;æ£•è‰²&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;ç†ŠäºŒ&quot;</span>, <span class="string">&quot;é»„è‰²&quot;</span>);</span><br><span class="line"><span class="comment">//key</span></span><br><span class="line"><span class="keyword">for</span>(String key : map.keySet())&#123;</span><br><span class="line">    System.out.println(key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//value</span></span><br><span class="line"><span class="keyword">for</span>(String value : map.values())&#123;</span><br><span class="line">    System.out.println(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•ä¸‰ï¼šé€šè¿‡Iteratoréå†ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Iterator&lt;Entry&lt;String, String&gt;&gt; entries = map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span>(entries.hasNext())&#123;</span><br><span class="line">    Entry&lt;String, String&gt; entry = entries.next();</span><br><span class="line">    String key = entry.getKey();</span><br><span class="line">    String value = entry.getValue();</span><br><span class="line">    System.out.println(key+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•å››ï¼šé€šè¿‡é”®æ‰¾å€¼éå†ï¼Œè¿™ç§æ–¹å¼çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œå› ä¸ºæœ¬èº«ä»é”®å–å€¼æ˜¯è€—æ—¶çš„æ“ä½œï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(String key : map.keySet())&#123;</span><br><span class="line">    String value = map.get(key);</span><br><span class="line">    System.out.println(key+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="HashTableå’ŒHashMap">HashTableå’ŒHashMap</h2>
<h3 id="HashMapçš„å·¥ä½œåŸç†">HashMapçš„å·¥ä½œåŸç†</h3>
<p>HashMapåŸºäºhashingåŸç†ï¼Œæˆ‘ä»¬é€šè¿‡put()å’Œget()æ–¹æ³•å‚¨å­˜å’Œè·å–å¯¹è±¡ã€‚å½“æˆ‘ä»¬å°†é”®å€¼å¯¹ä¼ é€’ç»™put()æ–¹æ³•æ—¶ï¼Œå®ƒè°ƒç”¨é”®å¯¹è±¡çš„hashCode()æ–¹æ³•æ¥è®¡ç®—hashcodeï¼Œè®©åæ‰¾åˆ°bucketä½ç½®æ¥å‚¨å­˜å€¼å¯¹è±¡ã€‚å½“è·å–å¯¹è±¡æ—¶ï¼Œé€šè¿‡é”®å¯¹è±¡çš„equals()æ–¹æ³•æ‰¾åˆ°æ­£ç¡®çš„é”®å€¼å¯¹ï¼Œç„¶åè¿”å›å€¼å¯¹è±¡ã€‚HashMapä½¿ç”¨é“¾è¡¨æ¥è§£å†³ç¢°æ’é—®é¢˜ï¼Œå½“å‘ç”Ÿç¢°æ’äº†ï¼Œå¯¹è±¡å°†ä¼šå‚¨å­˜åœ¨é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚ HashMapåœ¨æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­å‚¨å­˜é”®å€¼å¯¹å¯¹è±¡ã€‚<strong>HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnull</strong>ï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnull</p>
<p>å½“ä¸¤ä¸ªä¸åŒçš„é”®å¯¹è±¡çš„hashcodeç›¸åŒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å®ƒä»¬ä¼šå‚¨å­˜åœ¨åŒä¸€ä¸ªbucketä½ç½®çš„é“¾è¡¨ä¸­ã€‚é”®å¯¹è±¡çš„equals()æ–¹æ³•ç”¨æ¥æ‰¾åˆ°é”®å€¼å¯¹ã€‚</p>
<h3 id="HashMapå’ŒHashtableçš„åŒºåˆ«">HashMapå’ŒHashtableçš„åŒºåˆ«</h3>
<p>HashMapå’ŒHashtableéƒ½å®ç°äº†Mapæ¥å£ï¼Œä½†å†³å®šç”¨å“ªä¸€ä¸ªä¹‹å‰å…ˆè¦å¼„æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„åˆ†åˆ«ã€‚ä¸»è¦çš„åŒºåˆ«æœ‰ï¼šçº¿ç¨‹å®‰å…¨æ€§ï¼ŒåŒæ­¥(synchronization)ï¼Œä»¥åŠé€Ÿåº¦ã€‚</p>
<ol>
<li>HashMapå‡ ä¹å¯ä»¥ç­‰ä»·äºHashtableï¼Œé™¤äº†<strong>HashMapæ˜¯ésynchronizedçš„ï¼Œå¹¶å¯ä»¥æ¥å—null</strong>(HashMapå¯ä»¥æ¥å—ä¸ºnullçš„é”®å€¼(key)å’Œå€¼(value)ï¼Œè€Œ<strong>Hashtableä¸èƒ½æ¥å—nullçš„key</strong>)ã€‚</li>
<li>HashMapæ˜¯ésynchronizedï¼Œè€ŒHashtableæ˜¯synchronizedï¼Œè¿™æ„å‘³ç€<strong>Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªHashtableï¼›è€Œå¦‚æœæ²¡æœ‰æ­£ç¡®çš„åŒæ­¥çš„è¯ï¼Œ<strong>HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚Java 5æä¾›äº†<strong>ConcurrentHashMap</strong>ï¼Œ<strong>å®ƒæ˜¯HashTableçš„æ›¿ä»£</strong>ï¼Œæ¯”HashTableçš„æ‰©å±•æ€§æ›´å¥½ã€‚</li>
<li>å¦ä¸€ä¸ªåŒºåˆ«æ˜¯<strong>HashMapçš„è¿­ä»£å™¨(Iterator)æ˜¯fail-fastè¿­ä»£å™¨</strong>ï¼Œè€ŒHashtableçš„enumeratorè¿­ä»£å™¨ä¸æ˜¯fail-fastçš„ã€‚æ‰€ä»¥å½“æœ‰å…¶å®ƒçº¿ç¨‹æ”¹å˜äº†HashMapçš„ç»“æ„ï¼ˆå¢åŠ æˆ–è€…ç§»é™¤å…ƒç´ ï¼‰ï¼Œå°†ä¼šæŠ›å‡ºConcurrentModificationExceptionï¼Œä½†è¿­ä»£å™¨æœ¬èº«çš„remove()æ–¹æ³•ç§»é™¤å…ƒç´ åˆ™ä¸ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸€å®šå‘ç”Ÿçš„è¡Œä¸ºï¼Œè¦çœ‹JVMã€‚è¿™æ¡åŒæ ·ä¹Ÿæ˜¯Enumerationå’ŒIteratorçš„åŒºåˆ«ã€‚</li>
<li>ç”±äºHashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹Ÿæ˜¯synchronizedï¼Œæ‰€ä»¥åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹å®ƒæ¯”HashMapè¦æ…¢ã€‚å¦‚æœä½ ä¸éœ€è¦åŒæ­¥ï¼Œåªéœ€è¦å•ä¸€çº¿ç¨‹ï¼Œé‚£ä¹ˆä½¿ç”¨HashMapæ€§èƒ½è¦å¥½è¿‡Hashtableã€‚</li>
<li>HashMapä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§»Mapä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚</li>
</ol>
<h3 id="è§£å†³Hsahå†²çªçš„æ–¹æ³•">è§£å†³Hsahå†²çªçš„æ–¹æ³•</h3>
<p>HashMapå°±æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨çš„ã€‚å“ˆå¸Œè¡¨ä¸ºè§£å†³å†²çªï¼Œå¯ä»¥é‡‡ç”¨<strong>å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•</strong>ç­‰æ¥è§£å†³é—®é¢˜ï¼ŒJavaä¸­HashMapé‡‡ç”¨äº†<strong>é“¾åœ°å€æ³•</strong></p>
<p><a href="https://zhuanlan.zhihu.com/p/21673805">https://zhuanlan.zhihu.com/p/21673805</a></p>
<p>HashMapå°±æ˜¯ä½¿ç”¨<strong>å“ˆå¸Œè¡¨æ¥å­˜å‚¨</strong>çš„ã€‚å“ˆå¸Œè¡¨ä¸ºè§£å†³å†²çªï¼Œå¯ä»¥é‡‡ç”¨å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•ç­‰æ¥è§£å†³é—®é¢˜ï¼Œ<strong>Javaä¸­HashMapé‡‡ç”¨äº†é“¾åœ°å€æ³•</strong>ã€‚é“¾åœ°å€æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ•°ç»„åŠ é“¾è¡¨çš„ç»“åˆã€‚åœ¨æ¯ä¸ªæ•°ç»„å…ƒç´ ä¸Šéƒ½ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå½“æ•°æ®è¢«Hashåï¼Œå¾—åˆ°æ•°ç»„ä¸‹æ ‡ï¼ŒæŠŠæ•°æ®æ”¾åœ¨å¯¹åº”ä¸‹æ ‡å…ƒç´ çš„é“¾è¡¨ä¸Š</p>
<p>ä¾‹å¦‚ç¨‹åºæ‰§è¡Œä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">map.put(&quot;ç¾å›¢&quot;,&quot;å°ç¾&quot;);</span><br></pre></td></tr></table></figure>
<p>ç³»ç»Ÿå°†è°ƒç”¨&quot;ç¾å›¢&quot;è¿™ä¸ªkeyçš„hashCode()æ–¹æ³•å¾—åˆ°å…¶<strong>hashCode</strong> å€¼ï¼ˆè¯¥æ–¹æ³•é€‚ç”¨äºæ¯ä¸ªJavaå¯¹è±¡ï¼‰ï¼Œç„¶åå†<strong>é€šè¿‡Hashç®—æ³•çš„åä¸¤æ­¥è¿ç®—ï¼ˆé«˜ä½è¿ç®—å’Œå–æ¨¡è¿ç®—ï¼Œä¸‹æ–‡æœ‰ä»‹ç»ï¼‰æ¥å®šä½è¯¥é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®ï¼Œæœ‰æ—¶ä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†Hashç¢°æ’</strong>ã€‚å½“ç„¶Hashç®—æ³•è®¡ç®—ç»“æœè¶Šåˆ†æ•£å‡åŒ€ï¼ŒHashç¢°æ’çš„æ¦‚ç‡å°±è¶Šå°ï¼Œmapçš„å­˜å–æ•ˆç‡å°±ä¼šè¶Šé«˜ã€‚</p>
<p>å¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºç°è¾ƒå¤šç¢°æ’ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®å°±æ˜¯åœ¨æ ¹æ®å®é™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘Hashç¢°æ’ã€‚é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æ§åˆ¶mapä½¿å¾—Hashç¢°æ’çš„æ¦‚ç‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„Hashç®—æ³•å’Œæ‰©å®¹æœºåˆ¶ã€‚</p>
<h3 id="HashMapçš„æ‰©å®¹">HashMapçš„æ‰©å®¹</h3>
<p><a href="https://zhuanlan.zhihu.com/p/92481037">https://zhuanlan.zhihu.com/p/92481037</a></p>
<p>åˆå§‹åŒ–å¤§å°ä¸º16ï¼Œæ‰©å±•å› å­ä¸º0.75ï¼ˆæ³Šæ¾åˆ†å¸ƒï¼‰</p>
<h3 id="LinkHashMap">LinkHashMap</h3>
<p>LinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚ï¼ˆè½¬listçš„æ—¶å€™å¯ä»¥æŒ‰ç…§é¡ºåºè½¬åŒ–ï¼‰</p>
<h3 id="ConcurrentHashMap">ConcurrentHashMap</h3>
<p><a href="https://zhuanlan.zhihu.com/p/35668936">https://zhuanlan.zhihu.com/p/35668936</a></p>
<h2 id="TreeMap">TreeMap</h2>
<p><a href="https://zhuanlan.zhihu.com/p/35598760">https://zhuanlan.zhihu.com/p/35598760</a></p>
<h2 id="ConcurrentSkipListMap">ConcurrentSkipListMap</h2>
<p><a href="https://zhuanlan.zhihu.com/p/138021927">https://zhuanlan.zhihu.com/p/138021927</a></p>
<h2 id="WeakHashMap">WeakHashMap</h2>
<p><a href="https://zhuanlan.zhihu.com/p/24887482">https://zhuanlan.zhihu.com/p/24887482</a></p>
<h2 id="IdentityHashMap">IdentityHashMap</h2>
<p><a href="https://zhuanlan.zhihu.com/p/125093062">https://zhuanlan.zhihu.com/p/125093062</a></p>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹å’Œé«˜å¹¶å‘</tag>
      </tags>
  </entry>
</search>
